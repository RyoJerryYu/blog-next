<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width, initial-scale=1" data-next-head=""/><meta property="og:image" content="https://ryojerryyu.github.io/blog-next/img/home-bg-kasumi-hanabi.jpg" data-next-head=""/><meta name="twitter:image" content="https://ryojerryyu.github.io/blog-next/img/home-bg-kasumi-hanabi.jpg" data-next-head=""/><meta property="og:url" content="https://blog.ryo-okami.xyz/learn_from_ai/pytorch-model-save-and-load" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@ryo_okami" data-next-head=""/><meta name="twitter:creator" content="@ryo_okami" data-next-head=""/><link rel="icon" href="/blog-next/favicon.ico" data-next-head=""/><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" data-next-head=""/><title data-next-head="">PyTorch 模型的保存与加载机制详解 | Ryo&#x27;s Blog</title><meta property="og:title" content="PyTorch 模型的保存与加载机制详解" data-next-head=""/><meta property="og:site_name" content="Ryo&#x27;s Blog" data-next-head=""/><meta name="twitter:title" content="PyTorch 模型的保存与加载机制详解 | Ryo&#x27;s Blog" data-next-head=""/><meta name="description" content="&gt; 本文为与 DeepSeek 对话记录，深入探讨 PyTorch 中模型的保存和加载机制，包括不同的保存方式、最佳实践以及常见问题的解决方案。
&gt; [!reasoning]-
&gt;" data-next-head=""/><meta property="og:description" content="&gt; 本文为与 DeepSeek 对话记录，深入探讨 PyTorch 中模型的保存和加载机制，包括不同的保存方式、最佳实践以及常见问题的解决方案。
&gt; [!reasoning]-
&gt;" data-next-head=""/><meta name="twitter:description" content="&gt; 本文为与 DeepSeek 对话记录，深入探讨 PyTorch 中模型的保存和加载机制，包括不同的保存方式、最佳实践以及常见问题的解决方案。
&gt; [!reasoning]-
&gt;" data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="article:published_time" content="2025-03-07T13:00:00.000Z" data-next-head=""/><meta property="article:modified_time" content="2025-03-07T13:00:00.000Z" data-next-head=""/><meta property="article:tag" content="Deep Learning" data-next-head=""/><meta property="article:tag" content="PyTorch" data-next-head=""/><meta property="article:tag" content="Model Management" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png"/><link rel="manifest" href="/site.webmanifest"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/blog-next/_next/static/css/8bc897d2815c155b.css" as="style"/><link rel="preload" href="/blog-next/_next/static/css/1fe12698870890cf.css" as="style"/><link rel="stylesheet" href="/blog-next/_next/static/css/8bc897d2815c155b.css" data-n-g=""/><link rel="stylesheet" href="/blog-next/_next/static/css/1fe12698870890cf.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/blog-next/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/blog-next/_next/static/chunks/webpack-0838eb7d41561e24.js" defer=""></script><script src="/blog-next/_next/static/chunks/framework-d33e0fe36067854f.js" defer=""></script><script src="/blog-next/_next/static/chunks/main-dea36a7529be985a.js" defer=""></script><script src="/blog-next/_next/static/chunks/pages/_app-0fb7c4bae3c90fb5.js" defer=""></script><script src="/blog-next/_next/static/chunks/6d2b60a9-09feccc7018ac291.js" defer=""></script><script src="/blog-next/_next/static/chunks/52d06cd5-4b5b522181081dc4.js" defer=""></script><script src="/blog-next/_next/static/chunks/5342-0e842ae0467f6356.js" defer=""></script><script src="/blog-next/_next/static/chunks/4587-c57308f349adb436.js" defer=""></script><script src="/blog-next/_next/static/chunks/878-eed54f05f61d9289.js" defer=""></script><script src="/blog-next/_next/static/chunks/8315-ca0cea8fcd39047d.js" defer=""></script><script src="/blog-next/_next/static/chunks/9474-5c91fbd5a8098aa7.js" defer=""></script><script src="/blog-next/_next/static/chunks/pages/learn_from_ai/%5Bslug%5D-60c5be3e9c114dc0.js" defer=""></script><script src="/blog-next/_next/static/deaNyTD2T14Ep6qDNMnTd/_buildManifest.js" defer=""></script><script src="/blog-next/_next/static/deaNyTD2T14Ep6qDNMnTd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css czlpqi">.css-czlpqi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;--AppBar-background:#1976d2;--AppBar-color:#fff;background-color:var(--AppBar-background);color:var(--AppBar-color);background-color:rgba(15, 23, 42, 0.75);}@media print{.css-czlpqi{position:absolute;}}</style><style data-emotion="css 1cmpeoq">.css-1cmpeoq{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:var(--Paper-shadow);background-image:var(--Paper-overlay);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;--AppBar-background:#1976d2;--AppBar-color:#fff;background-color:var(--AppBar-background);color:var(--AppBar-color);background-color:rgba(15, 23, 42, 0.75);}@media print{.css-1cmpeoq{position:absolute;}}</style><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionFixed mui-fixed css-1cmpeoq" style="--Paper-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12)"><style data-emotion="css awgou1">.css-awgou1{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.css-awgou1{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-awgou1{min-height:48px;}}}@media (min-width:600px){.css-awgou1{min-height:64px;}}</style><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-awgou1"><style data-emotion="css 1guk29">@media (min-width:0px){.css-1guk29{display:none;}}@media (min-width:900px){.css-1guk29{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="ml-2 w-24 mr-4 MuiBox-root css-1guk29"><a class="DefaultLayout_textlink__W55gl" href="/blog-next">Ryo&#x27;s Blog</a></div><style data-emotion="css 1m04nb5">@media (min-width:0px){.css-1m04nb5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}@media (min-width:900px){.css-1m04nb5{display:none;}}</style><div class="ml-2 mr-4 MuiBox-root css-1m04nb5"><a title="Ryo&#x27;s Blog" href="/blog-next"><style data-emotion="css q7mezt">.css-q7mezt{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium h-6 w-6 text-gray-300 hover:text-white css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg></a></div><style data-emotion="css nznm6s">.css-nznm6s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="MuiBox-root css-nznm6s"><div class="DefaultLayoutMenu bg-transparent min-w-full"><ul class="rc-menu-overflow rc-menu rc-menu-root rc-menu-horizontal" role="menu" tabindex="0" data-menu-list="true"><li class="rc-menu-overflow-item rc-menu-item" style="opacity:1;order:0" role="menuitem" tabindex="-1"><a class="DefaultLayout_textlink__W55gl" href="/blog-next/articles">Articles</a></li><li class="rc-menu-overflow-item rc-menu-item" style="opacity:1;order:1" role="menuitem" tabindex="-1"><a class="DefaultLayout_textlink__W55gl" href="/blog-next/learn_from_ai">Learn from AI</a></li><li class="rc-menu-overflow-item rc-menu-item" style="opacity:1;order:2" role="menuitem" tabindex="-1"><a class="DefaultLayout_textlink__W55gl" href="/blog-next/tags">Tags</a></li><li class="rc-menu-overflow-item rc-menu-submenu rc-menu-submenu-horizontal" style="opacity:1;order:3" role="none"><div role="menuitem" class="rc-menu-submenu-title" tabindex="-1" aria-expanded="false" aria-haspopup="true"><span class="DefaultLayout_textlink__W55gl">More</span><i class="rc-menu-submenu-arrow"></i></div></li><li class="rc-menu-overflow-item rc-menu-overflow-item-rest rc-menu-submenu rc-menu-submenu-horizontal" style="opacity:0;height:0;overflow-y:hidden;order:9007199254740991;pointer-events:none;position:absolute" aria-hidden="true" role="none"><div role="menuitem" class="rc-menu-submenu-title" tabindex="-1" title="..." aria-expanded="false" aria-haspopup="true">...<i class="rc-menu-submenu-arrow"></i></div></li></ul><div style="display:none" aria-hidden="true"></div></div></div><style data-emotion="css k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="MuiBox-root css-k008qs"><a title="Twitter" href="https://twitter.com/ryo_okami"><svg class="h-6 w-6 fill-gray-300 hover:fill-white mx-1 sm:mx-2" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a title="GitHub" href="https://github.com/RyoJerryYu"><svg class="h-6 w-6 fill-gray-300 hover:fill-white mx-1 sm:mx-2" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a title="Pixiv" href="https://www.pixiv.net/users/9159893"><svg class="h-6 w-6 fill-gray-300 hover:fill-white mx-1 sm:mx-2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4.935 0A4.924 4.924 0 0 0 0 4.935v14.13A4.924 4.924 0 0 0 4.935 24h14.13A4.924 4.924 0 0 0 24 19.065V4.935A4.924 4.924 0 0 0 19.065 0zm7.81 4.547c2.181 0 4.058.676 5.399 1.847a6.118 6.118 0 0 1 2.116 4.66c.005 1.854-.88 3.476-2.257 4.563-1.375 1.092-3.225 1.697-5.258 1.697-2.314 0-4.46-.842-4.46-.842v2.718c.397.116 1.048.365.635.779H5.79c-.41-.41.19-.65.644-.779V7.666c-1.053.81-1.593 1.51-1.868 2.031.32 1.02-.284.969-.284.969l-1.09-1.73s3.868-4.39 9.553-4.39zm-.19.971c-1.423-.003-3.184.473-4.27 1.244v8.646c.988.487 2.484.832 4.26.832h.01c1.596 0 2.98-.593 3.93-1.533.952-.948 1.486-2.183 1.492-3.683-.005-1.54-.504-2.864-1.42-3.86-.918-.992-2.274-1.645-4.002-1.646Z"></path></svg></a></div></div></header><style data-emotion="css awgou1">.css-awgou1{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.css-awgou1{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-awgou1{min-height:48px;}}}@media (min-width:600px){.css-awgou1{min-height:64px;}}</style><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-awgou1"></div><style data-emotion="css vktxal">.css-vktxal{--Grid-columns:12;--Grid-columnSpacing:0px;--Grid-rowSpacing:0px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;min-width:0;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:var(--Grid-rowSpacing) var(--Grid-columnSpacing);width:100%;max-width:80rem;margin-left:auto;margin-right:auto;padding:0.5rem;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}.css-vktxal >*{--Grid-parent-columns:12;}.css-vktxal >*{--Grid-parent-columnSpacing:0px;}.css-vktxal >*{--Grid-parent-rowSpacing:0px;}</style><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-row css-vktxal"><style data-emotion="css 9gdssj">.css-9gdssj{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 0 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 0) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:900px){.css-9gdssj{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 0 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 0) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:1200px){.css-9gdssj{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 2 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 2) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}</style><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-0 MuiGrid-grid-md-0 MuiGrid-grid-lg-2 css-9gdssj"></div><style data-emotion="css 9h67uz">.css-9h67uz{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 12 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 12) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:900px){.css-9h67uz{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 9 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 9) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:1200px){.css-9h67uz{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 8 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 8) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}</style><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-12 MuiGrid-grid-md-9 MuiGrid-grid-lg-8 css-9h67uz"><div class="DefaultLayout_contentHeight__RDRZE"><article class="Post_post__acRqJ"><h1 class="Post_postTitle__N1NIA">PyTorch 模型的保存与加载机制详解</h1><div class="Post_postDate__SQx7A"><time dateTime="2025-03-07T13:00:00.000Z">2025-03-07</time></div><div class="TagsBox_tagsBox__WzhAf mt-2"><a class="tag-word TagsBox_tag__Rk32C" href="/blog-next/tags/deep-learning">#<!-- -->Deep Learning</a><a class="tag-word TagsBox_tag__Rk32C" href="/blog-next/tags/pytorch">#<!-- -->PyTorch</a><a class="tag-word TagsBox_tag__Rk32C" href="/blog-next/tags/model-management">#<!-- -->Model Management</a></div><div class="post-body Post_postContent__mJ_Ju"><blockquote>
<p>本文为与 DeepSeek 对话记录，深入探讨 PyTorch 中模型的保存和加载机制，包括不同的保存方式、最佳实践以及常见问题的解决方案。</p>
</blockquote>
<h2 id="q-pytorch-中所谓的保存模型加载模型指的是保存加载什么是-state_dict-吗"><a href="#q-pytorch-中所谓的保存模型加载模型指的是保存加载什么是-state_dict-吗">Q: PyTorch 中所谓的保存模型/加载模型，指的是保存/加载什么？是 state_dict 吗？</a></h2>
<div class="rounded-md p-2 my-4 bg-sky-100"><div class="text-base font-bold text-sky-500 cursor-pointer"><style data-emotion="css q7mezt">.css-q7mezt{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="m15.82 7.22-1 .4c-.21-.16-.43-.29-.67-.39L14 6.17c-.02-.1-.1-.17-.2-.17h-1.6c-.1 0-.18.07-.19.17l-.15 1.06c-.24.1-.47.23-.67.39l-1-.4c-.09-.03-.2 0-.24.09l-.8 1.38c-.05.09-.03.2.05.26l.85.66c-.03.12-.05.26-.05.39q0 .195.03.39l-.84.66c-.08.06-.1.17-.05.25l.8 1.39c.05.09.15.12.25.09l.99-.4c.21.16.43.29.68.39l.14 1.06c.02.1.1.17.2.17h1.6c.1 0 .18-.07.2-.17l.15-1.06c.24-.1.47-.23.67-.39l.99.4c.09.04.2 0 .24-.09l.8-1.39c.05-.09.03-.19-.05-.25l-.83-.66q.03-.195.03-.39 0-.21-.03-.39l.85-.66c.08-.06.1-.17.05-.26l-.8-1.38c-.05-.09-.16-.12-.25-.09M13 11.43c-.79 0-1.43-.64-1.43-1.43s.64-1.43 1.43-1.43 1.43.64 1.43 1.43-.64 1.43-1.43 1.43"></path><path d="M19.94 9.06c-.43-3.27-3.23-5.86-6.53-6.05C13.27 3 13.14 3 13 3 9.47 3 6.57 5.61 6.08 9l-1.93 3.48c-.41.66.07 1.52.85 1.52h1v2c0 1.1.9 2 2 2h1v3h7v-4.68c2.62-1.25 4.35-4.08 3.94-7.26m-5.05 5.57-.89.42V19h-3v-3H8v-4H6.7l1.33-2.33C8.21 7.06 10.35 5 13 5c2.76 0 5 2.24 5 5 0 2.09-1.29 3.88-3.11 4.63"></path></svg> <!-- -->Reasoning<!-- --> <svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"></path></svg></div></div>
<p>在 PyTorch 中，保存和加载模型的<strong>核心是 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span></strong>，但具体操作可以灵活选择。以下是详细说明：</p>
<hr/>
<h3 id="1-state_dict-是什么"><a href="#1-state_dict-是什么">1. <strong><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 是什么？</strong></a></h3>
<ul>
<li><strong><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span></strong> 是一个 Python 字典对象，它将模型的每一层（如卷积层、全连接层等）映射到对应的参数张量（权重和偏置）。</li>
<li>例如，一个简单的神经网络可能包含：<!-- -->
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">model.state_dict() </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> {</span></span>
<span data-line=""><span style="color:#A9B2C3">    &#x27;</span><span style="color:#98C379">conv1.weight</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">: tensor(</span><span style="color:#56B6C2">...</span><span style="color:#A9B2C3">),</span></span>
<span data-line=""><span style="color:#A9B2C3">    &#x27;</span><span style="color:#98C379">conv1.bias</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">: tensor(</span><span style="color:#56B6C2">...</span><span style="color:#A9B2C3">),</span></span>
<span data-line=""><span style="color:#A9B2C3">    &#x27;</span><span style="color:#98C379">fc1.weight</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">: tensor(</span><span style="color:#56B6C2">...</span><span style="color:#A9B2C3">),</span></span>
<span data-line=""><span style="color:#A9B2C3">    &#x27;</span><span style="color:#98C379">fc1.bias</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">: tensor(</span><span style="color:#56B6C2">...</span><span style="color:#A9B2C3">),</span></span>
<span data-line=""><span style="color:#56B6C2">    ...</span></span>
<span data-line=""><span style="color:#A9B2C3">}</span></span></code></pre></figure>
</li>
<li><strong>优化器</strong>（如 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>torch.optim.SGD</span></span></code></span>）也有自己的 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span>，保存优化器的状态（如动量缓冲等）。</li>
</ul>
<hr/>
<h3 id="2-保存模型的两种方式"><a href="#2-保存模型的两种方式">2. <strong>保存模型的两种方式</strong></a></h3>
<h4 id="方式-1仅保存-state_dict推荐"><a href="#方式-1仅保存-state_dict推荐"><strong>方式 1：仅保存 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span>（推荐）</strong></a></h4>
<ul>
<li><strong>代码示例</strong>：<!-- -->
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">torch.save(model.state_dict(), </span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">model_weights.pth</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">)</span></span></code></pre></figure>
</li>
<li><strong>优点</strong>：<!-- -->
<ul>
<li>文件体积小，只保存参数，不保存模型结构。</li>
<li>加载灵活：需先实例化模型结构，再加载参数。</li>
<li>避免因代码变更（如类名修改）导致的加载失败。</li>
</ul>
</li>
</ul>
<h4 id="方式-2保存整个模型不推荐"><a href="#方式-2保存整个模型不推荐"><strong>方式 2：保存整个模型（不推荐）</strong></a></h4>
<ul>
<li><strong>代码示例</strong>：<!-- -->
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">torch.save(model, </span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">entire_model.pth</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">)</span></span></code></pre></figure>
</li>
<li><strong>缺点</strong>：<!-- -->
<ul>
<li>文件体积大，包含模型结构和参数。</li>
<li>依赖原始代码环境（模型类的定义必须存在），否则加载时会报错。</li>
</ul>
</li>
</ul>
<hr/>
<h3 id="3-加载模型的对应方法"><a href="#3-加载模型的对应方法">3. <strong>加载模型的对应方法</strong></a></h3>
<h4 id="加载-state_dict需先构建模型结构"><a href="#加载-state_dict需先构建模型结构"><strong>加载 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span>（需先构建模型结构）</strong></a></h4>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">model </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> MyModelClass()  </span><span style="color:#5F6672;font-style:italic"># 必须与保存时的模型结构一致</span></span>
<span data-line=""><span style="color:#A9B2C3">model.load_state_dict(torch.load(</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">model_weights.pth</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">))</span></span>
<span data-line=""><span style="color:#A9B2C3">model.eval()  </span><span style="color:#5F6672;font-style:italic"># 切换到推理模式（关闭 dropout 等）</span></span></code></pre></figure>
<h4 id="加载整个模型直接使用"><a href="#加载整个模型直接使用"><strong>加载整个模型（直接使用）</strong></a></h4>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">model </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> torch.load(</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">entire_model.pth</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">)</span></span>
<span data-line=""><span style="color:#A9B2C3">model.eval()</span></span></code></pre></figure>
<hr/>
<h3 id="4-实际场景中的最佳实践"><a href="#4-实际场景中的最佳实践">4. <strong>实际场景中的最佳实践</strong></a></h3>
<ul>
<li>
<p><strong>保存训练检查点（Checkpoint）</strong>：
通常需要保存 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 之外的信息（如优化器状态、训练步数等）：</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">checkpoint </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> {</span></span>
<span data-line=""><span style="color:#A9B2C3">    &#x27;</span><span style="color:#98C379">model_state_dict</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">: model.state_dict(),</span></span>
<span data-line=""><span style="color:#A9B2C3">    &#x27;</span><span style="color:#98C379">optimizer_state_dict</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">: optimizer.state_dict(),</span></span>
<span data-line=""><span style="color:#A9B2C3">    &#x27;</span><span style="color:#98C379">epoch</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">: </span><span style="color:#56B6C2">100</span><span style="color:#A9B2C3">,</span></span>
<span data-line=""><span style="color:#A9B2C3">    &#x27;</span><span style="color:#98C379">loss</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">: loss,</span></span>
<span data-line=""><span style="color:#A9B2C3">}</span></span>
<span data-line=""><span style="color:#A9B2C3">torch.save(checkpoint, </span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">checkpoint.pth</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">)</span></span></code></pre></figure>
</li>
<li>
<p><strong>加载检查点</strong>：</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">checkpoint </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> torch.load(</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">checkpoint.pth</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">)</span></span>
<span data-line=""><span style="color:#A9B2C3">model.load_state_dict(checkpoint[</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">model_state_dict</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">])</span></span>
<span data-line=""><span style="color:#A9B2C3">optimizer.load_state_dict(checkpoint[</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">optimizer_state_dict</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">])</span></span>
<span data-line=""><span style="color:#A9B2C3">epoch </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> checkpoint[</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">epoch</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">]</span></span></code></pre></figure>
</li>
</ul>
<hr/>
<h3 id="5-关键总结"><a href="#5-关键总结">5. <strong>关键总结</strong></a></h3>
<ul>
<li><strong>保存模型</strong>：本质是保存模型的 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span>（推荐），但也可以保存整个模型。</li>
<li><strong>加载模型</strong>：<!-- -->
<ul>
<li>若保存的是 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span>，需先实例化模型结构，再加载参数。</li>
<li>若保存的是整个模型，直接加载但需保证代码兼容性。</li>
</ul>
</li>
<li><strong>灵活性</strong>：使用 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 更安全、更灵活，适合跨项目或模型结构可能变化的场景。</li>
</ul>
<h2 id="q-model-的-config-又是什么东西是超参吗"><a href="#q-model-的-config-又是什么东西是超参吗">Q: model 的 config 又是什么东西？是超参吗？</a></h2>
<div class="rounded-md p-2 my-4 bg-sky-100"><div class="text-base font-bold text-sky-500 cursor-pointer"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="m15.82 7.22-1 .4c-.21-.16-.43-.29-.67-.39L14 6.17c-.02-.1-.1-.17-.2-.17h-1.6c-.1 0-.18.07-.19.17l-.15 1.06c-.24.1-.47.23-.67.39l-1-.4c-.09-.03-.2 0-.24.09l-.8 1.38c-.05.09-.03.2.05.26l.85.66c-.03.12-.05.26-.05.39q0 .195.03.39l-.84.66c-.08.06-.1.17-.05.25l.8 1.39c.05.09.15.12.25.09l.99-.4c.21.16.43.29.68.39l.14 1.06c.02.1.1.17.2.17h1.6c.1 0 .18-.07.2-.17l.15-1.06c.24-.1.47-.23.67-.39l.99.4c.09.04.2 0 .24-.09l.8-1.39c.05-.09.03-.19-.05-.25l-.83-.66q.03-.195.03-.39 0-.21-.03-.39l.85-.66c.08-.06.1-.17.05-.26l-.8-1.38c-.05-.09-.16-.12-.25-.09M13 11.43c-.79 0-1.43-.64-1.43-1.43s.64-1.43 1.43-1.43 1.43.64 1.43 1.43-.64 1.43-1.43 1.43"></path><path d="M19.94 9.06c-.43-3.27-3.23-5.86-6.53-6.05C13.27 3 13.14 3 13 3 9.47 3 6.57 5.61 6.08 9l-1.93 3.48c-.41.66.07 1.52.85 1.52h1v2c0 1.1.9 2 2 2h1v3h7v-4.68c2.62-1.25 4.35-4.08 3.94-7.26m-5.05 5.57-.89.42V19h-3v-3H8v-4H6.7l1.33-2.33C8.21 7.06 10.35 5 13 5c2.76 0 5 2.24 5 5 0 2.09-1.29 3.88-3.11 4.63"></path></svg> <!-- -->Reasoning<!-- --> <svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"></path></svg></div></div>
<p>在机器学习中，<strong>模型的 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span>（配置）</strong> 通常指<strong>定义模型结构的所有参数</strong>，而超参（Hyperparameters）更多指<strong>控制训练过程的参数</strong>。这两者有时会有重叠，但核心区别在于作用对象。以下是详细解释：</p>
<hr/>
<h3 id="1-什么是模型的-config"><a href="#1-什么是模型的-config">1. <strong>什么是模型的 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span>？</strong></a></h3>
<ul>
<li>
<p><strong>模型配置</strong>（Model Configuration）是定义<strong>模型结构</strong>的一组参数，例如：</p>
<ul>
<li>神经网络的层数、每层的神经元数量</li>
<li>卷积核大小、步长（Stride）、填充（Padding）</li>
<li>激活函数类型（如 ReLU、Sigmoid）</li>
<li>注意力机制的头数（如 Transformer 中的 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>num_heads</span></span></code></span>）</li>
<li>词嵌入维度（如 NLP 模型中的 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>hidden_size</span></span></code></span>）</li>
</ul>
</li>
<li>
<p><strong>示例</strong>（以 Transformer 模型为例）：</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">config </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> {</span></span>
<span data-line=""><span style="color:#A9B2C3">    &quot;</span><span style="color:#98C379">num_layers</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: </span><span style="color:#56B6C2">12</span><span style="color:#A9B2C3">,          </span><span style="color:#5F6672;font-style:italic"># Transformer 层数</span></span>
<span data-line=""><span style="color:#A9B2C3">    &quot;</span><span style="color:#98C379">hidden_size</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: </span><span style="color:#56B6C2">768</span><span style="color:#A9B2C3">,         </span><span style="color:#5F6672;font-style:italic"># 隐藏层维度</span></span>
<span data-line=""><span style="color:#A9B2C3">    &quot;</span><span style="color:#98C379">num_attention_heads</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: </span><span style="color:#56B6C2">12</span><span style="color:#A9B2C3">,  </span><span style="color:#5F6672;font-style:italic"># 注意力头数</span></span>
<span data-line=""><span style="color:#A9B2C3">    &quot;</span><span style="color:#98C379">intermediate_size</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: </span><span style="color:#56B6C2">3072</span><span style="color:#A9B2C3">,  </span><span style="color:#5F6672;font-style:italic"># FeedForward 层维度</span></span>
<span data-line=""><span style="color:#A9B2C3">    &quot;</span><span style="color:#98C379">vocab_size</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: </span><span style="color:#56B6C2">30522</span><span style="color:#A9B2C3">,        </span><span style="color:#5F6672;font-style:italic"># 词表大小</span></span>
<span data-line=""><span style="color:#A9B2C3">}</span></span></code></pre></figure>
</li>
</ul>
<hr/>
<h3 id="2-模型-config-与超参数的区别"><a href="#2-模型-config-与超参数的区别">2. <strong>模型 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span> 与超参数的区别</strong></a></h3>
<table><thead><tr><th><strong>类别</strong></th><th><strong>模型配置（Config）</strong></th><th><strong>超参数（Hyperparameters）</strong></th></tr></thead><tbody><tr><td><strong>作用对象</strong></td><td>模型结构</td><td>训练过程</td></tr><tr><td><strong>典型参数</strong></td><td>层数、维度、注意力头数、卷积核大小</td><td>学习率、批量大小（Batch Size）、优化器类型、训练轮数（Epochs）</td></tr><tr><td><strong>保存目的</strong></td><td>重建模型结构（如加载 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 前）</td><td>复现训练过程（如调参、实验对比）</td></tr><tr><td><strong>修改频率</strong></td><td>低频（模型结构稳定后很少改动）</td><td>高频（需反复调整优化）</td></tr></tbody></table>
<hr/>
<h3 id="3-为什么需要单独管理-config"><a href="#3-为什么需要单独管理-config">3. <strong>为什么需要单独管理 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span>？</strong></a></h3>
<ul>
<li>
<p><strong>场景 1：重建模型</strong><br/>
<!-- -->若仅保存 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span>（模型权重），加载时必须<strong>先根据 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span> 重建模型结构</strong>，才能加载权重：</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#5F6672;font-style:italic"># 保存</span></span>
<span data-line=""><span style="color:#A9B2C3">torch.save(model.state_dict(), </span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">model_weights.pth</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">)</span></span>
<span data-line=""><span style="color:#E06C75">with</span><span style="color:#B57EDC"> open</span><span style="color:#A9B2C3">(</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">model_config.json</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">, </span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">w</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">) </span><span style="color:#E06C75">as</span><span style="color:#A9B2C3"> f:</span></span>
<span data-line=""><span style="color:#A9B2C3">    json.dump(config, f)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#5F6672;font-style:italic"># 加载</span></span>
<span data-line=""><span style="color:#E06C75">with</span><span style="color:#B57EDC"> open</span><span style="color:#A9B2C3">(</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">model_config.json</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">, </span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">r</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">) </span><span style="color:#E06C75">as</span><span style="color:#A9B2C3"> f:</span></span>
<span data-line=""><span style="color:#A9B2C3">    config </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> json.load(f)</span></span>
<span data-line=""><span style="color:#A9B2C3">model </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> MyModel(</span><span style="color:#E06C75">**</span><span style="color:#A9B2C3">config)  </span><span style="color:#5F6672;font-style:italic"># 根据 config 实例化模型</span></span>
<span data-line=""><span style="color:#A9B2C3">model.load_state_dict(torch.load(</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">model_weights.pth</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">))</span></span></code></pre></figure>
</li>
<li>
<p><strong>场景 2：版本控制与实验复现</strong><br/>
<!-- -->将 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span> 保存为 JSON/YAML 文件，便于记录不同模型结构的实验效果。</p>
</li>
<li>
<p><strong>场景 3：共享模型</strong><br/>
<!-- -->开源社区常用模式（如 HuggingFace Transformers）：</p>
<ul>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config.json</span></span></code></span>：定义模型结构</li>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>pytorch_model.bin</span></span></code></span>：保存 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span></li>
</ul>
</li>
</ul>
<hr/>
<h3 id="4-config-与超参数的重叠情况"><a href="#4-config-与超参数的重叠情况">4. <strong><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span> 与超参数的重叠情况</strong></a></h3>
<p>某些参数可能同时影响模型结构和训练，例如：</p>
<ul>
<li><strong>Dropout 比率</strong>：既是模型结构的一部分，也被视为超参数。</li>
<li><strong>词嵌入维度</strong>：影响模型结构，但可能因训练资源调整（如显存不足时调小维度）。</li>
</ul>
<p>此时，可以<strong>将两者统一管理</strong>，但建议分开存储：</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#5F6672;font-style:italic"># 统一配置文件（config.yaml）</span></span>
<span data-line=""><span style="color:#A9B2C3">model:</span></span>
<span data-line=""><span style="color:#A9B2C3">  num_layers: </span><span style="color:#56B6C2">12</span></span>
<span data-line=""><span style="color:#A9B2C3">  hidden_size: </span><span style="color:#56B6C2">768</span></span>
<span data-line=""><span style="color:#A9B2C3">training:</span></span>
<span data-line=""><span style="color:#A9B2C3">  learning_rate: </span><span style="color:#56B6C2">1e-4</span></span>
<span data-line=""><span style="color:#A9B2C3">  batch_size: </span><span style="color:#56B6C2">32</span></span></code></pre></figure>
<hr/>
<h3 id="5-实际代码示例"><a href="#5-实际代码示例">5. <strong>实际代码示例</strong></a></h3>
<h4 id="定义模型时使用-config"><a href="#定义模型时使用-config">定义模型时使用 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span>：</a></h4>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#61AFEF">class</span><span style="color:#E5C07B"> TransformerModel</span><span style="color:#A9B2C3">(</span><span style="color:#D19A66">nn</span><span style="color:#A9B2C3">.</span><span style="color:#D19A66">Module</span><span style="color:#A9B2C3">):</span></span>
<span data-line=""><span style="color:#61AFEF">    def</span><span style="color:#B57EDC"> __init__</span><span style="color:#A9B2C3">(</span><span style="color:#C6CCD7">self</span><span style="color:#A9B2C3">, </span><span style="color:#C6CCD7">config</span><span style="color:#A9B2C3">):</span></span>
<span data-line=""><span style="color:#E5C07B">        super</span><span style="color:#A9B2C3">().</span><span style="color:#B57EDC">__init__</span><span style="color:#A9B2C3">()</span></span>
<span data-line=""><span style="color:#E06C75">        self</span><span style="color:#A9B2C3">.embedding </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> nn.Embedding(config[</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">vocab_size</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">], config[</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">hidden_size</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">])</span></span>
<span data-line=""><span style="color:#E06C75">        self</span><span style="color:#A9B2C3">.layers </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> nn.ModuleList([TransformerBlock(config) </span><span style="color:#E06C75">for</span><span style="color:#A9B2C3"> _ </span><span style="color:#E06C75">in</span><span style="color:#B57EDC"> range</span><span style="color:#A9B2C3">(config[</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">num_layers</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">])])</span></span>
<span data-line=""><span style="color:#5F6672;font-style:italic">        # ...</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#5F6672;font-style:italic"># 初始化模型</span></span>
<span data-line=""><span style="color:#A9B2C3">config </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> {</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">vocab_size</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: </span><span style="color:#56B6C2">30000</span><span style="color:#A9B2C3">, </span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">hidden_size</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: </span><span style="color:#56B6C2">512</span><span style="color:#A9B2C3">, </span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">num_layers</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: </span><span style="color:#56B6C2">6</span><span style="color:#A9B2C3">}</span></span>
<span data-line=""><span style="color:#A9B2C3">model </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> TransformerModel(config)</span></span></code></pre></figure>
<h4 id="保存与加载完整模型含结构和权重"><a href="#保存与加载完整模型含结构和权重">保存与加载完整模型（含结构和权重）：</a></h4>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#5F6672;font-style:italic"># 保存（不推荐，但某些场景需要）</span></span>
<span data-line=""><span style="color:#A9B2C3">full_model </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> {</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">config</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: config, </span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">state_dict</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">: model.state_dict()}</span></span>
<span data-line=""><span style="color:#A9B2C3">torch.save(full_model, </span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">full_model.pth</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#5F6672;font-style:italic"># 加载</span></span>
<span data-line=""><span style="color:#A9B2C3">loaded </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> torch.load(</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">full_model.pth</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">)</span></span>
<span data-line=""><span style="color:#A9B2C3">model </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> TransformerModel(loaded[</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">config</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">])</span></span>
<span data-line=""><span style="color:#A9B2C3">model.load_state_dict(loaded[</span><span style="color:#A9B2C3">&quot;</span><span style="color:#98C379">state_dict</span><span style="color:#A9B2C3">&quot;</span><span style="color:#A9B2C3">])</span></span></code></pre></figure>
<hr/>
<h3 id="6-总结"><a href="#6-总结">6. <strong>总结</strong></a></h3>
<ul>
<li><strong>模型 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span></strong>：定义模型结构的参数（如层数、维度），是<strong>重建模型</strong>的必需信息。</li>
<li><strong>超参数</strong>：控制训练过程的参数（如学习率、批量大小），影响模型如何学习。</li>
<li><strong>最佳实践</strong>：<!-- -->
<ul>
<li>始终保存 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>config</span></span></code></span>（如 JSON 文件），确保模型可复现。</li>
<li>分开管理模型配置和训练超参数，避免混淆。</li>
</ul>
</li>
</ul>
<div class="rounded-md p-2 my-4 bg-sky-100"><div class="text-base font-bold text-sky-500"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"></path></svg> <!-- -->亮曰<!-- --> </div><div class="m-2"><ul>
<li>Config 主要是定义模型结构。会根据 Config 决定有多少层等。</li>
<li>超参主要是训练过程中的学习率、 Epochs 等，复现训练过程时需要，但与模型结构无关，只与训练过程有关。</li>
</ul></div></div>
<h2 id="q-所谓权重就是指-state_dict-中的内容吗"><a href="#q-所谓权重就是指-state_dict-中的内容吗">Q: 所谓&quot;权重&quot;就是指 state_dict 中的内容吗？</a></h2>
<div class="rounded-md p-2 my-4 bg-sky-100"><div class="text-base font-bold text-sky-500 cursor-pointer"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="m15.82 7.22-1 .4c-.21-.16-.43-.29-.67-.39L14 6.17c-.02-.1-.1-.17-.2-.17h-1.6c-.1 0-.18.07-.19.17l-.15 1.06c-.24.1-.47.23-.67.39l-1-.4c-.09-.03-.2 0-.24.09l-.8 1.38c-.05.09-.03.2.05.26l.85.66c-.03.12-.05.26-.05.39q0 .195.03.39l-.84.66c-.08.06-.1.17-.05.25l.8 1.39c.05.09.15.12.25.09l.99-.4c.21.16.43.29.68.39l.14 1.06c.02.1.1.17.2.17h1.6c.1 0 .18-.07.2-.17l.15-1.06c.24-.1.47-.23.67-.39l.99.4c.09.04.2 0 .24-.09l.8-1.39c.05-.09.03-.19-.05-.25l-.83-.66q.03-.195.03-.39 0-.21-.03-.39l.85-.66c.08-.06.1-.17.05-.26l-.8-1.38c-.05-.09-.16-.12-.25-.09M13 11.43c-.79 0-1.43-.64-1.43-1.43s.64-1.43 1.43-1.43 1.43.64 1.43 1.43-.64 1.43-1.43 1.43"></path><path d="M19.94 9.06c-.43-3.27-3.23-5.86-6.53-6.05C13.27 3 13.14 3 13 3 9.47 3 6.57 5.61 6.08 9l-1.93 3.48c-.41.66.07 1.52.85 1.52h1v2c0 1.1.9 2 2 2h1v3h7v-4.68c2.62-1.25 4.35-4.08 3.94-7.26m-5.05 5.57-.89.42V19h-3v-3H8v-4H6.7l1.33-2.33C8.21 7.06 10.35 5 13 5c2.76 0 5 2.24 5 5 0 2.09-1.29 3.88-3.11 4.63"></path></svg> <!-- -->Reasoning<!-- --> <svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"></path></svg></div></div>
<p>在 PyTorch 中，<strong>&quot;权重&quot;确实是 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 中的核心内容</strong>，但 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 包含的信息可能比&quot;权重&quot;更广泛。以下是详细解释：</p>
<hr/>
<h3 id="1-权重是什么"><a href="#1-权重是什么">1. <strong>&quot;权重&quot;是什么？</strong></a></h3>
<ul>
<li><strong>权重（Weights）</strong> 是模型中<strong>可学习的参数</strong>，例如：<!-- -->
<ul>
<li>全连接层（<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>nn.Linear</span></span></code></span>）中的权重矩阵（<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>weight</span></span></code></span>）和偏置（<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>bias</span></span></code></span>）。</li>
<li>卷积层（<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>nn.Conv2d</span></span></code></span>）的卷积核参数。</li>
<li>嵌入层（<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>nn.Embedding</span></span></code></span>）的词向量矩阵。</li>
</ul>
</li>
<li>这些参数通过反向传播和优化器（如 SGD、Adam）在训练过程中逐步更新。</li>
</ul>
<hr/>
<h3 id="2-state_dict-中的内容"><a href="#2-state_dict-中的内容">2. <strong><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 中的内容</strong></a></h3>
<p><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 是 PyTorch 中模型或优化器的<strong>状态字典</strong>，具体包含：</p>
<ul>
<li><strong>对模型而言</strong>：<!-- -->
<ul>
<li>所有权重（<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>weight</span></span></code></span>）、偏置（<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>bias</span></span></code></span>）。</li>
<li>其他<strong>与层相关的参数</strong>，例如：<!-- -->
<ul>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>BatchNorm</span></span></code></span> 层的 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>running_mean</span></span></code></span> 和 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>running_var</span></span></code></span>（在推理时使用的均值和方差）。</li>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>LSTM</span></span></code></span> 或 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>GRU</span></span></code></span> 中的隐藏状态缓存（如果模型设计时显式存储了这些状态）。</li>
</ul>
</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#5F6672;font-style:italic"># 示例：一个简单模型的 state_dict</span></span>
<span data-line=""><span style="color:#A9B2C3">model </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> nn.Sequential(</span></span>
<span data-line=""><span style="color:#A9B2C3">    nn.Linear(</span><span style="color:#56B6C2">10</span><span style="color:#A9B2C3">, </span><span style="color:#56B6C2">20</span><span style="color:#A9B2C3">),</span></span>
<span data-line=""><span style="color:#A9B2C3">    nn.ReLU(),</span></span>
<span data-line=""><span style="color:#A9B2C3">    nn.BatchNorm1d(</span><span style="color:#56B6C2">20</span><span style="color:#A9B2C3">)</span></span>
<span data-line=""><span style="color:#A9B2C3">)</span></span>
<span data-line=""><span style="color:#B57EDC">print</span><span style="color:#A9B2C3">(model.state_dict().keys())</span></span>
<span data-line=""><span style="color:#5F6672;font-style:italic"># 输出：</span></span>
<span data-line=""><span style="color:#5F6672;font-style:italic"># [&#x27;0.weight&#x27;, &#x27;0.bias&#x27;, &#x27;2.weight&#x27;, &#x27;2.bias&#x27;, &#x27;2.running_mean&#x27;, &#x27;2.running_var&#x27;, &#x27;2.num_batches_tracked&#x27;]</span></span></code></pre></figure>
</li>
<li><strong>对优化器而言</strong>：<!-- -->
<ul>
<li>优化器的状态（如动量缓存、历史梯度等）。</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">optimizer </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> torch.optim.Adam(model.parameters())</span></span>
<span data-line=""><span style="color:#B57EDC">print</span><span style="color:#A9B2C3">(optimizer.state_dict().keys())</span></span>
<span data-line=""><span style="color:#5F6672;font-style:italic"># 输出：</span></span>
<span data-line=""><span style="color:#5F6672;font-style:italic"># [&#x27;state&#x27;, &#x27;param_groups&#x27;]</span></span></code></pre></figure>
</li>
</ul>
<hr/>
<h3 id="3-权重与-state_dict-的关系"><a href="#3-权重与-state_dict-的关系">3. <strong>&quot;权重&quot;与 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 的关系</strong></a></h3>
<ul>
<li><strong><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 包含权重，但不仅限于权重</strong>：<!-- -->
<ul>
<li>权重是 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 中的一部分（如 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>conv1.weight</span></span></code></span>, <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>fc.bias</span></span></code></span>）。</li>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 还可能包含<strong>非可学习的参数</strong>（如 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>BatchNorm</span></span></code></span> 的统计量 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>running_mean</span></span></code></span>）。</li>
<li>对于复杂模型（如 Transformer），还可能包含位置编码、注意力掩码等参数。</li>
</ul>
</li>
<li><strong>总结</strong>：<!-- -->
<ul>
<li><strong>权重是 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 的核心内容</strong>，但 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 是更全面的模型状态表示。</li>
</ul>
</li>
</ul>
<hr/>
<h3 id="4-为什么需要-state_dict-而不仅仅是权重"><a href="#4-为什么需要-state_dict-而不仅仅是权重">4. <strong>为什么需要 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 而不仅仅是权重？</strong></a></h3>
<ul>
<li><strong>完整恢复模型状态</strong>：
如果仅保存权重，忽略 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>BatchNorm</span></span></code></span> 的 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>running_mean</span></span></code></span> 等参数，在推理时会导致统计量错误，影响模型性能。</li>
<li><strong>兼容性</strong>：
加载模型时需确保 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 的键（如层名称）与当前模型结构严格匹配，否则会报错 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>Missing keys</span></span></code></span> 或 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>Unexpected keys</span></span></code></span>。</li>
<li><strong>灵活性</strong>：
可以手动修改 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span>，例如迁移学习中仅加载部分层的权重。</li>
</ul>
<hr/>
<h3 id="5-操作-state_dict-的常见场景"><a href="#5-操作-state_dict-的常见场景">5. <strong>操作 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 的常见场景</strong></a></h3>
<h4 id="1-查看模型权重"><a href="#1-查看模型权重"><strong>(1) 查看模型权重</strong></a></h4>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#E06C75">for</span><span style="color:#A9B2C3"> name, param </span><span style="color:#E06C75">in</span><span style="color:#A9B2C3"> model.named_parameters():</span></span>
<span data-line=""><span style="color:#B57EDC">    print</span><span style="color:#A9B2C3">(</span><span style="color:#61AFEF">f</span><span style="color:#98C379">&quot;层名: </span><span style="color:#56B6C2">{</span><span style="color:#A9B2C3">name</span><span style="color:#56B6C2">}</span><span style="color:#98C379">, 参数形状: </span><span style="color:#56B6C2">{</span><span style="color:#A9B2C3">param.shape</span><span style="color:#56B6C2">}</span><span style="color:#98C379">&quot;</span><span style="color:#A9B2C3">)</span></span></code></pre></figure>
<h4 id="2-选择性加载部分权重迁移学习"><a href="#2-选择性加载部分权重迁移学习"><strong>(2) 选择性加载部分权重（迁移学习）</strong></a></h4>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#A9B2C3">pretrained_dict </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> torch.load(</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#98C379">pretrained.pth</span><span style="color:#A9B2C3">&#x27;</span><span style="color:#A9B2C3">)</span></span>
<span data-line=""><span style="color:#A9B2C3">model_dict </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> model.state_dict()</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#5F6672;font-style:italic"># 筛选出名称和形状匹配的权重</span></span>
<span data-line=""><span style="color:#A9B2C3">pretrained_dict </span><span style="color:#E06C75">=</span><span style="color:#A9B2C3"> {</span></span>
<span data-line=""><span style="color:#A9B2C3">    k: v </span><span style="color:#E06C75">for</span><span style="color:#A9B2C3"> k, v </span><span style="color:#E06C75">in</span><span style="color:#A9B2C3"> pretrained_dict.items()</span></span>
<span data-line=""><span style="color:#E06C75">    if</span><span style="color:#A9B2C3"> k </span><span style="color:#E06C75">in</span><span style="color:#A9B2C3"> model_dict </span><span style="color:#E06C75">and</span><span style="color:#A9B2C3"> v.shape </span><span style="color:#E06C75">==</span><span style="color:#A9B2C3"> model_dict[k].shape</span></span>
<span data-line=""><span style="color:#A9B2C3">}</span></span>
<span data-line=""><span style="color:#A9B2C3">model_dict.update(pretrained_dict)</span></span>
<span data-line=""><span style="color:#A9B2C3">model.load_state_dict(model_dict)</span></span></code></pre></figure>
<h4 id="3-手动修改权重"><a href="#3-手动修改权重"><strong>(3) 手动修改权重</strong></a></h4>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="python" data-theme="plastic"><code data-language="python" data-theme="plastic" style="display:grid"><span data-line=""><span style="color:#5F6672;font-style:italic"># 将第一层卷积的权重置零</span></span>
<span data-line=""><span style="color:#E06C75">with</span><span style="color:#A9B2C3"> torch.no_grad():</span></span>
<span data-line=""><span style="color:#A9B2C3">    model.conv1.weight.copy_(torch.zeros_like(model.conv1.weight))</span></span></code></pre></figure>
<hr/>
<h3 id="6-总结-1"><a href="#6-总结-1">6. <strong>总结</strong></a></h3>
<ul>
<li><strong>权重</strong>是模型的可学习参数，是 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span> 的核心内容。</li>
<li><strong><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>state_dict</span></span></code></span></strong> 是模型状态的完整表示，包括：<!-- -->
<ul>
<li>所有权重、偏置。</li>
<li>非可学习的运行时参数（如 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>BatchNorm</span></span></code></span> 的统计量）。</li>
</ul>
</li>
<li><strong>最佳实践</strong>：<!-- -->
<ul>
<li>保存模型时使用 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>torch.save(model.state_dict(), ...)</span></span></code></span>。</li>
<li>加载时需先构建相同结构的模型，再调用 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="plastic"><span data-line=""><span>model.load_state_dict()</span></span></code></span>。</li>
<li>若需调整模型结构，可选择性加载匹配的权重。</li>
</ul>
</li>
</ul>
<div class="rounded-md p-2 my-4 bg-sky-100"><div class="text-base font-bold text-sky-500"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"></path></svg> <!-- -->亮曰<!-- --> </div><div class="m-2"><p>state_dict 包括 Parameter 与 Buffer ，模型的可学习参数——<strong>权重</strong>主要指其中的 Parameter 。</p></div></div></div><div class="w-96 text-gray-700 leading-none"><span class="!text-sm"><a class="!inline-block !p-0 !m-0 align-text-bottom" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" loading="lazy" width="88" height="31" decoding="async" data-nimg="1" class="!m-0 h-4 w-auto pr-1" style="color:transparent;border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png"/></a>This work is licensed under a<!-- --> <a class="underline" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</span></div><div class="TagsBox_tagsBox__WzhAf mt-4"><a class="tag-word TagsBox_tag__Rk32C" href="/blog-next/tags/deep-learning">#<!-- -->Deep Learning</a><a class="tag-word TagsBox_tag__Rk32C" href="/blog-next/tags/pytorch">#<!-- -->PyTorch</a><a class="tag-word TagsBox_tag__Rk32C" href="/blog-next/tags/model-management">#<!-- -->Model Management</a></div><div class="mt-4 mb-4 flex justify-center"><div class="ml-0 mr-auto"><a href="/blog-next/learn_from_ai/golang-new-and-memory-management">&lt;- GoLang 中 new() 与内存管理机制详解</a></div><div class="mr-0 ml-auto"><a href="/blog-next/learn_from_ai/resnet-math-and-gradient-vanishing">ResNet 的数学原理与梯度消失问题分析 -&gt;</a></div></div><hr class="mt-4"/></article></div></div><style data-emotion="css vkdybf">.css-vkdybf{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 0 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 0) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:900px){.css-vkdybf{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 3 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 3) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:1200px){.css-vkdybf{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 2 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 2) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}</style><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-0 MuiGrid-grid-md-3 MuiGrid-grid-lg-2 css-vkdybf"><div class="inset-0 w-full h-full flex items-center justify-center bg-transparent"><style data-emotion="css 14awfyb animation-61bdi0">.css-14awfyb{display:inline-block;-webkit-animation:animation-61bdi0 1.4s linear infinite;animation:animation-61bdi0 1.4s linear infinite;color:#1976d2;}@-webkit-keyframes animation-61bdi0{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}@keyframes animation-61bdi0{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}</style><span class="MuiCircularProgress-root MuiCircularProgress-indeterminate MuiCircularProgress-colorPrimary css-14awfyb" style="width:40px;height:40px" role="progressbar"><style data-emotion="css 4ejps8">.css-4ejps8{display:block;}</style><svg class="MuiCircularProgress-svg css-4ejps8" viewBox="22 22 44 44"><style data-emotion="css 13odlrs animation-1o38n3e">.css-13odlrs{stroke:currentColor;stroke-dasharray:80px,200px;stroke-dashoffset:0;-webkit-animation:animation-1o38n3e 1.4s ease-in-out infinite;animation:animation-1o38n3e 1.4s ease-in-out infinite;}@-webkit-keyframes animation-1o38n3e{0%{stroke-dasharray:1px,200px;stroke-dashoffset:0;}50%{stroke-dasharray:100px,200px;stroke-dashoffset:-15px;}100%{stroke-dasharray:1px,200px;stroke-dashoffset:-126px;}}@keyframes animation-1o38n3e{0%{stroke-dasharray:1px,200px;stroke-dashoffset:0;}50%{stroke-dasharray:100px,200px;stroke-dashoffset:-15px;}100%{stroke-dasharray:1px,200px;stroke-dashoffset:-126px;}}</style><circle class="MuiCircularProgress-circle MuiCircularProgress-circleIndeterminate css-13odlrs" cx="44" cy="44" r="20.2" fill="none" stroke-width="3.6"></circle></svg></span></div></div></div><footer class="DefaultLayout_footer__aWV4u"><style data-emotion="css vktxal">.css-vktxal{--Grid-columns:12;--Grid-columnSpacing:0px;--Grid-rowSpacing:0px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;min-width:0;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:var(--Grid-rowSpacing) var(--Grid-columnSpacing);width:100%;max-width:80rem;margin-left:auto;margin-right:auto;padding:0.5rem;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}.css-vktxal >*{--Grid-parent-columns:12;}.css-vktxal >*{--Grid-parent-columnSpacing:0px;}.css-vktxal >*{--Grid-parent-rowSpacing:0px;}</style><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-row css-vktxal"><style data-emotion="css 9gdssj">.css-9gdssj{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 0 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 0) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:900px){.css-9gdssj{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 0 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 0) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:1200px){.css-9gdssj{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 2 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 2) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}</style><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-0 MuiGrid-grid-md-0 MuiGrid-grid-lg-2 css-9gdssj"></div><style data-emotion="css 9h67uz">.css-9h67uz{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 12 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 12) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:900px){.css-9h67uz{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 9 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 9) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:1200px){.css-9h67uz{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 8 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 8) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}</style><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-12 MuiGrid-grid-md-9 MuiGrid-grid-lg-8 css-9h67uz"><div class="flex flex-row justify-center items-center"><div class="DefaultLayout_footerLeft__Qn_VV">© 2023 Ryo Jerry Yu. All rights reserved.</div><div class="DefaultLayout_footerRight__GlReP"><a title="Twitter" href="https://twitter.com/ryo_okami"><svg class="h-6 w-6 fill-gray-300 hover:fill-white transition-all ease-in-out mx-1 md:mx-2" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a title="GitHub" href="https://github.com/RyoJerryYu"><svg class="h-6 w-6 fill-gray-300 hover:fill-white transition-all ease-in-out mx-1 md:mx-2" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a title="Pixiv" href="https://www.pixiv.net/users/9159893"><svg class="h-6 w-6 fill-gray-300 hover:fill-white transition-all ease-in-out mx-1 md:mx-2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4.935 0A4.924 4.924 0 0 0 0 4.935v14.13A4.924 4.924 0 0 0 4.935 24h14.13A4.924 4.924 0 0 0 24 19.065V4.935A4.924 4.924 0 0 0 19.065 0zm7.81 4.547c2.181 0 4.058.676 5.399 1.847a6.118 6.118 0 0 1 2.116 4.66c.005 1.854-.88 3.476-2.257 4.563-1.375 1.092-3.225 1.697-5.258 1.697-2.314 0-4.46-.842-4.46-.842v2.718c.397.116 1.048.365.635.779H5.79c-.41-.41.19-.65.644-.779V7.666c-1.053.81-1.593 1.51-1.868 2.031.32 1.02-.284.969-.284.969l-1.09-1.73s3.868-4.39 9.553-4.39zm-.19.971c-1.423-.003-3.184.473-4.27 1.244v8.646c.988.487 2.484.832 4.26.832h.01c1.596 0 2.98-.593 3.93-1.533.952-.948 1.486-2.183 1.492-3.683-.005-1.54-.504-2.864-1.42-3.86-.918-.992-2.274-1.645-4.002-1.646Z"></path></svg></a></div></div></div><style data-emotion="css vkdybf">.css-vkdybf{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 0 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 0) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:900px){.css-vkdybf{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 3 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 3) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:1200px){.css-vkdybf{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 2 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 2) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}</style><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-0 MuiGrid-grid-md-3 MuiGrid-grid-lg-2 css-vkdybf"></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"pytorch-model-save-and-load","tags":[{"tag":"Deep Learning","slug":"deep-learning","path":"/tags/deep-learning","postSlugs":[{"postType":"learn_from_ai","postPagePath":"/learn_from_ai/pytorch-model-save-and-load"},{"postType":"learn_from_ai","postPagePath":"/learn_from_ai/resnet-math-and-gradient-vanishing"}]},{"tag":"PyTorch","slug":"pytorch","path":"/tags/pytorch","postSlugs":[{"postType":"learn_from_ai","postPagePath":"/learn_from_ai/deep-learning-model-formats"},{"postType":"learn_from_ai","postPagePath":"/learn_from_ai/pytorch-backpropagation-mechanism"},{"postType":"learn_from_ai","postPagePath":"/learn_from_ai/pytorch-model-save-and-load"}]},{"tag":"Model Management","slug":"model-management","path":"/tags/model-management","postSlugs":[{"postType":"learn_from_ai","postPagePath":"/learn_from_ai/pytorch-model-save-and-load"}]}],"source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    blockquote: \"blockquote\",\n    br: \"br\",\n    code: \"code\",\n    figure: \"figure\",\n    h2: \"h2\",\n    h3: \"h3\",\n    h4: \"h4\",\n    hr: \"hr\",\n    li: \"li\",\n    ol: \"ol\",\n    p: \"p\",\n    pre: \"pre\",\n    span: \"span\",\n    strong: \"strong\",\n    table: \"table\",\n    tbody: \"tbody\",\n    td: \"td\",\n    th: \"th\",\n    thead: \"thead\",\n    tr: \"tr\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  }, {ObsidianCallout} = _components;\n  if (!ObsidianCallout) _missingMdxReference(\"ObsidianCallout\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"本文为与 DeepSeek 对话记录，深入探讨 PyTorch 中模型的保存和加载机制，包括不同的保存方式、最佳实践以及常见问题的解决方案。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"q-pytorch-中所谓的保存模型加载模型指的是保存加载什么是-state_dict-吗\",\n      children: _jsx(_components.a, {\n        href: \"#q-pytorch-中所谓的保存模型加载模型指的是保存加载什么是-state_dict-吗\",\n        children: \"Q: PyTorch 中所谓的保存模型/加载模型，指的是保存/加载什么？是 state_dict 吗？\"\n      })\n    }), \"\\n\", _jsxs(ObsidianCallout, {\n      type: \"reasoning\",\n      title: \"\",\n      foldable: true,\n      isCollapsed: true,\n      children: [_jsx(_components.p, {\n        children: \"嗯，我现在要弄清楚 PyTorch 中保存和加载模型到底是怎么回事。用户问是不是保存和加载 state_dict，我需要仔细想一想这个问题。\"\n      }), _jsx(_components.p, {\n        children: \"首先，我记得在 PyTorch 里训练模型的时候，模型的可学习参数，比如各层的权重和偏置，是存放在模型的 parameters 中的。而 state_dict 应该是一个保存这些参数的东西。对，每个 torch.nn.Module 都有 state_dict，它是一个字典，将每个层映射到对应的参数张量。\"\n      }), _jsx(_components.p, {\n        children: \"那保存模型的时候，有两种常见的方法。一种是直接保存整个模型，使用 torch.save(model, 'model.pth')。这样的话，保存的是整个模型对象，包括结构定义和参数。不过这种方法可能有缺点，比如当模型定义所在的文件路径变化时，加载的时候可能会找不到类定义，导致错误。所以通常更推荐另一种方法，就是只保存 state_dict，这样需要的时候再加载到一个定义好的模型结构中。\"\n      }), _jsx(_components.p, {\n        children: \"所以用户的问题是说保存模型是不是保存 state_dict，对吧？是的，通常最佳做法是保存 state_dict，而不是整个模型对象。因为 state_dict 只包含参数，不包含模型结构，这样在加载的时候更灵活。比如，当你想在不同项目中使用同一个模型参数，或者模型类有修改时，加载 state_dict 会更方便。\"\n      }), _jsx(_components.p, {\n        children: \"那加载的时候，就需要先实例化模型，然后用 load_state_dict 方法加载参数。比如：\"\n      }), _jsx(_components.p, {\n        children: \"model = MyModelClass(*args, **kwargs)\"\n      }), _jsx(_components.p, {\n        children: \"model.load_state_dict(torch.load('model.pth'))\"\n      }), _jsx(_components.p, {\n        children: \"这样参数就被正确加载到模型里了。而如果保存的是整个模型，加载的时候可以直接用 model = torch.load('model.pth')，但这时候模型类必须在当前作用域可访问，否则会出错。\"\n      }), _jsx(_components.p, {\n        children: \"所以总结一下，保存模型通常指的是保存 state_dict，而加载模型就是加载这个 state_dict 到已经定义好的模型结构中。当然，PyTorch 也允许保存整个模型，但不够灵活，所以推荐用 state_dict 的方式。\"\n      }), _jsx(_components.p, {\n        children: \"另外，可能还有其他需要保存的内容，比如优化器的 state_dict，这样在恢复训练的时候可以接着之前的优化器状态继续训练。这时候保存的 checkpoint 可能包括 model_state_dict、optimizer_state_dict、epoch、loss 等信息。加载的时候需要分别处理这些部分。\"\n      }), _jsx(_components.p, {\n        children: \"但用户的问题主要是关于保存和加载模型本身，所以核心答案应该是 state_dict。不过要说明保存整个模型的情况也存在，但 state_dict 更推荐。所以回答的时候应该涵盖这两种情况，但强调 state_dict 是更常用的方法。\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"在 PyTorch 中，保存和加载模型的\", _jsxs(_components.strong, {\n        children: [\"核心是 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"state_dict\"\n              })\n            })\n          })\n        })]\n      }), \"，但具体操作可以灵活选择。以下是详细说明：\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"1-state_dict-是什么\",\n      children: _jsxs(_components.a, {\n        href: \"#1-state_dict-是什么\",\n        children: [\"1. \", _jsxs(_components.strong, {\n          children: [_jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \" 是什么？\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          })\n        }), \" 是一个 Python 字典对象，它将模型的每一层（如卷积层、全连接层等）映射到对应的参数张量（权重和偏置）。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"例如，一个简单的神经网络可能包含：\", \"\\n\", _jsx(_components.figure, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.pre, {\n            tabIndex: \"0\",\n            \"data-language\": \"python\",\n            \"data-theme\": \"plastic\",\n            children: _jsxs(_components.code, {\n              \"data-language\": \"python\",\n              \"data-theme\": \"plastic\",\n              style: {\n                display: \"grid\"\n              },\n              children: [_jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"model.state_dict() \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"=\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" {\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    '\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"conv1.weight\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": tensor(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"...\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"),\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    '\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"conv1.bias\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": tensor(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"...\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"),\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    '\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"fc1.weight\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": tensor(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"...\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"),\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    '\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"fc1.bias\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": tensor(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"...\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"),\"\n                })]\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"    ...\"\n                })\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"}\"\n                })\n              })]\n            })\n          })\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"优化器\"\n        }), \"（如 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"torch.optim.SGD\"\n              })\n            })\n          })\n        }), \"）也有自己的 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"state_dict\"\n              })\n            })\n          })\n        }), \"，保存优化器的状态（如动量缓冲等）。\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"2-保存模型的两种方式\",\n      children: _jsxs(_components.a, {\n        href: \"#2-保存模型的两种方式\",\n        children: [\"2. \", _jsx(_components.strong, {\n          children: \"保存模型的两种方式\"\n        })]\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"方式-1仅保存-state_dict推荐\",\n      children: _jsx(_components.a, {\n        href: \"#方式-1仅保存-state_dict推荐\",\n        children: _jsxs(_components.strong, {\n          children: [\"方式 1：仅保存 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \"（推荐）\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"代码示例\"\n        }), \"：\", \"\\n\", _jsx(_components.figure, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.pre, {\n            tabIndex: \"0\",\n            \"data-language\": \"python\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"python\",\n              \"data-theme\": \"plastic\",\n              style: {\n                display: \"grid\"\n              },\n              children: _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"torch.save(model.state_dict(), \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"model_weights.pth\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \")\"\n                })]\n              })\n            })\n          })\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"优点\"\n        }), \"：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"文件体积小，只保存参数，不保存模型结构。\"\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"加载灵活：需先实例化模型结构，再加载参数。\"\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"避免因代码变更（如类名修改）导致的加载失败。\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"方式-2保存整个模型不推荐\",\n      children: _jsx(_components.a, {\n        href: \"#方式-2保存整个模型不推荐\",\n        children: _jsx(_components.strong, {\n          children: \"方式 2：保存整个模型（不推荐）\"\n        })\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"代码示例\"\n        }), \"：\", \"\\n\", _jsx(_components.figure, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.pre, {\n            tabIndex: \"0\",\n            \"data-language\": \"python\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"python\",\n              \"data-theme\": \"plastic\",\n              style: {\n                display: \"grid\"\n              },\n              children: _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"torch.save(model, \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"entire_model.pth\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \")\"\n                })]\n              })\n            })\n          })\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"缺点\"\n        }), \"：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"文件体积大，包含模型结构和参数。\"\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"依赖原始代码环境（模型类的定义必须存在），否则加载时会报错。\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"3-加载模型的对应方法\",\n      children: _jsxs(_components.a, {\n        href: \"#3-加载模型的对应方法\",\n        children: [\"3. \", _jsx(_components.strong, {\n          children: \"加载模型的对应方法\"\n        })]\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"加载-state_dict需先构建模型结构\",\n      children: _jsx(_components.a, {\n        href: \"#加载-state_dict需先构建模型结构\",\n        children: _jsxs(_components.strong, {\n          children: [\"加载 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \"（需先构建模型结构）\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.figure, {\n      \"data-rehype-pretty-code-figure\": \"\",\n      children: _jsx(_components.pre, {\n        tabIndex: \"0\",\n        \"data-language\": \"python\",\n        \"data-theme\": \"plastic\",\n        children: _jsxs(_components.code, {\n          \"data-language\": \"python\",\n          \"data-theme\": \"plastic\",\n          style: {\n            display: \"grid\"\n          },\n          children: [_jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" MyModelClass()  \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#5F6672\",\n                fontStyle: \"italic\"\n              },\n              children: \"# 必须与保存时的模型结构一致\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model.load_state_dict(torch.load(\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"'\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"model_weights.pth\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"'\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"))\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model.eval()  \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#5F6672\",\n                fontStyle: \"italic\"\n              },\n              children: \"# 切换到推理模式（关闭 dropout 等）\"\n            })]\n          })]\n        })\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"加载整个模型直接使用\",\n      children: _jsx(_components.a, {\n        href: \"#加载整个模型直接使用\",\n        children: _jsx(_components.strong, {\n          children: \"加载整个模型（直接使用）\"\n        })\n      })\n    }), \"\\n\", _jsx(_components.figure, {\n      \"data-rehype-pretty-code-figure\": \"\",\n      children: _jsx(_components.pre, {\n        tabIndex: \"0\",\n        \"data-language\": \"python\",\n        \"data-theme\": \"plastic\",\n        children: _jsxs(_components.code, {\n          \"data-language\": \"python\",\n          \"data-theme\": \"plastic\",\n          style: {\n            display: \"grid\"\n          },\n          children: [_jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" torch.load(\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"'\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"entire_model.pth\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"'\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \")\"\n            })]\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model.eval()\"\n            })\n          })]\n        })\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"4-实际场景中的最佳实践\",\n      children: _jsxs(_components.a, {\n        href: \"#4-实际场景中的最佳实践\",\n        children: [\"4. \", _jsx(_components.strong, {\n          children: \"实际场景中的最佳实践\"\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"保存训练检查点（Checkpoint）\"\n          }), \"：\\n通常需要保存 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \" 之外的信息（如优化器状态、训练步数等）：\"]\n        }), \"\\n\", _jsx(_components.figure, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.pre, {\n            tabIndex: \"0\",\n            \"data-language\": \"python\",\n            \"data-theme\": \"plastic\",\n            children: _jsxs(_components.code, {\n              \"data-language\": \"python\",\n              \"data-theme\": \"plastic\",\n              style: {\n                display: \"grid\"\n              },\n              children: [_jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"checkpoint \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"=\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" {\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    '\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"model_state_dict\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": model.state_dict(),\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    '\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"optimizer_state_dict\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": optimizer.state_dict(),\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    '\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"epoch\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"100\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \",\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    '\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"loss\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": loss,\"\n                })]\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"}\"\n                })\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"torch.save(checkpoint, \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"checkpoint.pth\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \")\"\n                })]\n              })]\n            })\n          })\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"加载检查点\"\n          }), \"：\"]\n        }), \"\\n\", _jsx(_components.figure, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.pre, {\n            tabIndex: \"0\",\n            \"data-language\": \"python\",\n            \"data-theme\": \"plastic\",\n            children: _jsxs(_components.code, {\n              \"data-language\": \"python\",\n              \"data-theme\": \"plastic\",\n              style: {\n                display: \"grid\"\n              },\n              children: [_jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"checkpoint \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"=\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" torch.load(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"checkpoint.pth\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \")\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"model.load_state_dict(checkpoint[\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"model_state_dict\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"])\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"optimizer.load_state_dict(checkpoint[\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"optimizer_state_dict\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"])\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"epoch \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"=\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" checkpoint[\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"epoch\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"'\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"]\"\n                })]\n              })]\n            })\n          })\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"5-关键总结\",\n      children: _jsxs(_components.a, {\n        href: \"#5-关键总结\",\n        children: [\"5. \", _jsx(_components.strong, {\n          children: \"关键总结\"\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"保存模型\"\n        }), \"：本质是保存模型的 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"state_dict\"\n              })\n            })\n          })\n        }), \"（推荐），但也可以保存整个模型。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"加载模型\"\n        }), \"：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [\"若保存的是 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"state_dict\"\n                  })\n                })\n              })\n            }), \"，需先实例化模型结构，再加载参数。\"]\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"若保存的是整个模型，直接加载但需保证代码兼容性。\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"灵活性\"\n        }), \"：使用 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"state_dict\"\n              })\n            })\n          })\n        }), \" 更安全、更灵活，适合跨项目或模型结构可能变化的场景。\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"q-model-的-config-又是什么东西是超参吗\",\n      children: _jsx(_components.a, {\n        href: \"#q-model-的-config-又是什么东西是超参吗\",\n        children: \"Q: model 的 config 又是什么东西？是超参吗？\"\n      })\n    }), \"\\n\", _jsxs(ObsidianCallout, {\n      type: \"reasoning\",\n      title: \"\",\n      foldable: true,\n      isCollapsed: true,\n      children: [_jsx(_components.p, {\n        children: \"嗯，用户之前问过 PyTorch 中保存和加载模型的概念，现在又接着问\\\"model 的 config 是什么东西？是超参吗？\\\"我需要仔细分析这个问题，确保理解用户的真实需求。\"\n      }), _jsx(_components.p, {\n        children: \"首先，用户已经了解 state_dict，现在转向模型配置（config）。可能他们在实际项目中遇到了需要保存或管理模型结构的情况，或者在阅读代码时遇到了 config 这个术语。用户想知道 config 具体指什么，是否包括超参数。\"\n      }), _jsx(_components.p, {\n        children: \"接下来，我需要明确\\\"model config\\\"的定义。在机器学习中，模型配置通常指的是定义模型结构的参数，比如神经网络的层数、每层的神经元数量、激活函数类型等。而超参数可能包括学习率、批量大小、优化器类型等训练过程中的设置。但有时候这两者之间的界限并不严格，特别是当某些结构参数也被视为超参数时。\"\n      }), _jsx(_components.p, {\n        children: \"用户可能混淆了模型配置和超参数，需要区分这两者。需要举例说明，比如在 Transformer 模型中，config 可能包含隐藏层大小、头数等，而超参数则是训练时的设置。但有时，例如在 HuggingFace 的库中，模型配置类（如 BertConfig）确实包含了模型结构的所有参数，这可能让用户产生疑问。\"\n      }), _jsx(_components.p, {\n        children: \"另外，用户可能想知道为什么需要单独保存 config。可能他们在保存模型时，除了 state_dict 之外，还需要保存模型结构的信息，以便重新实例化模型。比如，如果只保存 state_dict，加载时需要先有模型类的定义和 config 参数，才能正确创建模型实例，然后加载权重。\"\n      }), _jsx(_components.p, {\n        children: \"需要解释 config 的作用：它定义了模型的结构，是重建模型实例的必要信息。与超参数不同，config 主要涉及模型架构，而超参数涉及训练过程。但有些情况下，两者可能有重叠，比如学习率可能被包含在训练配置中，而层数在模型配置中。\"\n      }), _jsx(_components.p, {\n        children: \"还需要考虑用户可能的实际应用场景。比如，使用 HuggingFace 的 Transformers 库时，模型配置被明确分离，用户需要保存 config.json 和 model.bin。这时候，config 保存模型结构，model.bin 保存 state_dict。用户可能在这种情况下遇到 config 的概念，需要解释这种设计的原因和好处。\"\n      }), _jsx(_components.p, {\n        children: \"此外，用户可能想知道如何管理 config，比如使用 YAML 或 JSON 文件来存储模型结构参数，方便版本控制和实验复现。这也是为什么分开保存 config 和 state_dict 更灵活，因为修改结构时只需调整 config 而不影响训练好的权重。\"\n      }), _jsx(_components.p, {\n        children: \"最后，要确保回答结构清晰，分点说明，给出代码示例，并比较 config 与超参数的区别和联系。同时，注意用户可能的技术水平，避免使用过于专业的术语，保持解释的易懂性。\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"在机器学习中，\", _jsxs(_components.strong, {\n        children: [\"模型的 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"config\"\n              })\n            })\n          })\n        }), \"（配置）\"]\n      }), \" 通常指\", _jsx(_components.strong, {\n        children: \"定义模型结构的所有参数\"\n      }), \"，而超参（Hyperparameters）更多指\", _jsx(_components.strong, {\n        children: \"控制训练过程的参数\"\n      }), \"。这两者有时会有重叠，但核心区别在于作用对象。以下是详细解释：\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"1-什么是模型的-config\",\n      children: _jsxs(_components.a, {\n        href: \"#1-什么是模型的-config\",\n        children: [\"1. \", _jsxs(_components.strong, {\n          children: [\"什么是模型的 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"config\"\n                })\n              })\n            })\n          }), \"？\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"模型配置\"\n          }), \"（Model Configuration）是定义\", _jsx(_components.strong, {\n            children: \"模型结构\"\n          }), \"的一组参数，例如：\"]\n        }), \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"神经网络的层数、每层的神经元数量\"\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"卷积核大小、步长（Stride）、填充（Padding）\"\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"激活函数类型（如 ReLU、Sigmoid）\"\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [\"注意力机制的头数（如 Transformer 中的 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"num_heads\"\n                  })\n                })\n              })\n            }), \"）\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [\"词嵌入维度（如 NLP 模型中的 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"hidden_size\"\n                  })\n                })\n              })\n            }), \"）\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"示例\"\n          }), \"（以 Transformer 模型为例）：\"]\n        }), \"\\n\", _jsx(_components.figure, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.pre, {\n            tabIndex: \"0\",\n            \"data-language\": \"python\",\n            \"data-theme\": \"plastic\",\n            children: _jsxs(_components.code, {\n              \"data-language\": \"python\",\n              \"data-theme\": \"plastic\",\n              style: {\n                display: \"grid\"\n              },\n              children: [_jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"config \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"=\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" {\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    \\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"num_layers\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"12\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \",          \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# Transformer 层数\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    \\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"hidden_size\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"768\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \",         \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# 隐藏层维度\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    \\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"num_attention_heads\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"12\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \",  \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# 注意力头数\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    \\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"intermediate_size\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"3072\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \",  \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# FeedForward 层维度\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    \\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"vocab_size\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \": \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"30522\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \",        \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# 词表大小\"\n                })]\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"}\"\n                })\n              })]\n            })\n          })\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"2-模型-config-与超参数的区别\",\n      children: _jsxs(_components.a, {\n        href: \"#2-模型-config-与超参数的区别\",\n        children: [\"2. \", _jsxs(_components.strong, {\n          children: [\"模型 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"config\"\n                })\n              })\n            })\n          }), \" 与超参数的区别\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: _jsx(_components.strong, {\n              children: \"类别\"\n            })\n          }), _jsx(_components.th, {\n            children: _jsx(_components.strong, {\n              children: \"模型配置（Config）\"\n            })\n          }), _jsx(_components.th, {\n            children: _jsx(_components.strong, {\n              children: \"超参数（Hyperparameters）\"\n            })\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: \"作用对象\"\n            })\n          }), _jsx(_components.td, {\n            children: \"模型结构\"\n          }), _jsx(_components.td, {\n            children: \"训练过程\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: \"典型参数\"\n            })\n          }), _jsx(_components.td, {\n            children: \"层数、维度、注意力头数、卷积核大小\"\n          }), _jsx(_components.td, {\n            children: \"学习率、批量大小（Batch Size）、优化器类型、训练轮数（Epochs）\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: \"保存目的\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"重建模型结构（如加载 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"state_dict\"\n                  })\n                })\n              })\n            }), \" 前）\"]\n          }), _jsx(_components.td, {\n            children: \"复现训练过程（如调参、实验对比）\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: \"修改频率\"\n            })\n          }), _jsx(_components.td, {\n            children: \"低频（模型结构稳定后很少改动）\"\n          }), _jsx(_components.td, {\n            children: \"高频（需反复调整优化）\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"3-为什么需要单独管理-config\",\n      children: _jsxs(_components.a, {\n        href: \"#3-为什么需要单独管理-config\",\n        children: [\"3. \", _jsxs(_components.strong, {\n          children: [\"为什么需要单独管理 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"config\"\n                })\n              })\n            })\n          }), \"？\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"场景 1：重建模型\"\n          }), _jsx(_components.br, {}), \"\\n\", \"若仅保存 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \"（模型权重），加载时必须\", _jsxs(_components.strong, {\n            children: [\"先根据 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"config\"\n                  })\n                })\n              })\n            }), \" 重建模型结构\"]\n          }), \"，才能加载权重：\"]\n        }), \"\\n\", _jsx(_components.figure, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.pre, {\n            tabIndex: \"0\",\n            \"data-language\": \"python\",\n            \"data-theme\": \"plastic\",\n            children: _jsxs(_components.code, {\n              \"data-language\": \"python\",\n              \"data-theme\": \"plastic\",\n              style: {\n                display: \"grid\"\n              },\n              children: [_jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# 保存\"\n                })\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"torch.save(model.state_dict(), \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"model_weights.pth\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \")\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"with\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#B57EDC\"\n                  },\n                  children: \" open\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"model_config.json\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \", \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"w\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \") \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"as\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" f:\"\n                })]\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    json.dump(config, f)\"\n                })\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: \" \"\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# 加载\"\n                })\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"with\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#B57EDC\"\n                  },\n                  children: \" open\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"model_config.json\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \", \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"r\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \") \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"as\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" f:\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    config \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"=\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" json.load(f)\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"model \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"=\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" MyModel(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"**\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"config)  \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# 根据 config 实例化模型\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"model.load_state_dict(torch.load(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#98C379\"\n                  },\n                  children: \"model_weights.pth\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"\\\"\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"))\"\n                })]\n              })]\n            })\n          })\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"场景 2：版本控制与实验复现\"\n          }), _jsx(_components.br, {}), \"\\n\", \"将 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"config\"\n                })\n              })\n            })\n          }), \" 保存为 JSON/YAML 文件，便于记录不同模型结构的实验效果。\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"场景 3：共享模型\"\n          }), _jsx(_components.br, {}), \"\\n\", \"开源社区常用模式（如 HuggingFace Transformers）：\"]\n        }), \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"config.json\"\n                  })\n                })\n              })\n            }), \"：定义模型结构\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"pytorch_model.bin\"\n                  })\n                })\n              })\n            }), \"：保存 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"state_dict\"\n                  })\n                })\n              })\n            })]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"4-config-与超参数的重叠情况\",\n      children: _jsxs(_components.a, {\n        href: \"#4-config-与超参数的重叠情况\",\n        children: [\"4. \", _jsxs(_components.strong, {\n          children: [_jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"config\"\n                })\n              })\n            })\n          }), \" 与超参数的重叠情况\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"某些参数可能同时影响模型结构和训练，例如：\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Dropout 比率\"\n        }), \"：既是模型结构的一部分，也被视为超参数。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"词嵌入维度\"\n        }), \"：影响模型结构，但可能因训练资源调整（如显存不足时调小维度）。\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"此时，可以\", _jsx(_components.strong, {\n        children: \"将两者统一管理\"\n      }), \"，但建议分开存储：\"]\n    }), \"\\n\", _jsx(_components.figure, {\n      \"data-rehype-pretty-code-figure\": \"\",\n      children: _jsx(_components.pre, {\n        tabIndex: \"0\",\n        \"data-language\": \"python\",\n        \"data-theme\": \"plastic\",\n        children: _jsxs(_components.code, {\n          \"data-language\": \"python\",\n          \"data-theme\": \"plastic\",\n          style: {\n            display: \"grid\"\n          },\n          children: [_jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#5F6672\",\n                fontStyle: \"italic\"\n              },\n              children: \"# 统一配置文件（config.yaml）\"\n            })\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model:\"\n            })\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"  num_layers: \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"12\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"  hidden_size: \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"768\"\n            })]\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"training:\"\n            })\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"  learning_rate: \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"1e-4\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"  batch_size: \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"32\"\n            })]\n          })]\n        })\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"5-实际代码示例\",\n      children: _jsxs(_components.a, {\n        href: \"#5-实际代码示例\",\n        children: [\"5. \", _jsx(_components.strong, {\n          children: \"实际代码示例\"\n        })]\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"定义模型时使用-config\",\n      children: _jsxs(_components.a, {\n        href: \"#定义模型时使用-config\",\n        children: [\"定义模型时使用 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"config\"\n              })\n            })\n          })\n        }), \"：\"]\n      })\n    }), \"\\n\", _jsx(_components.figure, {\n      \"data-rehype-pretty-code-figure\": \"\",\n      children: _jsx(_components.pre, {\n        tabIndex: \"0\",\n        \"data-language\": \"python\",\n        \"data-theme\": \"plastic\",\n        children: _jsxs(_components.code, {\n          \"data-language\": \"python\",\n          \"data-theme\": \"plastic\",\n          style: {\n            display: \"grid\"\n          },\n          children: [_jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#61AFEF\"\n              },\n              children: \"class\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E5C07B\"\n              },\n              children: \" TransformerModel\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"(\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#D19A66\"\n              },\n              children: \"nn\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \".\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#D19A66\"\n              },\n              children: \"Module\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"):\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#61AFEF\"\n              },\n              children: \"    def\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#B57EDC\"\n              },\n              children: \" __init__\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"(\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#C6CCD7\"\n              },\n              children: \"self\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \", \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#C6CCD7\"\n              },\n              children: \"config\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"):\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#E5C07B\"\n              },\n              children: \"        super\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"().\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#B57EDC\"\n              },\n              children: \"__init__\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"()\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"        self\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \".embedding \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" nn.Embedding(config[\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"vocab_size\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"], config[\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"hidden_size\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"])\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"        self\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \".layers \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" nn.ModuleList([TransformerBlock(config) \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"for\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" _ \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"in\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#B57EDC\"\n              },\n              children: \" range\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"(config[\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"num_layers\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"])])\"\n            })]\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#5F6672\",\n                fontStyle: \"italic\"\n              },\n              children: \"        # ...\"\n            })\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: \" \"\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#5F6672\",\n                fontStyle: \"italic\"\n              },\n              children: \"# 初始化模型\"\n            })\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"config \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" {\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"vocab_size\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \": \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"30000\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \", \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"hidden_size\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \": \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"512\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \", \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"num_layers\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \": \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"6\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"}\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" TransformerModel(config)\"\n            })]\n          })]\n        })\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"保存与加载完整模型含结构和权重\",\n      children: _jsx(_components.a, {\n        href: \"#保存与加载完整模型含结构和权重\",\n        children: \"保存与加载完整模型（含结构和权重）：\"\n      })\n    }), \"\\n\", _jsx(_components.figure, {\n      \"data-rehype-pretty-code-figure\": \"\",\n      children: _jsx(_components.pre, {\n        tabIndex: \"0\",\n        \"data-language\": \"python\",\n        \"data-theme\": \"plastic\",\n        children: _jsxs(_components.code, {\n          \"data-language\": \"python\",\n          \"data-theme\": \"plastic\",\n          style: {\n            display: \"grid\"\n          },\n          children: [_jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#5F6672\",\n                fontStyle: \"italic\"\n              },\n              children: \"# 保存（不推荐，但某些场景需要）\"\n            })\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"full_model \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" {\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"config\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \": config, \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"state_dict\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \": model.state_dict()}\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"torch.save(full_model, \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"full_model.pth\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \")\"\n            })]\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: \" \"\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#5F6672\",\n                fontStyle: \"italic\"\n              },\n              children: \"# 加载\"\n            })\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"loaded \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" torch.load(\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"full_model.pth\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \")\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" TransformerModel(loaded[\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"config\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"])\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model.load_state_dict(loaded[\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"state_dict\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"])\"\n            })]\n          })]\n        })\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"6-总结\",\n      children: _jsxs(_components.a, {\n        href: \"#6-总结\",\n        children: [\"6. \", _jsx(_components.strong, {\n          children: \"总结\"\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsxs(_components.strong, {\n          children: [\"模型 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"config\"\n                })\n              })\n            })\n          })]\n        }), \"：定义模型结构的参数（如层数、维度），是\", _jsx(_components.strong, {\n          children: \"重建模型\"\n        }), \"的必需信息。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"超参数\"\n        }), \"：控制训练过程的参数（如学习率、批量大小），影响模型如何学习。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"最佳实践\"\n        }), \"：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [\"始终保存 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"config\"\n                  })\n                })\n              })\n            }), \"（如 JSON 文件），确保模型可复现。\"]\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"分开管理模型配置和训练超参数，避免混淆。\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(ObsidianCallout, {\n      type: \"info\",\n      title: \"亮曰\",\n      children: _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"Config 主要是定义模型结构。会根据 Config 决定有多少层等。\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"超参主要是训练过程中的学习率、 Epochs 等，复现训练过程时需要，但与模型结构无关，只与训练过程有关。\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"q-所谓权重就是指-state_dict-中的内容吗\",\n      children: _jsx(_components.a, {\n        href: \"#q-所谓权重就是指-state_dict-中的内容吗\",\n        children: \"Q: 所谓\\\"权重\\\"就是指 state_dict 中的内容吗？\"\n      })\n    }), \"\\n\", _jsxs(ObsidianCallout, {\n      type: \"reasoning\",\n      title: \"\",\n      foldable: true,\n      isCollapsed: true,\n      children: [_jsx(_components.p, {\n        children: \"嗯，用户问：\\\"所谓'权重'就是指 state_dict 中的内容吗？\\\"这个问题看起来是想确认 PyTorch 中的权重和 state_dict 之间的关系。首先，我需要回顾一下之前的对话，确保回答的一致性。\"\n      }), _jsx(_components.p, {\n        children: \"之前已经解释了 state_dict 是保存模型参数的核心，里面包含了各层的权重和偏置。用户可能现在对\\\"权重\\\"这个术语的具体指向有疑问，需要明确权重是否等同于 state_dict 中的所有内容。\"\n      }), _jsx(_components.p, {\n        children: \"首先，我应该明确\\\"权重\\\"在机器学习中的定义。通常，权重指的是模型中的可学习参数，比如线性层中的权重矩阵和偏置向量。而 state_dict 不仅包括这些权重，还可能包括其他参数，比如 BatchNorm 层的均值和方差，或者优化器的状态。因此，state_dict 的内容可能比单纯的\\\"权重\\\"更广泛。\"\n      }), _jsx(_components.p, {\n        children: \"接下来，需要区分 state_dict 中的不同部分。模型和优化器都有自己的 state_dict。模型的 state_dict 包含各层的参数，而优化器的 state_dict 包含优化器的状态，如动量缓存等。用户的问题可能集中在模型的 state_dict 中的权重部分，而是否包括其他参数需要澄清。\"\n      }), _jsx(_components.p, {\n        children: \"另外，用户可能对如何正确保存和加载模型有更深入的理解需求。比如，保存 state_dict 时，是否只保存了权重，还是还有其他必要的参数？需要说明 state_dict 中的内容对于模型重建的重要性，以及权重在其中的角色。\"\n      }), _jsx(_components.p, {\n        children: \"可能用户在实际操作中遇到了问题，比如加载模型时结构不匹配，或者参数未正确加载，因此需要明确 state_dict 中的内容。需要举例说明，比如一个简单的线性模型，展示其 state_dict 中的键值对，明确哪些是权重，哪些是偏置，或者其他类型的参数。\"\n      }), _jsx(_components.p, {\n        children: \"还需要考虑用户可能的误解，比如认为 state_dict 仅包含权重，而忽略了其他必要的参数，导致模型无法正确运行。因此，强调 state_dict 包含所有必要的参数，而权重是其中的一部分，但还有其他如偏置、BatchNorm 的参数等。\"\n      }), _jsx(_components.p, {\n        children: \"此外，用户可能关心如何仅保存或操作权重，比如迁移学习中的部分参数加载。这时候需要说明如何从 state_dict 中选择性地提取或加载特定的权重部分。\"\n      }), _jsx(_components.p, {\n        children: \"总结来说，回答需要明确以下几点：\"\n      }), _jsxs(_components.ol, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"权重是模型中的可学习参数，如线性层的权重矩阵。\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"state_dict 包含模型的所有参数，包括权重、偏置以及其他层特定的参数。\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"模型的 state_dict 与优化器的 state_dict 不同，后者包含优化器状态。\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"正确加载模型需要确保 state_dict 的结构与当前模型结构匹配。\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"示例说明 state_dict 中的具体内容，帮助用户直观理解。\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), _jsx(_components.p, {\n        children: \"同时，要注意用词准确，避免混淆，比如\\\"参数\\\"和\\\"权重\\\"的区别，确保用户能清晰理解两者的包含关系。可能还需要提到在保存和加载时的最佳实践，比如如何结合 config 来重建模型结构，再加载 state_dict 中的参数，以确保模型的正确性。\"\n      }), _jsx(_components.p, {\n        children: \"最后，检查是否有遗漏点，比如是否提到 eval()模式的影响，或者训练/推理时加载参数的注意事项，但根据问题范围，可能不需要展开，除非用户有进一步的问题。\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"在 PyTorch 中，\", _jsxs(_components.strong, {\n        children: [\"\\\"权重\\\"确实是 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"state_dict\"\n              })\n            })\n          })\n        }), \" 中的核心内容\"]\n      }), \"，但 \", _jsx(_components.span, {\n        \"data-rehype-pretty-code-figure\": \"\",\n        children: _jsx(_components.code, {\n          \"data-language\": \"plaintext\",\n          \"data-theme\": \"plastic\",\n          children: _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              children: \"state_dict\"\n            })\n          })\n        })\n      }), \" 包含的信息可能比\\\"权重\\\"更广泛。以下是详细解释：\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"1-权重是什么\",\n      children: _jsxs(_components.a, {\n        href: \"#1-权重是什么\",\n        children: [\"1. \", _jsx(_components.strong, {\n          children: \"\\\"权重\\\"是什么？\"\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"权重（Weights）\"\n        }), \" 是模型中\", _jsx(_components.strong, {\n          children: \"可学习的参数\"\n        }), \"，例如：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [\"全连接层（\", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"nn.Linear\"\n                  })\n                })\n              })\n            }), \"）中的权重矩阵（\", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"weight\"\n                  })\n                })\n              })\n            }), \"）和偏置（\", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"bias\"\n                  })\n                })\n              })\n            }), \"）。\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [\"卷积层（\", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"nn.Conv2d\"\n                  })\n                })\n              })\n            }), \"）的卷积核参数。\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [\"嵌入层（\", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"nn.Embedding\"\n                  })\n                })\n              })\n            }), \"）的词向量矩阵。\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"这些参数通过反向传播和优化器（如 SGD、Adam）在训练过程中逐步更新。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"2-state_dict-中的内容\",\n      children: _jsxs(_components.a, {\n        href: \"#2-state_dict-中的内容\",\n        children: [\"2. \", _jsxs(_components.strong, {\n          children: [_jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \" 中的内容\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.span, {\n        \"data-rehype-pretty-code-figure\": \"\",\n        children: _jsx(_components.code, {\n          \"data-language\": \"plaintext\",\n          \"data-theme\": \"plastic\",\n          children: _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              children: \"state_dict\"\n            })\n          })\n        })\n      }), \" 是 PyTorch 中模型或优化器的\", _jsx(_components.strong, {\n        children: \"状态字典\"\n      }), \"，具体包含：\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"对模型而言\"\n        }), \"：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [\"所有权重（\", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"weight\"\n                  })\n                })\n              })\n            }), \"）、偏置（\", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"bias\"\n                  })\n                })\n              })\n            }), \"）。\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [\"其他\", _jsx(_components.strong, {\n              children: \"与层相关的参数\"\n            }), \"，例如：\", \"\\n\", _jsxs(_components.ul, {\n              children: [\"\\n\", _jsxs(_components.li, {\n                children: [_jsx(_components.span, {\n                  \"data-rehype-pretty-code-figure\": \"\",\n                  children: _jsx(_components.code, {\n                    \"data-language\": \"plaintext\",\n                    \"data-theme\": \"plastic\",\n                    children: _jsx(_components.span, {\n                      \"data-line\": \"\",\n                      children: _jsx(_components.span, {\n                        children: \"BatchNorm\"\n                      })\n                    })\n                  })\n                }), \" 层的 \", _jsx(_components.span, {\n                  \"data-rehype-pretty-code-figure\": \"\",\n                  children: _jsx(_components.code, {\n                    \"data-language\": \"plaintext\",\n                    \"data-theme\": \"plastic\",\n                    children: _jsx(_components.span, {\n                      \"data-line\": \"\",\n                      children: _jsx(_components.span, {\n                        children: \"running_mean\"\n                      })\n                    })\n                  })\n                }), \" 和 \", _jsx(_components.span, {\n                  \"data-rehype-pretty-code-figure\": \"\",\n                  children: _jsx(_components.code, {\n                    \"data-language\": \"plaintext\",\n                    \"data-theme\": \"plastic\",\n                    children: _jsx(_components.span, {\n                      \"data-line\": \"\",\n                      children: _jsx(_components.span, {\n                        children: \"running_var\"\n                      })\n                    })\n                  })\n                }), \"（在推理时使用的均值和方差）。\"]\n              }), \"\\n\", _jsxs(_components.li, {\n                children: [_jsx(_components.span, {\n                  \"data-rehype-pretty-code-figure\": \"\",\n                  children: _jsx(_components.code, {\n                    \"data-language\": \"plaintext\",\n                    \"data-theme\": \"plastic\",\n                    children: _jsx(_components.span, {\n                      \"data-line\": \"\",\n                      children: _jsx(_components.span, {\n                        children: \"LSTM\"\n                      })\n                    })\n                  })\n                }), \" 或 \", _jsx(_components.span, {\n                  \"data-rehype-pretty-code-figure\": \"\",\n                  children: _jsx(_components.code, {\n                    \"data-language\": \"plaintext\",\n                    \"data-theme\": \"plastic\",\n                    children: _jsx(_components.span, {\n                      \"data-line\": \"\",\n                      children: _jsx(_components.span, {\n                        children: \"GRU\"\n                      })\n                    })\n                  })\n                }), \" 中的隐藏状态缓存（如果模型设计时显式存储了这些状态）。\"]\n              }), \"\\n\"]\n            }), \"\\n\"]\n          }), \"\\n\"]\n        }), \"\\n\", _jsx(_components.figure, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.pre, {\n            tabIndex: \"0\",\n            \"data-language\": \"python\",\n            \"data-theme\": \"plastic\",\n            children: _jsxs(_components.code, {\n              \"data-language\": \"python\",\n              \"data-theme\": \"plastic\",\n              style: {\n                display: \"grid\"\n              },\n              children: [_jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# 示例：一个简单模型的 state_dict\"\n                })\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"model \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"=\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" nn.Sequential(\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    nn.Linear(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"10\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \", \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"20\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"),\"\n                })]\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    nn.ReLU(),\"\n                })\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"    nn.BatchNorm1d(\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#56B6C2\"\n                  },\n                  children: \"20\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \")\"\n                })]\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \")\"\n                })\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#B57EDC\"\n                  },\n                  children: \"print\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"(model.state_dict().keys())\"\n                })]\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# 输出：\"\n                })\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# ['0.weight', '0.bias', '2.weight', '2.bias', '2.running_mean', '2.running_var', '2.num_batches_tracked']\"\n                })\n              })]\n            })\n          })\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"对优化器而言\"\n        }), \"：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"优化器的状态（如动量缓存、历史梯度等）。\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsx(_components.figure, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.pre, {\n            tabIndex: \"0\",\n            \"data-language\": \"python\",\n            \"data-theme\": \"plastic\",\n            children: _jsxs(_components.code, {\n              \"data-language\": \"python\",\n              \"data-theme\": \"plastic\",\n              style: {\n                display: \"grid\"\n              },\n              children: [_jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"optimizer \"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#E06C75\"\n                  },\n                  children: \"=\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \" torch.optim.Adam(model.parameters())\"\n                })]\n              }), \"\\n\", _jsxs(_components.span, {\n                \"data-line\": \"\",\n                children: [_jsx(_components.span, {\n                  style: {\n                    color: \"#B57EDC\"\n                  },\n                  children: \"print\"\n                }), _jsx(_components.span, {\n                  style: {\n                    color: \"#A9B2C3\"\n                  },\n                  children: \"(optimizer.state_dict().keys())\"\n                })]\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# 输出：\"\n                })\n              }), \"\\n\", _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  style: {\n                    color: \"#5F6672\",\n                    fontStyle: \"italic\"\n                  },\n                  children: \"# ['state', 'param_groups']\"\n                })\n              })]\n            })\n          })\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"3-权重与-state_dict-的关系\",\n      children: _jsxs(_components.a, {\n        href: \"#3-权重与-state_dict-的关系\",\n        children: [\"3. \", _jsxs(_components.strong, {\n          children: [\"\\\"权重\\\"与 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \" 的关系\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsxs(_components.strong, {\n          children: [_jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \" 包含权重，但不仅限于权重\"]\n        }), \"：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [\"权重是 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"state_dict\"\n                  })\n                })\n              })\n            }), \" 中的一部分（如 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"conv1.weight\"\n                  })\n                })\n              })\n            }), \", \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"fc.bias\"\n                  })\n                })\n              })\n            }), \"）。\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"state_dict\"\n                  })\n                })\n              })\n            }), \" 还可能包含\", _jsx(_components.strong, {\n              children: \"非可学习的参数\"\n            }), \"（如 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"BatchNorm\"\n                  })\n                })\n              })\n            }), \" 的统计量 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"running_mean\"\n                  })\n                })\n              })\n            }), \"）。\"]\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"对于复杂模型（如 Transformer），还可能包含位置编码、注意力掩码等参数。\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"总结\"\n        }), \"：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [_jsxs(_components.strong, {\n              children: [\"权重是 \", _jsx(_components.span, {\n                \"data-rehype-pretty-code-figure\": \"\",\n                children: _jsx(_components.code, {\n                  \"data-language\": \"plaintext\",\n                  \"data-theme\": \"plastic\",\n                  children: _jsx(_components.span, {\n                    \"data-line\": \"\",\n                    children: _jsx(_components.span, {\n                      children: \"state_dict\"\n                    })\n                  })\n                })\n              }), \" 的核心内容\"]\n            }), \"，但 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"state_dict\"\n                  })\n                })\n              })\n            }), \" 是更全面的模型状态表示。\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"4-为什么需要-state_dict-而不仅仅是权重\",\n      children: _jsxs(_components.a, {\n        href: \"#4-为什么需要-state_dict-而不仅仅是权重\",\n        children: [\"4. \", _jsxs(_components.strong, {\n          children: [\"为什么需要 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \" 而不仅仅是权重？\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"完整恢复模型状态\"\n        }), \"：\\n如果仅保存权重，忽略 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"BatchNorm\"\n              })\n            })\n          })\n        }), \" 的 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"running_mean\"\n              })\n            })\n          })\n        }), \" 等参数，在推理时会导致统计量错误，影响模型性能。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"兼容性\"\n        }), \"：\\n加载模型时需确保 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"state_dict\"\n              })\n            })\n          })\n        }), \" 的键（如层名称）与当前模型结构严格匹配，否则会报错 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"Missing keys\"\n              })\n            })\n          })\n        }), \" 或 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"Unexpected keys\"\n              })\n            })\n          })\n        }), \"。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"灵活性\"\n        }), \"：\\n可以手动修改 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"state_dict\"\n              })\n            })\n          })\n        }), \"，例如迁移学习中仅加载部分层的权重。\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"5-操作-state_dict-的常见场景\",\n      children: _jsxs(_components.a, {\n        href: \"#5-操作-state_dict-的常见场景\",\n        children: [\"5. \", _jsxs(_components.strong, {\n          children: [\"操作 \", _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          }), \" 的常见场景\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"1-查看模型权重\",\n      children: _jsx(_components.a, {\n        href: \"#1-查看模型权重\",\n        children: _jsx(_components.strong, {\n          children: \"(1) 查看模型权重\"\n        })\n      })\n    }), \"\\n\", _jsx(_components.figure, {\n      \"data-rehype-pretty-code-figure\": \"\",\n      children: _jsx(_components.pre, {\n        tabIndex: \"0\",\n        \"data-language\": \"python\",\n        \"data-theme\": \"plastic\",\n        children: _jsxs(_components.code, {\n          \"data-language\": \"python\",\n          \"data-theme\": \"plastic\",\n          style: {\n            display: \"grid\"\n          },\n          children: [_jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"for\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" name, param \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"in\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" model.named_parameters():\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#B57EDC\"\n              },\n              children: \"    print\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"(\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#61AFEF\"\n              },\n              children: \"f\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"\\\"层名: \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"{\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"name\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"}\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \", 参数形状: \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"{\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"param.shape\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#56B6C2\"\n              },\n              children: \"}\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"\\\"\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \")\"\n            })]\n          })]\n        })\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"2-选择性加载部分权重迁移学习\",\n      children: _jsx(_components.a, {\n        href: \"#2-选择性加载部分权重迁移学习\",\n        children: _jsx(_components.strong, {\n          children: \"(2) 选择性加载部分权重（迁移学习）\"\n        })\n      })\n    }), \"\\n\", _jsx(_components.figure, {\n      \"data-rehype-pretty-code-figure\": \"\",\n      children: _jsx(_components.pre, {\n        tabIndex: \"0\",\n        \"data-language\": \"python\",\n        \"data-theme\": \"plastic\",\n        children: _jsxs(_components.code, {\n          \"data-language\": \"python\",\n          \"data-theme\": \"plastic\",\n          style: {\n            display: \"grid\"\n          },\n          children: [_jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"pretrained_dict \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" torch.load(\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"'\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#98C379\"\n              },\n              children: \"pretrained.pth\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"'\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \")\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model_dict \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" model.state_dict()\"\n            })]\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: \" \"\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#5F6672\",\n                fontStyle: \"italic\"\n              },\n              children: \"# 筛选出名称和形状匹配的权重\"\n            })\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"pretrained_dict \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"=\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" {\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"    k: v \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"for\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" k, v \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"in\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" pretrained_dict.items()\"\n            })]\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"    if\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" k \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"in\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" model_dict \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"and\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" v.shape \"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"==\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" model_dict[k].shape\"\n            })]\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"}\"\n            })\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model_dict.update(pretrained_dict)\"\n            })\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"model.load_state_dict(model_dict)\"\n            })\n          })]\n        })\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"3-手动修改权重\",\n      children: _jsx(_components.a, {\n        href: \"#3-手动修改权重\",\n        children: _jsx(_components.strong, {\n          children: \"(3) 手动修改权重\"\n        })\n      })\n    }), \"\\n\", _jsx(_components.figure, {\n      \"data-rehype-pretty-code-figure\": \"\",\n      children: _jsx(_components.pre, {\n        tabIndex: \"0\",\n        \"data-language\": \"python\",\n        \"data-theme\": \"plastic\",\n        children: _jsxs(_components.code, {\n          \"data-language\": \"python\",\n          \"data-theme\": \"plastic\",\n          style: {\n            display: \"grid\"\n          },\n          children: [_jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#5F6672\",\n                fontStyle: \"italic\"\n              },\n              children: \"# 将第一层卷积的权重置零\"\n            })\n          }), \"\\n\", _jsxs(_components.span, {\n            \"data-line\": \"\",\n            children: [_jsx(_components.span, {\n              style: {\n                color: \"#E06C75\"\n              },\n              children: \"with\"\n            }), _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \" torch.no_grad():\"\n            })]\n          }), \"\\n\", _jsx(_components.span, {\n            \"data-line\": \"\",\n            children: _jsx(_components.span, {\n              style: {\n                color: \"#A9B2C3\"\n              },\n              children: \"    model.conv1.weight.copy_(torch.zeros_like(model.conv1.weight))\"\n            })\n          })]\n        })\n      })\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.h3, {\n      id: \"6-总结-1\",\n      children: _jsxs(_components.a, {\n        href: \"#6-总结-1\",\n        children: [\"6. \", _jsx(_components.strong, {\n          children: \"总结\"\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"权重\"\n        }), \"是模型的可学习参数，是 \", _jsx(_components.span, {\n          \"data-rehype-pretty-code-figure\": \"\",\n          children: _jsx(_components.code, {\n            \"data-language\": \"plaintext\",\n            \"data-theme\": \"plastic\",\n            children: _jsx(_components.span, {\n              \"data-line\": \"\",\n              children: _jsx(_components.span, {\n                children: \"state_dict\"\n              })\n            })\n          })\n        }), \" 的核心内容。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: _jsx(_components.span, {\n            \"data-rehype-pretty-code-figure\": \"\",\n            children: _jsx(_components.code, {\n              \"data-language\": \"plaintext\",\n              \"data-theme\": \"plastic\",\n              children: _jsx(_components.span, {\n                \"data-line\": \"\",\n                children: _jsx(_components.span, {\n                  children: \"state_dict\"\n                })\n              })\n            })\n          })\n        }), \" 是模型状态的完整表示，包括：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"所有权重、偏置。\"\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [\"非可学习的运行时参数（如 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"BatchNorm\"\n                  })\n                })\n              })\n            }), \" 的统计量）。\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"最佳实践\"\n        }), \"：\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [\"保存模型时使用 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"torch.save(model.state_dict(), ...)\"\n                  })\n                })\n              })\n            }), \"。\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [\"加载时需先构建相同结构的模型，再调用 \", _jsx(_components.span, {\n              \"data-rehype-pretty-code-figure\": \"\",\n              children: _jsx(_components.code, {\n                \"data-language\": \"plaintext\",\n                \"data-theme\": \"plastic\",\n                children: _jsx(_components.span, {\n                  \"data-line\": \"\",\n                  children: _jsx(_components.span, {\n                    children: \"model.load_state_dict()\"\n                  })\n                })\n              })\n            }), \"。\"]\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"若需调整模型结构，可选择性加载匹配的权重。\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(ObsidianCallout, {\n      type: \"info\",\n      title: \"亮曰\",\n      children: _jsxs(_components.p, {\n        children: [\"state_dict 包括 Parameter 与 Buffer ，模型的可学习参数——\", _jsx(_components.strong, {\n          children: \"权重\"\n        }), \"主要指其中的 Parameter 。\"]\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"meta":{"content":"\n\u003e 本文为与 DeepSeek 对话记录，深入探讨 PyTorch 中模型的保存和加载机制，包括不同的保存方式、最佳实践以及常见问题的解决方案。\n\n## Q: PyTorch 中所谓的保存模型/加载模型，指的是保存/加载什么？是 state_dict 吗？\n\n\u003e [!reasoning]-\n\u003e\n\u003e 嗯，我现在要弄清楚 PyTorch 中保存和加载模型到底是怎么回事。用户问是不是保存和加载 state_dict，我需要仔细想一想这个问题。\n\u003e\n\u003e 首先，我记得在 PyTorch 里训练模型的时候，模型的可学习参数，比如各层的权重和偏置，是存放在模型的 parameters 中的。而 state_dict 应该是一个保存这些参数的东西。对，每个 torch.nn.Module 都有 state_dict，它是一个字典，将每个层映射到对应的参数张量。\n\u003e\n\u003e 那保存模型的时候，有两种常见的方法。一种是直接保存整个模型，使用 torch.save(model, 'model.pth')。这样的话，保存的是整个模型对象，包括结构定义和参数。不过这种方法可能有缺点，比如当模型定义所在的文件路径变化时，加载的时候可能会找不到类定义，导致错误。所以通常更推荐另一种方法，就是只保存 state_dict，这样需要的时候再加载到一个定义好的模型结构中。\n\u003e\n\u003e 所以用户的问题是说保存模型是不是保存 state_dict，对吧？是的，通常最佳做法是保存 state_dict，而不是整个模型对象。因为 state_dict 只包含参数，不包含模型结构，这样在加载的时候更灵活。比如，当你想在不同项目中使用同一个模型参数，或者模型类有修改时，加载 state_dict 会更方便。\n\u003e\n\u003e 那加载的时候，就需要先实例化模型，然后用 load_state_dict 方法加载参数。比如：\n\u003e\n\u003e model = MyModelClass(\\*args, \\*\\*kwargs)\n\u003e\n\u003e model.load_state_dict(torch.load('model.pth'))\n\u003e\n\u003e 这样参数就被正确加载到模型里了。而如果保存的是整个模型，加载的时候可以直接用 model = torch.load('model.pth')，但这时候模型类必须在当前作用域可访问，否则会出错。\n\u003e\n\u003e 所以总结一下，保存模型通常指的是保存 state_dict，而加载模型就是加载这个 state_dict 到已经定义好的模型结构中。当然，PyTorch 也允许保存整个模型，但不够灵活，所以推荐用 state_dict 的方式。\n\u003e\n\u003e 另外，可能还有其他需要保存的内容，比如优化器的 state_dict，这样在恢复训练的时候可以接着之前的优化器状态继续训练。这时候保存的 checkpoint 可能包括 model_state_dict、optimizer_state_dict、epoch、loss 等信息。加载的时候需要分别处理这些部分。\n\u003e\n\u003e 但用户的问题主要是关于保存和加载模型本身，所以核心答案应该是 state_dict。不过要说明保存整个模型的情况也存在，但 state_dict 更推荐。所以回答的时候应该涵盖这两种情况，但强调 state_dict 是更常用的方法。\n\n在 PyTorch 中，保存和加载模型的**核心是 `state_dict`**，但具体操作可以灵活选择。以下是详细说明：\n\n---\n\n### 1. **`state_dict` 是什么？**\n\n- **`state_dict`** 是一个 Python 字典对象，它将模型的每一层（如卷积层、全连接层等）映射到对应的参数张量（权重和偏置）。\n- 例如，一个简单的神经网络可能包含：\n  ```python\n  model.state_dict() = {\n      'conv1.weight': tensor(...),\n      'conv1.bias': tensor(...),\n      'fc1.weight': tensor(...),\n      'fc1.bias': tensor(...),\n      ...\n  }\n  ```\n- **优化器**（如 `torch.optim.SGD`）也有自己的 `state_dict`，保存优化器的状态（如动量缓冲等）。\n\n---\n\n### 2. **保存模型的两种方式**\n\n#### **方式 1：仅保存 `state_dict`（推荐）**\n\n- **代码示例**：\n  ```python\n  torch.save(model.state_dict(), 'model_weights.pth')\n  ```\n- **优点**：\n  - 文件体积小，只保存参数，不保存模型结构。\n  - 加载灵活：需先实例化模型结构，再加载参数。\n  - 避免因代码变更（如类名修改）导致的加载失败。\n\n#### **方式 2：保存整个模型（不推荐）**\n\n- **代码示例**：\n  ```python\n  torch.save(model, 'entire_model.pth')\n  ```\n- **缺点**：\n  - 文件体积大，包含模型结构和参数。\n  - 依赖原始代码环境（模型类的定义必须存在），否则加载时会报错。\n\n---\n\n### 3. **加载模型的对应方法**\n\n#### **加载 `state_dict`（需先构建模型结构）**\n\n```python\nmodel = MyModelClass()  # 必须与保存时的模型结构一致\nmodel.load_state_dict(torch.load('model_weights.pth'))\nmodel.eval()  # 切换到推理模式（关闭 dropout 等）\n```\n\n#### **加载整个模型（直接使用）**\n\n```python\nmodel = torch.load('entire_model.pth')\nmodel.eval()\n```\n\n---\n\n### 4. **实际场景中的最佳实践**\n\n- **保存训练检查点（Checkpoint）**：\n  通常需要保存 `state_dict` 之外的信息（如优化器状态、训练步数等）：\n\n  ```python\n  checkpoint = {\n      'model_state_dict': model.state_dict(),\n      'optimizer_state_dict': optimizer.state_dict(),\n      'epoch': 100,\n      'loss': loss,\n  }\n  torch.save(checkpoint, 'checkpoint.pth')\n  ```\n\n- **加载检查点**：\n  ```python\n  checkpoint = torch.load('checkpoint.pth')\n  model.load_state_dict(checkpoint['model_state_dict'])\n  optimizer.load_state_dict(checkpoint['optimizer_state_dict'])\n  epoch = checkpoint['epoch']\n  ```\n\n---\n\n### 5. **关键总结**\n\n- **保存模型**：本质是保存模型的 `state_dict`（推荐），但也可以保存整个模型。\n- **加载模型**：\n  - 若保存的是 `state_dict`，需先实例化模型结构，再加载参数。\n  - 若保存的是整个模型，直接加载但需保证代码兼容性。\n- **灵活性**：使用 `state_dict` 更安全、更灵活，适合跨项目或模型结构可能变化的场景。\n\n## Q: model 的 config 又是什么东西？是超参吗？\n\n\u003e [!reasoning]-\n\u003e\n\u003e 嗯，用户之前问过 PyTorch 中保存和加载模型的概念，现在又接着问\"model 的 config 是什么东西？是超参吗？\"我需要仔细分析这个问题，确保理解用户的真实需求。\n\u003e\n\u003e 首先，用户已经了解 state_dict，现在转向模型配置（config）。可能他们在实际项目中遇到了需要保存或管理模型结构的情况，或者在阅读代码时遇到了 config 这个术语。用户想知道 config 具体指什么，是否包括超参数。\n\u003e\n\u003e 接下来，我需要明确\"model config\"的定义。在机器学习中，模型配置通常指的是定义模型结构的参数，比如神经网络的层数、每层的神经元数量、激活函数类型等。而超参数可能包括学习率、批量大小、优化器类型等训练过程中的设置。但有时候这两者之间的界限并不严格，特别是当某些结构参数也被视为超参数时。\n\u003e\n\u003e 用户可能混淆了模型配置和超参数，需要区分这两者。需要举例说明，比如在 Transformer 模型中，config 可能包含隐藏层大小、头数等，而超参数则是训练时的设置。但有时，例如在 HuggingFace 的库中，模型配置类（如 BertConfig）确实包含了模型结构的所有参数，这可能让用户产生疑问。\n\u003e\n\u003e 另外，用户可能想知道为什么需要单独保存 config。可能他们在保存模型时，除了 state_dict 之外，还需要保存模型结构的信息，以便重新实例化模型。比如，如果只保存 state_dict，加载时需要先有模型类的定义和 config 参数，才能正确创建模型实例，然后加载权重。\n\u003e\n\u003e 需要解释 config 的作用：它定义了模型的结构，是重建模型实例的必要信息。与超参数不同，config 主要涉及模型架构，而超参数涉及训练过程。但有些情况下，两者可能有重叠，比如学习率可能被包含在训练配置中，而层数在模型配置中。\n\u003e\n\u003e 还需要考虑用户可能的实际应用场景。比如，使用 HuggingFace 的 Transformers 库时，模型配置被明确分离，用户需要保存 config.json 和 model.bin。这时候，config 保存模型结构，model.bin 保存 state_dict。用户可能在这种情况下遇到 config 的概念，需要解释这种设计的原因和好处。\n\u003e\n\u003e 此外，用户可能想知道如何管理 config，比如使用 YAML 或 JSON 文件来存储模型结构参数，方便版本控制和实验复现。这也是为什么分开保存 config 和 state_dict 更灵活，因为修改结构时只需调整 config 而不影响训练好的权重。\n\u003e\n\u003e 最后，要确保回答结构清晰，分点说明，给出代码示例，并比较 config 与超参数的区别和联系。同时，注意用户可能的技术水平，避免使用过于专业的术语，保持解释的易懂性。\n\n在机器学习中，**模型的 `config`（配置）** 通常指**定义模型结构的所有参数**，而超参（Hyperparameters）更多指**控制训练过程的参数**。这两者有时会有重叠，但核心区别在于作用对象。以下是详细解释：\n\n---\n\n### 1. **什么是模型的 `config`？**\n\n- **模型配置**（Model Configuration）是定义**模型结构**的一组参数，例如：\n\n  - 神经网络的层数、每层的神经元数量\n  - 卷积核大小、步长（Stride）、填充（Padding）\n  - 激活函数类型（如 ReLU、Sigmoid）\n  - 注意力机制的头数（如 Transformer 中的 `num_heads`）\n  - 词嵌入维度（如 NLP 模型中的 `hidden_size`）\n\n- **示例**（以 Transformer 模型为例）：\n  ```python\n  config = {\n      \"num_layers\": 12,          # Transformer 层数\n      \"hidden_size\": 768,         # 隐藏层维度\n      \"num_attention_heads\": 12,  # 注意力头数\n      \"intermediate_size\": 3072,  # FeedForward 层维度\n      \"vocab_size\": 30522,        # 词表大小\n  }\n  ```\n\n---\n\n### 2. **模型 `config` 与超参数的区别**\n\n| **类别**     | **模型配置（Config）**                 | **超参数（Hyperparameters）**                                  |\n| ------------ | -------------------------------------- | -------------------------------------------------------------- |\n| **作用对象** | 模型结构                               | 训练过程                                                       |\n| **典型参数** | 层数、维度、注意力头数、卷积核大小     | 学习率、批量大小（Batch Size）、优化器类型、训练轮数（Epochs） |\n| **保存目的** | 重建模型结构（如加载 `state_dict` 前） | 复现训练过程（如调参、实验对比）                               |\n| **修改频率** | 低频（模型结构稳定后很少改动）         | 高频（需反复调整优化）                                         |\n\n---\n\n### 3. **为什么需要单独管理 `config`？**\n\n- **场景 1：重建模型**  \n  若仅保存 `state_dict`（模型权重），加载时必须**先根据 `config` 重建模型结构**，才能加载权重：\n\n  ```python\n  # 保存\n  torch.save(model.state_dict(), \"model_weights.pth\")\n  with open(\"model_config.json\", \"w\") as f:\n      json.dump(config, f)\n\n  # 加载\n  with open(\"model_config.json\", \"r\") as f:\n      config = json.load(f)\n  model = MyModel(**config)  # 根据 config 实例化模型\n  model.load_state_dict(torch.load(\"model_weights.pth\"))\n  ```\n\n- **场景 2：版本控制与实验复现**  \n  将 `config` 保存为 JSON/YAML 文件，便于记录不同模型结构的实验效果。\n\n- **场景 3：共享模型**  \n  开源社区常用模式（如 HuggingFace Transformers）：\n  - `config.json`：定义模型结构\n  - `pytorch_model.bin`：保存 `state_dict`\n\n---\n\n### 4. **`config` 与超参数的重叠情况**\n\n某些参数可能同时影响模型结构和训练，例如：\n\n- **Dropout 比率**：既是模型结构的一部分，也被视为超参数。\n- **词嵌入维度**：影响模型结构，但可能因训练资源调整（如显存不足时调小维度）。\n\n此时，可以**将两者统一管理**，但建议分开存储：\n\n```python\n# 统一配置文件（config.yaml）\nmodel:\n  num_layers: 12\n  hidden_size: 768\ntraining:\n  learning_rate: 1e-4\n  batch_size: 32\n```\n\n---\n\n### 5. **实际代码示例**\n\n#### 定义模型时使用 `config`：\n\n```python\nclass TransformerModel(nn.Module):\n    def __init__(self, config):\n        super().__init__()\n        self.embedding = nn.Embedding(config[\"vocab_size\"], config[\"hidden_size\"])\n        self.layers = nn.ModuleList([TransformerBlock(config) for _ in range(config[\"num_layers\"])])\n        # ...\n\n# 初始化模型\nconfig = {\"vocab_size\": 30000, \"hidden_size\": 512, \"num_layers\": 6}\nmodel = TransformerModel(config)\n```\n\n#### 保存与加载完整模型（含结构和权重）：\n\n```python\n# 保存（不推荐，但某些场景需要）\nfull_model = {\"config\": config, \"state_dict\": model.state_dict()}\ntorch.save(full_model, \"full_model.pth\")\n\n# 加载\nloaded = torch.load(\"full_model.pth\")\nmodel = TransformerModel(loaded[\"config\"])\nmodel.load_state_dict(loaded[\"state_dict\"])\n```\n\n---\n\n### 6. **总结**\n\n- **模型 `config`**：定义模型结构的参数（如层数、维度），是**重建模型**的必需信息。\n- **超参数**：控制训练过程的参数（如学习率、批量大小），影响模型如何学习。\n- **最佳实践**：\n  - 始终保存 `config`（如 JSON 文件），确保模型可复现。\n  - 分开管理模型配置和训练超参数，避免混淆。\n\n\u003e [!info] 亮曰\n\u003e\n\u003e - Config 主要是定义模型结构。会根据 Config 决定有多少层等。\n\u003e - 超参主要是训练过程中的学习率、 Epochs 等，复现训练过程时需要，但与模型结构无关，只与训练过程有关。\n\n## Q: 所谓\"权重\"就是指 state_dict 中的内容吗？\n\n\u003e [!reasoning]-\n\u003e\n\u003e 嗯，用户问：\"所谓'权重'就是指 state_dict 中的内容吗？\"这个问题看起来是想确认 PyTorch 中的权重和 state_dict 之间的关系。首先，我需要回顾一下之前的对话，确保回答的一致性。\n\u003e\n\u003e 之前已经解释了 state_dict 是保存模型参数的核心，里面包含了各层的权重和偏置。用户可能现在对\"权重\"这个术语的具体指向有疑问，需要明确权重是否等同于 state_dict 中的所有内容。\n\u003e\n\u003e 首先，我应该明确\"权重\"在机器学习中的定义。通常，权重指的是模型中的可学习参数，比如线性层中的权重矩阵和偏置向量。而 state_dict 不仅包括这些权重，还可能包括其他参数，比如 BatchNorm 层的均值和方差，或者优化器的状态。因此，state_dict 的内容可能比单纯的\"权重\"更广泛。\n\u003e\n\u003e 接下来，需要区分 state_dict 中的不同部分。模型和优化器都有自己的 state_dict。模型的 state_dict 包含各层的参数，而优化器的 state_dict 包含优化器的状态，如动量缓存等。用户的问题可能集中在模型的 state_dict 中的权重部分，而是否包括其他参数需要澄清。\n\u003e\n\u003e 另外，用户可能对如何正确保存和加载模型有更深入的理解需求。比如，保存 state_dict 时，是否只保存了权重，还是还有其他必要的参数？需要说明 state_dict 中的内容对于模型重建的重要性，以及权重在其中的角色。\n\u003e\n\u003e 可能用户在实际操作中遇到了问题，比如加载模型时结构不匹配，或者参数未正确加载，因此需要明确 state_dict 中的内容。需要举例说明，比如一个简单的线性模型，展示其 state_dict 中的键值对，明确哪些是权重，哪些是偏置，或者其他类型的参数。\n\u003e\n\u003e 还需要考虑用户可能的误解，比如认为 state_dict 仅包含权重，而忽略了其他必要的参数，导致模型无法正确运行。因此，强调 state_dict 包含所有必要的参数，而权重是其中的一部分，但还有其他如偏置、BatchNorm 的参数等。\n\u003e\n\u003e 此外，用户可能关心如何仅保存或操作权重，比如迁移学习中的部分参数加载。这时候需要说明如何从 state_dict 中选择性地提取或加载特定的权重部分。\n\u003e\n\u003e 总结来说，回答需要明确以下几点：\n\u003e\n\u003e 1. 权重是模型中的可学习参数，如线性层的权重矩阵。\n\u003e\n\u003e 2. state_dict 包含模型的所有参数，包括权重、偏置以及其他层特定的参数。\n\u003e\n\u003e 3. 模型的 state_dict 与优化器的 state_dict 不同，后者包含优化器状态。\n\u003e\n\u003e 4. 正确加载模型需要确保 state_dict 的结构与当前模型结构匹配。\n\u003e\n\u003e 5. 示例说明 state_dict 中的具体内容，帮助用户直观理解。\n\u003e\n\u003e 同时，要注意用词准确，避免混淆，比如\"参数\"和\"权重\"的区别，确保用户能清晰理解两者的包含关系。可能还需要提到在保存和加载时的最佳实践，比如如何结合 config 来重建模型结构，再加载 state_dict 中的参数，以确保模型的正确性。\n\u003e\n\u003e 最后，检查是否有遗漏点，比如是否提到 eval()模式的影响，或者训练/推理时加载参数的注意事项，但根据问题范围，可能不需要展开，除非用户有进一步的问题。\n\n在 PyTorch 中，**\"权重\"确实是 `state_dict` 中的核心内容**，但 `state_dict` 包含的信息可能比\"权重\"更广泛。以下是详细解释：\n\n---\n\n### 1. **\"权重\"是什么？**\n\n- **权重（Weights）** 是模型中**可学习的参数**，例如：\n  - 全连接层（`nn.Linear`）中的权重矩阵（`weight`）和偏置（`bias`）。\n  - 卷积层（`nn.Conv2d`）的卷积核参数。\n  - 嵌入层（`nn.Embedding`）的词向量矩阵。\n- 这些参数通过反向传播和优化器（如 SGD、Adam）在训练过程中逐步更新。\n\n---\n\n### 2. **`state_dict` 中的内容**\n\n`state_dict` 是 PyTorch 中模型或优化器的**状态字典**，具体包含：\n\n- **对模型而言**：\n  - 所有权重（`weight`）、偏置（`bias`）。\n  - 其他**与层相关的参数**，例如：\n    - `BatchNorm` 层的 `running_mean` 和 `running_var`（在推理时使用的均值和方差）。\n    - `LSTM` 或 `GRU` 中的隐藏状态缓存（如果模型设计时显式存储了这些状态）。\n  ```python\n  # 示例：一个简单模型的 state_dict\n  model = nn.Sequential(\n      nn.Linear(10, 20),\n      nn.ReLU(),\n      nn.BatchNorm1d(20)\n  )\n  print(model.state_dict().keys())\n  # 输出：\n  # ['0.weight', '0.bias', '2.weight', '2.bias', '2.running_mean', '2.running_var', '2.num_batches_tracked']\n  ```\n- **对优化器而言**：\n  - 优化器的状态（如动量缓存、历史梯度等）。\n  ```python\n  optimizer = torch.optim.Adam(model.parameters())\n  print(optimizer.state_dict().keys())\n  # 输出：\n  # ['state', 'param_groups']\n  ```\n\n---\n\n### 3. **\"权重\"与 `state_dict` 的关系**\n\n- **`state_dict` 包含权重，但不仅限于权重**：\n  - 权重是 `state_dict` 中的一部分（如 `conv1.weight`, `fc.bias`）。\n  - `state_dict` 还可能包含**非可学习的参数**（如 `BatchNorm` 的统计量 `running_mean`）。\n  - 对于复杂模型（如 Transformer），还可能包含位置编码、注意力掩码等参数。\n- **总结**：\n  - **权重是 `state_dict` 的核心内容**，但 `state_dict` 是更全面的模型状态表示。\n\n---\n\n### 4. **为什么需要 `state_dict` 而不仅仅是权重？**\n\n- **完整恢复模型状态**：\n  如果仅保存权重，忽略 `BatchNorm` 的 `running_mean` 等参数，在推理时会导致统计量错误，影响模型性能。\n- **兼容性**：\n  加载模型时需确保 `state_dict` 的键（如层名称）与当前模型结构严格匹配，否则会报错 `Missing keys` 或 `Unexpected keys`。\n- **灵活性**：\n  可以手动修改 `state_dict`，例如迁移学习中仅加载部分层的权重。\n\n---\n\n### 5. **操作 `state_dict` 的常见场景**\n\n#### **(1) 查看模型权重**\n\n```python\nfor name, param in model.named_parameters():\n    print(f\"层名: {name}, 参数形状: {param.shape}\")\n```\n\n#### **(2) 选择性加载部分权重（迁移学习）**\n\n```python\npretrained_dict = torch.load('pretrained.pth')\nmodel_dict = model.state_dict()\n\n# 筛选出名称和形状匹配的权重\npretrained_dict = {\n    k: v for k, v in pretrained_dict.items()\n    if k in model_dict and v.shape == model_dict[k].shape\n}\nmodel_dict.update(pretrained_dict)\nmodel.load_state_dict(model_dict)\n```\n\n#### **(3) 手动修改权重**\n\n```python\n# 将第一层卷积的权重置零\nwith torch.no_grad():\n    model.conv1.weight.copy_(torch.zeros_like(model.conv1.weight))\n```\n\n---\n\n### 6. **总结**\n\n- **权重**是模型的可学习参数，是 `state_dict` 的核心内容。\n- **`state_dict`** 是模型状态的完整表示，包括：\n  - 所有权重、偏置。\n  - 非可学习的运行时参数（如 `BatchNorm` 的统计量）。\n- **最佳实践**：\n  - 保存模型时使用 `torch.save(model.state_dict(), ...)`。\n  - 加载时需先构建相同结构的模型，再调用 `model.load_state_dict()`。\n  - 若需调整模型结构，可选择性加载匹配的权重。\n\n\u003e [!info] 亮曰\n\u003e\n\u003e state_dict 包括 Parameter 与 Buffer ，模型的可学习参数——**权重**主要指其中的 Parameter 。\n","title":"PyTorch 模型的保存与加载机制详解","abstract":"\u003e 本文为与 DeepSeek 对话记录，深入探讨 PyTorch 中模型的保存和加载机制，包括不同的保存方式、最佳实践以及常见问题的解决方案。\n\u003e [!reasoning]-\n\u003e","length":433,"created_at":"2025-03-07T13:00:00.000Z","updated_at":"2025-03-07T13:00:00.000Z","tags":["Deep Learning","PyTorch","Model Management"],"license":true,"headingTrees":[{"key":"q-pytorch-中所谓的保存模型加载模型指的是保存加载什么是-state_dict-吗","href":"#q-pytorch-中所谓的保存模型加载模型指的是保存加载什么是-state_dict-吗","heading":2,"title":"Q: PyTorch 中所谓的保存模型/加载模型，指的是保存/加载什么？是 state_dict 吗？","children":[{"key":"1-state_dict-是什么","href":"#1-state_dict-是什么","heading":3,"title":"1. state_dict 是什么？","children":[],"id":"1-state_dict-是什么"},{"key":"2-保存模型的两种方式","href":"#2-保存模型的两种方式","heading":3,"title":"2. 保存模型的两种方式","children":[{"key":"方式-1仅保存-state_dict推荐","href":"#方式-1仅保存-state_dict推荐","heading":4,"title":"方式 1：仅保存 state_dict（推荐）","children":[],"id":"方式-1仅保存-state_dict推荐"},{"key":"方式-2保存整个模型不推荐","href":"#方式-2保存整个模型不推荐","heading":4,"title":"方式 2：保存整个模型（不推荐）","children":[],"id":"方式-2保存整个模型不推荐"}],"id":"2-保存模型的两种方式"},{"key":"3-加载模型的对应方法","href":"#3-加载模型的对应方法","heading":3,"title":"3. 加载模型的对应方法","children":[{"key":"加载-state_dict需先构建模型结构","href":"#加载-state_dict需先构建模型结构","heading":4,"title":"加载 state_dict（需先构建模型结构）","children":[],"id":"加载-state_dict需先构建模型结构"},{"key":"加载整个模型直接使用","href":"#加载整个模型直接使用","heading":4,"title":"加载整个模型（直接使用）","children":[],"id":"加载整个模型直接使用"}],"id":"3-加载模型的对应方法"},{"key":"4-实际场景中的最佳实践","href":"#4-实际场景中的最佳实践","heading":3,"title":"4. 实际场景中的最佳实践","children":[],"id":"4-实际场景中的最佳实践"},{"key":"5-关键总结","href":"#5-关键总结","heading":3,"title":"5. 关键总结","children":[],"id":"5-关键总结"}],"id":"q-pytorch-中所谓的保存模型加载模型指的是保存加载什么是-state_dict-吗"},{"key":"q-model-的-config-又是什么东西是超参吗","href":"#q-model-的-config-又是什么东西是超参吗","heading":2,"title":"Q: model 的 config 又是什么东西？是超参吗？","children":[{"key":"1-什么是模型的-config","href":"#1-什么是模型的-config","heading":3,"title":"1. 什么是模型的 config？","children":[],"id":"1-什么是模型的-config"},{"key":"2-模型-config-与超参数的区别","href":"#2-模型-config-与超参数的区别","heading":3,"title":"2. 模型 config 与超参数的区别","children":[],"id":"2-模型-config-与超参数的区别"},{"key":"3-为什么需要单独管理-config","href":"#3-为什么需要单独管理-config","heading":3,"title":"3. 为什么需要单独管理 config？","children":[],"id":"3-为什么需要单独管理-config"},{"key":"4-config-与超参数的重叠情况","href":"#4-config-与超参数的重叠情况","heading":3,"title":"4. config 与超参数的重叠情况","children":[],"id":"4-config-与超参数的重叠情况"},{"key":"5-实际代码示例","href":"#5-实际代码示例","heading":3,"title":"5. 实际代码示例","children":[{"key":"定义模型时使用-config","href":"#定义模型时使用-config","heading":4,"title":"定义模型时使用 config：","children":[],"id":"定义模型时使用-config"},{"key":"保存与加载完整模型含结构和权重","href":"#保存与加载完整模型含结构和权重","heading":4,"title":"保存与加载完整模型（含结构和权重）：","children":[],"id":"保存与加载完整模型含结构和权重"}],"id":"5-实际代码示例"},{"key":"6-总结","href":"#6-总结","heading":3,"title":"6. 总结","children":[],"id":"6-总结"}],"id":"q-model-的-config-又是什么东西是超参吗"},{"key":"q-所谓权重就是指-state_dict-中的内容吗","href":"#q-所谓权重就是指-state_dict-中的内容吗","heading":2,"title":"Q: 所谓\"权重\"就是指 state_dict 中的内容吗？","children":[{"key":"1-权重是什么","href":"#1-权重是什么","heading":3,"title":"1. \"权重\"是什么？","children":[],"id":"1-权重是什么"},{"key":"2-state_dict-中的内容","href":"#2-state_dict-中的内容","heading":3,"title":"2. state_dict 中的内容","children":[],"id":"2-state_dict-中的内容"},{"key":"3-权重与-state_dict-的关系","href":"#3-权重与-state_dict-的关系","heading":3,"title":"3. \"权重\"与 state_dict 的关系","children":[],"id":"3-权重与-state_dict-的关系"},{"key":"4-为什么需要-state_dict-而不仅仅是权重","href":"#4-为什么需要-state_dict-而不仅仅是权重","heading":3,"title":"4. 为什么需要 state_dict 而不仅仅是权重？","children":[],"id":"4-为什么需要-state_dict-而不仅仅是权重"},{"key":"5-操作-state_dict-的常见场景","href":"#5-操作-state_dict-的常见场景","heading":3,"title":"5. 操作 state_dict 的常见场景","children":[{"key":"1-查看模型权重","href":"#1-查看模型权重","heading":4,"title":"(1) 查看模型权重","children":[],"id":"1-查看模型权重"},{"key":"2-选择性加载部分权重迁移学习","href":"#2-选择性加载部分权重迁移学习","heading":4,"title":"(2) 选择性加载部分权重（迁移学习）","children":[],"id":"2-选择性加载部分权重迁移学习"},{"key":"3-手动修改权重","href":"#3-手动修改权重","heading":4,"title":"(3) 手动修改权重","children":[],"id":"3-手动修改权重"}],"id":"5-操作-state_dict-的常见场景"},{"key":"6-总结-1","href":"#6-总结-1","heading":3,"title":"6. 总结","children":[],"id":"6-总结-1"}],"id":"q-所谓权重就是指-state_dict-中的内容吗"}],"wikiRefAliases":[],"richRefAliases":[]},"prevNextInfo":{"prevInfo":{"pathMapping":{"pagePath":"/learn_from_ai/golang-new-and-memory-management","filePath":"public/content/learn_from_ai/2025-03-07-golang-new-and-memory-management.md"},"meta":{"title":"GoLang 中 new() 与内存管理机制详解","created_at":"2025-03-07T16:00:00.000Z","updated_at":"2025-03-07T16:00:00.000Z"}},"nextInfo":{"pathMapping":{"pagePath":"/learn_from_ai/resnet-math-and-gradient-vanishing","filePath":"public/content/learn_from_ai/2025-03-07-resnet-math-and-gradient-vanishing.md"},"meta":{"title":"ResNet 的数学原理与梯度消失问题分析","created_at":"2025-03-07T10:00:00.000Z","updated_at":"2025-03-07T10:00:00.000Z"}}},"backRefResources":[]},"__N_SSG":true},"page":"/learn_from_ai/[slug]","query":{"slug":"pytorch-model-save-and-load"},"buildId":"deaNyTD2T14Ep6qDNMnTd","assetPrefix":"/blog-next","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>