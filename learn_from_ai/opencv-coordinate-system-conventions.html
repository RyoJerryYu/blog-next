<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta property="og:image" content="https://ryojerryyu.github.io/blog-next/img/home-bg-kasumi-hanabi.jpg" data-next-head=""/><meta name="twitter:image" content="https://ryojerryyu.github.io/blog-next/img/home-bg-kasumi-hanabi.jpg" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:url" content="https://blog.ryo-okami.xyz/learn_from_ai/opencv-coordinate-system-conventions" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@ryo_okami" data-next-head=""/><meta name="twitter:creator" content="@ryo_okami" data-next-head=""/><link rel="icon" href="/blog-next/favicon.ico" data-next-head=""/><meta name="viewport" content="width=device-width, initial-scale=1" data-next-head=""/><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" data-next-head=""/><title data-next-head="">OpenCV åæ ‡è¡¨ç¤ºï¼šç†è§£ (y, x) ä¸ (x, y) çš„åŒºåˆ« | Ryo&#x27;s Blog</title><meta property="og:title" content="OpenCV åæ ‡è¡¨ç¤ºï¼šç†è§£ (y, x) ä¸ (x, y) çš„åŒºåˆ«" data-next-head=""/><meta property="og:site_name" content="Ryo&#x27;s Blog" data-next-head=""/><meta name="twitter:title" content="OpenCV åæ ‡è¡¨ç¤ºï¼šç†è§£ (y, x) ä¸ (x, y) çš„åŒºåˆ« | Ryo&#x27;s Blog" data-next-head=""/><meta name="description" content="&gt; ğŸ“ æœ¬æ–‡æ˜¯æˆ‘åœ¨å­¦ä¹  OpenCV æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚é—®é¢˜çš„è§£ç­”å’Œä¸­æ–‡ç¿»è¯‘å‡ç”± AI ç”Ÿæˆã€‚
Why sometimes opencv represent a point coordinate as (y,x) (e.g. the result of cv2.findContours) , and sometimes it represent as (x, y) (e.g. the arg `center` of cv2.circle)?
&gt; ä¸ºä»€ä¹ˆ OpenCV æœ‰æ—¶ç”¨ (y,x) è¡¨ç¤ºåæ ‡ç‚¹ï¼ˆæ¯”å¦‚ cv2.findContours çš„è¿”å›å€¼ï¼‰ï¼Œæœ‰æ—¶åˆç”¨ (x,y) è¡¨ç¤ºï¼ˆæ¯”å¦‚ cv2.circle å‡½æ•°çš„ `center` å‚æ•°ï¼‰ï¼Ÿ" data-next-head=""/><meta property="og:description" content="&gt; ğŸ“ æœ¬æ–‡æ˜¯æˆ‘åœ¨å­¦ä¹  OpenCV æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚é—®é¢˜çš„è§£ç­”å’Œä¸­æ–‡ç¿»è¯‘å‡ç”± AI ç”Ÿæˆã€‚
Why sometimes opencv represent a point coordinate as (y,x) (e.g. the result of cv2.findContours) , and sometimes it represent as (x, y) (e.g. the arg `center` of cv2.circle)?
&gt; ä¸ºä»€ä¹ˆ OpenCV æœ‰æ—¶ç”¨ (y,x) è¡¨ç¤ºåæ ‡ç‚¹ï¼ˆæ¯”å¦‚ cv2.findContours çš„è¿”å›å€¼ï¼‰ï¼Œæœ‰æ—¶åˆç”¨ (x,y) è¡¨ç¤ºï¼ˆæ¯”å¦‚ cv2.circle å‡½æ•°çš„ `center` å‚æ•°ï¼‰ï¼Ÿ" data-next-head=""/><meta name="twitter:description" content="&gt; ğŸ“ æœ¬æ–‡æ˜¯æˆ‘åœ¨å­¦ä¹  OpenCV æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚é—®é¢˜çš„è§£ç­”å’Œä¸­æ–‡ç¿»è¯‘å‡ç”± AI ç”Ÿæˆã€‚
Why sometimes opencv represent a point coordinate as (y,x) (e.g. the result of cv2.findContours) , and sometimes it represent as (x, y) (e.g. the arg `center` of cv2.circle)?
&gt; ä¸ºä»€ä¹ˆ OpenCV æœ‰æ—¶ç”¨ (y,x) è¡¨ç¤ºåæ ‡ç‚¹ï¼ˆæ¯”å¦‚ cv2.findContours çš„è¿”å›å€¼ï¼‰ï¼Œæœ‰æ—¶åˆç”¨ (x,y) è¡¨ç¤ºï¼ˆæ¯”å¦‚ cv2.circle å‡½æ•°çš„ `center` å‚æ•°ï¼‰ï¼Ÿ" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png"/><link rel="manifest" href="/site.webmanifest"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/blog-next/_next/static/css/8db32621d94754ab.css" as="style"/><link rel="stylesheet" href="/blog-next/_next/static/css/8db32621d94754ab.css" data-n-g=""/><link rel="preload" href="/blog-next/_next/static/css/5bd958681a4509b5.css" as="style"/><link rel="stylesheet" href="/blog-next/_next/static/css/5bd958681a4509b5.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog-next/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/blog-next/_next/static/chunks/webpack-3597c977fede260d.js" defer=""></script><script src="/blog-next/_next/static/chunks/framework-898697981b1ca118.js" defer=""></script><script src="/blog-next/_next/static/chunks/main-a0a5fc4e603d1ed2.js" defer=""></script><script src="/blog-next/_next/static/chunks/pages/_app-861c1dc7f33f622c.js" defer=""></script><script src="/blog-next/_next/static/chunks/ee8b1517-1aa9307a3ec34e41.js" defer=""></script><script src="/blog-next/_next/static/chunks/4785-70b0f2db3df81cbd.js" defer=""></script><script src="/blog-next/_next/static/chunks/9965-95126bbb1fbfbef4.js" defer=""></script><script src="/blog-next/_next/static/chunks/39-0a3d8a77fd97d8ce.js" defer=""></script><script src="/blog-next/_next/static/chunks/7171-15e4933f5e756a14.js" defer=""></script><script src="/blog-next/_next/static/chunks/pages/learn_from_ai/%5Bslug%5D-609118750b7c6737.js" defer=""></script><script src="/blog-next/_next/static/w1ZimoTUC3z7UiVINTMsP/_buildManifest.js" defer=""></script><script src="/blog-next/_next/static/w1ZimoTUC3z7UiVINTMsP/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="DefaultLayout_header__aepTD"><div class="DefaultLayout_icon__11sTk"><div class="DefaultLayout_textbox__H9FZG"><a class="DefaultLayout_textlink__EVwys" href="/blog-next">Ryo&#x27;s Blog</a></div></div><div class="DefaultLayout_navBar__gY4ra"><div class="DefaultLayout_navBarItem__nhL6L"><a class="DefaultLayout_textlink__EVwys" href="/blog-next/articles">Articles</a></div><div class="DefaultLayout_navBarItem__nhL6L"><a class="DefaultLayout_textlink__EVwys" href="/blog-next/ideas">Ideas</a></div><div class="DefaultLayout_navBarItem__nhL6L"><a class="DefaultLayout_textlink__EVwys" href="/blog-next/learn_from_ai">Learn from AI</a></div><div class="DefaultLayout_navBarItem__nhL6L"><a class="DefaultLayout_textlink__EVwys" href="/blog-next/tags">Tags</a></div><div class="DefaultLayout_navBarItem__nhL6L"><a class="DefaultLayout_textlink__EVwys" href="/blog-next/clips">Clips</a></div></div><div class="DefaultLayout_headerRight__0Kj26"><div class=" flex flex-row gap-8 items-center justify-center"><a title="Twitter" href="https://twitter.com/ryo_okami"><svg class=" h-6 w-6 fill-gray-300 hover:fill-white transition-all ease-in-out" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a title="GitHub" href="https://github.com/RyoJerryYu"><svg class=" h-6 w-6 fill-gray-300 hover:fill-white transition-all ease-in-out" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a title="Pixiv" href="https://www.pixiv.net/users/9159893"><svg class=" h-6 w-6 fill-gray-300 hover:fill-white transition-all ease-in-out" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4.935 0A4.924 4.924 0 0 0 0 4.935v14.13A4.924 4.924 0 0 0 4.935 24h14.13A4.924 4.924 0 0 0 24 19.065V4.935A4.924 4.924 0 0 0 19.065 0zm7.81 4.547c2.181 0 4.058.676 5.399 1.847a6.118 6.118 0 0 1 2.116 4.66c.005 1.854-.88 3.476-2.257 4.563-1.375 1.092-3.225 1.697-5.258 1.697-2.314 0-4.46-.842-4.46-.842v2.718c.397.116 1.048.365.635.779H5.79c-.41-.41.19-.65.644-.779V7.666c-1.053.81-1.593 1.51-1.868 2.031.32 1.02-.284.969-.284.969l-1.09-1.73s3.868-4.39 9.553-4.39zm-.19.971c-1.423-.003-3.184.473-4.27 1.244v8.646c.988.487 2.484.832 4.26.832h.01c1.596 0 2.98-.593 3.93-1.533.952-.948 1.486-2.183 1.492-3.683-.005-1.54-.504-2.864-1.42-3.86-.918-.992-2.274-1.645-4.002-1.646Z"></path></svg></a></div></div></header><div class="DefaultLayout_headerBg__FStmg"></div><div class="max-w-3xl mx-auto p-2"><div class="DefaultLayout_contentHeight__DabjQ"><article class="Post_post__acRqJ"><h1 class="Post_postTitle__N1NIA">OpenCV åæ ‡è¡¨ç¤ºï¼šç†è§£ (y, x) ä¸ (x, y) çš„åŒºåˆ«</h1><div class="Post_postDate__SQx7A"><time dateTime="2024-11-29T03:00:00.000Z">2024-11-29</time></div><div class="TagsBox_tagsBox__WzhAf mt-2"><a href="/blog-next/tags/opencv"><div class="TagsBox_tag__Rk32C">OpenCV</div></a><a href="/blog-next/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86"><div class="TagsBox_tag__Rk32C">å›¾åƒå¤„ç†</div></a><a href="/blog-next/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><div class="TagsBox_tag__Rk32C">å­¦ä¹ ç¬”è®°</div></a></div><div class="post-body Post_postContent__mJ_Ju"><blockquote>
<p>ğŸ“ æœ¬æ–‡æ˜¯æˆ‘åœ¨å­¦ä¹  OpenCV æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚é—®é¢˜çš„è§£ç­”å’Œä¸­æ–‡ç¿»è¯‘å‡ç”± AI ç”Ÿæˆã€‚</p>
</blockquote>
<h1 id="opencv-åæ ‡è¡¨ç¤ºç†è§£-y-x-ä¸-x-y-çš„åŒºåˆ«"><a href="#opencv-åæ ‡è¡¨ç¤ºç†è§£-y-x-ä¸-x-y-çš„åŒºåˆ«">OpenCV åæ ‡è¡¨ç¤ºï¼šç†è§£ (y, x) ä¸ (x, y) çš„åŒºåˆ«</a></h1>
<h2 id="q"><a href="#q">Q</a></h2>
<p>Why sometimes opencv represent a point coordinate as (y,x) (e.g. the result of cv2.findContours) , and sometimes it represent as (x, y) (e.g. the arg <code>center</code> of cv2.circle)?</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆ OpenCV æœ‰æ—¶ç”¨ (y,x) è¡¨ç¤ºåæ ‡ç‚¹ï¼ˆæ¯”å¦‚ cv2.findContours çš„è¿”å›å€¼ï¼‰ï¼Œæœ‰æ—¶åˆç”¨ (x,y) è¡¨ç¤ºï¼ˆæ¯”å¦‚ cv2.circle å‡½æ•°çš„ <code>center</code> å‚æ•°ï¼‰ï¼Ÿ</p>
</blockquote>
<h2 id="a"><a href="#a">A</a></h2>
<p>OpenCV uses different conventions for different functions based on their specific requirements and historical reasons:</p>
<blockquote>
<p>OpenCV åŸºäºä¸åŒå‡½æ•°çš„å…·ä½“éœ€æ±‚å’Œå†å²åŸå› ï¼Œä½¿ç”¨äº†ä¸åŒçš„åæ ‡è¡¨ç¤ºçº¦å®šï¼š</p>
</blockquote>
<ol>
<li><strong>(y, x) Convention</strong>: This is often used when dealing with image matrices directly. In image processing, images are typically represented as 2D arrays where the first dimension is the row (height, y-coordinate) and the second dimension is the column (width, x-coordinate). Functions like <code>cv2.findContours</code> return coordinates in this order to match the array indexing.</li>
</ol>
<blockquote>
<ol>
<li><strong>(y, x) çº¦å®š</strong>ï¼šè¿™ç§è¡¨ç¤ºæ–¹æ³•é€šå¸¸ç”¨äºç›´æ¥å¤„ç†å›¾åƒçŸ©é˜µæ—¶ã€‚åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œå›¾åƒé€šå¸¸è¡¨ç¤ºä¸ºäºŒç»´æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ç»´æ˜¯è¡Œï¼ˆé«˜åº¦ï¼Œyåæ ‡ï¼‰ï¼Œç¬¬äºŒç»´æ˜¯åˆ—ï¼ˆå®½åº¦ï¼Œxåæ ‡ï¼‰ã€‚åƒ <code>cv2.findContours</code> è¿™æ ·çš„å‡½æ•°è¿”å›è¿™ç§é¡ºåºçš„åæ ‡æ˜¯ä¸ºäº†åŒ¹é…æ•°ç»„ç´¢å¼•æ–¹å¼ã€‚</li>
</ol>
</blockquote>
<ol start="2">
<li><strong>(x, y) Convention</strong>: This is used in functions that deal with geometric shapes or points in a more traditional Cartesian coordinate system, where <code>x</code> is the horizontal axis and <code>y</code> is the vertical axis. Functions like <code>cv2.circle</code> use this convention to specify the center of the circle.</li>
</ol>
<blockquote>
<ol start="2">
<li><strong>(x, y) çº¦å®š</strong>ï¼šè¿™ç§è¡¨ç¤ºæ–¹æ³•ç”¨äºå¤„ç†å‡ ä½•å›¾å½¢æˆ–åœ¨ä¼ ç»Ÿç¬›å¡å°”åæ ‡ç³»ä¸­çš„ç‚¹ï¼Œå…¶ä¸­ <code>x</code> æ˜¯æ°´å¹³è½´ï¼Œ<code>y</code> æ˜¯å‚ç›´è½´ã€‚åƒ <code>cv2.circle</code> è¿™æ ·çš„å‡½æ•°ä½¿ç”¨è¿™ç§çº¦å®šæ¥æŒ‡å®šåœ†å¿ƒä½ç½®ã€‚</li>
</ol>
</blockquote>
<p>The inconsistency arises because OpenCV aims to balance between image matrix operations and geometric operations, each having their own conventional coordinate systems.</p>
<blockquote>
<p>è¿™ç§ä¸ä¸€è‡´æ€§çš„å‡ºç°æ˜¯å› ä¸º OpenCV éœ€è¦åœ¨å›¾åƒçŸ©é˜µè¿ç®—å’Œå‡ ä½•è¿ç®—ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œè€Œè¿™ä¸¤ç§è¿ç®—å„è‡ªæœ‰å…¶ä¼ ç»Ÿçš„åæ ‡ç³»ç»Ÿè¡¨ç¤ºæ–¹æ³•ã€‚</p>
</blockquote></div><div class="w-96 text-gray-700 leading-none"><span class="!text-sm"><a class="!inline-block !p-0 !m-0 align-text-bottom" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" loading="lazy" width="88" height="31" decoding="async" data-nimg="1" class="!m-0 h-4 w-auto pr-1" style="color:transparent;border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png"/></a>This work is licensed under a<!-- --> <a class="underline" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</span></div><div class="TagsBox_tagsBox__WzhAf mt-4"><a href="/blog-next/tags/opencv"><div class="TagsBox_tag__Rk32C">OpenCV</div></a><a href="/blog-next/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86"><div class="TagsBox_tag__Rk32C">å›¾åƒå¤„ç†</div></a><a href="/blog-next/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><div class="TagsBox_tag__Rk32C">å­¦ä¹ ç¬”è®°</div></a></div><div class="mt-4 mb-4 flex justify-center"><div class="mr-0 ml-auto"><a href="/blog-next/learn_from_ai/deep-learning-model-formats">æ·±åº¦å­¦ä¹ æ¨¡å‹æ–‡ä»¶æ ¼å¼å¯¹æ¯”ï¼špthã€safetensor ä¸ onnx -&gt;</a></div></div><hr class="mt-4"/></article></div></div><footer class="DefaultLayout_footer__n5339"><div class="max-w-3xl mx-auto p-2 w-full"><div class="flex flex-row justify-center items-center"><div class="DefaultLayout_footerLeft__j0yvY">Â© 2023 Ryo Jerry Yu. All rights reserved.</div><div class="DefaultLayout_footerRight___Dn67"><div class=" flex flex-row gap-8 items-center justify-center"><a title="Twitter" href="https://twitter.com/ryo_okami"><svg class="DefaultLayout_footerIcon__sgrmB h-8 w-8" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a title="GitHub" href="https://github.com/RyoJerryYu"><svg class="DefaultLayout_footerIcon__sgrmB h-8 w-8" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a title="Pixiv" href="https://www.pixiv.net/users/9159893"><svg class="DefaultLayout_footerIcon__sgrmB h-8 w-8" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4.935 0A4.924 4.924 0 0 0 0 4.935v14.13A4.924 4.924 0 0 0 4.935 24h14.13A4.924 4.924 0 0 0 24 19.065V4.935A4.924 4.924 0 0 0 19.065 0zm7.81 4.547c2.181 0 4.058.676 5.399 1.847a6.118 6.118 0 0 1 2.116 4.66c.005 1.854-.88 3.476-2.257 4.563-1.375 1.092-3.225 1.697-5.258 1.697-2.314 0-4.46-.842-4.46-.842v2.718c.397.116 1.048.365.635.779H5.79c-.41-.41.19-.65.644-.779V7.666c-1.053.81-1.593 1.51-1.868 2.031.32 1.02-.284.969-.284.969l-1.09-1.73s3.868-4.39 9.553-4.39zm-.19.971c-1.423-.003-3.184.473-4.27 1.244v8.646c.988.487 2.484.832 4.26.832h.01c1.596 0 2.98-.593 3.93-1.533.952-.948 1.486-2.183 1.492-3.683-.005-1.54-.504-2.864-1.42-3.86-.918-.992-2.274-1.645-4.002-1.646Z"></path></svg></a></div></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"opencv-coordinate-system-conventions","tags":[{"tag":"OpenCV","slug":"opencv","path":"/tags/opencv","postSlugs":[{"postType":"learn_from_ai","postSlug":"opencv-coordinate-system-conventions","postPagePath":"/learn_from_ai/opencv-coordinate-system-conventions"}]},{"tag":"å›¾åƒå¤„ç†","slug":"å›¾åƒå¤„ç†","path":"/tags/å›¾åƒå¤„ç†","postSlugs":[{"postType":"learn_from_ai","postSlug":"opencv-coordinate-system-conventions","postPagePath":"/learn_from_ai/opencv-coordinate-system-conventions"}]},{"tag":"å­¦ä¹ ç¬”è®°","slug":"å­¦ä¹ ç¬”è®°","path":"/tags/å­¦ä¹ ç¬”è®°","postSlugs":[{"postType":"learn_from_ai","postSlug":"deep-learning-model-formats","postPagePath":"/learn_from_ai/deep-learning-model-formats"},{"postType":"learn_from_ai","postSlug":"opencv-coordinate-system-conventions","postPagePath":"/learn_from_ai/opencv-coordinate-system-conventions"}]}],"source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    blockquote: \"blockquote\",\n    code: \"code\",\n    h1: \"h1\",\n    h2: \"h2\",\n    li: \"li\",\n    ol: \"ol\",\n    p: \"p\",\n    strong: \"strong\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"ğŸ“ æœ¬æ–‡æ˜¯æˆ‘åœ¨å­¦ä¹  OpenCV æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚é—®é¢˜çš„è§£ç­”å’Œä¸­æ–‡ç¿»è¯‘å‡ç”± AI ç”Ÿæˆã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h1, {\n      id: \"opencv-åæ ‡è¡¨ç¤ºç†è§£-y-x-ä¸-x-y-çš„åŒºåˆ«\",\n      children: _jsx(_components.a, {\n        href: \"#opencv-åæ ‡è¡¨ç¤ºç†è§£-y-x-ä¸-x-y-çš„åŒºåˆ«\",\n        children: \"OpenCV åæ ‡è¡¨ç¤ºï¼šç†è§£ (y, x) ä¸ (x, y) çš„åŒºåˆ«\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"q\",\n      children: _jsx(_components.a, {\n        href: \"#q\",\n        children: \"Q\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Why sometimes opencv represent a point coordinate as (y,x) (e.g. the result of cv2.findContours) , and sometimes it represent as (x, y) (e.g. the arg \", _jsx(_components.code, {\n        children: \"center\"\n      }), \" of cv2.circle)?\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [\"ä¸ºä»€ä¹ˆ OpenCV æœ‰æ—¶ç”¨ (y,x) è¡¨ç¤ºåæ ‡ç‚¹ï¼ˆæ¯”å¦‚ cv2.findContours çš„è¿”å›å€¼ï¼‰ï¼Œæœ‰æ—¶åˆç”¨ (x,y) è¡¨ç¤ºï¼ˆæ¯”å¦‚ cv2.circle å‡½æ•°çš„ \", _jsx(_components.code, {\n          children: \"center\"\n        }), \" å‚æ•°ï¼‰ï¼Ÿ\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"a\",\n      children: _jsx(_components.a, {\n        href: \"#a\",\n        children: \"A\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"OpenCV uses different conventions for different functions based on their specific requirements and historical reasons:\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"OpenCV åŸºäºä¸åŒå‡½æ•°çš„å…·ä½“éœ€æ±‚å’Œå†å²åŸå› ï¼Œä½¿ç”¨äº†ä¸åŒçš„åæ ‡è¡¨ç¤ºçº¦å®šï¼š\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"(y, x) Convention\"\n        }), \": This is often used when dealing with image matrices directly. In image processing, images are typically represented as 2D arrays where the first dimension is the row (height, y-coordinate) and the second dimension is the column (width, x-coordinate). Functions like \", _jsx(_components.code, {\n          children: \"cv2.findContours\"\n        }), \" return coordinates in this order to match the array indexing.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [_jsx(_components.strong, {\n            children: \"(y, x) çº¦å®š\"\n          }), \"ï¼šè¿™ç§è¡¨ç¤ºæ–¹æ³•é€šå¸¸ç”¨äºç›´æ¥å¤„ç†å›¾åƒçŸ©é˜µæ—¶ã€‚åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œå›¾åƒé€šå¸¸è¡¨ç¤ºä¸ºäºŒç»´æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ç»´æ˜¯è¡Œï¼ˆé«˜åº¦ï¼Œyåæ ‡ï¼‰ï¼Œç¬¬äºŒç»´æ˜¯åˆ—ï¼ˆå®½åº¦ï¼Œxåæ ‡ï¼‰ã€‚åƒ \", _jsx(_components.code, {\n            children: \"cv2.findContours\"\n          }), \" è¿™æ ·çš„å‡½æ•°è¿”å›è¿™ç§é¡ºåºçš„åæ ‡æ˜¯ä¸ºäº†åŒ¹é…æ•°ç»„ç´¢å¼•æ–¹å¼ã€‚\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"2\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"(x, y) Convention\"\n        }), \": This is used in functions that deal with geometric shapes or points in a more traditional Cartesian coordinate system, where \", _jsx(_components.code, {\n          children: \"x\"\n        }), \" is the horizontal axis and \", _jsx(_components.code, {\n          children: \"y\"\n        }), \" is the vertical axis. Functions like \", _jsx(_components.code, {\n          children: \"cv2.circle\"\n        }), \" use this convention to specify the center of the circle.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.ol, {\n        start: \"2\",\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [_jsx(_components.strong, {\n            children: \"(x, y) çº¦å®š\"\n          }), \"ï¼šè¿™ç§è¡¨ç¤ºæ–¹æ³•ç”¨äºå¤„ç†å‡ ä½•å›¾å½¢æˆ–åœ¨ä¼ ç»Ÿç¬›å¡å°”åæ ‡ç³»ä¸­çš„ç‚¹ï¼Œå…¶ä¸­ \", _jsx(_components.code, {\n            children: \"x\"\n          }), \" æ˜¯æ°´å¹³è½´ï¼Œ\", _jsx(_components.code, {\n            children: \"y\"\n          }), \" æ˜¯å‚ç›´è½´ã€‚åƒ \", _jsx(_components.code, {\n            children: \"cv2.circle\"\n          }), \" è¿™æ ·çš„å‡½æ•°ä½¿ç”¨è¿™ç§çº¦å®šæ¥æŒ‡å®šåœ†å¿ƒä½ç½®ã€‚\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The inconsistency arises because OpenCV aims to balance between image matrix operations and geometric operations, each having their own conventional coordinate systems.\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"è¿™ç§ä¸ä¸€è‡´æ€§çš„å‡ºç°æ˜¯å› ä¸º OpenCV éœ€è¦åœ¨å›¾åƒçŸ©é˜µè¿ç®—å’Œå‡ ä½•è¿ç®—ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œè€Œè¿™ä¸¤ç§è¿ç®—å„è‡ªæœ‰å…¶ä¼ ç»Ÿçš„åæ ‡ç³»ç»Ÿè¡¨ç¤ºæ–¹æ³•ã€‚\"\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"meta":{"content":"\n\u003e ğŸ“ æœ¬æ–‡æ˜¯æˆ‘åœ¨å­¦ä¹  OpenCV æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚é—®é¢˜çš„è§£ç­”å’Œä¸­æ–‡ç¿»è¯‘å‡ç”± AI ç”Ÿæˆã€‚\n\n# OpenCV åæ ‡è¡¨ç¤ºï¼šç†è§£ (y, x) ä¸ (x, y) çš„åŒºåˆ«\n\n## Q\nWhy sometimes opencv represent a point coordinate as (y,x) (e.g. the result of cv2.findContours) , and sometimes it represent as (x, y) (e.g. the arg `center` of cv2.circle)?\n\n\u003e ä¸ºä»€ä¹ˆ OpenCV æœ‰æ—¶ç”¨ (y,x) è¡¨ç¤ºåæ ‡ç‚¹ï¼ˆæ¯”å¦‚ cv2.findContours çš„è¿”å›å€¼ï¼‰ï¼Œæœ‰æ—¶åˆç”¨ (x,y) è¡¨ç¤ºï¼ˆæ¯”å¦‚ cv2.circle å‡½æ•°çš„ `center` å‚æ•°ï¼‰ï¼Ÿ\n\n## A\nOpenCV uses different conventions for different functions based on their specific requirements and historical reasons:\n\n\u003e OpenCV åŸºäºä¸åŒå‡½æ•°çš„å…·ä½“éœ€æ±‚å’Œå†å²åŸå› ï¼Œä½¿ç”¨äº†ä¸åŒçš„åæ ‡è¡¨ç¤ºçº¦å®šï¼š\n\n1. **(y, x) Convention**: This is often used when dealing with image matrices directly. In image processing, images are typically represented as 2D arrays where the first dimension is the row (height, y-coordinate) and the second dimension is the column (width, x-coordinate). Functions like `cv2.findContours` return coordinates in this order to match the array indexing.\n\n\u003e 1. **(y, x) çº¦å®š**ï¼šè¿™ç§è¡¨ç¤ºæ–¹æ³•é€šå¸¸ç”¨äºç›´æ¥å¤„ç†å›¾åƒçŸ©é˜µæ—¶ã€‚åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œå›¾åƒé€šå¸¸è¡¨ç¤ºä¸ºäºŒç»´æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ç»´æ˜¯è¡Œï¼ˆé«˜åº¦ï¼Œyåæ ‡ï¼‰ï¼Œç¬¬äºŒç»´æ˜¯åˆ—ï¼ˆå®½åº¦ï¼Œxåæ ‡ï¼‰ã€‚åƒ `cv2.findContours` è¿™æ ·çš„å‡½æ•°è¿”å›è¿™ç§é¡ºåºçš„åæ ‡æ˜¯ä¸ºäº†åŒ¹é…æ•°ç»„ç´¢å¼•æ–¹å¼ã€‚\n\n2. **(x, y) Convention**: This is used in functions that deal with geometric shapes or points in a more traditional Cartesian coordinate system, where `x` is the horizontal axis and `y` is the vertical axis. Functions like `cv2.circle` use this convention to specify the center of the circle.\n\n\u003e 2. **(x, y) çº¦å®š**ï¼šè¿™ç§è¡¨ç¤ºæ–¹æ³•ç”¨äºå¤„ç†å‡ ä½•å›¾å½¢æˆ–åœ¨ä¼ ç»Ÿç¬›å¡å°”åæ ‡ç³»ä¸­çš„ç‚¹ï¼Œå…¶ä¸­ `x` æ˜¯æ°´å¹³è½´ï¼Œ`y` æ˜¯å‚ç›´è½´ã€‚åƒ `cv2.circle` è¿™æ ·çš„å‡½æ•°ä½¿ç”¨è¿™ç§çº¦å®šæ¥æŒ‡å®šåœ†å¿ƒä½ç½®ã€‚\n\nThe inconsistency arises because OpenCV aims to balance between image matrix operations and geometric operations, each having their own conventional coordinate systems.\n\n\u003e è¿™ç§ä¸ä¸€è‡´æ€§çš„å‡ºç°æ˜¯å› ä¸º OpenCV éœ€è¦åœ¨å›¾åƒçŸ©é˜µè¿ç®—å’Œå‡ ä½•è¿ç®—ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œè€Œè¿™ä¸¤ç§è¿ç®—å„è‡ªæœ‰å…¶ä¼ ç»Ÿçš„åæ ‡ç³»ç»Ÿè¡¨ç¤ºæ–¹æ³•ã€‚","title":"OpenCV åæ ‡è¡¨ç¤ºï¼šç†è§£ (y, x) ä¸ (x, y) çš„åŒºåˆ«","abstract":"\u003e ğŸ“ æœ¬æ–‡æ˜¯æˆ‘åœ¨å­¦ä¹  OpenCV æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚é—®é¢˜çš„è§£ç­”å’Œä¸­æ–‡ç¿»è¯‘å‡ç”± AI ç”Ÿæˆã€‚\nWhy sometimes opencv represent a point coordinate as (y,x) (e.g. the result of cv2.findContours) , and sometimes it represent as (x, y) (e.g. the arg `center` of cv2.circle)?\n\u003e ä¸ºä»€ä¹ˆ OpenCV æœ‰æ—¶ç”¨ (y,x) è¡¨ç¤ºåæ ‡ç‚¹ï¼ˆæ¯”å¦‚ cv2.findContours çš„è¿”å›å€¼ï¼‰ï¼Œæœ‰æ—¶åˆç”¨ (x,y) è¡¨ç¤ºï¼ˆæ¯”å¦‚ cv2.circle å‡½æ•°çš„ `center` å‚æ•°ï¼‰ï¼Ÿ","length":26,"created_at":"2024-11-29T03:00:00.000Z","updated_at":"2024-11-29T03:00:00.000Z","tags":["OpenCV","å›¾åƒå¤„ç†","å­¦ä¹ ç¬”è®°"],"license":true},"prevNextInfo":{"prevInfo":null,"nextInfo":{"pathMapping":{"filePath":"public/content/learn_from_ai/2024-11-29-deep-learning-model-formats.md","pagePath":"/learn_from_ai/deep-learning-model-formats","slug":"deep-learning-model-formats"},"meta":{"content":"\n\u003e æœ¬é¡µé¢ä»‹ç»äº†ä¸‰ç§æœºå™¨å­¦ä¹ æ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼š.pthã€.safetensor å’Œ .onnxã€‚ä¸»è¦å†…å®¹åŒ…æ‹¬æ¯ç§æ ¼å¼çš„å®šä¹‰ã€ä¿å­˜çš„å†…å®¹ã€ç”¨é€”ä»¥åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å’Œè½¬æ¢æ–¹æ³•ã€‚\n\n# pytorch ä¿å­˜çš„ .pth æ–‡ä»¶é‡Œéƒ½ä¿å­˜äº†äº›ä»€ä¹ˆä¸œè¥¿ï¼Ÿ\n\nPyTorchä¸­çš„`.pth`æ–‡ä»¶é€šå¸¸ç”¨äºä¿å­˜æ¨¡å‹çš„æƒé‡ï¼ˆparametersï¼‰å’Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„ä¼˜åŒ–å™¨çŠ¶æ€ï¼ˆoptimizer stateï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œä¸€ä¸ª`.pth`æ–‡ä»¶å¯èƒ½åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\n1. **æ¨¡å‹çŠ¶æ€å­—å…¸ï¼ˆModel state dictionaryï¼‰**ï¼š\n   - è¿™æ˜¯`.pth`æ–‡ä»¶ä¸­æœ€ä¸»è¦çš„éƒ¨åˆ†ï¼Œå®ƒåŒ…å«äº†æ¨¡å‹çš„æ‰€æœ‰æƒé‡ï¼ˆå³ç¥ç»ç½‘ç»œçš„å‚æ•°ï¼‰ï¼ŒåŒ…æ‹¬å·ç§¯å±‚çš„æ»¤æ³¢å™¨ã€å…¨è¿æ¥å±‚çš„æƒé‡å’Œåç½®ç­‰ã€‚\n   - çŠ¶æ€å­—å…¸æ˜¯ä¸€ä¸ªç®€å•çš„Pythonå­—å…¸å¯¹è±¡ï¼Œå…¶é”®æ˜¯å±‚çš„åå­—ï¼Œå€¼æ˜¯ç›¸åº”çš„å‚æ•°å¼ é‡ã€‚\n2. **ä¼˜åŒ–å™¨çŠ¶æ€å­—å…¸ï¼ˆOptimizer state dictionaryï¼‰**ï¼š\n   - å½“ä¿å­˜æ¨¡å‹æ—¶ï¼Œé€šå¸¸ä¹Ÿä¼šä¿å­˜ä¼˜åŒ–å™¨çš„çŠ¶æ€ï¼Œè¿™æ ·å¯ä»¥åœ¨æ¨¡å‹è®­ç»ƒä¸­æ–­åï¼Œä»ä¸Šæ¬¡åœæ­¢çš„åœ°æ–¹ç»§ç»­è®­ç»ƒã€‚\n   - ä¼˜åŒ–å™¨çŠ¶æ€å­—å…¸é€šå¸¸åŒ…å«æ¯ä¸ªå‚æ•°çš„æ¢¯åº¦ã€åŠ¨é‡ï¼ˆmomentumï¼‰å’Œå…¶ä»–ä¸ä¼˜åŒ–å™¨ç›¸å…³çš„çŠ¶æ€ä¿¡æ¯ï¼ˆä¾‹å¦‚Adamä¼˜åŒ–å™¨çš„çŸ©ä¼°è®¡ï¼‰ã€‚\n3. **å…¶ä»–å¯é€‰ä¿¡æ¯**ï¼š\n   - æœ‰æ—¶å€™ï¼Œ`.pth`æ–‡ä»¶å¯èƒ½è¿˜ä¼šåŒ…å«å…¶ä»–è¾…åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚è®­ç»ƒçš„æŸå¤±å€¼ã€é¢å¤–çš„å…ƒæ•°æ®æˆ–è€…æ‰¹å¤„ç†å¤§å°ç­‰ï¼Œä½†è¿™äº›ä¿¡æ¯ä¸æ˜¯å¿…é¡»çš„ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•åœ¨PyTorchä¸­ä¿å­˜å’ŒåŠ è½½`.pth`æ–‡ä»¶ï¼š\n```python\n# ä¿å­˜æ¨¡å‹å’Œä¼˜åŒ–å™¨çŠ¶æ€\ntorch.save({\n    'epoch': epoch,\n    'model_state_dict': model.state_dict(),\n    'optimizer_state_dict': optimizer.state_dict(),\n    'loss': loss,\n    ...\n}, 'model.pth')\n# åŠ è½½æ¨¡å‹å’Œä¼˜åŒ–å™¨çŠ¶æ€\ncheckpoint = torch.load('model.pth')\nmodel.load_state_dict(checkpoint['model_state_dict'])\noptimizer.load_state_dict(checkpoint['optimizer_state_dict'])\nepoch = checkpoint['epoch']\nloss = checkpoint['loss']\n...\n```\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`model`æ˜¯ä½ è¦ä¿å­˜çš„æ¨¡å‹å¯¹è±¡ï¼Œ`optimizer`æ˜¯è®­ç»ƒè¯¥æ¨¡å‹ä½¿ç”¨çš„ä¼˜åŒ–å™¨ã€‚é€šè¿‡`torch.save`å‡½æ•°ï¼Œä½ å¯ä»¥å°†æ¨¡å‹çš„çŠ¶æ€å­—å…¸å’Œä¼˜åŒ–å™¨çš„çŠ¶æ€å­—å…¸ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨`torch.load`å‡½æ•°æ¥æ¢å¤è¿™äº›çŠ¶æ€ï¼Œä»¥ä¾¿ç»§ç»­è®­ç»ƒæˆ–è€…è¿›è¡Œæ¨ç†ã€‚\n\n# .safetensor æ–‡ä»¶ä¸­åˆä¿å­˜äº†ä»€ä¹ˆä¸œè¥¿ï¼Ÿ\n\n`.safetensor` æ–‡ä»¶æ ¼å¼æ˜¯ç”± Hugging Face çš„ Safety Checker å·¥å…·å¼•å…¥çš„ï¼Œå®ƒæ˜¯ä¸ºäº†åœ¨æ¨¡å‹æ¨ç†æ—¶æä¾›ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ã€‚`.safetensor` æ–‡ä»¶ä¸­ä¿å­˜çš„å†…å®¹ä¸»è¦åŒ…æ‹¬ï¼š\n1. **æ¨¡å‹æƒé‡**ï¼š\n   - è¿™æ˜¯æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œä¸ PyTorch çš„ `.pth` æ–‡ä»¶ç±»ä¼¼ï¼Œ`.safetensor` æ–‡ä»¶ä¹Ÿä¿å­˜äº†æ¨¡å‹çš„æƒé‡ï¼Œå³ç¥ç»ç½‘ç»œä¸­çš„å‚æ•°ã€‚\n2. **å…ƒæ•°æ®**ï¼š\n   - `.safetensor` æ–‡ä»¶åŒ…å«äº†ä¸€äº›å…ƒæ•°æ®ï¼Œè¿™äº›æ•°æ®æè¿°äº†æ¨¡å‹çš„æ¶æ„ã€æƒé‡å½¢çŠ¶ã€æ•°æ®ç±»å‹ç­‰ä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥åœ¨åŠ è½½æ¨¡å‹æ—¶è¿›è¡ŒéªŒè¯å’Œé€‚é…ã€‚\n3. **å®‰å…¨æ€§ä¿¡æ¯**ï¼š\n   - `.safetensor` æ–‡ä»¶å¯èƒ½ä¼šåŒ…å«ä¸æ¨¡å‹å®‰å…¨æ€§ç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å“ªäº›å±‚æˆ–å‚æ•°å¯èƒ½éœ€è¦ç‰¹åˆ«çš„å®‰å…¨æ£€æŸ¥ï¼Œä»¥åŠå¯èƒ½çš„é˜ˆå€¼è®¾ç½®ç­‰ã€‚\nå…·ä½“æ¥è¯´ï¼Œ`.safetensor` æ–‡ä»¶çš„å†…å®¹ç»“æ„å¯èƒ½å¦‚ä¸‹ï¼š\n- `weights`: åŒ…å«æ¨¡å‹æƒé‡çš„å­—å…¸ï¼Œé€šå¸¸æ˜¯ä»¥å¼ é‡çš„å½¢å¼å­˜å‚¨ã€‚\n- `metadata`: åŒ…å«æ¨¡å‹çš„å…ƒæ•°æ®ï¼Œå¦‚ç‰ˆæœ¬å·ã€æ¶æ„ä¿¡æ¯ç­‰ã€‚\n- `config`: åŒ…å«æ¨¡å‹é…ç½®ä¿¡æ¯ï¼Œå¦‚æ¨¡å‹ç±»å‹ã€ç±»åç­‰ã€‚\n- `safety`: åŒ…å«æ¨¡å‹å®‰å…¨æ€§ç›¸å…³çš„ä¿¡æ¯ã€‚\nä½¿ç”¨ `.safetensor` æ–‡ä»¶çš„ç›®çš„ä¹‹ä¸€æ˜¯ä¸ºäº†ç¡®ä¿åœ¨æ¨¡å‹éƒ¨ç½²æ—¶èƒ½å¤Ÿè¿›è¡Œæœ‰æ•ˆçš„å®‰å…¨æ£€æŸ¥ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ç”Ÿæˆå‹æ¨¡å‹ï¼ˆå¦‚æ–‡æœ¬ç”Ÿæˆã€å›¾åƒç”Ÿæˆç­‰ï¼‰æ—¶ï¼Œå¯ä»¥é˜²æ­¢ç”Ÿæˆä¸é€‚å½“çš„å†…å®¹ã€‚\nè¯·æ³¨æ„ï¼Œ`.safetensor` æ–‡ä»¶æ ¼å¼å¹¶ä¸æ˜¯ PyTorch çš„æ ‡å‡†ä¿å­˜æ ¼å¼ï¼Œè€Œæ˜¯ Hugging Face çš„ç‰¹å®šå®ç°ã€‚å› æ­¤ï¼Œå®ƒå¯èƒ½ä¸å¦‚ `.pth` æ–‡ä»¶é‚£æ ·è¢«å¹¿æ³›ä½¿ç”¨ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨ Hugging Face çš„æ¨¡å‹å’Œå·¥å…·ï¼Œå¯èƒ½ä¼šé‡åˆ° `.safetensor` æ–‡ä»¶ã€‚åœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦ç¡®ä¿ä½ çš„ç¯å¢ƒæ”¯æŒè¿™ç§æ ¼å¼ã€‚\n\n# .onnx æ–‡ä»¶ä¸­åˆä¿å­˜äº†ä»€ä¹ˆä¿¡æ¯ï¼Ÿ\n\n`.onnx`ï¼ˆOpen Neural Network Exchangeï¼‰æ–‡ä»¶æ˜¯ä¸€ä¸ªå¼€æ”¾æ ¼å¼ï¼Œç”¨äºè¡¨ç¤ºæœºå™¨å­¦ä¹ æ¨¡å‹ã€‚å®ƒæ—¨åœ¨æä¾›ä¸€ç§æ ‡å‡†çš„æ–¹å¼æ¥è¡¨ç¤ºæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä½¿å¾—æ¨¡å‹å¯ä»¥åœ¨ä¸åŒçš„æ¡†æ¶å’Œå·¥å…·ä¹‹é—´è¿›è¡Œè½¬æ¢å’Œäº’æ“ä½œã€‚ä¸€ä¸ª`.onnx`æ–‡ä»¶ä¸­é€šå¸¸åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š\n1. **æ¨¡å‹å›¾ï¼ˆModel Graphï¼‰**ï¼š\n   - æ¨¡å‹å›¾å®šä¹‰äº†æ¨¡å‹çš„è®¡ç®—æµç¨‹ï¼Œå®ƒç”±èŠ‚ç‚¹ï¼ˆnodesï¼‰å’Œè¾¹ï¼ˆedgesï¼‰ç»„æˆã€‚\n   - èŠ‚ç‚¹ä»£è¡¨è®¡ç®—æ“ä½œï¼Œå¦‚å·ç§¯ã€çŸ©é˜µä¹˜æ³•ã€æ¿€æ´»å‡½æ•°ç­‰ã€‚\n   - è¾¹ä»£è¡¨èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®æµï¼Œå³å¼ é‡ï¼ˆtensorsï¼‰çš„æµåŠ¨ã€‚\n2. **åˆå§‹å€¼ï¼ˆInitializersï¼‰**ï¼š\n   - åˆå§‹å€¼åŒ…å«äº†æ¨¡å‹çš„æƒé‡ã€åç½®ç­‰å‚æ•°çš„å€¼ã€‚\n   - è¿™äº›å‚æ•°æ˜¯åœ¨æ¨¡å‹å›¾æ‰§è¡Œä¹‹å‰å°±å·²ç»ç¡®å®šçš„ã€‚\n3. **æ¨¡å‹å±æ€§ï¼ˆAttributesï¼‰**ï¼š\n   - æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½æœ‰ä¸ä¹‹å…³è”çš„å±æ€§ï¼Œè¿™äº›å±æ€§å®šä¹‰äº†èŠ‚ç‚¹çš„å…·ä½“è¡Œä¸ºï¼Œä¾‹å¦‚å·ç§¯æ“ä½œä¸­çš„æ­¥é•¿ï¼ˆstrideï¼‰å’Œå¡«å……ï¼ˆpaddingï¼‰ã€‚\n4. **è¾“å…¥å’Œè¾“å‡ºï¼ˆInputs and Outputsï¼‰**ï¼š\n   - å®šä¹‰äº†æ¨¡å‹çš„è¾“å…¥å’Œè¾“å‡ºå¼ é‡çš„åç§°ã€æ•°æ®ç±»å‹å’Œå½¢çŠ¶ã€‚\n   - è¿™æœ‰åŠ©äºç†è§£æ¨¡å‹æœŸæœ›çš„è¾“å…¥æ ¼å¼ä»¥åŠå®ƒå°†äº§ç”Ÿçš„è¾“å‡ºæ ¼å¼ã€‚\n5. **å…ƒæ•°æ®ï¼ˆMetadataï¼‰**ï¼š\n   - åŒ…æ‹¬æ¨¡å‹çš„åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€ç”Ÿäº§æ—¥æœŸç­‰ä¿¡æ¯ã€‚\n   - è¿™äº›ä¿¡æ¯æœ‰åŠ©äºæ¨¡å‹çš„è¿½è¸ªå’Œç®¡ç†ã€‚\n6. **ä¼˜åŒ–ä¿¡æ¯ï¼ˆOptimization Informationï¼‰**ï¼ˆå¯é€‰ï¼‰ï¼š\n   - ä¸€äº›`.onnx`æ–‡ä»¶å¯èƒ½åŒ…å«ç”¨äºä¼˜åŒ–æ¨¡å‹æ‰§è¡Œçš„é¢å¤–ä¿¡æ¯ï¼Œå¦‚èåˆæ“ä½œæˆ–ç‰¹å®šç¡¬ä»¶ä¸Šçš„ä¼˜åŒ–æŒ‡ä»¤ã€‚\n`.onnx`æ–‡ä»¶çš„ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š\n- `ir_version`: ONNXæ ¼å¼çš„ç‰ˆæœ¬å·ã€‚\n- `opset_import`: æ¨¡å‹ä½¿ç”¨çš„æ“ä½œé›†ç‰ˆæœ¬ã€‚\n- `producer_name`: ç”Ÿæˆè¯¥ONNXæ¨¡å‹çš„å·¥å…·æˆ–åº“çš„åç§°ã€‚\n- `producer_version`: ç”Ÿæˆè¯¥ONNXæ¨¡å‹çš„å·¥å…·æˆ–åº“çš„ç‰ˆæœ¬ã€‚\n- `graph`: åŒ…å«æ¨¡å‹å›¾çš„ç»“æ„å’Œå±æ€§ã€‚\n  - `node`: è®¡ç®—èŠ‚ç‚¹åˆ—è¡¨ã€‚\n  - `input`: è¾“å…¥åˆ—è¡¨ã€‚\n  - `output`: è¾“å‡ºåˆ—è¡¨ã€‚\n  - `initializer`: åˆå§‹åŒ–å‚æ•°åˆ—è¡¨ã€‚\n  - `value_info`: æä¾›é¢å¤–çš„å¼ é‡ä¿¡æ¯ã€‚\nä½¿ç”¨`.onnx`æ–‡ä»¶ï¼Œå¯ä»¥è½»æ¾åœ°å°†æ¨¡å‹ä»PyTorchã€TensorFlowã€Caffe2ç­‰æ¡†æ¶è½¬æ¢åˆ°ONNXæ ¼å¼ï¼Œç„¶åå†éƒ¨ç½²åˆ°ä¸åŒçš„æ¨ç†å¼•æ“æˆ–ç¡¬ä»¶å¹³å°ä¸Šï¼Œä¾‹å¦‚ä½¿ç”¨ONNX Runtimeè¿›è¡Œæ¨ç†ã€‚è¿™ç§æ ¼å¼æé«˜äº†æ¨¡å‹çš„ä¾¿æºæ€§å’Œäº’æ“ä½œæ€§ã€‚\n\n# ç®€è¿° .pth ï¼Œ .safetensor ï¼Œ .onnx ä¿å­˜çš„ä¿¡æ¯ä¸­ï¼Œæœ‰å“ªäº›æ˜¯ç›¸åŒçš„ï¼Ÿæœ‰å“ªäº›æœ‰åŒºåˆ«ï¼Ÿ\n\n.pth, .safetensor, å’Œ .onnx æ–‡ä»¶æ ¼å¼éƒ½ç”¨äºä¿å­˜æœºå™¨å­¦ä¹ æ¨¡å‹çš„ç›¸å…³ä¿¡æ¯ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®çš„ã€å…¼å®¹æ€§å’ŒåŒ…å«çš„å…·ä½“å†…å®¹æœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬ä¹‹é—´ç›¸åŒç‚¹å’ŒåŒºåˆ«çš„æ¦‚è¿°ï¼š\n**ç›¸åŒç‚¹ï¼š**\n1. **æ¨¡å‹å‚æ•°/æƒé‡**ï¼š\n   - æ‰€æœ‰ä¸‰ç§æ ¼å¼éƒ½ä¿å­˜äº†æ¨¡å‹çš„å‚æ•°æˆ–æƒé‡ï¼Œè¿™äº›æ˜¯è®­ç»ƒè¿‡ç¨‹ä¸­å­¦ä¹ åˆ°çš„æ•°å€¼ï¼Œå¯¹äºæ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›è‡³å…³é‡è¦ã€‚\n2. **å…ƒæ•°æ®**ï¼š\n   - å®ƒä»¬éƒ½å¯èƒ½åŒ…å«ä¸€äº›å…ƒæ•°æ®ï¼Œå¦‚æ¨¡å‹çš„ç‰ˆæœ¬ã€åˆ›å»ºæ—¥æœŸæˆ–å…¶ä»–æè¿°æ€§ä¿¡æ¯ï¼Œå°½ç®¡å…·ä½“çš„å…ƒæ•°æ®å†…å®¹å’Œæ ¼å¼å¯èƒ½æœ‰æ‰€ä¸åŒã€‚\n**åŒºåˆ«ï¼š**\n1. **æ ¼å¼å’Œå…¼å®¹æ€§**ï¼š\n   - `.pth` æ˜¯ PyTorch çš„åŸç”Ÿæ ¼å¼ï¼Œä¸“é—¨ç”¨äºä¿å­˜å’ŒåŠ è½½ PyTorch æ¨¡å‹çš„çŠ¶æ€å­—å…¸ï¼ŒåŒ…æ‹¬æ¨¡å‹æƒé‡å’Œä¼˜åŒ–å™¨çŠ¶æ€ã€‚\n   - `.safetensor` æ˜¯ Hugging Face çš„ Safety Checker å·¥å…·ä½¿ç”¨çš„æ ¼å¼ï¼Œé™¤äº†æ¨¡å‹æƒé‡ï¼Œè¿˜åŒ…å«äº†å®‰å…¨æ€§ç›¸å…³çš„ä¿¡æ¯ã€‚\n   - `.onnx` æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ã€è·¨æ¡†æ¶çš„æ ¼å¼ï¼Œç”¨äºåœ¨ä¸åŒçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ä¹‹é—´äº¤æ¢æ¨¡å‹ï¼Œä¸ä»…åŒ…å«æ¨¡å‹ç»“æ„å’Œå‚æ•°ï¼Œè¿˜å®šä¹‰äº†æ¨¡å‹è®¡ç®—å›¾ã€‚\n2. **åŒ…å«å†…å®¹**ï¼š\n   - `.pth` æ–‡ä»¶é€šå¸¸åŒ…å«æ¨¡å‹çš„çŠ¶æ€å­—å…¸å’Œä¼˜åŒ–å™¨çš„çŠ¶æ€å­—å…¸ï¼Œä»¥åŠå¯é€‰çš„å…¶ä»–è®­ç»ƒä¿¡æ¯ï¼ˆå¦‚æŸå¤±å€¼ã€è¿­ä»£æ¬¡æ•°ç­‰ï¼‰ã€‚\n   - `.safetensor` æ–‡ä»¶åŒ…å«æ¨¡å‹æƒé‡ã€å…ƒæ•°æ®ä»¥åŠä¸æ¨¡å‹å®‰å…¨æ€§ç›¸å…³çš„ä¿¡æ¯ã€‚\n   - `.onnx` æ–‡ä»¶åŒ…å«æ¨¡å‹è®¡ç®—å›¾ã€èŠ‚ç‚¹å®šä¹‰ã€è¾¹çš„è¿æ¥ã€åˆå§‹å€¼ï¼ˆæ¨¡å‹æƒé‡ï¼‰ã€è¾“å…¥è¾“å‡ºå®šä¹‰ä»¥åŠå¯é€‰çš„ä¼˜åŒ–ä¿¡æ¯ã€‚\n3. **ä½¿ç”¨åœºæ™¯**ï¼š\n   - `.pth` æ–‡ä»¶ä¸»è¦ç”¨äº PyTorch æ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†ã€‚\n   - `.safetensor` æ–‡ä»¶ç”¨äºåœ¨ Hugging Face çš„ç”Ÿæ€ç³»ç»Ÿä¸­è¿›è¡Œæ¨¡å‹çš„å®‰å…¨æ£€æŸ¥ã€‚\n   - `.onnx` æ–‡ä»¶ç”¨äºæ¨¡å‹åœ¨ä¸åŒæ¡†æ¶ä¹‹é—´çš„è½¬æ¢å’Œéƒ¨ç½²ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦è·¨å¹³å°æˆ–ç¡¬ä»¶ä¼˜åŒ–çš„åœºæ™¯ä¸­ã€‚\n4. **å¼€æ”¾æ€§å’Œäº’æ“ä½œæ€§**ï¼š\n   - `.onnx` æ ¼å¼çš„è®¾è®¡é‡ç‚¹åœ¨äºå¼€æ”¾æ€§å’Œäº’æ“ä½œæ€§ï¼Œä½¿å…¶æˆä¸ºä¸åŒæ¡†æ¶å’Œå·¥å…·ä¹‹é—´æ¨¡å‹äº¤æ¢çš„æ¡¥æ¢ã€‚\n   - `.pth` å’Œ `.safetensor` æ›´ä¸“æ³¨äºç‰¹å®šæ¡†æ¶æˆ–å·¥å…·é“¾å†…çš„ä½¿ç”¨ã€‚\næ€»ç»“æ¥è¯´ï¼Œè¿™ä¸‰ç§æ ¼å¼éƒ½ç”¨äºä¿å­˜æ¨¡å‹æƒé‡ï¼Œä½†å®ƒä»¬åœ¨æ ¼å¼å…¼å®¹æ€§ã€åŒ…å«çš„é¢å¤–ä¿¡æ¯å’Œä½¿ç”¨åœºæ™¯ä¸Šå­˜åœ¨æ˜æ˜¾å·®å¼‚ã€‚`.onnx` æ ¼å¼æ›´åŠ å¼€æ”¾å’Œé€šç”¨ï¼Œè€Œ `.pth` å’Œ `.safetensor` æ›´ä¸“æ³¨äºç‰¹å®šçš„æ¡†æ¶æˆ–åº”ç”¨éœ€æ±‚ã€‚\n\n# ç®€è¿° .pth ï¼Œ .safetensor ï¼Œ .onnx ä¿å­˜çš„ä¿¡æ¯ä¸­æœ‰å“ªäº›æ˜¯ç›¸åŒçš„ï¼Ÿä¿å­˜çš„ä¿¡æ¯ä¸­åˆæœ‰å“ªäº›æœ‰åŒºåˆ«ï¼Ÿ\n\n.pthã€.safetensorå’Œ.onnxæ–‡ä»¶æ ¼å¼è™½ç„¶éƒ½æ˜¯ä¸ºäº†ä¿å­˜æœºå™¨å­¦ä¹ æ¨¡å‹çš„ç›¸å…³ä¿¡æ¯ï¼Œä½†å®ƒä»¬åœ¨ä¿å­˜çš„å†…å®¹ä¸Šå­˜åœ¨ç›¸åŒç‚¹å’Œå·®å¼‚ã€‚\n**ç›¸åŒç‚¹ï¼š**\n1. **æ¨¡å‹å‚æ•°/æƒé‡**ï¼šè¿™ä¸‰ç§æ–‡ä»¶æ ¼å¼éƒ½ä¼šä¿å­˜æ¨¡å‹çš„å‚æ•°æˆ–æƒé‡ï¼Œè¿™äº›æƒé‡æ˜¯æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å­¦ä¹ åˆ°çš„ï¼Œå¯¹æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›è‡³å…³é‡è¦ã€‚\n2. **å…ƒæ•°æ®**ï¼šå®ƒä»¬éƒ½å¯èƒ½åŒ…å«ä¸€äº›å…ƒæ•°æ®ï¼Œä¾‹å¦‚æ¨¡å‹çš„ç‰ˆæœ¬ã€åˆ›å»ºæ—¥æœŸæˆ–å…¶ä»–æè¿°æ€§ä¿¡æ¯ï¼Œå°½ç®¡å…·ä½“çš„å…ƒæ•°æ®å’Œæ ¼å¼å¯èƒ½å› æ–‡ä»¶æ ¼å¼è€Œå¼‚ã€‚\n**åŒºåˆ«ï¼š**\n1. **æ ¼å¼å’Œå…¼å®¹æ€§**ï¼š\n   - .pthæ–‡ä»¶æ˜¯PyTorchçš„åŸç”Ÿæ ¼å¼ï¼Œä¸»è¦ç”¨äºä¿å­˜å’ŒåŠ è½½PyTorchæ¨¡å‹çš„çŠ¶æ€å­—å…¸ï¼ŒåŒ…æ‹¬æ¨¡å‹æƒé‡å’Œä¼˜åŒ–å™¨çŠ¶æ€ã€‚\n   - .safetensoræ–‡ä»¶æ˜¯Hugging Faceçš„Safety Checkerå·¥å…·ä½¿ç”¨çš„æ ¼å¼ï¼Œé™¤äº†æ¨¡å‹æƒé‡ï¼Œè¿˜åŒ…æ‹¬å®‰å…¨æ€§ç›¸å…³çš„ä¿¡æ¯ã€‚\n   - .onnxæ–‡ä»¶æ˜¯ä¸€ç§å¼€æ”¾çš„ã€è·¨æ¡†æ¶çš„æ ¼å¼ï¼Œç”¨äºåœ¨ä¸åŒæ·±åº¦å­¦ä¹ æ¡†æ¶ä¹‹é—´äº¤æ¢æ¨¡å‹ï¼ŒåŒ…å«æ¨¡å‹ç»“æ„å’Œå‚æ•°ä»¥åŠæ¨¡å‹è®¡ç®—å›¾ã€‚\n2. **åŒ…å«å†…å®¹**ï¼š\n   - .pthæ–‡ä»¶é€šå¸¸åŒ…å«æ¨¡å‹çš„çŠ¶æ€å­—å…¸å’Œä¼˜åŒ–å™¨çš„çŠ¶æ€å­—å…¸ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬å…¶ä»–è®­ç»ƒä¿¡æ¯ï¼Œå¦‚æŸå¤±å€¼ã€è¿­ä»£æ¬¡æ•°ç­‰ã€‚\n   - .safetensoræ–‡ä»¶åŒ…å«æ¨¡å‹æƒé‡ã€å…ƒæ•°æ®ä»¥åŠä¸æ¨¡å‹å®‰å…¨æ€§ç›¸å…³çš„ä¿¡æ¯ã€‚\n   - .onnxæ–‡ä»¶åŒ…å«æ¨¡å‹è®¡ç®—å›¾ã€èŠ‚ç‚¹å®šä¹‰ã€è¾¹çš„è¿æ¥ã€åˆå§‹å€¼ï¼ˆæ¨¡å‹æƒé‡ï¼‰ã€è¾“å…¥è¾“å‡ºå®šä¹‰ä»¥åŠå¯é€‰çš„ä¼˜åŒ–ä¿¡æ¯ã€‚\n3. **ä½¿ç”¨åœºæ™¯**ï¼š\n   - .pthæ–‡ä»¶ä¸»è¦ç”¨äºPyTorchæ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†ã€‚\n   - .safetensoræ–‡ä»¶ç”¨äºHugging Faceç”Ÿæ€ç³»ç»Ÿä¸­çš„æ¨¡å‹å®‰å…¨æ£€æŸ¥ã€‚\n   - .onnxæ–‡ä»¶ç”¨äºæ¨¡å‹åœ¨ä¸åŒæ¡†æ¶ä¹‹é—´çš„è½¬æ¢å’Œéƒ¨ç½²ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦è·¨å¹³å°æˆ–ç¡¬ä»¶ä¼˜åŒ–çš„åœºæ™¯ä¸­ã€‚\n4. **å¼€æ”¾æ€§å’Œäº’æ“ä½œæ€§**ï¼š\n   - .onnxæ ¼å¼é‡ç‚¹åœ¨äºå¼€æ”¾æ€§å’Œäº’æ“ä½œæ€§ï¼Œä¾¿äºä¸åŒæ¡†æ¶å’Œå·¥å…·ä¹‹é—´æ¨¡å‹äº¤æ¢ã€‚\n   - .pthå’Œ.safetensoræ–‡ä»¶æ›´ä¸“æ³¨äºç‰¹å®šæ¡†æ¶æˆ–å·¥å…·é“¾å†…çš„ä½¿ç”¨ã€‚\næ€»ç»“æ¥è¯´ï¼Œè¿™ä¸‰ç§æ–‡ä»¶æ ¼å¼éƒ½ä¿å­˜æ¨¡å‹æƒé‡ï¼Œä½†åœ¨æ ¼å¼å…¼å®¹æ€§ã€åŒ…å«çš„é¢å¤–ä¿¡æ¯å’Œä½¿ç”¨åœºæ™¯ä¸Šå­˜åœ¨æ˜æ˜¾å·®å¼‚ã€‚.onnxæ ¼å¼æ›´å¼€æ”¾å’Œé€šç”¨ï¼Œè€Œ.pthå’Œ.safetensoråˆ™æ›´ä¸“æ³¨äºç‰¹å®šæ¡†æ¶æˆ–åº”ç”¨éœ€æ±‚ã€‚\n\n# .pth ï¼Œ .safetensor ï¼Œ .onnx ä¸‰ç§æ ¼å¼ï¼Œå„è‡ªèƒ½å¦ç”¨äºæ¨¡å‹çš„ finetunning ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ\n\n.pthã€.safetensor å’Œ .onnx ä¸‰ç§æ ¼å¼åœ¨æ¨¡å‹å¾®è°ƒï¼ˆfinetuningï¼‰æ–¹é¢çš„é€‚ç”¨æ€§å„æœ‰ä¸åŒï¼Œä»¥ä¸‹æ˜¯å„è‡ªçš„é€‚ç”¨æ€§åˆ†æï¼š\n**.pth æ ¼å¼ï¼š**\n.pth æ–‡ä»¶å¯ä»¥ç”¨äºæ¨¡å‹çš„å¾®è°ƒã€‚åŸå› å¦‚ä¸‹ï¼š\n- .pth æ–‡ä»¶æ˜¯ PyTorch çš„åŸç”Ÿæ ¼å¼ï¼Œå®ƒä¿å­˜äº†æ¨¡å‹çš„çŠ¶æ€å­—å…¸ï¼ŒåŒ…æ‹¬æ¨¡å‹çš„æƒé‡å’Œå¯é€‰çš„ä¼˜åŒ–å™¨çŠ¶æ€ã€‚\n- åœ¨å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åŠ è½½ .pth æ–‡ä»¶ä¸­çš„æ¨¡å‹æƒé‡ï¼Œç„¶åæ ¹æ®æ–°çš„æ•°æ®é›†å¯¹æ¨¡å‹è¿›è¡Œè¿›ä¸€æ­¥çš„è®­ç»ƒã€‚\n- å¦‚æœ .pth æ–‡ä»¶ä¸­åŒ…å«äº†ä¼˜åŒ–å™¨çŠ¶æ€ï¼Œé‚£ä¹ˆå¯ä»¥ä»ä¸­æ–­ç‚¹ç»§ç»­è®­ç»ƒï¼Œè¿™å¯¹äºå¾®è°ƒè¿‡ç¨‹æ˜¯æœ‰å¸®åŠ©çš„ã€‚\n**.safetensor æ ¼å¼ï¼š**\n.safetensor æ–‡ä»¶ä¹Ÿå¯ä»¥ç”¨äºæ¨¡å‹çš„å¾®è°ƒï¼Œä½†æœ‰ä¸€äº›é™åˆ¶ï¼š\n- .safetensor æ–‡ä»¶ä¸»è¦æ˜¯ç”± Hugging Face çš„ Safety Checker å·¥å…·ä½¿ç”¨çš„ï¼Œå®ƒä¿å­˜äº†æ¨¡å‹æƒé‡å’Œä¸å®‰å…¨æ€§ç›¸å…³çš„ä¿¡æ¯ã€‚\n- è™½ç„¶è¿™ä¸ªæ ¼å¼ä¸»è¦ç”¨äºå®‰å…¨æ£€æŸ¥ï¼Œä½†å®ƒä»ç„¶åŒ…å«äº†æ¨¡å‹æƒé‡ï¼Œå› æ­¤ç†è®ºä¸Šå¯ä»¥ç”¨äºå¾®è°ƒã€‚\n- ä½†æ˜¯ï¼Œç”±äº .safetensor æ–‡ä»¶æ ¼å¼å¯èƒ½ä¸å¦‚ .pth é‚£æ ·è¢«å¹¿æ³›æ”¯æŒï¼Œå› æ­¤åœ¨å¾®è°ƒæ—¶å¯èƒ½éœ€è¦é¢å¤–çš„æ­¥éª¤æ¥è½¬æ¢æ ¼å¼æˆ–åŠ è½½æƒé‡ã€‚\n**.onnx æ ¼å¼ï¼š**\n.onnx æ–‡ä»¶åœ¨å¾®è°ƒæ–¹é¢çš„é€‚ç”¨æ€§è¾ƒä½ï¼ŒåŸå› å¦‚ä¸‹ï¼š\n- .onnx æ–‡ä»¶æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ã€è·¨æ¡†æ¶çš„æ ¼å¼ï¼Œå®ƒä¸ä»…åŒ…å«æ¨¡å‹æƒé‡ï¼Œè¿˜å®šä¹‰äº†æ¨¡å‹è®¡ç®—å›¾ã€‚\n- è™½ç„¶ .onnx æ ¼å¼æ”¯æŒåœ¨ä¸åŒçš„æ¡†æ¶ä¹‹é—´è½¬æ¢æ¨¡å‹ï¼Œä½†å®ƒä¸æ˜¯ä¸ºäº†å¾®è°ƒè€Œè®¾è®¡çš„ã€‚è®¡ç®—å›¾æ˜¯å›ºå®šçš„ï¼Œä¸æ˜“äºä¿®æ”¹ã€‚\n- å¦‚æœéœ€è¦å¾®è°ƒ .onnx æ ¼å¼çš„æ¨¡å‹ï¼Œé€šå¸¸éœ€è¦å…ˆå°†æ¨¡å‹è½¬æ¢å›åŸå§‹æ¡†æ¶ï¼ˆå¦‚ PyTorch æˆ– TensorFlowï¼‰ï¼Œç„¶åå†è¿›è¡Œå¾®è°ƒã€‚\n- å› æ­¤ï¼Œç›´æ¥åœ¨ .onnx æ ¼å¼ä¸Šè¿›è¡Œå¾®è°ƒé€šå¸¸ä¸åˆ‡å®é™…ï¼Œé™¤éæœ‰ç‰¹å®šçš„å·¥å…·æˆ–åº“æ”¯æŒè¿™ç§æ“ä½œã€‚\næ€»ç»“æ¥è¯´ï¼Œ.pth æ ¼å¼æœ€é€‚åˆç”¨äº PyTorch æ¨¡å‹çš„å¾®è°ƒï¼Œå› ä¸ºå®ƒç›´æ¥ä¸ PyTorch çš„è®­ç»ƒå’Œæ¨ç†æµç¨‹å…¼å®¹ã€‚.safetensor æ ¼å¼ä¹Ÿå¯ä»¥ç”¨äºå¾®è°ƒï¼Œä½†å¯èƒ½éœ€è¦é¢å¤–çš„æ­¥éª¤æ¥å¤„ç†ã€‚è€Œ .onnx æ ¼å¼é€šå¸¸ä¸ç›´æ¥ç”¨äºå¾®è°ƒï¼Œéœ€è¦è½¬æ¢ä¸ºå…¶ä»–æ¡†æ¶æ ¼å¼åæ‰èƒ½è¿›è¡Œå¾®è°ƒã€‚\n\n# .pth ï¼Œ .safetensor ï¼Œ .onnx ä¸‰ç§æ ¼å¼ï¼Œå„è‡ªèƒ½å¦ç”¨äºè®­ç»ƒ LoRA ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ\n\nLoRAï¼ˆLow-Rank Adaptationï¼‰æ˜¯ä¸€ç§ç”¨äºå¾®è°ƒå¤§å‹é¢„è®­ç»ƒæ¨¡å‹çš„æŠ€æœ¯ï¼Œå®ƒé€šè¿‡å¼•å…¥ä½ç§©åˆ†è§£æ¥å‡å°‘å¾®è°ƒæ‰€éœ€çš„å‚æ•°æ•°é‡ï¼Œä»è€Œå‡å°‘å­˜å‚¨å’Œè®¡ç®—éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯å…³äº .pthã€.safetensor å’Œ .onnx æ ¼å¼åœ¨è®­ç»ƒ LoRA æ—¶çš„é€‚ç”¨æ€§åˆ†æï¼š\n**.pth æ ¼å¼ï¼š**\n.pth æ–‡ä»¶å¯ä»¥ç”¨äºè®­ç»ƒ LoRAã€‚åŸå› å¦‚ä¸‹ï¼š\n- .pth æ–‡ä»¶æ˜¯ PyTorch çš„åŸç”Ÿæ ¼å¼ï¼Œå¯ä»¥ç›´æ¥ä¿å­˜å’ŒåŠ è½½æ¨¡å‹çš„æƒé‡ï¼ŒåŒ…æ‹¬ LoRA å¼•å…¥çš„ä½ç§©çŸ©é˜µã€‚\n- åœ¨è®­ç»ƒ LoRA æ—¶ï¼Œé€šå¸¸éœ€è¦åœ¨åŸå§‹é¢„è®­ç»ƒæ¨¡å‹çš„åŸºç¡€ä¸Šæ·»åŠ é¢å¤–çš„å‚æ•°ï¼ˆå³ä½ç§©çŸ©é˜µï¼‰ï¼Œè¿™äº›å‚æ•°å¯ä»¥åœ¨ PyTorch ä¸­é€šè¿‡è‡ªå®šä¹‰å±‚æˆ–ä¿®æ”¹ç°æœ‰å±‚æ¥å®ç°ã€‚\n- ç”±äº .pth æ–‡ä»¶ä¸ PyTorch æ¡†æ¶ç´§å¯†é›†æˆï¼Œå› æ­¤å¯ä»¥è½»æ¾åœ°ä¿å­˜å’ŒåŠ è½½ LoRA çš„å‚æ•°ï¼Œå¹¶è¿›è¡Œè®­ç»ƒã€‚\n**.safetensor æ ¼å¼ï¼š**\n.safetensor æ–‡ä»¶ä¹Ÿå¯ä»¥ç”¨äºè®­ç»ƒ LoRAï¼Œä½†å¯èƒ½æœ‰ä¸€äº›é™åˆ¶ï¼š\n- .safetensor æ–‡ä»¶æ˜¯ä¸ºäº†æé«˜æ¨¡å‹ä½¿ç”¨çš„å®‰å…¨æ€§è€Œè®¾è®¡çš„ï¼Œå®ƒä¿å­˜äº†æ¨¡å‹æƒé‡å’Œå…¶ä»–ä¸å®‰å…¨æ€§ç›¸å…³çš„ä¿¡æ¯ã€‚\n- å¦‚æœ LoRA çš„å‚æ•°è¢«åŒ…å«åœ¨ .safetensor æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆç†è®ºä¸Šå¯ä»¥ç”¨äºè®­ç»ƒã€‚\n- ç„¶è€Œï¼Œç”±äº .safetensor æ–‡ä»¶æ ¼å¼å¯èƒ½ä¸å¦‚ .pth é‚£æ ·è¢«å¹¿æ³›æ”¯æŒï¼Œå› æ­¤åœ¨è®­ç»ƒ LoRA æ—¶å¯èƒ½éœ€è¦é¢å¤–çš„æ­¥éª¤æ¥å¤„ç†æ–‡ä»¶æ ¼å¼ã€‚\n**.onnx æ ¼å¼ï¼š**\n.onnx æ–‡ä»¶åœ¨è®­ç»ƒ LoRA æ–¹é¢é€šå¸¸ä¸é€‚ç”¨ã€‚åŸå› å¦‚ä¸‹ï¼š\n- .onnx æ–‡ä»¶å®šä¹‰äº†æ¨¡å‹çš„è®¡ç®—å›¾å’Œæƒé‡ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªé™æ€çš„æ¨¡å‹æè¿°æ ¼å¼ï¼Œä¸é€‚åˆåŠ¨æ€ä¿®æ”¹æ¨¡å‹ç»“æ„ï¼Œå¦‚æ·»åŠ  LoRA å±‚ã€‚\n- LoRA éœ€è¦åœ¨é¢„è®­ç»ƒæ¨¡å‹çš„ç‰¹å®šå±‚ä¸­æ’å…¥ä½ç§©çŸ©é˜µï¼Œè¿™é€šå¸¸éœ€è¦å¯¹æ¨¡å‹ç»“æ„è¿›è¡Œä¿®æ”¹ï¼Œè€Œ .onnx æ ¼å¼ä¸æ”¯æŒè¿™ç§ä¿®æ”¹ã€‚\n- å¦‚æœéœ€è¦ä½¿ç”¨ .onnx æ–‡ä»¶ä¸­çš„æ¨¡å‹æ¥è®­ç»ƒ LoRAï¼Œé€šå¸¸éœ€è¦å…ˆå°†æ¨¡å‹è½¬æ¢å› PyTorch æˆ–å…¶ä»–æ”¯æŒåŠ¨æ€å›¾ä¿®æ”¹çš„æ¡†æ¶ï¼Œç„¶åå†è¿›è¡Œè®­ç»ƒã€‚\næ€»ç»“æ¥è¯´ï¼Œ.pth æ ¼å¼æœ€é€‚åˆç”¨äºè®­ç»ƒ LoRAï¼Œå› ä¸ºå®ƒä¸ PyTorch æ¡†æ¶ç´§å¯†é›†æˆï¼Œæ”¯æŒåŠ¨æ€å›¾å’Œè‡ªå®šä¹‰å±‚çš„æ·»åŠ ã€‚.safetensor æ ¼å¼åœ¨ç†è®ºä¸Šä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†å¯èƒ½éœ€è¦é¢å¤–çš„å¤„ç†æ­¥éª¤ã€‚è€Œ .onnx æ ¼å¼ç”±äºä¸æ”¯æŒåŠ¨æ€ä¿®æ”¹æ¨¡å‹ç»“æ„ï¼Œå› æ­¤ä¸é€‚åˆç›´æ¥ç”¨äºè®­ç»ƒ LoRAã€‚\n\n# pth ï¼Œ safetensor ï¼Œ onnx ï¼Œä¸‰ç§æ ¼å¼å¦‚ä½•ä¸¤ä¸¤è½¬æ¢ï¼Ÿ\n\n.pthã€.safetensor å’Œ .onnx æ–‡ä»¶æ ¼å¼ä¹‹é—´çš„è½¬æ¢é€šå¸¸éœ€è¦é€šè¿‡ç‰¹å®šçš„å·¥å…·å’Œåº“æ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨è¿™ä¸‰ç§æ ¼å¼ä¹‹é—´è¿›è¡Œä¸¤ä¸¤è½¬æ¢çš„æ¦‚è¿°ï¼š\n### .pth åˆ° .safetensor çš„è½¬æ¢\nç›®å‰ï¼Œå¹¶æ²¡æœ‰ç›´æ¥çš„æ ‡å‡†å·¥å…·æ¥å°† .pth æ–‡ä»¶è½¬æ¢ä¸º .safetensor æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå¯ä»¥æ‰‹åŠ¨åŠ è½½ .pth æ–‡ä»¶ä¸­çš„æƒé‡ï¼Œå¹¶å°†å…¶ä¿å­˜ä¸º .safetensor æ ¼å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹æ­¥éª¤ï¼š\n1. ä½¿ç”¨ PyTorch åŠ è½½ .pth æ–‡ä»¶ã€‚\n2. æå–æ¨¡å‹æƒé‡ã€‚\n3. ä½¿ç”¨ Hugging Face çš„ `transformers` åº“æˆ–å…¶ä»–ç›¸å…³å·¥å…·å°†æƒé‡ä¿å­˜ä¸º .safetensor æ–‡ä»¶ã€‚\n### .safetensor åˆ° .pth çš„è½¬æ¢\nåŒæ ·åœ°ï¼Œå°† .safetensor æ–‡ä»¶è½¬æ¢ä¸º .pth æ–‡ä»¶ä¹Ÿæ²¡æœ‰ç›´æ¥çš„è½¬æ¢å·¥å…·ã€‚ä»¥ä¸‹æ˜¯æ‰‹åŠ¨è½¬æ¢çš„æ­¥éª¤ï¼š\n1. ä½¿ç”¨ Hugging Face çš„ `transformers` åº“æˆ–å…¶ä»–ç›¸å…³å·¥å…·åŠ è½½ .safetensor æ–‡ä»¶ã€‚\n2. æå–æ¨¡å‹æƒé‡ã€‚\n3. ä½¿ç”¨ PyTorch å°†æƒé‡ä¿å­˜ä¸º .pth æ–‡ä»¶ã€‚\n### .pth åˆ° .onnx çš„è½¬æ¢\nPyTorch æä¾›äº†ç›´æ¥å°†æ¨¡å‹è½¬æ¢ä¸º .onnx æ ¼å¼çš„å·¥å…·ï¼š\n```python\nimport torch\nimport torch.onnx\n# å‡è®¾ model æ˜¯ä¸€ä¸ª PyTorch æ¨¡å‹\nmodel = ...  # åŠ è½½æˆ–å®šä¹‰æ¨¡å‹\n# å‡è®¾è¾“å…¥æ˜¯ä¸€ä¸ªå¼ é‡ï¼Œå…¶å½¢çŠ¶ä¸æ¨¡å‹è¾“å…¥å…¼å®¹\ninput_sample = torch.randn(batch_size, channels, height, width)\n# å°†æ¨¡å‹è½¬æ¢ä¸º ONNX æ ¼å¼\ntorch.onnx.export(model,               # æ¨¡å‹\n                  input_sample,        # æ¨¡å‹è¾“å…¥ï¼ˆæˆ–ä¸€ä¸ªåŒ…å«è¾“å…¥çš„å…ƒç»„ï¼‰\n                  \"model.onnx\",       # è¾“å‡ºæ–‡ä»¶å\n                  export_params=True,  # æ˜¯å¦å¯¼å‡ºå‚æ•°\n                  opset_version=10,    # ONNX ç®—å­é›†ç‰ˆæœ¬\n                  do_constant_folding=True,  # æ˜¯å¦æ‰§è¡Œå¸¸é‡æŠ˜å ä¼˜åŒ–\n                  input_names=['input'],   # è¾“å…¥å\n                  output_names=['output'], # è¾“å‡ºå\n                  dynamic_axes={'input': {0: 'batch_size'},  # åŠ¨æ€è½´\n                                'output': {0: 'batch_size'}})\n```\n### .onnx åˆ° .pth çš„è½¬æ¢\nå°† .onnx æ–‡ä»¶è½¬æ¢ä¸º .pth æ–‡ä»¶é€šå¸¸ä¸ç›´æ¥è¿›è¡Œï¼Œå› ä¸º .onnx æ–‡ä»¶åŒ…å«äº†æ¨¡å‹çš„ç»“æ„ä¿¡æ¯ï¼Œè€Œ .pth æ–‡ä»¶åªåŒ…å«æƒé‡ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥é‡æ–°åˆ›å»º PyTorch æ¨¡å‹ç»“æ„ï¼Œç„¶ååŠ è½½ .onnx æ–‡ä»¶ä¸­çš„æƒé‡ï¼š\n1. å®šä¹‰ä¸ .onnx æ–‡ä»¶å¯¹åº”çš„ PyTorch æ¨¡å‹ç»“æ„ã€‚\n2. ä½¿ç”¨ `onnx.load` åŠ è½½ .onnx æ–‡ä»¶ã€‚\n3. æå–æƒé‡å¹¶å°†å…¶åŠ è½½åˆ° PyTorch æ¨¡å‹ä¸­ã€‚\n### .safetensor åˆ° .onnx çš„è½¬æ¢\nç›®å‰æ²¡æœ‰ç›´æ¥çš„æ–¹æ³•å°† .safetensor æ–‡ä»¶è½¬æ¢ä¸º .onnx æ–‡ä»¶ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥å…ˆå°† .safetensor æ–‡ä»¶è½¬æ¢ä¸º .pth æ–‡ä»¶ï¼Œç„¶åå†æŒ‰ç…§ä¸Šè¿°æ–¹æ³•å°† .pth æ–‡ä»¶è½¬æ¢ä¸º .onnx æ–‡ä»¶ã€‚\n### .onnx åˆ° .safetensor çš„è½¬æ¢\nåŒæ ·åœ°ï¼Œå°† .onnx æ–‡ä»¶è½¬æ¢ä¸º .safetensor æ–‡ä»¶ä¹Ÿæ²¡æœ‰ç›´æ¥çš„è½¬æ¢å·¥å…·ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥å…ˆå°† .onnx æ–‡ä»¶è½¬æ¢ä¸º .pth æ–‡ä»¶ï¼Œç„¶åå†å°† .pth æ–‡ä»¶è½¬æ¢ä¸º .safetensor æ–‡ä»¶ã€‚\nåœ¨è¿›è¡Œè¿™äº›è½¬æ¢æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè½¬æ¢è¿‡ç¨‹ä¸­å¯èƒ½ä¼šä¸¢å¤±ä¸€äº›ç‰¹å®šçš„ä¿¡æ¯ï¼Œå¦‚ä¼˜åŒ–å™¨çŠ¶æ€æˆ–æ¨¡å‹é…ç½®ï¼Œå› æ­¤åœ¨è½¬æ¢åå¯èƒ½éœ€è¦é¢å¤–çš„æ­¥éª¤æ¥ç¡®ä¿æ¨¡å‹çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚\n\n# æˆ‘æœ‰ä¸€ä¸ªä»ç½‘ç»œä¸Šä¸‹è½½çš„ .pth æ–‡ä»¶ `001.pth` ã€‚ç»™æˆ‘ Python ä»£ç ï¼Œå°†å…¶è½¬æ¢ä¸º onnx æ ¼å¼ã€‚\n\nè¦å°†ä¸€ä¸ª `.pth` æ–‡ä»¶è½¬æ¢ä¸º `.onnx` æ ¼å¼ï¼Œä½ éœ€è¦é¦–å…ˆåŠ è½½ `.pth` æ–‡ä»¶ä¸­çš„æ¨¡å‹ï¼Œç„¶åä½¿ç”¨ PyTorch çš„ `torch.onnx.export` å‡½æ•°æ¥è¿›è¡Œè½¬æ¢ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª Python ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•è¿›è¡Œè¿™ä¸€è½¬æ¢è¿‡ç¨‹ã€‚å‡è®¾ä½ å·²ç»æœ‰äº†å¯¹åº”çš„ PyTorch æ¨¡å‹å®šä¹‰ï¼Œå¹¶ä¸” `.pth` æ–‡ä»¶ä¸­åŒ…å«çš„æ˜¯è¯¥æ¨¡å‹çš„æƒé‡ã€‚\nè¯·æ³¨æ„ï¼Œä»¥ä¸‹ä»£ç å‡è®¾ä½ çš„æ¨¡å‹æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ PyTorch æ¨¡å‹ï¼Œå¹¶ä¸”ä½ çŸ¥é“æ¨¡å‹çš„è¾“å…¥å°ºï¿½ï¿½ã€‚ä½ éœ€è¦æ ¹æ®ä½ çš„æ¨¡å‹å®é™…æƒ…å†µæ¥è°ƒæ•´è¾“å…¥å°ºå¯¸å’Œæ¨¡å‹ç»“æ„ã€‚\n```python\nimport torch\nimport torch.onnx\n# å‡è®¾æ¨¡å‹ç»“æ„å’Œè¾“å…¥å°ºå¯¸å·²çŸ¥\n# è¿™é‡Œæ˜¯ç¤ºä¾‹æ¨¡å‹ç»“æ„å’Œè¾“å…¥å°ºå¯¸ï¼Œä½ éœ€è¦æ ¹æ®ä½ çš„æ¨¡å‹è¿›è¡Œä¿®æ”¹\nclass MyModel(torch.nn.Module):\n    def __init__(self):\n        super(MyModel, self).__init__()\n        # å®šä¹‰æ¨¡å‹ç»“æ„\n        self.conv1 = torch.nn.Conv2d(3, 16, kernel_size=3, stride=1, padding=1)\n        self.relu = torch.nn.ReLU()\n        self.pool = torch.nn.MaxPool2d(kernel_size=2, stride=2, padding=0)\n        # ... æ·»åŠ æ›´å¤šå±‚ ...\n    def forward(self, x):\n        # å®šä¹‰å‰å‘ä¼ æ’­\n        x = self.conv1(x)\n        x = self.relu(x)\n        x = self.pool(x)\n        # ... åº”ç”¨æ›´å¤šå±‚ ...\n        return x\n# åˆ›å»ºæ¨¡å‹å®ä¾‹\nmodel = MyModel()\n# åŠ è½½.pthæ–‡ä»¶ä¸­çš„æƒé‡\nmodel.load_state_dict(torch.load('001.pth'))\n# è®¾ç½®æ¨¡å‹ä¸ºè¯„ä¼°æ¨¡å¼ï¼ˆå¦‚æœé€‚ç”¨ï¼‰\nmodel.eval()\n# åˆ›å»ºä¸€ä¸ªç¬¦åˆæ¨¡å‹è¾“å…¥å°ºå¯¸çš„ç¤ºä¾‹è¾“å…¥\n# å‡è®¾è¾“å…¥æ˜¯å•å¼ å›¾ç‰‡ï¼Œé€šé“æ•°ä¸º3ï¼Œé«˜å’Œå®½åˆ†åˆ«ä¸º224å’Œ224\n# ä½ éœ€è¦æ ¹æ®ä½ çš„æ¨¡å‹è°ƒæ•´è¾“å…¥å°ºå¯¸\ninput_sample = torch.randn(1, 3, 224, 224)\n# æŒ‡å®šONNXæ¨¡å‹çš„è¾“å‡ºæ–‡ä»¶å\noutput_file = 'model.onnx'\n# å¯¼å‡ºæ¨¡å‹ä¸ºONNXæ ¼å¼\ntorch.onnx.export(model,               # æ¨¡å‹\n                  input_sample,        # æ¨¡å‹è¾“å…¥ï¼ˆæˆ–ä¸€ä¸ªåŒ…å«è¾“å…¥çš„å…ƒç»„ï¼‰\n                  output_file,         # è¾“å‡ºæ–‡ä»¶å\n                  export_params=True,  # æ˜¯å¦å¯¼å‡ºå‚æ•°\n                  opset_version=10,    # ONNX ç®—å­é›†ç‰ˆæœ¬\n                  do_constant_folding=True,  # æ˜¯å¦æ‰§è¡Œå¸¸é‡æŠ˜å ä¼˜åŒ–\n                  input_names=['input'],   # è¾“å…¥å\n                  output_names=['output'], # è¾“å‡ºå\n                  dynamic_axes={'input': {0: 'batch_size'},  # åŠ¨æ€è½´\n                                'output': {0: 'batch_size'}})\n```\nåœ¨è¿è¡Œè¿™æ®µä»£ç ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š\n- ä½ çš„ç¯å¢ƒä¸­å·²ç»å®‰è£…äº† PyTorch å’Œ onnxã€‚\n- ä½ å·²ç»æ ¹æ®ä½ çš„æ¨¡å‹ç»“æ„æ­£ç¡®åœ°å®šä¹‰äº† `MyModel` ç±»ã€‚\n- ä½ å·²ç»æ ¹æ®ä½ çš„æ¨¡å‹è¾“å…¥å°ºå¯¸æ­£ç¡®åœ°è®¾ç½®äº† `input_sample`ã€‚\nè¿è¡Œä¸Šè¿°ä»£ç åï¼Œä½ åº”è¯¥ä¼šåœ¨å½“å‰ç›®å½•ä¸‹å¾—åˆ°ä¸€ä¸ªåä¸º `model.onnx` çš„æ–‡ä»¶ï¼Œè¿™å°±æ˜¯è½¬æ¢åçš„ ONNX æ ¼å¼çš„æ¨¡å‹ã€‚\n\n# æˆ‘æ²¡æœ‰å¯¹åº”çš„ PyTorch æ¨¡å‹å®šä¹‰ã€‚æˆ‘è¦å¦‚ä½•è·å¾—ï¼Ÿ\n\nå¦‚æœä½ æ²¡æœ‰æ¨¡å‹çš„ PyTorch å®šä¹‰ï¼Œä½†ä½ æœ‰ä¸€ä¸ª `.pth` æ–‡ä»¶ï¼Œä½ å¯ä»¥å°è¯•ä»¥ä¸‹å‡ ç§æ–¹æ³•æ¥è·å–æˆ–é‡å»ºæ¨¡å‹çš„ç»“æ„ï¼š\n### 1. ä½¿ç”¨ PyTorch çš„ `torch.jit.load`\nå¦‚æœä½ çš„ `.pth` æ–‡ä»¶æ˜¯ä¸€ä¸ª JIT traced çš„æ¨¡å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ `torch.jit.load` æ¥åŠ è½½å®ƒï¼Œè¿™æ ·å°±ä¸éœ€è¦åŸå§‹çš„æ¨¡å‹å®šä¹‰ã€‚\n```python\nimport torch\n# åŠ è½½JIT tracedæ¨¡å‹\ntraced_model = torch.jit.load('001.pth')\n# ä½¿ç”¨æ¨¡å‹ï¼ˆä¾‹å¦‚è¿›è¡Œæ¨ç†ï¼‰\n# input_sample = ...  # åˆ›å»ºä¸€ä¸ªç¬¦åˆæ¨¡å‹è¾“å…¥å°ºå¯¸çš„ç¤ºä¾‹è¾“å…¥\n# output = traced_model(input_sample)\n```\n### 2. æŸ¥æ‰¾æ¨¡å‹çš„æ–‡æ¡£æˆ–ä»£ç \nå¦‚æœæ¨¡å‹æ˜¯ä»æŸä¸ªçŸ¥åçš„ä»£ç åº“æˆ–è®ºæ–‡ä¸­è·å¾—çš„ï¼Œä½ å¯ä»¥å°è¯•æŸ¥æ‰¾åŸå§‹çš„æ¨¡å‹å®šä¹‰ä»£ç ã€‚é€šå¸¸ï¼Œè®ºæ–‡çš„é™„å½•æˆ–ä»£ç åº“çš„ README æ–‡ä»¶ä¼šåŒ…å«æ¨¡å‹çš„å®šä¹‰ã€‚\n### 3. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“\næœ‰äº›ç¬¬ä¸‰æ–¹åº“å¯èƒ½æä¾›äº†é¢„å®šä¹‰çš„æ¨¡å‹ç»“æ„ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨è¿™äº›åº“æ¥åŠ è½½æ¨¡å‹ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªåœ¨ torchvision ä¸­å®šä¹‰çš„æ¨¡å‹ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š\n```python\nimport torch\nimport torchvision.models as models\n# å‡è®¾ä½ çŸ¥é“æ¨¡å‹æ˜¯ torchvision ä¸­çš„æŸä¸ªæ¨¡å‹\nmodel = models.resnet50(pretrained=False)\n# åŠ è½½æƒé‡\nmodel.load_state_dict(torch.load('001.pth'))\n```\n### 4. ååºåˆ—åŒ–çŠ¶æ€å­—å…¸\nå¦‚æœä½ åªæ˜¯ä¸¢å¤±äº†æ¨¡å‹å®šä¹‰ï¼Œä½†ä½ æœ‰çŠ¶æ€å­—å…¸ï¼Œä½ å¯ä»¥å°è¯•ååºåˆ—åŒ–çŠ¶æ€å­—å…¸æ¥é‡å»ºæ¨¡å‹ç»“æ„ã€‚\n```python\nimport torch\n# åŠ è½½çŠ¶æ€å­—å…¸\nstate_dict = torch.load('001.pth')\n# å‡è®¾ä½ çŸ¥é“æ¨¡å‹ç»“æ„ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç©ºçš„æ¨¡å‹å®ä¾‹ï¼Œç„¶ååŠ è½½çŠ¶æ€å­—å…¸\n# model = ...  # åˆ›å»ºæ¨¡å‹å®ä¾‹\n# model.load_state_dict(state_dict)\n```\n### 5. ä½¿ç”¨æ¨¡å‹æ¶æ„æœç´¢å·¥å…·\næœ‰ä¸€äº›å·¥å…·å’Œåº“å¯ä»¥å¸®åŠ©ä½ æ ¹æ®æƒé‡æ–‡ä»¶æ¨æ–­å‡ºæ¨¡å‹ç»“æ„ã€‚ä¾‹å¦‚ï¼Œ`netron` æ˜¯ä¸€ä¸ªå¯è§†åŒ–ç¥ç»ç½‘ç»œå·¥å…·ï¼Œå¯ä»¥æ˜¾ç¤º `.pth` æ–‡ä»¶ä¸­çš„æ¨¡å‹ç»“æ„ã€‚\n```bash\n# å®‰è£… netron\npip install netron\n# ä½¿ç”¨ netron å¯è§†åŒ–æ¨¡å‹\nnetron start 001.pth\n```\né€šè¿‡è¿™äº›æ–¹æ³•ï¼Œä½ åº”è¯¥èƒ½å¤Ÿæ‰¾åˆ°æˆ–é‡å»ºæ¨¡å‹çš„ç»“æ„ã€‚ä¸€æ—¦ä½ æœ‰äº†æ¨¡å‹å®šä¹‰ï¼Œä½ å¯ä»¥ä½¿ç”¨å‰é¢æä¾›çš„ä»£ç ç¤ºä¾‹æ¥å°† `.pth` æ–‡ä»¶è½¬æ¢ä¸º `.onnx` æ ¼å¼ã€‚å¦‚æœä½ æ— æ³•ç¡®å®šæ¨¡å‹ç»“æ„ï¼Œä½ å¯èƒ½éœ€è¦è”ç³»æ¨¡å‹çš„åŸå§‹ä½œè€…æˆ–æŸ¥æ‰¾ç›¸å…³çš„æ–‡æ¡£æ¥è·å–æ¨¡å‹å®šä¹‰ã€‚\n\n\n","title":"æ·±åº¦å­¦ä¹ æ¨¡å‹æ–‡ä»¶æ ¼å¼å¯¹æ¯”ï¼špthã€safetensor ä¸ onnx","abstract":"\u003e æœ¬é¡µé¢ä»‹ç»äº†ä¸‰ç§æœºå™¨å­¦ä¹ æ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼š.pthã€.safetensor å’Œ .onnxã€‚ä¸»è¦å†…å®¹åŒ…æ‹¬æ¯ç§æ ¼å¼çš„å®šä¹‰ã€ä¿å­˜çš„å†…å®¹ã€ç”¨é€”ä»¥åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å’Œè½¬æ¢æ–¹æ³•ã€‚\nPyTorchä¸­çš„`.pth`æ–‡ä»¶é€šå¸¸ç”¨äºä¿å­˜æ¨¡å‹çš„æƒé‡ï¼ˆparametersï¼‰å’Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„ä¼˜åŒ–å™¨çŠ¶æ€ï¼ˆoptimizer stateï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œä¸€ä¸ª`.pth`æ–‡ä»¶å¯èƒ½åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\n1. **æ¨¡å‹çŠ¶æ€å­—å…¸ï¼ˆModel state dictionaryï¼‰**ï¼š","length":322,"created_at":"2024-11-29T02:00:00.000Z","updated_at":"2024-11-29T02:00:00.000Z","tags":["PyTorch","ONNX","æ·±åº¦å­¦ä¹ ","æ¨¡å‹éƒ¨ç½²","å­¦ä¹ ç¬”è®°"],"license":true}}}},"__N_SSG":true},"page":"/learn_from_ai/[slug]","query":{"slug":"opencv-coordinate-system-conventions"},"buildId":"w1ZimoTUC3z7UiVINTMsP","assetPrefix":"/blog-next","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>