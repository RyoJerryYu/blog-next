{"pageProps":{"slug":"try-cursor-and-thinking","tags":[{"tag":"Cursor","slug":"cursor","path":"/tags/cursor","postSlugs":[{"postType":"articles","postSlug":"try-cursor-and-thinking","postPagePath":"/articles/try-cursor-and-thinking"}]},{"tag":"æ‚è°ˆ","slug":"æ‚è°ˆ","path":"/tags/æ‚è°ˆ","postSlugs":[{"postType":"articles","postSlug":"hello-world","postPagePath":"/articles/hello-world"},{"postType":"articles","postSlug":"try-cursor-and-thinking","postPagePath":"/articles/try-cursor-and-thinking"}]}],"source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    blockquote: \"blockquote\",\n    h2: \"h2\",\n    h3: \"h3\",\n    img: \"img\",\n    li: \"li\",\n    ol: \"ol\",\n    p: \"p\",\n    strong: \"strong\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"è¯•ç€ç”¨äº†ä¸€ä¸‹ cursor ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ã€‚éæŠ€æœ¯ä¹Ÿèƒ½åŠå°æ—¶èƒ½åšä¸€æ¬¾ App å¯èƒ½æ˜¯çœŸçš„ã€‚ä½†æ›¿ä»£ä¸äº†æŠ€æœ¯å²—ä¹Ÿæ˜¯çœŸçš„ã€‚\"\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"å…ˆè¯´é—®é¢˜\",\n      children: _jsx(_components.a, {\n        href: \"#å…ˆè¯´é—®é¢˜\",\n        children: \"å…ˆè¯´é—®é¢˜\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"è™½ç„¶ Cursor åŸºäº VSCode äºŒæ¬¡å¼€å‘ï¼Œä½†å¯èƒ½ä¸ºäº†åš AI åŠŸèƒ½æŠŠ Editor Pooling æˆ–è€… File Watching èƒ½åŠ›æåäº†ï¼Œç»å¸¸ Apply äº†ä¿®æ”¹å Explorer å’Œ Editor é‡Œæ²¡æœ‰åŠæ—¶åé¦ˆã€‚ç„¶åè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½å› ä¸ºå¯ä»¥åˆ å†…å®¹å¯¼è‡´æ‰‹æ„Ÿè·Ÿ VSCode é‡Œçš„ Copilot æ¯”è¾ƒä¸åŒï¼Œç”¨èµ·æ¥æ¯”è¾ƒ annoying ã€‚\"\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"æ–‡ä»¶ç³»ç»Ÿç›‘æ§é—®é¢˜\",\n      children: _jsx(_components.a, {\n        href: \"#æ–‡ä»¶ç³»ç»Ÿç›‘æ§é—®é¢˜\",\n        children: \"æ–‡ä»¶ç³»ç»Ÿç›‘æ§é—®é¢˜\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ä½œä¸ºä¸€ä¸ªåŸºäº VSCode äºŒæ¬¡å¼€å‘çš„ç¼–è¾‘å™¨ï¼ŒCursor åœ¨æ–‡ä»¶ç³»ç»Ÿç›‘æ§æ–¹é¢å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å½“å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹åï¼ŒExplorer å’Œ Editor ç»å¸¸æ— æ³•åŠæ—¶åæ˜ è¿™äº›å˜åŒ–ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºä¸ºäº†å®ç° AI åŠŸèƒ½è€Œå¯¹åŸæœ‰çš„ Editor Pooling æˆ– File Watching æœºåˆ¶è¿›è¡Œäº†ä¿®æ”¹å¯¼è‡´çš„ã€‚\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"è¿™ç®€ç›´å¤ªè®©äººæŠ“ç‹‚äº†ï¼ğŸ˜« ä½ æ”¹äº†ä»£ç ï¼Œç¼–è¾‘å™¨å´åœ¨é‚£è£…å‚»å……æ„£ã€‚å°±å¥½åƒä½ å‘äº†æ¶ˆæ¯ï¼Œå¯¹æ–¹å·²è¯»ä¸å› ğŸ’¬ã€‚ç¨‹åºå‘˜æœ€è®¨åŒç­‰å¾…äº†ï¼Œå¯¹å§ï¼Ÿâ³\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"è‡ªåŠ¨è¡¥å…¨ä½“éªŒå·®å¼‚\",\n      children: _jsx(_components.a, {\n        href: \"#è‡ªåŠ¨è¡¥å…¨ä½“éªŒå·®å¼‚\",\n        children: \"è‡ªåŠ¨è¡¥å…¨ä½“éªŒå·®å¼‚\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Cursor çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ä¸ VSCode ä¸­çš„ GitHub Copilot æœ‰æ˜æ˜¾çš„ä½¿ç”¨ä½“éªŒå·®å¼‚ã€‚ç”±äº Cursor çš„è¡¥å…¨å¯ä»¥åˆ é™¤å·²æœ‰å†…å®¹ï¼Œè¿™ç§è¡Œä¸ºæ–¹å¼ä¸ç¨‹åºå‘˜ä¹ æƒ¯çš„ç¼–è¾‘æ¨¡å¼ä¸å¤ªç›¸ç¬¦ï¼Œä½¿ç”¨èµ·æ¥æ„Ÿè§‰æ¯”è¾ƒçªå…€å’Œçƒ¦äººã€‚\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"è¿™ä¸ªåŠŸèƒ½çœŸçš„è®©äººåˆçˆ±åˆæ¨ ğŸ’”ï¼AI å°åŠ©æ‰‹å¤ªçƒ­æƒ…äº†ï¼ŒåŠ¨ä¸åŠ¨å°±æƒ³å¸®ä½ é‡å†™ä»£ç ã€‚å†·é™ç‚¹ï¼Œè€é“ï¼æˆ‘åªæ˜¯æƒ³è¦ä¸€ç‚¹æç¤ºè€Œå·²ï¼ğŸ¤ª\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"æ€§èƒ½å½±å“\",\n      children: _jsx(_components.a, {\n        href: \"#æ€§èƒ½å½±å“\",\n        children: \"æ€§èƒ½å½±å“\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"è¿™äº›æŠ€æœ¯é—®é¢˜ä¸ä»…å½±å“äº†å¼€å‘ä½“éªŒï¼Œè¿˜å¯èƒ½ä¼šé™ä½ç¼–ç æ•ˆç‡ã€‚å®æ—¶çš„æ–‡ä»¶ç³»ç»Ÿåé¦ˆå¯¹äºå¼€å‘å·¥ä½œæµç¨‹æ¥è¯´æ˜¯éå¸¸é‡è¦çš„ï¼Œè€Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½çš„å·®å¼‚ä¹Ÿä¼šå½±å“åˆ°æ—¥å¸¸ç¼–ç çš„æµç•…åº¦ã€‚\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"æ€§èƒ½é—®é¢˜çœŸæ˜¯è®©äººå¤´å¤§ ğŸ¤¯ï¼å†™ä»£ç å°±åº”è¯¥æ˜¯è¡Œäº‘æµæ°´çš„æ„Ÿè§‰ï¼Œç°åœ¨å´ç»å¸¸è¦ç­‰ç­‰ç­‰...ç­‰åˆ°æˆ‘éƒ½èƒ½å–å®Œä¸€æ¯å’–å•¡äº† â˜•ï¸ï¼\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"chat-anywhere\",\n      children: _jsx(_components.a, {\n        href: \"#chat-anywhere\",\n        children: \"Chat Anywhere\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ä¸è¿‡ Chat Anywhere è¿™ä¸ªåšæ³•åº”è¯¥æ˜¯åšå¯¹äº†ã€‚éœ€è¦ç”¨ AI ä»£å†™çš„åœºæ™¯ï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸æ˜¯ä¸ä¼šå†™è€Œæ˜¯æ‡’å¾—å†™ï¼Œä»¥å‰åœ¨ VSCode é‡Œéœ€è¦åˆ‡åˆ° Coplilot çš„ Tab ï¼Œå†™ prompt ç­‰å›å¤ï¼Œç„¶åå†å°†ç­”æ¡ˆå¤åˆ¶ç²˜è´´å›å»ï¼Œå¤šæ•°æƒ…å†µä¸‹æœ‰è¿™é—²å·¥å¤«è¿˜ä¸å¦‚ç›´æ¥è‡ªå·±å†™ğŸ¤£ï¼Œåœ¨ Cursor é‡Œå¯ä»¥ç›´æ¥åŸåœ°è°ƒ AI æ”¹å†™ï¼ŒçœŸçš„å·¨èˆ’æœã€‚\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"è¿™åŠŸèƒ½ç®€ç›´å°±æ˜¯æ‡’äººç¦éŸ³å•Šï¼ğŸ¯ å†ä¹Ÿä¸ç”¨åœ¨å„ç§çª—å£ä¹‹é—´è·³æ¥è·³å»äº†ï¼çˆ½æ­ªæ­ªï¼ğŸŠ\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"æ™ºèƒ½ä»£ç åˆ†æ\",\n      children: _jsx(_components.a, {\n        href: \"#æ™ºèƒ½ä»£ç åˆ†æ\",\n        children: \"æ™ºèƒ½ä»£ç åˆ†æ\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"è¿˜æœ‰ Cursor å¯ä»¥ç›´æ¥å°†æ•´ä¸ªé¡¹ç›® Indexing æ‰ï¼Œè¿˜èƒ½ç†è§£ä»£ç é—´çš„è°ƒç”¨å…³ç³»ï¼Œä¸€ä¸ª prompt ç›´æ¥å‡ºè°ƒç”¨å…³ç³»å›¾ï¼Œå†ä¹Ÿä¸ç”¨æŒ çˆ†å¤´æƒ³æ€ä¹ˆåš RAG æ€ä¹ˆç»™æ–‡ç« åˆ†å—äº†ï¼Œçˆ½åˆ°ã€‚\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/blog-next/content/articles/2024-11-16-try-cursor-and-thinking/Pasted%20image%2020241116200220.png\",\n      alt: \"Pasted image 20241116200220.png\",\n      title: \"Pasted image 20241116200220.png\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/blog-next/content/articles/2024-11-16-try-cursor-and-thinking/Pasted%20image%2020241116200148.png\",\n      alt: \"Pasted image 20241116200148.png\",\n      title: \"Pasted image 20241116200148.png\"\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"cursor-å¯èƒ½ä¼šæ¯”è¾ƒæœ‰ç”¨çš„åœºæ™¯\",\n      children: _jsx(_components.a, {\n        href: \"#cursor-å¯èƒ½ä¼šæ¯”è¾ƒæœ‰ç”¨çš„åœºæ™¯\",\n        children: \"Cursor å¯èƒ½ä¼šæ¯”è¾ƒæœ‰ç”¨çš„åœºæ™¯\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"æ™ºèƒ½æ³¨é‡Šç”Ÿæˆ\",\n      children: _jsx(_components.a, {\n        href: \"#æ™ºèƒ½æ³¨é‡Šç”Ÿæˆ\",\n        children: \"æ™ºèƒ½æ³¨é‡Šç”Ÿæˆ\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Cursor åœ¨ç”Ÿæˆä»£ç æ³¨é‡Šæ–¹é¢è¡¨ç°å‡ºè‰²ã€‚å®ƒä¸ä»…èƒ½åˆ†æå½“å‰æ–‡ä»¶çš„ä»£ç ï¼Œè¿˜èƒ½ç†è§£æ•´ä¸ªé¡¹ç›®çš„ä¸Šä¸‹æ–‡ã€‚é€šè¿‡åˆ†æ import å…³ç³»ã€å‡½æ•°è°ƒç”¨é“¾ã€æ¥å£å®ç°å’Œç±»å‹å®šä¹‰ç­‰å¤šä¸ªç»´åº¦ï¼Œå®ƒèƒ½ç”Ÿæˆæ›´åŠ å‡†ç¡®å’Œæœ‰æ„ä¹‰çš„æ³¨é‡Šã€‚è¿™å¯¹äºç»´æŠ¤å¤§å‹é¡¹ç›®æˆ–è€…éœ€è¦å¿«é€Ÿç†è§£ä»–äººä»£ç çš„åœºæ™¯ç‰¹åˆ«æœ‰å¸®åŠ©ã€‚\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"ç»ˆäºä¸ç”¨ä¸ºå†™æ³¨é‡ŠæŠ“è€³æŒ è…®äº†ï¼ğŸ‰ AI å¸®ä½ åˆ†æå®Œæ‰€æœ‰ä»£ç å…³ç³»ï¼Œä¸‰ä¸‹äº”é™¤äºŒå°±èƒ½ç”Ÿæˆä¸€ä»½æ¼‚äº®çš„æ³¨é‡Šï¼ğŸ’¡\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"æ–‡æ¡£å’Œæ–‡ç« åˆ›ä½œ\",\n      children: _jsx(_components.a, {\n        href: \"#æ–‡æ¡£å’Œæ–‡ç« åˆ›ä½œ\",\n        children: \"æ–‡æ¡£å’Œæ–‡ç« åˆ›ä½œ\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"åœ¨æ–‡æ¡£å’Œæ–‡ç« åˆ›ä½œæ–¹é¢ï¼ŒCursor çš„åŸåœ° AI æ”¹å†™åŠŸèƒ½ç‰¹åˆ«å®ç”¨ã€‚å½“ä½ éœ€è¦å†™ä¸€ç¯‡é•¿æ–‡ï¼Œéœ€è¦å‚è€ƒå¤šä¸ªæ–‡æ¡£æºï¼Œä½†åˆä¸éœ€è¦ç‰¹åˆ«ä¸¥æ ¼çš„é€»è¾‘æ¨å¯¼æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½ç®€ç›´æ˜¯ç¥å™¨ã€‚ä½ å¯ä»¥ï¼š\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"è®© AI å¸®ä½ è§„åˆ’æ–‡ç« ç»“æ„ï¼Œç”Ÿæˆåˆé€‚çš„ç›®å½•\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"æ ¹æ®å·²æœ‰å†…å®¹å¿«é€Ÿæ‰©å……æ®µè½\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"å®æ—¶è°ƒæ•´æ–‡ç« è¯­æ°”å’Œé£æ ¼\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"å‚è€ƒç›¸å…³æ–‡æ¡£è‡ªåŠ¨è¡¥å……å†…å®¹\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"å†™æ–‡æ¡£å†ä¹Ÿä¸ç”¨å¯¹ç€ç©ºç™½å‘å‘†äº†ï¼âœï¸ AI å°åŠ©æ‰‹éšæ—¶å¾…å‘½ï¼Œå¸®ä½ æŠŠæƒ³æ³•å˜æˆä¼˜ç¾çš„æ–‡å­—ï¼ğŸ“\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"é¡¹ç›®ç»“æ„ä¼˜åŒ–\",\n      children: _jsx(_components.a, {\n        href: \"#é¡¹ç›®ç»“æ„ä¼˜åŒ–\",\n        children: \"é¡¹ç›®ç»“æ„ä¼˜åŒ–\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"åœ¨é¡¹ç›®ç»“æ„ç»´æŠ¤æ–¹é¢ï¼ŒCursor æä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„åŠŸèƒ½ï¼š\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"å¯è§†åŒ–é¡¹ç›®ç»“æ„\"\n          }), \"ï¼šä¸€é”®ç”Ÿæˆé¡¹ç›®ä¾èµ–å…³ç³»å›¾ï¼Œè®©é¡¹ç›®ç»“æ„ä¸€ç›®äº†ç„¶ã€‚å†ä¹Ÿä¸ç”¨åœ¨å¤æ‚çš„ç›®å½•ç»“æ„ä¸­è¿·å¤±æ–¹å‘ã€‚\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"æ™ºèƒ½é‡æ„å»ºè®®\"\n          }), \"ï¼šåŸºäºé¡¹ç›®åˆ†æï¼ŒAI å¯ä»¥æä¾›é¡¹ç›®ç»“æ„ä¼˜åŒ–å»ºè®®ï¼Œå¸®åŠ©ä½ å»ºç«‹æ›´æ¸…æ™°çš„ä»£ç ç»„ç»‡æ–¹å¼ã€‚\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"è‡ªåŠ¨åŒ–å·¥å…·ç”Ÿæˆ\"\n          }), \"ï¼šéœ€è¦æ‰¹é‡å¤„ç†æ–‡ä»¶ï¼ŸCursor å¯ä»¥ç›´æ¥ç”Ÿæˆ Shell å‘½ä»¤æˆ– Python è„šæœ¬ï¼Œå¸®ä½ å®Œæˆç¹ççš„ç›®å½•æ“ä½œã€‚\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"é¡¹ç›®ç®¡ç†å˜å¾—å¦‚æ­¤è½»æ¾ï¼ğŸš€ è®© AI å¸®ä½ æ¢³ç†é¡¹ç›®ç»“æ„ï¼Œç”Ÿæˆå·¥å…·è„šæœ¬ï¼Œç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›ç®€ç›´èµ·é£ï¼âœ¨\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"æ€»ç»“\",\n      children: _jsx(_components.a, {\n        href: \"#æ€»ç»“\",\n        children: \"æ€»ç»“\"\n      })\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"æ€»çš„æ¥è¯´ï¼ŒCursor ä½œä¸ºä¸€æ¬¾åŸºäº AI çš„ä»£ç ç¼–è¾‘å™¨æœ‰å…¶ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œå°¤å…¶æ˜¯ Chat Anywhere å’Œæ™ºèƒ½ä»£ç åˆ†æè¿™æ ·çš„åˆ›æ–°åŠŸèƒ½ç¡®å®æå‡äº†å¼€å‘æ•ˆç‡ã€‚ä½†åŒæ—¶ä¹Ÿå­˜åœ¨ä¸€äº›æŠ€æœ¯é—®é¢˜ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿç›‘æ§å’Œè‡ªåŠ¨è¡¥å…¨ä½“éªŒç­‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒå±•ç¤ºäº† AI è¾…åŠ©ç¼–ç¨‹çš„æ½œåŠ›ï¼Œä¸ºæœªæ¥ç¼–ç¨‹å·¥å…·çš„å‘å±•æä¾›äº†æ–°çš„æ€è·¯ã€‚\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"é¡ºä¾¿ä¸€æï¼Œåœ¨å¼•ç”¨å—é‡Œçš„å†…å®¹éƒ½æ˜¯ç”± AI ç”Ÿæˆçš„ã€‚\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"meta":{"content":"\nè¯•ç€ç”¨äº†ä¸€ä¸‹ cursor ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ã€‚éæŠ€æœ¯ä¹Ÿèƒ½åŠå°æ—¶èƒ½åšä¸€æ¬¾ App å¯èƒ½æ˜¯çœŸçš„ã€‚ä½†æ›¿ä»£ä¸äº†æŠ€æœ¯å²—ä¹Ÿæ˜¯çœŸçš„ã€‚\n\n## å…ˆè¯´é—®é¢˜\n\nè™½ç„¶ Cursor åŸºäº VSCode äºŒæ¬¡å¼€å‘ï¼Œä½†å¯èƒ½ä¸ºäº†åš AI åŠŸèƒ½æŠŠ Editor Pooling æˆ–è€… File Watching èƒ½åŠ›æåäº†ï¼Œç»å¸¸ Apply äº†ä¿®æ”¹å Explorer å’Œ Editor é‡Œæ²¡æœ‰åŠæ—¶åé¦ˆã€‚ç„¶åè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½å› ä¸ºå¯ä»¥åˆ å†…å®¹å¯¼è‡´æ‰‹æ„Ÿè·Ÿ VSCode é‡Œçš„ Copilot æ¯”è¾ƒä¸åŒï¼Œç”¨èµ·æ¥æ¯”è¾ƒ annoying ã€‚\n\n### æ–‡ä»¶ç³»ç»Ÿç›‘æ§é—®é¢˜\n\nä½œä¸ºä¸€ä¸ªåŸºäº VSCode äºŒæ¬¡å¼€å‘çš„ç¼–è¾‘å™¨ï¼ŒCursor åœ¨æ–‡ä»¶ç³»ç»Ÿç›‘æ§æ–¹é¢å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å½“å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹åï¼ŒExplorer å’Œ Editor ç»å¸¸æ— æ³•åŠæ—¶åæ˜ è¿™äº›å˜åŒ–ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºä¸ºäº†å®ç° AI åŠŸèƒ½è€Œå¯¹åŸæœ‰çš„ Editor Pooling æˆ– File Watching æœºåˆ¶è¿›è¡Œäº†ä¿®æ”¹å¯¼è‡´çš„ã€‚\n\n> è¿™ç®€ç›´å¤ªè®©äººæŠ“ç‹‚äº†ï¼ğŸ˜« ä½ æ”¹äº†ä»£ç ï¼Œç¼–è¾‘å™¨å´åœ¨é‚£è£…å‚»å……æ„£ã€‚å°±å¥½åƒä½ å‘äº†æ¶ˆæ¯ï¼Œå¯¹æ–¹å·²è¯»ä¸å› ğŸ’¬ã€‚ç¨‹åºå‘˜æœ€è®¨åŒç­‰å¾…äº†ï¼Œå¯¹å§ï¼Ÿâ³\n\n### è‡ªåŠ¨è¡¥å…¨ä½“éªŒå·®å¼‚\n\nCursor çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ä¸ VSCode ä¸­çš„ GitHub Copilot æœ‰æ˜æ˜¾çš„ä½¿ç”¨ä½“éªŒå·®å¼‚ã€‚ç”±äº Cursor çš„è¡¥å…¨å¯ä»¥åˆ é™¤å·²æœ‰å†…å®¹ï¼Œè¿™ç§è¡Œä¸ºæ–¹å¼ä¸ç¨‹åºå‘˜ä¹ æƒ¯çš„ç¼–è¾‘æ¨¡å¼ä¸å¤ªç›¸ç¬¦ï¼Œä½¿ç”¨èµ·æ¥æ„Ÿè§‰æ¯”è¾ƒçªå…€å’Œçƒ¦äººã€‚\n\n> è¿™ä¸ªåŠŸèƒ½çœŸçš„è®©äººåˆçˆ±åˆæ¨ ğŸ’”ï¼AI å°åŠ©æ‰‹å¤ªçƒ­æƒ…äº†ï¼ŒåŠ¨ä¸åŠ¨å°±æƒ³å¸®ä½ é‡å†™ä»£ç ã€‚å†·é™ç‚¹ï¼Œè€é“ï¼æˆ‘åªæ˜¯æƒ³è¦ä¸€ç‚¹æç¤ºè€Œå·²ï¼ğŸ¤ª\n\n### æ€§èƒ½å½±å“\n\nè¿™äº›æŠ€æœ¯é—®é¢˜ä¸ä»…å½±å“äº†å¼€å‘ä½“éªŒï¼Œè¿˜å¯èƒ½ä¼šé™ä½ç¼–ç æ•ˆç‡ã€‚å®æ—¶çš„æ–‡ä»¶ç³»ç»Ÿåé¦ˆå¯¹äºå¼€å‘å·¥ä½œæµç¨‹æ¥è¯´æ˜¯éå¸¸é‡è¦çš„ï¼Œè€Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½çš„å·®å¼‚ä¹Ÿä¼šå½±å“åˆ°æ—¥å¸¸ç¼–ç çš„æµç•…åº¦ã€‚\n\n> æ€§èƒ½é—®é¢˜çœŸæ˜¯è®©äººå¤´å¤§ ğŸ¤¯ï¼å†™ä»£ç å°±åº”è¯¥æ˜¯è¡Œäº‘æµæ°´çš„æ„Ÿè§‰ï¼Œç°åœ¨å´ç»å¸¸è¦ç­‰ç­‰ç­‰...ç­‰åˆ°æˆ‘éƒ½èƒ½å–å®Œä¸€æ¯å’–å•¡äº† â˜•ï¸ï¼\n\n\n## Chat Anywhere\n\nä¸è¿‡ Chat Anywhere è¿™ä¸ªåšæ³•åº”è¯¥æ˜¯åšå¯¹äº†ã€‚éœ€è¦ç”¨ AI ä»£å†™çš„åœºæ™¯ï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸æ˜¯ä¸ä¼šå†™è€Œæ˜¯æ‡’å¾—å†™ï¼Œä»¥å‰åœ¨ VSCode é‡Œéœ€è¦åˆ‡åˆ° Coplilot çš„ Tab ï¼Œå†™ prompt ç­‰å›å¤ï¼Œç„¶åå†å°†ç­”æ¡ˆå¤åˆ¶ç²˜è´´å›å»ï¼Œå¤šæ•°æƒ…å†µä¸‹æœ‰è¿™é—²å·¥å¤«è¿˜ä¸å¦‚ç›´æ¥è‡ªå·±å†™ğŸ¤£ï¼Œåœ¨ Cursor é‡Œå¯ä»¥ç›´æ¥åŸåœ°è°ƒ AI æ”¹å†™ï¼ŒçœŸçš„å·¨èˆ’æœã€‚\n\n> è¿™åŠŸèƒ½ç®€ç›´å°±æ˜¯æ‡’äººç¦éŸ³å•Šï¼ğŸ¯ å†ä¹Ÿä¸ç”¨åœ¨å„ç§çª—å£ä¹‹é—´è·³æ¥è·³å»äº†ï¼çˆ½æ­ªæ­ªï¼ğŸŠ\n\n## æ™ºèƒ½ä»£ç åˆ†æ\n\nè¿˜æœ‰ Cursor å¯ä»¥ç›´æ¥å°†æ•´ä¸ªé¡¹ç›® Indexing æ‰ï¼Œè¿˜èƒ½ç†è§£ä»£ç é—´çš„è°ƒç”¨å…³ç³»ï¼Œä¸€ä¸ª prompt ç›´æ¥å‡ºè°ƒç”¨å…³ç³»å›¾ï¼Œå†ä¹Ÿä¸ç”¨æŒ çˆ†å¤´æƒ³æ€ä¹ˆåš RAG æ€ä¹ˆç»™æ–‡ç« åˆ†å—äº†ï¼Œçˆ½åˆ°ã€‚\n\n![[Pasted image 20241116200220.png]]\n\n![[Pasted image 20241116200148.png]]\n\n## Cursor å¯èƒ½ä¼šæ¯”è¾ƒæœ‰ç”¨çš„åœºæ™¯\n\n### æ™ºèƒ½æ³¨é‡Šç”Ÿæˆ\n\nCursor åœ¨ç”Ÿæˆä»£ç æ³¨é‡Šæ–¹é¢è¡¨ç°å‡ºè‰²ã€‚å®ƒä¸ä»…èƒ½åˆ†æå½“å‰æ–‡ä»¶çš„ä»£ç ï¼Œè¿˜èƒ½ç†è§£æ•´ä¸ªé¡¹ç›®çš„ä¸Šä¸‹æ–‡ã€‚é€šè¿‡åˆ†æ import å…³ç³»ã€å‡½æ•°è°ƒç”¨é“¾ã€æ¥å£å®ç°å’Œç±»å‹å®šä¹‰ç­‰å¤šä¸ªç»´åº¦ï¼Œå®ƒèƒ½ç”Ÿæˆæ›´åŠ å‡†ç¡®å’Œæœ‰æ„ä¹‰çš„æ³¨é‡Šã€‚è¿™å¯¹äºç»´æŠ¤å¤§å‹é¡¹ç›®æˆ–è€…éœ€è¦å¿«é€Ÿç†è§£ä»–äººä»£ç çš„åœºæ™¯ç‰¹åˆ«æœ‰å¸®åŠ©ã€‚\n\n> ç»ˆäºä¸ç”¨ä¸ºå†™æ³¨é‡ŠæŠ“è€³æŒ è…®äº†ï¼ğŸ‰ AI å¸®ä½ åˆ†æå®Œæ‰€æœ‰ä»£ç å…³ç³»ï¼Œä¸‰ä¸‹äº”é™¤äºŒå°±èƒ½ç”Ÿæˆä¸€ä»½æ¼‚äº®çš„æ³¨é‡Šï¼ğŸ’¡\n\n### æ–‡æ¡£å’Œæ–‡ç« åˆ›ä½œ\n\nåœ¨æ–‡æ¡£å’Œæ–‡ç« åˆ›ä½œæ–¹é¢ï¼ŒCursor çš„åŸåœ° AI æ”¹å†™åŠŸèƒ½ç‰¹åˆ«å®ç”¨ã€‚å½“ä½ éœ€è¦å†™ä¸€ç¯‡é•¿æ–‡ï¼Œéœ€è¦å‚è€ƒå¤šä¸ªæ–‡æ¡£æºï¼Œä½†åˆä¸éœ€è¦ç‰¹åˆ«ä¸¥æ ¼çš„é€»è¾‘æ¨å¯¼æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½ç®€ç›´æ˜¯ç¥å™¨ã€‚ä½ å¯ä»¥ï¼š\n\n- è®© AI å¸®ä½ è§„åˆ’æ–‡ç« ç»“æ„ï¼Œç”Ÿæˆåˆé€‚çš„ç›®å½•\n- æ ¹æ®å·²æœ‰å†…å®¹å¿«é€Ÿæ‰©å……æ®µè½\n- å®æ—¶è°ƒæ•´æ–‡ç« è¯­æ°”å’Œé£æ ¼\n- å‚è€ƒç›¸å…³æ–‡æ¡£è‡ªåŠ¨è¡¥å……å†…å®¹\n\n> å†™æ–‡æ¡£å†ä¹Ÿä¸ç”¨å¯¹ç€ç©ºç™½å‘å‘†äº†ï¼âœï¸ AI å°åŠ©æ‰‹éšæ—¶å¾…å‘½ï¼Œå¸®ä½ æŠŠæƒ³æ³•å˜æˆä¼˜ç¾çš„æ–‡å­—ï¼ğŸ“\n\n### é¡¹ç›®ç»“æ„ä¼˜åŒ–\n\nåœ¨é¡¹ç›®ç»“æ„ç»´æŠ¤æ–¹é¢ï¼ŒCursor æä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„åŠŸèƒ½ï¼š\n\n1. **å¯è§†åŒ–é¡¹ç›®ç»“æ„**ï¼šä¸€é”®ç”Ÿæˆé¡¹ç›®ä¾èµ–å…³ç³»å›¾ï¼Œè®©é¡¹ç›®ç»“æ„ä¸€ç›®äº†ç„¶ã€‚å†ä¹Ÿä¸ç”¨åœ¨å¤æ‚çš„ç›®å½•ç»“æ„ä¸­è¿·å¤±æ–¹å‘ã€‚\n\n2. **æ™ºèƒ½é‡æ„å»ºè®®**ï¼šåŸºäºé¡¹ç›®åˆ†æï¼ŒAI å¯ä»¥æä¾›é¡¹ç›®ç»“æ„ä¼˜åŒ–å»ºè®®ï¼Œå¸®åŠ©ä½ å»ºç«‹æ›´æ¸…æ™°çš„ä»£ç ç»„ç»‡æ–¹å¼ã€‚\n\n3. **è‡ªåŠ¨åŒ–å·¥å…·ç”Ÿæˆ**ï¼šéœ€è¦æ‰¹é‡å¤„ç†æ–‡ä»¶ï¼ŸCursor å¯ä»¥ç›´æ¥ç”Ÿæˆ Shell å‘½ä»¤æˆ– Python è„šæœ¬ï¼Œå¸®ä½ å®Œæˆç¹ççš„ç›®å½•æ“ä½œã€‚\n\n> é¡¹ç›®ç®¡ç†å˜å¾—å¦‚æ­¤è½»æ¾ï¼ğŸš€ è®© AI å¸®ä½ æ¢³ç†é¡¹ç›®ç»“æ„ï¼Œç”Ÿæˆå·¥å…·è„šæœ¬ï¼Œç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›ç®€ç›´èµ·é£ï¼âœ¨\n\n\n## æ€»ç»“\n\n> æ€»çš„æ¥è¯´ï¼ŒCursor ä½œä¸ºä¸€æ¬¾åŸºäº AI çš„ä»£ç ç¼–è¾‘å™¨æœ‰å…¶ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œå°¤å…¶æ˜¯ Chat Anywhere å’Œæ™ºèƒ½ä»£ç åˆ†æè¿™æ ·çš„åˆ›æ–°åŠŸèƒ½ç¡®å®æå‡äº†å¼€å‘æ•ˆç‡ã€‚ä½†åŒæ—¶ä¹Ÿå­˜åœ¨ä¸€äº›æŠ€æœ¯é—®é¢˜ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿç›‘æ§å’Œè‡ªåŠ¨è¡¥å…¨ä½“éªŒç­‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒå±•ç¤ºäº† AI è¾…åŠ©ç¼–ç¨‹çš„æ½œåŠ›ï¼Œä¸ºæœªæ¥ç¼–ç¨‹å·¥å…·çš„å‘å±•æä¾›äº†æ–°çš„æ€è·¯ã€‚\n\né¡ºä¾¿ä¸€æï¼Œåœ¨å¼•ç”¨å—é‡Œçš„å†…å®¹éƒ½æ˜¯ç”± AI ç”Ÿæˆçš„ã€‚\n","title":"å°è¯• Cursor çš„æ„Ÿæƒ³å’Œä¸€äº›æ€è€ƒ","abstract":"è¯•ç€ç”¨äº†ä¸€ä¸‹ cursor ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ã€‚éæŠ€æœ¯ä¹Ÿèƒ½åŠå°æ—¶èƒ½åšä¸€æ¬¾ App å¯èƒ½æ˜¯çœŸçš„ã€‚ä½†æ›¿ä»£ä¸äº†æŠ€æœ¯å²—ä¹Ÿæ˜¯çœŸçš„ã€‚\nè™½ç„¶ Cursor åŸºäº VSCode äºŒæ¬¡å¼€å‘ï¼Œä½†å¯èƒ½ä¸ºäº†åš AI åŠŸèƒ½æŠŠ Editor Pooling æˆ–è€… File Watching èƒ½åŠ›æåäº†ï¼Œç»å¸¸ Apply äº†ä¿®æ”¹å Explorer å’Œ Editor é‡Œæ²¡æœ‰åŠæ—¶åé¦ˆã€‚ç„¶åè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½å› ä¸ºå¯ä»¥åˆ å†…å®¹å¯¼è‡´æ‰‹æ„Ÿè·Ÿ VSCode é‡Œçš„ Copilot æ¯”è¾ƒä¸åŒï¼Œç”¨èµ·æ¥æ¯”è¾ƒ annoying ã€‚\nä½œä¸ºä¸€ä¸ªåŸºäº VSCode äºŒæ¬¡å¼€å‘çš„ç¼–è¾‘å™¨ï¼ŒCursor åœ¨æ–‡ä»¶ç³»ç»Ÿç›‘æ§æ–¹é¢å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å½“å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹åï¼ŒExplorer å’Œ Editor ç»å¸¸æ— æ³•åŠæ—¶åæ˜ è¿™äº›å˜åŒ–ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºä¸ºäº†å®ç° AI åŠŸèƒ½è€Œå¯¹åŸæœ‰çš„ Editor Pooling æˆ– File Watching æœºåˆ¶è¿›è¡Œäº†ä¿®æ”¹å¯¼è‡´çš„ã€‚","length":78,"created_at":"2024-11-16T15:42:00.000Z","updated_at":"2024-11-16T15:42:00.000Z","tags":["Cursor","æ‚è°ˆ"],"license":true},"prevNextInfo":{"prevInfo":null,"nextInfo":{"pathMapping":{"filePath":"public/content/articles/2022-08-20-introduction-for-k8s-2.md","pagePath":"/articles/introduction-for-k8s-2","slug":"introduction-for-k8s-2"},"meta":{"content":"\næˆ‘ä»¬ä¹‹å‰è¯´çš„éƒ½æ˜¯ç”¨äºéƒ¨ç½² Pod çš„èµ„æºï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä»‹ç»ä¸åˆ›å»º Pod ä¸ç›¸å…³çš„èµ„æºï¼šå‚¨å­˜ä¸ç½‘ç»œã€‚\n\n# å‚¨å­˜\n\nå…¶å®æˆ‘ä»¬ä¹‹å‰å·²ç»æ¥è§¦è¿‡å‚¨å­˜ç›¸å…³çš„å†…å®¹äº†ï¼šåœ¨è®² Stateful Set æ—¶æˆ‘ä»¬æè¿‡ Stateful Set åˆ›å»ºå‡ºæ¥çš„ Pod éƒ½ä¼šæœ‰ç›¸äº’ç‹¬ç«‹çš„å‚¨å­˜ï¼›è€Œè®² Daemon Set æ—¶æˆ‘ä»¬æåˆ° K8s æ¨èåªåœ¨ Daemon Set çš„ Pod ä¸­è®¿é—®å®¿ä¸»æœºç£ç›˜ã€‚ä½†ç‹¬ç«‹çš„å‚¨å­˜å…·ä½“æŒ‡ä»€ä¹ˆï¼Ÿé™¤äº†è®¿é—®å®¿ä¸»æœºç£ç›˜ä»¥å¤–è¿˜æœ‰ä»€ä¹ˆå…¶ä»–çš„å‚¨å­˜ï¼Ÿ\n\nåœ¨ Docker ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®¿ä¸»æœºç£ç›˜ä¸Šçš„ä¸€ä¸ªè·¯å¾„ä½œä¸ºä¸€ä¸ª Volume æ¥ç»™å®¹å™¨ç»‘å®šï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ Docker Engine ç®¡ç†çš„ Volume æ¥æä¾›æŒä¹…åŒ–å­˜å‚¨æˆ–æ˜¯å®¹å™¨é—´å…±äº«æ–‡ä»¶ã€‚åœ¨ K8s é‡Œé¢ä¹Ÿæ²¿ç”¨äº† Volume è¿™ä¸ªæ¦‚å¿µï¼Œå¯ä»¥é€šè¿‡ Mount ç»‘å®šåˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œå¹¶é€šè¿‡å®ç° CSI çš„å„ç§å¼•æ“æ¥æä¾›æ›´å¤šæ ·çš„å­˜å‚¨ã€‚\n\n> CSI: Container Storage Interface ï¼Œå®¹å™¨å‚¨å­˜æ¥å£æ ‡å‡†ï¼Œæ˜¯ K8s æå‡ºçš„ä¸€ç§è§„èŒƒã€‚ä¸ç®¡æ˜¯å“ªç§å‚¨å­˜å¼•æ“ï¼Œåªè¦ç¼–å†™ä¸€ä¸ªå¯¹åº”çš„æ’ä»¶å®ç° CSI ï¼Œéƒ½å¯ä»¥åœ¨ K8s ä¸­ä½¿ç”¨ã€‚\n\n### K8s ä¸­ä½¿ç”¨ Volume ä¸å¯ç”¨çš„ Volume ç±»å‹\n\nå…¶å® K8s ä¸­ä½¿ç”¨ Volume çš„ä¾‹å­æˆ‘ä»¬ä¸€å¼€å§‹å°±å·²ç»æ¥è§¦è¿‡äº†ã€‚è¿˜è®°å¾—ä¸€å¼€å§‹ä»‹ç» Pod æ—¶çš„ Nginx ä¾‹å­å—ï¼Ÿ\n\n```yaml\nmetadata:\n  name: simple-webapp\nspec:\n  containers:\n    - name: main-application\n      image: nginx\n      volumeMounts:\n        - name: shared-logs\n          mountPath: /var/log/nginx\n    - name: sidecar-container\n      image: busybox\n      command: [\"sh\",\"-c\",\"while true; do cat /var/log/nginx/access.log; sleep 30; done\"]\n      volumeMounts:\n        - name: shared-logs\n          mountPath: /var/log/nginx\n  volumes:\n    - name: shared-logs\n      emptyDir: {}\n```\n\nè¿™ä¸ª Pod æè¿°ä¸­å£°æ˜äº†ä¸€ä¸ªç§ç±»ä¸º `emptyDir` çš„ï¼Œåä¸º `shared-logs` çš„ Volume ï¼Œç„¶å Pod ä¸­çš„ä¸¤ä¸ªå®¹å™¨éƒ½åˆ†åˆ« Mount äº†è¿™ä¸ª Volume ã€‚\n\nK8s ä¸­é»˜è®¤æä¾›äº†å‡ ç§ Volume ï¼Œæ¯”å¦‚ï¼š\n\n- emptyDir ï¼šä¸€ä¸ªç®€å•çš„ç©ºç›®å½•ï¼Œä¸€èˆ¬ç”¨äºå‚¨å­˜ä¸´æ—¶æ•°æ®æˆ–æ˜¯ Pod çš„å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®ã€‚\n- hostPath ï¼šç»‘å®šåˆ°èŠ‚ç‚¹å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„è·¯å¾„ï¼Œä¸€èˆ¬åœ¨ Daemon Set ä¸­ä½¿ç”¨ã€‚\n- gitRepo ï¼šè¿™ç§ Volume å…¶å®ç›¸å½“äº emptyDir ï¼Œä¸è¿‡åœ¨ Pod å¯åŠ¨æ—¶ä¼šä» Git ä»“åº“ clone ä¸€ä»½å†…å®¹ä½œä¸ºé»˜è®¤æ•°æ®ã€‚\n- configMap ã€ secret ï¼šä¸€èˆ¬ç”¨äºé…ç½®æ–‡ä»¶åŠ è½½ï¼Œéœ€è¦ä¸ configMap ã€ secret è¿™ä¸¤ç§èµ„æºä¸€åŒä½¿ç”¨ã€‚ä¼šå°† configMap ã€ secret ä¸­å¯¹åº”çš„å†…å®¹æ‹·è´ä¸€ä»½ä½œä¸º Volume ç»‘åˆ°å®¹å™¨ã€‚ï¼ˆä¸‹ä¸€èŠ‚ä¸­ä¼šå±•å¼€è®¨è®ºï¼‰\n- nfs ã€ glusterfs ã€ â€¦â€¦ï¼šå¯ä»¥é€šè¿‡å„ç§ç½‘ç»œå­˜å‚¨åè®®ç›´æ¥æŒ‚è½½ä¸€ä¸ªç½‘ç»œå­˜å‚¨\n- (deprecated!) gcePersistentDisk ã€ awsElasticBlockStore â€¦â€¦ï¼šå¯ä»¥è°ƒç”¨å„ä¸ªäº‘å¹³å°çš„ API ï¼Œåˆ›å»ºä¸€ä¸ªå—å‚¨å­˜ç¡¬ä»¶æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Šï¼Œå†å°†é‚£ä¸ªç¡¬ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚\n- persistentVolumeClaim ï¼šæŒä¹…å·å£°æ˜ï¼Œç”¨äºæŠŠå®é™…å‚¨å­˜æ–¹å¼æŠ½è±¡åŒ–ï¼Œä½¿å¾— Pod ä¸éœ€è¦å…³å¿ƒå…·ä½“çš„å‚¨å­˜ç±»å‹ã€‚è¿™ç§ç±»å‹ä¼šåœ¨ä¸‹é¢è¯¦ç»†ä»‹ç»ã€‚\n\næˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œ Volume çš„å£°æ˜æ˜¯ Pod çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯ä¸€ç§å•ç‹¬çš„èµ„æºã€‚ Volume æ˜¯ Pod çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ä¸åŒçš„ Pod ä¹‹é—´æ°¸è¿œä¸å¯èƒ½å…±äº«åŒä¸€ä¸ª Volume ã€‚\n\n> ä½†æ˜¯ Volume æ‰€æŒ‡å‘çš„ä½ç½®å¯ä»¥ç›¸åŒï¼Œæ¯”å¦‚ HostPath ç±»å‹çš„ Volume å°±å¯ä»¥ä¸¤ä¸ª Pod å¯ä»¥ç»‘å®šåˆ°å®¿ä¸»æœºä¸ŠåŒä¸€ä¸ªè·¯å¾„ï¼Œå› æ­¤ Volume é‡Œçš„æ•°æ®è¿˜æ˜¯èƒ½é€šè¿‡ä¸€å®šæ–¹å¼åœ¨ Pod é—´å…±äº«ã€‚ä½†å½“ç„¶ K8s ä¸æ¨èè¿™ä¹ˆåšã€‚\n\nå¦å¤–ï¼Œç”±äº Volume æ˜¯ Pod çš„ä¸€éƒ¨åˆ†ï¼Œ Volume çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯è·Ÿéš Pod çš„ï¼Œå½“ä¸€ä¸ª Pod è¢«é”€æ¯æ—¶ï¼Œ Volume ä¹Ÿä¼šè¢«é”€æ¯ï¼Œå› æ­¤æœ€ä¸»è¦è¿˜æ˜¯ç”¨äº Pod å†…å®¹å™¨é—´çš„æ–‡ä»¶å…±äº«ã€‚å¦‚æœéœ€è¦æŒä¹…åŒ–å‚¨å­˜ï¼Œéœ€è¦ä½¿ç”¨ Persistent Volume ã€‚\n\n> Volume ä¼šè¢«é”€æ¯ä¸ä»£è¡¨ Volume æŒ‡å‘çš„å†…å®¹ä¼šè¢«é”€æ¯ã€‚æ¯”å¦‚ hostPath ã€ NFS ç­‰ç±»å‹ Volume ä¸­çš„å†…å®¹å°±ä¼šç»§ç»­ä¿ç•™åœ¨å®¿ä¸»æœºæˆ–æ˜¯ NAS ä¸Šã€‚ä¸‹é¢æåˆ°çš„ Presistent Volume Claim ä¹Ÿæ˜¯ï¼Œæ‹¥æœ‰ `persistentVolumeClaim` ç±»å‹ Volume çš„ Pod è¢«åˆ é™¤åå¯¹åº”çš„ PVC ä¸ä¸€å®šä¼šè¢«åˆ é™¤ã€‚\n\n### Presistent Volume ã€ Presistent Volume Claim ã€ Storage Class\n\nå¦‚æœéœ€è¦åœ¨ Pod å£°æ˜ä¸­ç›´æ¥æŒ‡å®š NFS ã€ awsElasticBlockStore ä¹‹ç±»çš„ä¿¡æ¯ï¼Œå°±éœ€è¦åº”ç”¨çš„å¼€å‘äººå‘˜å¯¹çœŸå®å¯ç”¨çš„å‚¨å­˜ç»“æ„æœ‰æ‰€ç†è§£ï¼Œè¿èƒŒäº† K8s çš„ç†å¿µã€‚å› æ­¤ K8s å°±å¼„å‡ºäº†å°æ ‡é¢˜ä¸­çš„ä¸‰ç§èµ„æºæ¥å°†å‚¨å­˜æŠ½è±¡åŒ–ã€‚\n\nä¸€ä¸ª Persistent Volume (PV) å¯¹åº”äº‘å¹³å°æä¾›çš„ä¸€ä¸ªå—å­˜å‚¨ï¼Œæˆ–æ˜¯ NAS ä¸Šçš„ä¸€ä¸ªè·¯å¾„ã€‚å¯ä»¥ç®€å•åœ°ç†è§£ä¸º **PV ç›´æ¥æè¿°äº†ä¸€å—å¯ç”¨çš„ç‰©ç†å­˜å‚¨** ã€‚å› ä¸º PV ç›´æ¥å¯¹åº”åˆ°ç¡¬ä»¶ï¼Œå› æ­¤ PV è·ŸèŠ‚ç‚¹ä¸€æ ·ï¼Œæ˜¯åç§°ç©ºé—´æ— å…³çš„ã€‚\n\nè€Œä¸€ä¸ª **Persistent Volume Claim (PVC) åˆ™æ˜¯æè¿°äº†æ€æ ·å»ä½¿ç”¨å‚¨å­˜** ï¼šä½¿ç”¨å¤šå°‘ç©ºé—´ã€åªè¯»è¿˜æ˜¯è¯»å†™ç­‰ã€‚ä¸€ä¸ª PVC è¢«åˆ›å»ºåä¼šä¸”åªä¼šå¯¹åº”åˆ°ä¸€ä¸ª PV ã€‚ PVC ä»å±äºä¸€ä¸ªåç§°ç©ºé—´ï¼Œå¹¶èƒ½è¢«è¯¥åç§°ç©ºé—´ä¸‹çš„ Pod æŒ‡å®šä¸ºä¸€ä¸ª Volume ã€‚\n\nPV ä¸ PVC è¿™ä¸¤ç§æŠ½è±¡æ˜¯å¾ˆå¿…è¦çš„ã€‚è¯•æƒ³ä¸€ä¸‹ç”¨è‡ªå·±çš„ç‰©ç†æœºæ­å»ºä¸€ä¸ª K8s é›†ç¾¤çš„åœºæ™¯ã€‚ä½ ä¼šæå‰ç»™ç‰©ç†æœºæ’ä¸Šè®¸å¤šä¸ªå‚¨å­˜ç¡¬ä»¶ï¼Œè¿™æ—¶ä½ å°±éœ€è¦ç”¨ PV æ¥æè¿°è¿™äº›ç¡¬ä»¶ï¼Œä¹‹åæ‰èƒ½åœ¨ K8s é‡Œåˆ©ç”¨è¿™äº›ç¡¬ä»¶çš„å‚¨å­˜ã€‚è€Œå®é™…å°†åº”ç”¨éƒ¨ç½²åˆ° K8s ä¸­æ—¶ï¼Œä½ æ‰éœ€è¦ç”¨ PVC æ¥æè¿° Pod ä¸­éœ€è¦æ€ä¹ˆæ ·çš„å‚¨å­˜å·ï¼Œç„¶å K8s å°±ä¼šè‡ªåŠ¨æŒ‘ä¸€ä¸ªåˆé€‚ PV ç»™è¿™ä¸ª PVC ç»‘å®šä¸Šã€‚è¿™æ ·å®é™…éƒ¨ç½²åº”ç”¨çš„æ—¶å€™å°±ä¸ç”¨å†ç‰¹æ„è·‘å»æœºæˆ¿ç»™ç‰©ç†æœºæ’ç¡¬ä»¶äº†ã€‚\n\nä½†æ˜¯ç°åœ¨éƒ½äº‘åŸç”Ÿæ—¶ä»£äº†ï¼Œå„ä¾›åº”å•†éƒ½æœ‰æä¾› API å¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªå—å‚¨å­˜ï¼Œè¿˜è¦æƒ³åŠæ³•æå‰å‡†å¤‡ PV å®åœ¨æ˜¯å¤ªè ¢äº†ã€‚äºæ˜¯ä¾¿éœ€è¦ Storage Class è¿™ç§èµ„æºã€‚\n\nä½¿ç”¨ Storage Class å‰éœ€è¦å…ˆå®‰è£…å„ç§äº‘ä¾›åº”å•†æä¾›çš„æ’ä»¶ï¼ˆå½“ç„¶ä½¿ç”¨äº‘æœåŠ¡æä¾›çš„ K8s çš„è¯ä¸€èˆ¬å·²ç»å‡†å¤‡å¥½äº†ï¼‰ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ª Storage Class ç±»å‹çš„èµ„æºï¼ˆå½“ç„¶ä¸€èˆ¬ä¹Ÿå·²ç»å‡†å¤‡å¥½äº†ï¼‰ã€‚ä¸‹é¢æ˜¯ AWS ä¸Šçš„ EKS æœåŠ¡ä¸­é»˜è®¤è‡ªå¸¦çš„ Storage Class ï¼š\n\n```yaml\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  annotations:\n    storageclass.kubernetes.io/is-default-class: \"true\"\n  name: gp2\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  fsType: ext4\n  type: gp2\n# å½“ PVC è¢«åˆ é™¤æ—¶ä¼šåŒæ—¶åˆ é™¤ PV\nreclaimPolicy: Delete\n# åªæœ‰å½“ PVC è¢«ç»‘å®šä¸ºä¸€ä¸ª Pod çš„ Volume æ—¶æ‰ä¼šåˆ›å»ºä¸€ä¸ª PV\nvolumeBindingMode: WaitForFirstConsumer\n```\n\nå¯ä»¥çœ‹åˆ° EKS è‡ªå¸¦çš„ gp2 æä¾›äº†ä¸€äº›é»˜è®¤çš„é€‰é¡¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç±»ä¼¼åœ°å»å®šä¹‰è‡ªå·±çš„ Storage Class ã€‚æœ‰äº† gp2 è¿™ä¸ª Storage Class ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª PVC å K8s å°±ä¼šè°ƒç”¨ AWS çš„ API ï¼Œåˆ›å»ºä¸€ä¸ªå—å‚¨å­˜æ¥åˆ°æˆ‘ä»¬çš„èŠ‚ç‚¹ä¸Šï¼Œç„¶å K8s å†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª PV å¹¶ç»‘å®šåˆ° PVC ä¸Šã€‚\n\nä¾‹å¦‚ï¼Œæˆ‘ä»¬éƒ¨ç½² Kafka æ—¶ä¼šåˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ PVC ï¼š\n\n```yaml\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: data-kafka-0\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: gp2\n```\n\nK8s å°±ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºå‡ºä¸€ä¸ªå¯¹åº”çš„ PV ï¼š\n\n```sh\n# `pvc-` å¼€å¤´è¿™ä¸ªæ˜¯ AWS è‡ªåŠ¨ç»™æˆ‘ä»¬èµ·çš„åå­—ã€‚å®ƒè™½ç„¶æ˜¯ `pvc-` å¼€å¤´ï¼Œä½†ä»–å…¶å®æ˜¯ä¸€ä¸ª PV ã€‚\nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                STORAGECLASS   REASON   AGE\npvc-3614c15f-5697-4d66-a13c-6ddf7eb89998   10Gi       RWO            Delete           Bound    kafka/data-kafka-0   gp2                     152d\n```\n\nè¦æ˜¯æ‰“å¼€ AWS Console è¿˜ä¼šå‘ç°ï¼Œ K8s è°ƒç”¨äº† AWS çš„ API ï¼Œè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª EBS å—å‚¨å­˜å¹¶ç»‘å®šåˆ°äº†æˆ‘ä»¬å¯¹åº”çš„å®¿ä¸»æœºä¸Šã€‚\n\nå¯ä»¥ç”¨ä¸‹é¢è¿™å¼ å›¾æ¥è¡¨ç¤º Pod ä¸­çš„ Volume ã€ PVC ã€ PV ä¹‹é—´çš„å…³ç³»ï¼š\n\n```mermaid\nflowchart TD\n\nsubgraph Pod[Pod: Kafka-0]\nsubgraph Container[Container: docker.io/bitnami/kafka:3.1.0]\nvm[VolumeMount: /bitnami/kafka]\nend\nvolume[(Volume: data)]\nvm --> volume\nend\n\npvc[pvc: data-kafka-0]\npv[pv: pvc-3614c15f-5697-4d66-a13c-6ddf7eb89998]\nebs[ebs: AWS ä¸ºæˆ‘ä»¬åˆ›å»ºçš„å—å‚¨å­˜ç¡¬ä»¶]\n\nvolume --> pvc\npvc --> pv\npv --> ebs\n```\n\nè€Œ Storage Class åœ¨ä¸Šå›¾ä¸­åˆ™è´Ÿè´£è¯»å–æˆ‘ä»¬æäº¤çš„ PVC ï¼Œç„¶ååˆ›å»º PV ä¸ EBS ã€‚\n\n### å†è¯´å› Stateful Set\n\nä¹‹å‰æˆ‘ä»¬æåˆ° Stateful Set æ—¶è¯´åˆ° Stateful Set åˆ›å»ºçš„ Pod æ‹¥æœ‰å›ºå®šçš„å‚¨å­˜ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè·Ÿ Deployment çš„å‚¨å­˜åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\n\næˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œå¦‚æœè¦ç»™ Deployment åˆ›å»ºå‡ºæ¥çš„ Pod æŒ‚è½½ PVC éœ€è¦æ€ä¹ˆåšã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªéƒ¨ç½² Nginx çš„ Deployment æ¸…å•ï¼Œå…¶ä¸­ html ç›®å½•ä¸‹çš„é™æ€æ–‡ä»¶å­˜æ”¾åœ¨ NFS é‡Œï¼Œé€šè¿‡ PVC æŒ‚è½½åˆ° Pod ä¸­ï¼š\n\n```yaml\n# è¿™é‡Œçœç•¥äº† Service ç›¸å…³çš„å†…å®¹\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-dpl-with-nfs-pvc\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:alpine\n        ports:\n        - containerPort: 80\n          name: web\n        volumeMounts: #æŒ‚è½½å®¹å™¨ä¸­çš„ç›®å½•åˆ° pvc nfs ä¸­çš„ç›®å½•\n        - name: www\n          mountPath: /usr/share/nginx/html\n      volumes:\n      - name: www\n        persistentVolumeClaim: #æŒ‡å®špvc\n          claimName: nfs-pvc-for-nginx\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nfs-pvc-for-nginx\n  namespace: default\nspec:\n  storageclassname: \"\" # æŒ‡å®šä½¿ç”¨ç°æœ‰ PV ï¼Œä¸ä½¿ç”¨ StorageClass åˆ›å»º PV\n  accessModes:\n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n---\n# è¿™ä¸ªä¾‹å­ä¸­éœ€è¦æŒ‚è½½ NFS ä¸Šçš„ç‰¹å®šè·¯å¾„ï¼Œæ‰€ä»¥æ‰‹åŠ¨å®šä¹‰äº†ä¸€ä¸ª PV\n# ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¸ä¼šæ‰‹åŠ¨åˆ›å»º PVï¼Œè€Œæ˜¯ä½¿ç”¨ StorageClass è‡ªåŠ¨åˆ›å»º\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: nfs-pv-for-nginx\nspec:\n  capacity: \n    storage: 1Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: /nfs/sharefolder/nginx\n    server: 81.70.4.171\n```\n\nè¿™ä»½æ¸…å•æˆ‘ä»¬ä¸»è¦å…³æ³¨å‰ä¸¤ä¸ªèµ„æºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é™¤äº†ä¸€ä¸ª Deployment èµ„æºä»¥å¤–æˆ‘ä»¬è¿˜å•ç‹¬å®šä¹‰äº†ä¸€ä¸ª PVC èµ„æºã€‚ç„¶ååœ¨ Deployment çš„ Pod æ¨¡æ¿ä¸­å£°æ˜å¹¶ç»‘å®šäº†è¿™ä¸ª PVC ã€‚\n\nå¯è¿™æ · apply äº†ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬åªå£°æ˜äº†ä¸€ä»½ PVC ï¼Œå½“ç„¶æˆ‘ä»¬åªä¼šæ‹¥æœ‰ä¸€ä¸ª PVC èµ„æºã€‚ä½†è¿™ä¸ª Deployment çš„å‰¯æœ¬æ•°æ˜¯ 3 ï¼Œå› æ­¤æˆ‘ä»¬ä¼šæœ‰ 3 ä¸ªç›¸åŒçš„ Pod å»ç»‘å®šåŒä¸€ä¸ª PVC ã€‚ä¹Ÿå°±æ˜¯æœ€ç»ˆä¼šåœ¨ 3 ä¸ªå®¹å™¨é‡Œè®¿é—®åŒä¸€ä¸ª NFS çš„åŒä¸€ä¸ªç›®å½•ã€‚å¦‚æœæˆ‘ä»¬åœ¨å…¶ä¸­ä¸€ä¸ªå®¹å™¨é‡Œå¯¹è¿™ä¸ªç›®å½•ä½œä¿®æ”¹ï¼Œä¹Ÿä¼šå½±å“åˆ°å¦å¤–ä¸¤ä¸ªå®¹å™¨ã€‚\n\n> æ³¨ï¼šè¿™ä¸€ç°è±¡ä¸ä¸€å®šåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½é€‚ç”¨ã€‚æ¯”å¦‚ AWS çš„ EBS å·åªæ”¯æŒå•ä¸ª AZ å†…çš„ç»‘å®šã€‚å¦‚æœ Pod å› ä¸º Node Affinity ç­‰è®¾å®šè¢«éƒ¨ç½²åˆ°äº†å¤šä¸ªåŒºï¼Œæ²¡æ³•ç»‘å®šåŒä¸€ä¸ª EBS å·ï¼Œå°±ä¼šåœ¨ Scedule çš„é˜¶æ®µæŠ¥é”™ã€‚\n\nå¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½ä¸å¸Œæœ›å¤šä¸ª Pod ç»‘å®šåˆ°åŒä¸€ PVC ã€‚æ¯”å¦‚æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ª DB é›†ç¾¤çš„æ—¶å€™ï¼Œå¦‚æœå¥½ä¸å®¹æ˜“éƒ¨ç½²å‡ºæ¥çš„å¤šä¸ªå®ä¾‹å±…ç„¶ç”¨çš„æ˜¯åŒä¸€ä»½å‚¨å­˜ï¼Œå°±ä¼šæ˜¾å¾—å¾ˆå‘†ã€‚ Stateful Set å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œä¼šä¸ºå…¶ç®¡ç†ä¸‹çš„æ¯ä¸ª Pod éƒ½éƒ¨ç½²ä¸€ä¸ªä¸“ç”¨çš„ PVC ã€‚\n\nä¸‹é¢æ˜¯ç»™ Stateful Set åˆ›å»ºå‡ºæ¥çš„ Pod æŒ‚è½½ PVC çš„ä¸€ä»½æ¸…å•ï¼š\n\n```yaml\n# è¿™é‡Œçœç•¥äº† Service ç›¸å…³çš„å†…å®¹\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: web\nspec:\n  serviceName: \"nginx\"\n  replicas: 2\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: k8s.gcr.io/nginx-slim:0.8\n        ports:\n        - containerPort: 80\n          name: web\n        volumeMounts:\n        - name: www\n          mountPath: /usr/share/nginx/html\n  volumeClaimTemplates:\n  - metadata:\n      name: www\n    spec:\n      accessModes: [ \"ReadWriteOnce\" ]\n      resources:\n        requests:\n          storage: 1Gi\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œéƒ¨ç½² Stateful Set æ—¶æˆ‘ä»¬ä¸èƒ½å¦å¤–å•ç‹¬å®šä¹‰ä¸€ä»½ PVC äº†ï¼Œåªèƒ½ä½œä¸º Stateful Set å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ volumeClaimTemplates å­—æ®µä¸­å®šä¹‰ PVC çš„æ¨¡æ¿ã€‚è¿™æ ·ä¸€æ¥ï¼Œ Stateful Set ä¼šæ ¹æ®è¿™ä¸ªæ¨¡æ¿ï¼Œä¸ºæ¯ä¸ª Pod åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ PVC ï¼Œå¹¶ä½œä¸º Pod çš„ Volume ç»‘å®šä¸Šï¼š\n\n```bash\n# Stateful Set åˆ›å»ºå‡ºæ¥çš„ Pod ï¼Œåå­—éƒ½æ˜¯æŒ‰é¡ºåºçš„\n$ kubectl get pods -l app=nginx\nNAME      READY     STATUS    RESTARTS   AGE\nweb-0     1/1       Running   0          1m\nweb-1     1/1       Running   0          1m\n\n# Stateful Set åˆ›å»ºå‡ºæ¥çš„ PVC ï¼Œåå­—ä¸ Pod çš„åå­—ä¸€ä¸€å¯¹åº”\n$ kubectl get pvc -l app=nginx\nNAME        STATUS    VOLUME                                     CAPACITY   ACCESSMODES   AGE\nwww-web-0   Bound     pvc-15c268c7-b507-11e6-932f-42010a800002   1Gi        RWO           48s\nwww-web-1   Bound     pvc-15c79307-b507-11e6-932f-42010a800002   1Gi        RWO           48s\n```\n\nè¿™æ ·ï¼Œ Stateful Set çš„å¤šä¸ª Pod å°±ä¼šæ‹¥æœ‰è‡ªå·±çš„å‚¨å­˜ï¼Œä¸ä¼šç›¸äº’æ‰“æ¶äº†ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬äº‹å…ˆå®šä¹‰äº† StorageClass ï¼Œè¿˜èƒ½æ ¹æ® Stateful Set çš„å‰¯æœ¬æ•°åŠ¨æ€é…ç½® PV ã€‚\n\n### ConfigMap ä¸ Secret æŒ‚è½½ä½œä¸ºç‰¹æ®Šçš„å·\n\næœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥é…ç½®åº”ç”¨ï¼ˆæ¯”å¦‚ Nginx çš„é…ç½®æ–‡ä»¶ï¼‰ï¼Œè€Œä¸”æˆ‘ä»¬æœ‰æ—¶å€™ä¼šéœ€è¦ä¸é‡å¯ Pod å°±çƒ­æ›´æ–°é…ç½®ã€‚å¦‚æœç”¨ PVC æ¥åŠ è½½é…ç½®æ–‡ä»¶ç•¥å¾®éº»çƒ¦ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ Config Map ã€‚\n\nä¸‹é¢æ˜¯ K8s å®˜ç½‘ä¸Š Config Map çš„ä¸€ä¸ªä¾‹å­ï¼š\n\n```yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: game-demo\ndata:\n  # ä¸€ä¸ª Key å¯ä»¥å¯¹åº”ä¸€ä¸ªå€¼\n  player_initial_lives: \"3\"\n  ui_properties_file_name: \"user-interface.properties\"\n\n  # ä¸€ä¸ª Key ä¹Ÿå¯ä»¥å¯¹åº”ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹\n  game.properties: |\n    enemy.types=aliens,monsters\n    player.maximum-lives=5    \n  user-interface.properties: |\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true    \n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: configmap-demo-pod\nspec:\n  containers:\n    - name: demo\n      image: alpine\n      command: [\"sleep\", \"3600\"]\n      env:\n        # ConfigMap çš„ Key å¯ä»¥ä½œä¸ºç¯å¢ƒå˜é‡å¼•ç”¨\n        - name: PLAYER_INITIAL_LIVES\n          valueFrom:\n            configMapKeyRef:\n              name: game-demo           # ä»è¿™ä¸ª Config Map é‡Œ\n              key: player_initial_lives # æ‹¿åˆ°è¿™ä¸ª key çš„å€¼\n        - name: UI_PROPERTIES_FILE_NAME\n          valueFrom:\n            configMapKeyRef:\n              name: game-demo\n              key: ui_properties_file_name\n      volumeMounts:\n      - name: config\n        mountPath: \"/config\"\n        readOnly: true\n  volumes:\n    # å®šä¹‰ Pod çš„ Volume ï¼Œç§ç±»ä¸º configMap\n    - name: config\n      configMap:\n        name: game-demo # ConfigMapçš„åå­—\n        # éœ€è¦ä½œä¸ºæ–‡ä»¶æ”¾å…¥ Volume çš„ Key\n        items:\n        - key: \"game.properties\"\n          path: \"game.properties\"\n        - key: \"user-interface.properties\"\n          path: \"user-interface.properties\"\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ° ConfigMap é‡Œçš„ Key å¯ä»¥ä½œä¸ºæ–‡ä»¶æˆ–æ˜¯ç¯å¢ƒå˜é‡åŠ è½½åˆ° Pod ä¸­ã€‚å¦å¤–ï¼Œä½œä¸ºç¯å¢ƒå˜é‡åŠ è½½åå…¶å®è¿˜èƒ½ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ä¼ å…¥åº”ç”¨ï¼Œå®ç°å„ç§é…ç½®æ–¹å¼ã€‚å¦‚æœä¿®æ”¹ Config map çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨æ›´æ–° Pod ä¸­çš„æ–‡ä»¶ã€‚\n\nç„¶è€Œï¼Œ Config Map çš„çƒ­æ›´æ–°æœ‰ä¸€äº›ä¸å¤ªçµæ´»çš„åœ°æ–¹ï¼š\n\n1. ä½œä¸ºç¯å¢ƒå˜é‡åŠ è½½çš„ Config Map æ•°æ®ä¸ä¼šè¢«çƒ­æ›´æ–°ã€‚æƒ³è¦æ›´æ–°è¿™ä¸€éƒ¨åˆ†æ•°æ®éœ€è¦é‡å¯ Podã€‚ï¼ˆå½“ç„¶ï¼Œå‘½ä»¤è¡Œå‚æ•°ä¹Ÿä¸èƒ½çƒ­æ›´æ–°ï¼‰\n2. ç”±äº Kubelet ä¼šå…ˆå°† Config Map å†…å®¹åŠ è½½åˆ°æœ¬åœ°ä½œä¸ºç¼“å­˜ï¼Œå› æ­¤ä¿®æ”¹ Config Map åæ–°çš„å†…å®¹ä¸ä¼šç¬¬ä¸€æ—¶é—´åŠ è½½åˆ° Pod ä¸­ã€‚è€Œä¸”åœ¨æ—§ç‰ˆæœ¬çš„ K8s ä¸­ï¼Œ Config Map è¢«æ›´æ–°ç›´åˆ°ç¼“å­˜è¢«åˆ·æ–°çš„æ—¶é—´é—´éš”è¿˜ä¼šå¾ˆé•¿ï¼Œæ–°ç‰ˆæœ¬çš„ K8s è¿™ä¸€éƒ¨åˆ†æœ‰äº†ä¼˜åŒ–ï¼Œå¯ä»¥è®¾å®šåˆ·æ–°æ—¶é—´ï¼Œä½†ä¼šå¯¼è‡´ API Server çš„è´Ÿæ‹…åŠ é‡ã€‚ï¼ˆè¿™å…¶å®æ˜¯ä¸€ä¸ª Known Issue ï¼Œè¢«è¯Ÿç—…å¤šå¹´ï¼š https://github.com/kubernetes/kubernetes/issues/22368 ï¼‰\n\né™¤ Config Map ä»¥å¤–ï¼Œ K8s è¿˜æä¾›äº†ä¸€ç§å« Secret çš„èµ„æºï¼Œç”¨æ³•å’Œ Config Map å‡ ä¹ä¸€æ ·ã€‚å¯¹æ¯” Config Map ï¼ŒSecret æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\n\n1. åœ¨ Pod é‡Œï¼Œ Secret åªä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ°¸è¿œä¸ä¼šè¢«å†™åˆ°ç£ç›˜ä¸Šã€‚\n2. ç”¨ `kubectl get` ä¹‹ç±»çš„å‘½ä»¤æ˜¾ç¤ºçš„ Secret å†…å®¹ä¼šè¢«ç”¨ base64 ç¼–ç ã€‚ï¼ˆä¸è¿‡ï¼Œ well ï¼Œä¼—æ‰€å‘¨çŸ¥ base64 å¯ä¸ç®—æ˜¯ä»€ä¹ˆåŠ å¯†ï¼‰\n3. å¯ä»¥é€šè¿‡ K8s çš„ Service Account ç­‰ RBAC ç›¸å…³çš„èµ„æºæ¥æ§åˆ¶ Secret çš„è®¿é—®æƒé™ã€‚\n\nä¸è¿‡ï¼Œç”±äº Secret ä¹Ÿæ˜¯ä»¥æ˜æ–‡çš„å½¢å¼è¢«å­˜å‚¨åœ¨ K8s çš„ä¸»èŠ‚ç‚¹ä¸­çš„ï¼Œå› æ­¤éœ€è¦ä¿è¯ K8s ä¸»èŠ‚ç‚¹çš„å®‰å…¨ã€‚\n\n> **Downward API æŒ‚è½½ä½œä¸ºç‰¹æ®Šçš„å·**\n> \n> è¿˜æœ‰å¦å¤–ä¸€ç§å« Downward API çš„ä¸œè¥¿ï¼Œå¯ä»¥ä½œä¸º Volume æˆ–æ˜¯ç¯å¢ƒå˜é‡è¢«åŠ è½½åˆ° Pod ä¸­ã€‚æœ‰ä¸€äº›å‚æ•°æˆ‘ä»¬å¾ˆéš¾äº‹å…ˆåœ¨ Manifest ä¸­å®šä¹‰ï¼ˆ e.g. Deployment ç”Ÿæˆçš„ Pod çš„åå­—ï¼‰ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ Downward API æ¥å®ç°ã€‚\n> \n> ```yaml\n> apiVersion: v1\n> kind: Pod\n> metadata:\n>     name: test-volume-pod\n>     namespace: kube-system\n>     labels:\n>         k8s-app: test-volume\n>         node-env: test\n> spec:\n>     containers:\n>     - name: test-volume-pod-container\n>       image: busybox:latest\n>       env:\n>       - name: POD_NAME # å°† Pod çš„åå­—ä½œä¸ºç¯å¢ƒå˜é‡ POD_NAME åŠ è½½åˆ° Pod ä¸­\n>         valueFrom:\n>           fieldRef:\n>             fieldPath: metadata.name\n>       command: [\"sh\", \"-c\"]\n>       args:\n>       - while true; do\n>           cat /etc/podinfo/labels | echo;\n>           env | sort | echo;\n>           sleep 3600;\n>         done;\n>       volumeMounts:\n>       - name: podinfo\n>         mountPath: /etc/podinfo\n>     volumes:\n>     - name: podinfo\n>       downwardAPI: # Downward API ç±»å‹çš„å·\n>         items:\n>         - path: \"labels\" # å°† Pod çš„æ ‡ç­¾ä½œä¸º  labels æ–‡ä»¶æŒ‚è½½åˆ° Pod ä¸­\n>           fieldRef:\n>             fieldPath: metadata.labels\n> ```\n\n\n\n# ç½‘ç»œ\n\nå…¶å® Pod åªè¦éƒ¨ç½²å¥½äº†ï¼Œå°±ä¼šè¢«åˆ†é…åˆ°ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„ IP åœ°å€ï¼Œæµé‡å°±å¯ä»¥é€šè¿‡ IP åœ°å€æ¥è®¿é—® Pod äº†ã€‚ç„¶è€Œé€šè¿‡å¯èƒ½ä¼šæœ‰å¾ˆå¤§é—®é¢˜ï¼š **Pod éšæ—¶ä¼šè¢«æ€æ­»ã€‚** è™½ç„¶é€šè¿‡ç”¨ Deployment ç­‰èµ„æºå¯ä»¥åœ¨æŒ‚æ‰åé‡æ–°åˆ›å»ºä¸€ä¸ª Pod ï¼Œä½†é‚£æ¯•ç«Ÿæ˜¯ä¸åŒçš„ Pod ï¼Œ IP å·²ç»æ”¹å˜ã€‚\n\nå¦å¤–ï¼Œ Deployment ç­‰èµ„æºçš„å°±æ˜¯ä¸ºäº†èƒ½æ›´æ–¹ä¾¿çš„åšåˆ°å¤šå‰¯æœ¬éƒ¨ç½²åŠä»»æ„ç¼©å®¹æ‰©å®¹è€Œå­˜åœ¨çš„ã€‚å¦‚æœåœ¨ K8s ä¸­è®¿é—® Pod è¿˜éœ€è¦å°å¿ƒç¿¼ç¿¼åœ°å»æ‰¾åˆ° Pod çš„ IP åœ°å€ï¼Œæˆ–æ˜¯å»å¯»æ‰¾ Pod æ˜¯å¦éƒ¨ç½²äº†æ–°å‰¯æœ¬ï¼Œ Deployment ç­‰èµ„æºå°±å‡ ä¹æ²¡æœ‰å­˜åœ¨ä»·å€¼äº†ã€‚\n\n> å…¶å® Pod éƒ¨ç½²å¥½åä¸æ­¢ä¼šè¢«åˆ†é… IP åœ°å€ï¼Œè¿˜ä¼šè¢«åˆ†é…åˆ°ä¸€ä¸ªç±»ä¼¼ `<pod-ip>.<namespace>.pod.cluster.local` çš„ DNS è®°å½•ã€‚ä¾‹å¦‚ä¸€ä¸ªä½äº default åå­—ç©ºé—´ï¼ŒIP åœ°å€ä¸º 172.17.0.3 çš„ Pod ï¼Œå¯¹åº” DNS è®°å½•ä¸º `172-17-0-3.default.pod.cluster.local` ã€‚\n\n### Service\n\nåœ¨å¤ä»£ï¼Œäººä»¬æ˜¯é€šè¿‡æ³¨å†Œä¸­å¿ƒã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰ä¸­é—´ä»¶æ¥è§£å†³ä¸Šé¢è¿™äº›é—®é¢˜çš„ï¼Œä½†è¿™æ ·å¾ˆä¸äº‘åŸç”Ÿã€‚äºæ˜¯ K8s å¼•å…¥äº† Service è¿™ç§èµ„æºï¼Œæ¥å®ç°ç®€æ˜“çš„æœåŠ¡å‘ç°ã€ DNS åŠŸèƒ½ã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªç»å…¸çš„ä¾‹å­ï¼Œéƒ¨ç½²äº†ä¸€ä¸ª Service å’Œä¸€ä¸ª Deploymentï¼š\n\n```yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: auth-service\n  labels:\n    app: auth\nspec:\n  type: ClusterIP\n  selector:\n    app: auth # æŒ‡å‘ Deployment åˆ›å»ºçš„ Pod\n  ports:\n  - port: 80 # Service æš´éœ²çš„ç«¯å£\n    targetPort: 8080 # Pod çš„ç«¯å£\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name:  auth\n  labels:\n    app: auth\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: auth\n  template:\n    metadata:\n      name: auth\n      labels:\n        app: auth\n    spec:\n      containers:\n      - name: auth\n        image: xxxxx.dkr.ecr.ap-northeast-1.amazonaws.com/auth:xxxxx\n        ports:\n        - containerPort: 8080\n```\n\næ ¹æ®å‰é¢çš„çŸ¥è¯†æˆ‘ä»¬çŸ¥é“ï¼Œè¿™ä»½æ–‡ä»¶ä¼šéƒ¨ç½² Deployment ä¼šåˆ›å»º 2 ä¸ªç›¸åŒçš„ Pod å‰¯æœ¬ã€‚å¦å¤–è¿˜ä¼šéƒ¨ç½²ä¸€ä¸ªåä¸º auth-service çš„ Service èµ„æºã€‚è¿™ä¸ª Service æš´éœ²äº†ä¸€ä¸ª 80 ç«¯å£ï¼Œå¹¶ä¸”æŒ‡å‘é‚£ä¸¤ä¸ª Pod çš„ 8080 ç«¯å£ã€‚\n\nè€Œè¿™ä»½æ–‡ä»¶éƒ¨ç½²åï¼Œ Service èµ„æºå°±ä¼šåœ¨é›†ç¾¤ä¸­æ³¨å†Œä¸€ä¸ª DNS A è®°å½•ï¼ˆæˆ– AAAA è®°å½•ï¼‰ï¼Œé›†ç¾¤å†…å…¶ä»– Pod ï¼ˆä¸ºäº†è¾¨åˆ«æˆ‘ä»¬å«å®ƒ Client ï¼‰å°±å¯ä»¥é€šè¿‡ç›¸åŒçš„ DNS åç§°æ¥è®¿é—® Deployment éƒ¨ç½²çš„è¿™ 2 ä¸ª Pod ï¼š\n\n```sh\ncurl http://auth-service.<namespace>.svc.cluster.local:80\n# æˆ–è€…çœç•¥æ‰åé¢çš„ä¸€å¤§ä¸²\ncurl http://auth-service.<namespace>:80\n# å¦‚æœ Client å’Œ Service åœ¨åŒä¸€ä¸ª Namespace ä¸­ï¼Œè¿˜å¯ä»¥ï¼š\ncurl http://auth-service:80\n```\n\nåƒè¿™æ · Client é€šè¿‡ Service æ¥è®¿é—®æ—¶ï¼Œä¼šéšæœºè®¿é—®åˆ°å…¶ä¸­ä¸€ä¸ª Pod ï¼Œè¿™æ ·ä¸€æ¥æ— è®º Deployment åˆ°åº•åˆ›å»ºäº†å¤šå°‘ä¸ªå‰¯æœ¬ï¼Œåªè¦å‰¯æœ¬çš„æ ‡ç­¾ç›¸åŒï¼Œå°±èƒ½é€šè¿‡åŒä¸€ä¸ª DNS åç§°æ¥è®¿é—®ï¼Œè¿˜èƒ½è‡ªåŠ¨å®ç°ä¸€äº›ç®€å•çš„è´Ÿè½½å‡è¡¡ã€‚\n\n> **ä¸ºä»€ä¹ˆ DNS åç§°å¯ä»¥ç®€åŒ–ï¼Ÿ**\n> \n> Pod è¢«éƒ¨ç½²æ—¶ï¼Œ kubelet ä¼šä¸ºæ¯ä¸ª Pod æ³¨å…¥ä¸€ä¸ªç±»ä¼¼å¦‚ä¸‹çš„ `/etc/resolv.conf` æ–‡ä»¶ï¼š\n> \n> ```\n> nameserver 10.32.0.10\n> search <namespace>.svc.cluster.local svc.cluster.local cluster.local\n> options ndots:5\n> ```\n> \n> Pod ä¸­è¿›è¡Œ DNS æŸ¥è¯¢æ—¶ï¼Œé»˜è®¤ä¼šå…ˆè¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åæŒ‰ç…§ `search` é€‰é¡¹ä¸­çš„å†…å®¹å±•å¼€ DNS ã€‚ä¾‹å¦‚ï¼Œåœ¨ test åç§°ç©ºé—´ä¸­çš„ Pod ï¼Œè®¿é—® data æ—¶çš„æŸ¥è¯¢å¯èƒ½è¢«å±•å¼€ä¸º data.test.svc.cluster.local ã€‚\n> æ›´å¤šå…³äº `/etc/resolv.conf` æ–‡ä»¶çš„å†…å®¹å¯å‚è€ƒ https://www.man7.org/linux/man-pages/man5/resolv.conf.5.html\n\n### Service çš„ç§ç±»\n\næˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ° Service èµ„æºæœ‰ä¸ªå­—æ®µ `type:ClusterIP` ã€‚å…¶å® Service èµ„æºæœ‰ä»¥ä¸‹å‡ ä¸ªç§ç±»ï¼š\n\n| ç§ç±»           | ä½œç”¨                                                                                                                                                                                                                                                                                             |\n| :------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `ClusterIP`    | è¿™ä¸ªç±»å‹çš„ Service ä¼šåœ¨é›†ç¾¤å†…åˆ›å»ºä¸€æ¡ DNS A è®°å½•å¹¶é€šè¿‡ä¸€å®šæ–¹æ³•å°†æµé‡ä»£ç†åˆ°å…¶æŒ‡å‘çš„ Pod ä¸Šã€‚è¿™ç§ Service ä¸ä¼šæš´éœ²åˆ°é›†ç¾¤å¤–ã€‚è¿™æ˜¯æœ€åŸºç¡€çš„ Service ç§ç±»ã€‚                                                                                                                                            |\n| `NodePort`     | è¿™ç§ Service ä¼šåœ¨ ClusterIP çš„åŸºç¡€ä¸Šï¼Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå„æš´éœ²ä¸€ä¸ªç«¯å£ï¼Œå¹¶æŠŠç«¯å£çš„æµé‡ä¹Ÿä»£ç†åˆ°æŒ‡å‘çš„ Pod ä¸Šã€‚å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•ä»é›†ç¾¤å¤–è®¿é—®é›†ç¾¤å†…çš„èµ„æºã€‚                                                                                                                                                |\n| `LoadBalancer` | è¿™ç§ Service ä¼šåœ¨ ClusterIP çš„åŸºç¡€ä¸Šï¼Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå„æš´éœ²ä¸€ä¸ªç«¯å£ï¼Œå¹¶åœ¨é›†ç¾¤å¤–åˆ›å»ºä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨æ¥å°†å¤–éƒ¨æµé‡è·¯ç”±åˆ°æš´éœ²çš„ç«¯å£ï¼Œå†æŠŠæµé‡ä»£ç†åˆ°æŒ‡å‘çš„ Pod ä¸Šã€‚è¿™ç§ Service ä¸€èˆ¬éœ€è¦è°ƒç”¨äº‘æœåŠ¡æä¾›çš„ API æˆ–æ˜¯é¢å¤–å®‰è£…çš„æ’ä»¶ã€‚å¦‚æœä»€ä¹ˆæ’ä»¶éƒ½æ²¡å®‰è£…çš„è¯ï¼Œè¿™ç§ Service éƒ¨ç½²åä¼šä¸ `NodePort` çš„è¡¨ç°ä¸€æ ·ã€‚ |\n| `ExternalName` | è¿™ç§ Service ä¸éœ€è¦ selector å­—æ®µæŒ‡å®šåç«¯ï¼Œè€Œæ˜¯ç”¨ externalName å­—æ®µæŒ‡å®šä¸€ä¸ªå¤–éƒ¨ DNS è®°å½•ï¼Œç„¶åå°†æµé‡å…¨éƒ¨æŒ‡å‘å¤–éƒ¨æœåŠ¡ã€‚å¦‚æœæ‰“ç®—å°†é›†ç¾¤å†…çš„æœåŠ¡è¿ç§»åˆ°é›†ç¾¤å¤–ã€æˆ–æ˜¯é›†ç¾¤å¤–è¿ç§»åˆ°é›†ç¾¤å†…ï¼Œè¿™ç§ç±»å‹çš„ Service å¯ä»¥å®ç°æ— ç¼è¿ç§»ã€‚                                                                          |\n\n### è™šæ‹Ÿ IP ä¸ Headless Service\n\nå¦‚æœä½ åœ¨é›†ç¾¤å†…å°è¯•å¯¹ Service å¯¹åº”çš„ DNS è®°å½•è¿›è¡ŒåŸŸåè§£æï¼Œä¼šå‘ç°è¿”å›æ¥çš„ IP åœ°å€ä¸ Service æŒ‡å‘çš„ä»»ä½•ä¸€ä¸ª Pod å¯¹åº”çš„ IP åœ°å€éƒ½ä¸ç›¸åŒã€‚å¦‚æœä½ è¿˜å°è¯•äº†å» Ping è¿™ä¸ª IP åœ°å€ï¼Œä¼šå‘ç°ä¸èƒ½ Ping é€šã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ\n\nåŸæ¥ï¼Œæ¯ä¸ª Service è¢«éƒ¨ç½²åï¼Œ K8s éƒ½ä¼šç»™ä»–åˆ†é…ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„ IP åœ°å€ï¼Œä¹Ÿå°±æ˜¯ Cluster IP ï¼ˆè¿™ä¹Ÿæ˜¯æœ€åŸºç¡€çš„ Service ç§ç±»ä¼šèµ·åå« Cluster IP çš„åŸå› ï¼‰ã€‚\n\nä½†æ˜¯è¿™ä¸ª Cluster IP ä¸ä¼šç»‘å®šä»»ä½•çš„ç½‘å¡ï¼Œæ˜¯ä¸€ä¸ªè™šæ‹Ÿ IP ã€‚ç„¶å K8s ä¸­æœ‰ä¸€ä¸ªå« kube-proxy çš„ç»„ä»¶ï¼ˆè¿™é‡Œå«ä»–åšç»„ä»¶ï¼Œæ˜¯å› ä¸º kube-proxy ä¸ Service ã€ Deployment ç­‰ä¸ä¸€æ ·ï¼Œä¸æ˜¯ä¸€ç§èµ„æºè€Œæ˜¯ K8s çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œ kube-proxy é€šè¿‡ä¿®æ”¹ iptables ï¼Œå°†è™šæ‹Ÿ IP çš„æµé‡ç»è¿‡ä¸€å®šçš„è´Ÿè½½å‡è¡¡è§„åˆ™åä»£ç†åˆ° Pod ä¸Šã€‚\n\n![K8s å®˜ç½‘ä¸Šçš„è™šæ‹Ÿ IP å›¾](https://d33wubrfki0l68.cloudfront.net/27b2978647a8d7bdc2a96b213f0c0d3242ef9ce0/e8c9b/images/docs/services-iptables-overview.svg)\n\n> **ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ DNS è½®è¯¢ï¼Ÿ**\n> \n> ä¸ºä»€ä¹ˆ K8s ä¸é…ç½®å¤šæ¡ DNS A è®°å½•ï¼Œç„¶åé€šè¿‡è½®è¯¢åç§°æ¥è§£æï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æå‡ºè™šæ‹Ÿ IP è¿™ä¹ˆå¤æ‚çš„ä¸œè¥¿ï¼Ÿè¿™ä¸ªé—®é¢˜ K8s å®˜ç½‘ä¸Šä¹Ÿæœ‰ç‰¹åˆ«æåˆ°åŸå› ï¼š\n> \n> - DNS å®ç°çš„å†å²ç”±æ¥å·²ä¹…ï¼Œå®ƒä¸éµå®ˆè®°å½• TTLï¼Œå¹¶ä¸”åœ¨åç§°æŸ¥æ‰¾ç»“æœåˆ°æœŸåå¯¹å…¶è¿›è¡Œç¼“å­˜ã€‚\n> - æœ‰äº›åº”ç”¨ç¨‹åºä»…æ‰§è¡Œä¸€æ¬¡ DNS æŸ¥æ‰¾ï¼Œå¹¶æ— é™æœŸåœ°ç¼“å­˜ç»“æœã€‚\n> - å³ä½¿åº”ç”¨å’Œåº“è¿›è¡Œäº†é€‚å½“çš„é‡æ–°è§£æï¼ŒDNS è®°å½•ä¸Šçš„ TTL å€¼ä½æˆ–ä¸ºé›¶ä¹Ÿå¯èƒ½ä¼šç»™ DNS å¸¦æ¥é«˜è´Ÿè½½ï¼Œä»è€Œä½¿ç®¡ç†å˜å¾—å›°éš¾ã€‚\n\næœ‰äº›æ—¶å€™ï¼ˆæ¯”å¦‚æƒ³ä½¿ç”¨è‡ªå·±çš„æœåŠ¡å‘ç°æœºåˆ¶æˆ–æ˜¯è‡ªå·±çš„è´Ÿè½½å‡è¡¡æœºåˆ¶æ—¶ï¼‰æˆ‘ä»¬ç¡®å®ä¹Ÿä¼šæƒ³è¶Šè¿‡è™šæ‹Ÿ IP ï¼Œç›´æ¥è·å–èƒŒå Pod çš„ IP åœ°å€ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å°† Service çš„ `spec.clusterIP` å­—æ®µæŒ‡å®šä¸º `None` ï¼Œè¿™æ · K8s å°±ä¸ä¼šç»™è¿™ä¸ª Service åˆ†é…ä¸€ä¸ª Cluster IP ã€‚è¿™æ ·çš„ Service è¢«ç§°ä¸º **Headless Service** ã€‚\n\nHeadless Service èµ„æºä¼šåˆ›å»ºä¸€ç»„ A è®°å½•ç›´æ¥æŒ‡å‘èƒŒåçš„ Pod ï¼Œå¯ä»¥é€šè¿‡ DNS è½®è¯¢ç­‰æ–¹å¼ç›´æ¥è·å¾—å…¶ä¸­ä¸€ä¸ª Pod çš„ IP åœ°å€ã€‚å¦å¤–æ›´é‡è¦çš„ä¸€ç‚¹ï¼Œ Headless Service è¿˜ä¼šåˆ›å»ºä¸€ç»„ SRV è®°å½•ï¼ŒåŒ…å«äº†æŒ‡å‘å„ä¸ª Pod çš„ DNS è®°å½•ï¼Œå¯ä»¥é€šè¿‡ SRV è®°å½•æ¥å‘ç°æ‰€æœ‰ Pod ã€‚\n\næˆ‘ä»¬å¯ä»¥åœ¨é›†ç¾¤é‡Œç”¨ nsloopup æˆ– dig å‘½ä»¤å»éªŒè¯ä¸€ä¸‹ï¼š\n\n```sh\n# åœ¨é›†ç¾¤çš„ Pod å†…éƒ¨è¿è¡Œ\n$ nslookup kafka-headless.kafka.svc.cluster.local\nServer:     10.96.0.10\nAddress:    10.96.0.10#53\n\nName:   kafka-headless.kafka.svc.cluster.local\nAddress: 172.17.0.6\nName:   kafka-headless.kafka.svc.cluster.local\nAddress: 172.17.0.5\nName:   kafka-headless.kafka.svc.cluster.local\nAddress: 172.17.0.4\n\n$ dig SRV kafka-headless.kafka.svc.cluster.local\n# .....\n;; ANSWER SECTION:\nkafka-headless.kafka.svc.cluster.local.      30      IN      SRV     0 20 9092 kafka-0.kafka-headless.kafka.svc.cluster.local.\nkafka-headless.kafka.svc.cluster.local.      30      IN      SRV     0 20 9092 kafka-1.kafka-headless.kafka.svc.cluster.local.\nkakfa-headless.kafka.svc.cluster.local.      30      IN      SRV     0 20 9092 kafka-2.kafka-headless.kafka.svc.cluster.local.\n\n;; ADDITIONAL SECTION:\nkafka-0.kafka-headless.kafka.svc.cluster.local. 30 IN A  172.17.0.6\nkafka-1.kafka-headless.kafka.svc.cluster.local. 30 IN A  172.17.0.5\nkafka-2.kafka-headless.kafka.svc.cluster.local. 30 IN A  172.17.0.4\n```\n\n> æ‹¥æœ‰ Cluster IP çš„ Service å…¶å®ä¹Ÿæœ‰ SRV è®°å½•ã€‚ä½†è¿™ç§æƒ…å†µçš„ SRV è®°å½•ä¸­å¯¹åº”çš„ Target ä»ä¸º Service è‡ªå·±çš„ FQDN ã€‚\n\n### ç¬¬ä¸‰æ¬¡å›åˆ° Stateful Set\n\nåœ¨ä¸Šé¢ Headless Service çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œå„ä¸ª Pod å¯¹åº”çš„ DNS A è®°å½•æ ¼å¼ä¸º `<pod_name>.<svc_name>.<namespace>.svc.cluster.local` ã€‚ä¸å¯¹å•Šï¼Œä¹‹å‰çš„å°çŸ¥è¯†é‡Œä¸æ˜¯è¯´è¿‡ Pod è¢«åˆ†é…çš„ DNS A è®°å½•æ ¼å¼åº”è¯¥æ˜¯ `172-17-0-3.default.pod.cluster.local` çš„å—ï¼Ÿ\n\nå…¶å® Headless Service è¿˜æœ‰ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„éšè—åŠŸèƒ½ã€‚ Pod è¿™ç§èµ„æºæœ¬èº«çš„å‚æ•°ä¸­æœ‰ `subdomain` å­—æ®µå’Œ `hostname` å­—æ®µï¼Œå¦‚æœè®¾ç½®äº†è¿™ä¸¤ä¸ªå­—æ®µï¼Œè¿™ä¸ª Pod å°±æ‹¥æœ‰äº†å½¢å¦‚ `<hostname>.<subdomain>.<namespace>.svc.cluster.local` çš„ FQDN ï¼ˆå…¨é™å®šåŸŸåï¼‰ã€‚å¦‚æœè¿™æ—¶åˆšå¥½åœ¨åŒä¸€åç§°ç©ºé—´ä¸‹æœ‰ä¸ `subdomain` åŒåçš„ Headless Service ï¼Œ DNS å°±ä¼šç”¨ä¸ºè¿™ä¸ª Pod ç”¨å®ƒçš„ FQDN æ¥åˆ›å»ºä¸€æ¡ DNS A è®°å½•ã€‚\n\næ¯”å¦‚ Pod1 åœ¨ `kafka` åç§°ç©ºé—´ä¸­ï¼Œ `hostname` ä¸º `kafka-1` ï¼Œ `subdomain` ä¸º `kafka-headless` ï¼Œé‚£ä¹ˆ Pod1 çš„ FQDN å°±æ˜¯ `kafka-1.kafka-headless.kakfa.svc.cluster.local` ã€‚è€ŒåŒæ ·åœ¨ `kafka` åç§°ç©ºé—´ä¸­ï¼Œåˆšå¥½åˆæœ‰ä¸€ä¸ª `kafka-headless` çš„ Headless Service ï¼Œé‚£ä¹ˆ DNS å°±ä¼šåˆ›å»ºä¸€æ¡ A è®°å½•ï¼Œå°±å¯ä»¥é€šè¿‡ `kafka-1.kafka-headless.kafka.svc.cluster.local` æ¥è®¿é—® Pod1 äº†ã€‚å½“ç„¶ï¼Œç”±äº DNS å±•å¼€ï¼Œä¹Ÿå¯ä»¥ç”¨ `kafka-1.kafka-headless.kafka` ç”šè‡³æ˜¯ `kafka-1.kafka-headless` æ¥è®¿é—®è¿™ä¸ª Pod ã€‚\n\nå…¶å®è¿™äº› Pod æ˜¯ç”¨ Stateful Set æ¥éƒ¨ç½²çš„ï¼Œè¿™ä¸€éƒ¨åˆ†å…¶å®æ˜¯ Stateful Set ç›¸å…³çš„åŠŸèƒ½ã€‚ä¹‹å‰æˆ‘ä»¬è¯´åˆ° Stateful Set æœ‰å”¯ä¸€ç¨³å®šçš„ç½‘ç»œæ ‡è¯†ã€‚æˆ‘ä»¬ç°åœ¨å°±æ¥è¯¦ç»†è®²è®²ï¼Œè¿™â€œå”¯ä¸€ç¨³å®šçš„ç½‘ç»œæ ‡è¯†â€åˆ°åº•æ˜¯åœ¨æŒ‡ä»€ä¹ˆã€‚\n\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ª kafka Stateful Set åˆ°åº•æ˜¯æ€ä¹ˆéƒ¨ç½²çš„ï¼š\n\n```yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: kafka-headless\nspec:\n  clusterIP: None # è¿™æ˜¯ä¸€ä¸ª headless service\n  ports:\n  - name: tcp-client\n    port: 9092\n    protocol: TCP\n    targetPort: kafka-client\n  selector:\n    select-label: kafka-label\n  type: ClusterIP\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: kafka\nspec:\n  replicas: 3\n  serviceName: kafka-headless # æ³¨æ„åˆ°è¿™é‡Œæœ‰ serviceName å­—æ®µ\n  selector:\n    matchLabels:\n      select-label: kafka-label\n  template:\n    metadata:\n      labels:\n        select-label: kafka-label\n    spec:\n      containers:\n      - name: kafka\n        image: docker.io/bitnami/kafka:3.1.0-debian-10-r52\n        # æ¥ä¸‹æ¥ Pod ç›¸å…³éƒ¨åˆ†çœç•¥\n  # ä¸‹é¢ Volume ç›¸å…³éƒ¨åˆ†ä¹Ÿçœç•¥\n```\n\næˆ‘ä»¬çœ‹åˆ°ï¼Œ Stateful Set çš„å®šä¹‰ä¸­å¿…é¡»è¦ç”¨ `spec.serviceName` å­—æ®µæŒ‡å®šä¸€ä¸ª Headless Service ã€‚ Stateful Set åˆ›å»º Pod æ—¶ï¼Œä¼šè‡ªåŠ¨ç»™ Pod æŒ‡å®š `hostname` å’Œ `subdomain` å­—æ®µã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ª Pod æ‰æœ‰äº†å”¯ä¸€å›ºå®šçš„ hostname ï¼Œå”¯ä¸€å›ºå®šçš„ FQDN ï¼Œä»¥åŠé€šè¿‡ä¸ Headless Service å…±åŒéƒ¨ç½²è€Œè·å¾—å”¯ä¸€å›ºå®šçš„ A è®°å½•ã€‚ï¼ˆæ­¤å¤–ï¼Œå…¶å®å½“ Pod å› ä¸ºç‰ˆæœ¬å‡çº§ç­‰åŸå› è¢«é‡æ–°åˆ›å»ºæ—¶ï¼Œç›¸åŒåºå·çš„ Pod è¿˜ä¼šè¢«åˆ†é…åˆ°ç›¸åŒå›ºå®šçš„é›†ç¾¤å†… IP ã€‚ï¼‰\n\n> **å…³äº Stateful Set ä¸­ `serviceName` å­—æ®µçš„äº‰è®®**\n> \n> Stateful Set ä¸­çš„ serviceName å­—æ®µæ˜¯å¿…å¡«å­—æ®µã€‚è¿™ä¸ªå­—æ®µå”¯ä¸€çš„ä½œç”¨å…¶å®å°±æ˜¯ç»™ Pod æŒ‡å®š subdomain ã€‚å…¶å®è¿™æ ·ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼š\n> \n> 1. Stateful Set éƒ¨ç½²æ—¶ä¸ä¼šæ£€æŸ¥æ˜¯å¦çœŸçš„å­˜åœ¨è¿™ä¹ˆä¸€ä¸ª Headless Service ã€‚å¦‚æœ serviceName ä¹±å¡«ä¸€ä¸ªå€¼ï¼Œä¼šå¯¼è‡´è™½ç„¶ Pod çš„ `hostname` å’Œ `subdomain` éƒ½æŒ‡å®šäº†å´æ²¡æœ‰åˆ›å»º A è®°å½•çš„æƒ…å†µã€‚\n> 2. æœ‰æ—¶ Stateful Set çš„ Pod ä¸éœ€è¦æ¥æ”¶æµé‡ï¼Œä¹Ÿä¸éœ€è¦ç›¸äº’å‘ç°ï¼Œè¿™æ—¶å€™è¿˜å¼ºè¡Œéœ€è¦æŒ‡å®šä¸€ä¸ª serviceName æ˜¾å¾—æœ‰ç‚¹å¤šä½™ã€‚\n> \n> åœ¨ GitHub ä¸Šæœ‰å…³äºè¿™ä¸ªé—®é¢˜çš„ Issue ï¼š https://github.com/kubernetes/kubernetes/issues/69608\n\n### ä»é›†ç¾¤å¤–éƒ¨è®¿é—®\n\nåœ¨ K8s é›†ç¾¤é‡ŒæŠŠåº”ç”¨éƒ¨ç½²å¥½äº†ï¼Œå¯æ˜¯å¦‚ä½•è®©é›†ç¾¤å¤–éƒ¨çš„å®¢æˆ·ç«¯è®¿é—®æˆ‘ä»¬é›†ç¾¤ä¸­çš„åº”ç”¨å‘¢ï¼Ÿè¿™å¯èƒ½æ˜¯å¤§å®¶æœ€å…³å¿ƒçš„é—®é¢˜ã€‚\n\nä¸è¿‡æœ‰è®¤çœŸå¬çš„åŒå­¦ä¼°è®¡å·²ç»æœ‰è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆäº†ã€‚ä¹‹å‰æˆ‘ä»¬è®²è¿‡ NodePort å’Œ LoadBalancer è¿™ä¸¤ç§ Service ç±»å‹ã€‚\n\nå…¶ä¸­ NodePort Service åªæ˜¯ç®€å•åœ°åœ¨èŠ‚ç‚¹æœºå™¨ä¸Šå„å¼€ä¸€ä¸ªç«¯å£ï¼Œè€Œå¦‚ä½•è·¯ç”±ã€å¦‚ä½•è´Ÿè½½å‡è¡¡ç­‰åˆ™ä¸€æ¦‚ä¸ç®¡ã€‚\n\nè€Œ LoadBalancer Service åˆ™æ˜¯åœ¨ NodePort çš„åŸºç¡€ä¸Šå†åŠ ä¸€ä¸ªä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œç„¶åæŠŠèŠ‚ç‚¹æš´éœ²çš„ç«¯å£æ³¨å†Œåˆ°è¿™ä¸ªè´Ÿè½½å‡è¡¡å™¨ä¸Šã€‚è¿™æ ·ä¸€æ¥ï¼Œé›†ç¾¤å¤–éƒ¨çš„å®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡åŒä¸€ä¸ª IP æ¥è®¿é—®é›†ç¾¤ä¸­çš„åº”ç”¨ã€‚ä½†æ˜¯è¦ä½¿ç”¨ LoadBalancer Service ï¼Œä¸€èˆ¬éœ€è¦å…ˆå®‰è£…äº‘ä¾›åº”å•†æä¾›çš„ Controller ï¼Œæˆ–æ˜¯å®‰è£…å…¶ä»–ç¬¬ä¸‰æ–¹çš„ Controller ï¼ˆæ¯”å¦‚ Nginx Controller ï¼‰ã€‚\n\nåœ¨ Service ä¹‹å¤–è¿˜å¦æœ‰ä¸€ç§èµ„æºç±»å‹å« Ingress ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å®ç°é›†ç¾¤å¤–éƒ¨è®¿é—®é›†ç¾¤å†…éƒ¨åº”ç”¨çš„åŠŸèƒ½ã€‚ Ingress å…¶å®ä¹Ÿä¼šåœ¨é›†ç¾¤å¤–åˆ›å»ºä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œå› æ­¤ä¹Ÿéœ€è¦é¢„å…ˆå®‰è£…äº‘ä¾›åº”å•†çš„ Controller ã€‚ä½† Ingress ä¸ Service ä¸åŒçš„æ˜¯ï¼Œå®ƒè¿˜ä¼šç®¡ç†ä¸€å®šçš„è·¯ç”±é€»è¾‘ï¼Œæ¥æ”¶æµé‡åå¯ä»¥æ ¹æ®è·¯ç”±æ¥åˆ†é…ç»™ä¸åŒçš„ Service ã€‚\n\n| ç±»å‹                 | OSI æ¨¡å‹å·¥ä½œå±‚æ•° | ä¾èµ–äºäº‘å¹³å°æˆ–å…¶ä»–æ’ä»¶ |\n| :------------------- | :--------------- | :--------------------- |\n| NodePort Service     | ç¬¬å››å±‚           | å¦                     |\n| LoadBalancer Service | ç¬¬å››å±‚           | æ˜¯                     |\n| Ingress              | ç¬¬ä¸ƒå±‚           | æ˜¯                     |\n\nç‰¹åˆ«å†è¯¦ç»†è¯´ä¸€ä¸‹ Ingress è¿™ç§èµ„æºã€‚ Ingress æœ¬èº«ä¸ä¼šåœ¨é›†ç¾¤å†…çš„ DNS ä¸Šåˆ›å»ºè®°å½•ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šä¸»åŠ¨å»è·¯ç”±é›†ç¾¤å†…çš„æµé‡ï¼ˆé™¤éä½ åœ¨é›†ç¾¤å†…å¼ºè¡Œè®¿é—® Ingress çš„è´Ÿè½½å‡è¡¡å™¨â€¦â€¦ ä¸è¿‡ä¸€èˆ¬ä¹Ÿæ²¡ä»€ä¹ˆç†ç”±è¦è¿™æ ·åšå¯¹å§ï¼‰ã€‚ä½† Ingress å¯ä»¥æ ¹æ® HTTP çš„ hostname å’Œ path æ¥è·¯ç”±æµé‡ï¼ŒæŠŠæµé‡åˆ†å‘åˆ°ä¸åŒçš„ Service ä¸Šã€‚ Ingress ä¹Ÿæ˜¯ K8s çš„åŸç”Ÿèµ„æºé‡Œå”¯ä¸€èƒ½çœ‹åˆ° OSI ç¬¬ä¸ƒå±‚çš„èµ„æºã€‚\n\nä¸‹é¢æ˜¯ AWS çš„ EKS æœåŠ¡ä¸­éƒ¨ç½²çš„ä¸€ä¸ª Ingress çš„ä¾‹å­ï¼ˆé›†ç¾¤ä¸­å·²å®‰è£… AWS Load Balancer Controller ï¼‰ï¼š\n\n```yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    kubernetes.io/ingress.class: alb\n    alb.ingress.kubernetes.io/scheme: internet-facing\n    alb.ingress.kubernetes.io/target-type: ip\n    alb.ingress.kubernetes.io/backend-protocol-version: GRPC\n    alb.ingress.kubernetes.io/listen-ports: '[{\"HTTPS\":443}]'\n    alb.ingress.kubernetes.io/healthcheck-path: /grpc.health.v1.Health/Check\n    alb.ingress.kubernetes.io/healthcheck-protocol: HTTP\n    alb.ingress.kubernetes.io/success-codes: 0,12\n    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:xxxxxxxxxx:certificate/xxxxxxxxxx\n\n    external-dns.alpha.kubernetes.io/hostname: sample.example.com\n  \n  name: gateway-ingress\nspec:\n  rules:\n  - host: sample.example.com\n    http:\n      paths:\n      - path: /grpc.health.v1.Health\n        pathType: Prefix\n        backend:\n          service:\n            name: health-service\n            port:\n              number: 50051\n      - path: /proto.sample.v1.Sample\n        pathType: Prefix\n        backend:\n          service:\n            name: sample-service\n            port:\n              number: 50051\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œ Ingress èµ„æºå¯ä»¥é€šè¿‡ `spec.rules` å­—æ®µä¸­å®šä¹‰å„æ¡è§„åˆ™ï¼Œé€šè¿‡ hostname æˆ–æ˜¯ path ç­‰ç¬¬ä¸ƒå±‚çš„ä¿¡æ¯æ¥è¿›è¡Œè·¯ç”±ã€‚ Ingress éƒ¨ç½²ä¸‹å»åï¼Œ AWS Load Balancer Controller ä¼šè¯»å–ä¼šæ ¹æ®çš„é…ç½®ï¼Œå¹¶åœ¨äº‘ä¸Šåˆ›å»ºä¸€ä¸ª AWS Application Load Balancer ï¼ˆALBï¼‰ï¼Œè€Œ `spec.rules` ä¼šåº”ç”¨åˆ° ALB ä¸Šï¼Œç”± ALB æ¥è´Ÿè´£æµé‡çš„è·¯ç”±ã€‚\n\næˆ‘ä»¬ä¹Ÿä¼šæ³¨æ„åˆ°ï¼Œæ€ä¹ˆ `metadata.annotations` é‡Œæœ‰è¿™ä¹ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„å­—æ®µï¼ Ingress æœ¬èº«çš„åŠŸèƒ½éƒ½æ˜¯ AWS Load Balancer Controller è°ƒç”¨ AWS çš„ API åˆ›å»º ALB æ¥å®ç°çš„ã€‚ä½† AWS çš„ ALB èƒ½å®ç°çš„åŠŸèƒ½å¯ä¸æ­¢ Ingress å­—æ®µå®šä¹‰çš„è¿™äº›ï¼Œæ¯”å¦‚å®‰è£… TLS è¯ä¹¦ã€ health check ç­‰ spec å­—æ®µä¸­æè¿°ä¸ä¸‹çš„åŠŸèƒ½ï¼Œå°±åªèƒ½æ˜¯é€šè¿‡ annotation çš„å½¢å¼æ¥å®šä¹‰äº†ã€‚\n\n> å°å½©è›‹ï¼šå¯ä»¥çœ‹åˆ°ä¾‹å­ä¸­çš„ Ingress èµ„æº annotation å­—æ®µé‡Œè¿˜æœ‰ä¸€è¡Œ `external-dns.alpha.kubernetes.io/hostname: sample.example.com` ã€‚å…¶å®è¿™ä¸ª K8s é›†ç¾¤ä¸­è¿˜å®‰è£…äº† external-dns è¿™ä¸ªåº”ç”¨ï¼Œå®ƒå¯ä»¥æ ¹æ® annotation æ¥åœ¨å¤–éƒ¨ DNS ä¸Šç›´æ¥åˆ›å»º DNS è®°å½•ï¼æœ‰äº†è¿™ä¸ªæ’ä»¶æˆ‘ä»¬å¯ä¸ç”¨å†æ…¢æ…¢æ‰“å¼€å…¬å…± DNS ç®¡ç†é¡µé¢ï¼Œå†å°å¿ƒç¿¼ç¿¼åœ°è®°ä¸‹ IP åœ°å€å»æ·»åŠ  A è®°å½•äº†ã€‚\n\n# æ›´é«˜çº§çš„éƒ¨ç½²æ–¹å¼ï¼ˆä¸€ï¼‰\n\nä¸€è·¯è¯´é“è¿™é‡Œï¼Œ K8s ä¸­æœ€åŸºç¡€çš„èµ„æºå¤§éƒ¨åˆ†éƒ½å·²ç»ä»‹ç»äº†ã€‚ä½†æ˜¯ï¼Œè¿™ä¹ˆå¤šèµ„æºä¹‹é—´åˆéœ€è¦ç›¸äº’é…åˆï¼Œåªéƒ¨ç½²ä¸€ç§èµ„æºåŸºæœ¬æ²¡ä»€ä¹ˆç”Ÿäº§èƒ½åŠ›ã€‚\n\næ¯”å¦‚åªéƒ¨ç½² Deployment çš„è¯ï¼Œæˆ‘ä»¬ç¡®å®æ˜¯èƒ½åœ¨ä¸€ç»„å¤šå‰¯æœ¬çš„ Pod é‡Œè·‘èµ·å¯æ‰§è¡Œç¨‹åºï¼Œä½†è¿™ç»„ Pod å´å‡ ä¹æ²¡åŠæ³•æ¥å—é›†ç¾¤é‡Œå…¶ä»– Pod çš„æµé‡ï¼ˆåªèƒ½é€šè¿‡åˆ¶å®š Pod çš„ IP æ¥è®¿é—®ï¼Œä½† Pod çš„ IP æ˜¯ä¼šå˜çš„ï¼‰ã€‚å› æ­¤ä¸€èˆ¬æ¥è¯´ä¸€ä¸ª Deployment éƒ½ä¼šæ­é…ä¸€ä¸ª Service æ¥ä½¿ç”¨ã€‚è¿™è¿˜æ˜¯æœ€ç®€å•çš„ä¸€ç§æ­é…äº†ã€‚\n\nå‡è‹¥æˆ‘ä»¬ç°åœ¨è¦åœ¨è‡ªå·±çš„ K8s é‡Œå®‰è£…ä¸€ä¸ªåˆ«äººæä¾›çš„åº”ç”¨ã€‚å½“ç„¶ç”±äº K8s æ˜¯åŸºäºå®¹å™¨çš„ï¼Œåªè¦åˆ«äººæä¾›äº†ä»–åº”ç”¨çš„ yaml æ¸…å•ï¼Œæˆ‘ä»¬åªç”¨æŠŠæ¸…å•ç”¨ `kubectl apply -f` æäº¤ç»™ K8s ï¼Œç„¶åè®© K8s æŠŠæ¸…å•ä¸­çš„é•œåƒæ‹‰ä¸‹æ¥å°±èƒ½è·‘äº†ã€‚å¯å¦‚æœæˆ‘ä»¬éœ€è¦æ ¹æ®ç¯å¢ƒæ¥æ”¹ä¸€äº›å‚æ•°å‘¢ï¼Ÿ\n\nå¦‚æœåˆ«äººæä¾›çš„ yaml æ–‡ä»¶æ¯”è¾ƒç®€å•è¿˜å¥½è¯´ï¼Œæ”¹æ”¹å¯¹åº”çš„å­—æ®µå°±å¥½äº†ã€‚å¦‚æœåˆ«äººçš„åº”ç”¨æ¯”è¾ƒå¤æ‚ï¼Œé‚£æ”¹ yaml æ–‡ä»¶å¯å°±æ˜¯ä¸€ä¸ªå¤§éš¾é¢˜äº†ã€‚æ¯”å¦‚ AWS çš„ Load Balancer Controller ï¼Œå®ƒçš„ yaml æ¸…å•æ–‡ä»¶å¯æ˜¯å¤šè¾¾ 939 è¡Œï¼\n\n[[aws-elb-controller-lines.png]]\n\nåœ¨è¿™ç§å¤æ‚çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€äº›æ›´é«˜çº§çš„éƒ¨ç½²æ–¹å¼äº†ã€‚\n\n### Helm\n\né¦–å…ˆæ¥ä»‹ç»çš„æ˜¯ Helm ã€‚ Helm æ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç±»æ¯”ä¸€ä¸‹ CentOS ä¸­çš„ yum å·¥å…·ã€‚å®ƒå¯ä»¥æŠŠä¸€ç»„ K8s èµ„æºå‘å¸ƒæˆä¸€ä¸ª Chart ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ç”¨ Helm æ¥å®‰è£…è¿™ä¸ª Chart ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å‚æ•°è®¾å€¼æ¥æ”¹å˜ Chart ä¸­çš„éƒ¨åˆ†èµ„æºã€‚åˆ©ç”¨ Helm å®‰è£… Chart åè¿˜å¯ä»¥ç®¡ç† Chart çš„å‡çº§ã€å›æ»šã€å¸è½½ã€‚\n\nä½¿ç”¨åˆ«äººæä¾›çš„ Helm Chart å‰ï¼Œéœ€è¦å…ˆ add ä¸€ä¸‹ Chart çš„ä»“åº“ï¼Œç„¶åå†å®‰è£…ä»“åº“é‡Œæä¾›çš„ Chart ã€‚æ¯”å¦‚æˆ‘ä»¬è¦å®‰è£… bitnami æä¾›çš„ Kafka Chart æ—¶ï¼š\n\n```bash\n# æ·»åŠ  https://charts.bitnami.com/bitnami è¿™ä¸ªä»“åº“ï¼Œå‘½åä¸º bitnami\nhelm repo add bitnami https://charts.bitnami.com/bitnami\n\n# åœ¨ kafka åç§°ç©ºé—´é‡Œå®‰è£… bitnami ä»“åº“é‡Œçš„ kafka Chart ï¼Œå¹¶é€šè¿‡å‚æ•°è®¾ç½®ä¸º 3 ä¸ªå‰¯æœ¬ï¼Œå¹¶åŒæ—¶å®‰è£…ä¸€ä¸ª 3 å‰¯æœ¬çš„ Zookeeper\nhelm install kafka -n kafka \\\n  --set replicaCount=3 \\\n  --set zookeeper.enabled=true \\\n  --set zookeeper.replicaCount=3 \\\n  bitnami/kafka\n```\n\nå‘½ä»¤æ‰§è¡Œåï¼Œ helm å°±ä¼šæ ¹æ®å‚æ•°ä¸ Chart çš„å†…å®¹ï¼Œåœ¨ K8s é‡Œå®‰è£… StatefulSet ã€ Service ã€ ConfigMap ç­‰ä¸€åˆ‡æ‰€éœ€è¦çš„èµ„æºã€‚\n\n```sh\n$ k -n kafka get all,cm\nNAME                    READY   STATUS    RESTARTS      AGE\npod/kafka-0             1/1     Running   1             46d\npod/kafka-1             1/1     Running   3             46d\npod/kafka-2             1/1     Running   3             46d\npod/kafka-zookeeper-0   1/1     Running   0             46d\npod/kafka-zookeeper-1   1/1     Running   0             46d\npod/kafka-zookeeper-2   1/1     Running   0             46d\n\nNAME                               TYPE           CLUSTER-IP       EXTERNAL-IP      PORT(S)                      AGE\nservice/kafka                      ClusterIP      172.20.1.196     <none>           9092/TCP                     164d\nservice/kafka-headless             ClusterIP      None             <none>           9092/TCP,9093/TCP            164d\nservice/kafka-zookeeper            ClusterIP      172.20.227.236   <none>           2181/TCP,2888/TCP,3888/TCP   164d\nservice/kafka-zookeeper-headless   ClusterIP      None             <none>           2181/TCP,2888/TCP,3888/TCP   164d\n\nNAME                               READY   AGE\nstatefulset.apps/kafka             3/3     164d\nstatefulset.apps/kafka-zookeeper   3/3     164d\n\nNAME                                DATA   AGE\nconfigmap/kafka-scripts             2      164d\nconfigmap/kafka-zookeeper-scripts   2      164d\nconfigmap/kube-root-ca.crt          1      165d\n```\n\nç”šè‡³ï¼Œ Helm å¯ä»¥é€šè¿‡æ¨¡æ¿ç”Ÿæˆçš„ Pod ç¯å¢ƒå˜é‡ï¼Œæ¥é¢„å…ˆè®¾ç½®å¥½ Kafka çš„é…ç½®ï¼Œè®©ä»–æ‰¾å¾—åˆ° Zookeeper æœåŠ¡ï¼š\n\n```yaml\napiVersion: v1\nkind: Pod\n# ç•¥å»æ— å…³ä¿¡æ¯\nspec:\n  containers:\n  - name: kafka\n    command:\n    - /scripts/setup.sh\n    env:\n    - name: KAFKA_CFG_ZOOKEEPER_CONNECT\n      value: kafka-zookeeper\n    # ...\n```\n\né€šè¿‡è®¾ç½® `KAFKA_CFG_ZOOKEEPER_CONNECT` è¿™ä¸ªç¯å¢ƒå˜é‡ï¼ŒæŒ‡å®šäº† Kafka Broker å¯ä»¥é€šè¿‡è®¿é—® `kafka-zookeeper` æ¥æ‰¾åˆ° zookeeper æœåŠ¡ã€‚ï¼ˆè¿˜è®°å¾— zookeeper çš„ Service åå­—æ˜¯ `kafka-zookeeper` å—ï¼Ÿ zookeeper ä¸ kafka éƒ¨ç½²åœ¨åŒä¸€ä¸ªåç§°ç©ºé—´é‡Œï¼Œå› æ­¤å¯ä»¥ç›´æ¥é€šè¿‡ Service åè®¿é—®ã€‚ï¼‰\n\nå¦‚æœæˆ‘ä»¬æ‰“å¼€è¿™ä¸ª helm chart å¯¹åº”çš„[ä»£ç ä»“åº“](https://github.com/bitnami/charts/tree/master/bitnami/kafka)ï¼Œä¼šå‘ç°åŸæ¥æœ‰ä¸€ç»„ go template æ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ª `values.yaml` æ–‡ä»¶å’Œ `Chart.yaml` æ–‡ä»¶ï¼š\n\n```sh\n.\nâ”œâ”€â”€ Chart.lock\nâ”œâ”€â”€ Chart.yaml\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ templates\nâ”‚   â”œâ”€â”€ NOTES.txt # è¿™é‡Œå®šä¹‰çš„æ˜¯ helm å·¥å…·çš„å‘½ä»¤è¡Œä¿¡æ¯\nâ”‚   â”œâ”€â”€ _helpers.tpl # è¿™é‡Œé¢æ˜¯ä¸€äº›å®šä¹‰å¥½çš„ go template ä»£ç å—å¯ä»¥ä¾›å…¶ä»–æ¨¡æ¿ä½¿ç”¨\nâ”‚   â”œâ”€â”€ configmap.yaml\nâ”‚   â”œâ”€â”€ statefulset.yaml\nâ”‚   â”œâ”€â”€ svc-headless.yaml\nâ”‚   â”œâ”€â”€ svc.yaml\nâ”‚   â””â”€â”€ # ä»¥ä¸‹çœç•¥è‹¥å¹²æ¨¡æ¿æ–‡ä»¶\nâ””â”€â”€ values.yaml\n```\n\n- `Chart.yaml` ä¸­å®šä¹‰äº†è¿™ä¸ª Chart çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ã€ç‰ˆæœ¬ã€æè¿°ã€ä¾èµ–ç­‰ã€‚\n- `values.yaml` ä¸­å®šä¹‰äº†è¿™ä¸ª Chart çš„é»˜è®¤å‚æ•°ï¼ŒåŒ…æ‹¬å„ç§èµ„æºçš„é»˜è®¤é…ç½®ã€å‰¯æœ¬æ•°é‡ã€é•œåƒç‰ˆæœ¬ç­‰ã€‚å…¶ä¸­çš„å€¼éƒ½å¯ä»¥é€šè¿‡ `helm install` å‘½ä»¤çš„ `--set` å‚æ•°æ¥è¦†ç›–ã€‚\n- `templates/` æ–‡ä»¶å¤¹ä¸‹çš„éƒ½æ˜¯ go template çš„æ¨¡æ¿æ–‡ä»¶ã€‚\n\n`helm install` å°±æ˜¯é€šè¿‡ç”¨ `values.yaml` ä¸­é¢„å®šä¹‰çš„å‚æ•°ï¼Œæ¸²æŸ“ `templates/` æ–‡ä»¶å¤¹ä¸‹çš„ go template æ–‡ä»¶ï¼Œç”Ÿæˆæœ€ç»ˆçš„ yaml æ–‡ä»¶ï¼Œç„¶åå†é€šè¿‡ kubectl apply -f çš„æ–¹å¼ï¼Œå°† yaml æ–‡ä»¶é‡Œçš„èµ„æºéƒ¨ç½²åˆ° K8s é‡Œã€‚ç„¶åé€šè¿‡å¿˜èµ„æºé‡Œæ³¨å…¥ä¸€äº›ç‰¹æ®Š annotation çš„æ–¹å¼æ¥è®°ä½è‡ªå·±éƒ¨ç½²äº†é‚£äº›èµ„æºï¼Œè¿›è€Œæä¾› `update` ã€ `uninstall` ç­‰åŠŸèƒ½ã€‚\n\nå…³äºæ›´å¤š Helm çš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://helm.sh/docs/)ã€‚\n\n### Kustomize\n\nå¦ä¸€ä¸ªéƒ¨ç½²å·¥å…·æ˜¯ Kustomize ã€‚ä¹‹å‰æåˆ° Config Map æ—¶çš„ä¾‹å­ä¸­ï¼Œå°†é…ç½®æ–‡ä»¶çš„å†…å®¹ç›´æ¥å†™è¿›äº† yaml æ¸…å•çš„ä¸€ä¸ªå­—æ®µé‡Œï¼š\n\n```yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: game-demo\ndata:\n  # ä¸€ä¸ª Key å¯ä»¥å¯¹åº”ä¸€ä¸ªå€¼\n  player_initial_lives: \"3\"\n  ui_properties_file_name: \"user-interface.properties\"\n\n  # ä¸€ä¸ª Key ä¹Ÿå¯ä»¥å¯¹åº”ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹\n  game.properties: |\n    enemy.types=aliens,monsters\n    player.maximum-lives=5    \n  user-interface.properties: |\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true    \n```\n\nå…¶å®è¿™æ ·å¾ˆä¸å¥½ï¼Œå…ˆä¸è¯´è¿™æ ·å†™æ²¡åŠæ³•åœ¨ IDE é‡Œç”¨é…ç½®æ–‡ä»¶è‡ªå·±çš„è¯­æ³•æ£€æŸ¥ï¼Œæ¯è¡Œè¿˜éœ€è¦ä¸€å®šçš„ç¼©è¿›ï¼Œå¦‚æœé…ç½®æ–‡ä»¶æœ‰å¥½å‡ ç™¾è¡Œï¼Œä½ ç”šè‡³ä¼šå¿˜äº†è¿™ä¸€è¡Œåˆ°åº•æ˜¯å“ªä¸ªé…ç½®æ–‡ä»¶ï¼æ­¤æ—¶æˆ‘ä»¬å°±ä¼šè‡ªç„¶è€Œç„¶çš„æƒ³æŠŠæ¯ä¸ªé…ç½®æ–‡ä»¶ä»¥å•ç‹¬æ–‡ä»¶çš„å½¢å¼ä¿å­˜ã€‚\n\nKustomize å°±æ˜¯è¿™æ ·ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠæ¯ä¸ªé…ç½®æ–‡ä»¶ä»¥å•ç‹¬æ–‡ä»¶çš„å½¢å¼ä¿å­˜ï¼Œç„¶åå†é€šè¿‡ä¸€ä¸ª `kustomization.yaml` æ–‡ä»¶ï¼Œå°†è¿™äº›é…ç½®æ–‡ä»¶ç»„åˆèµ·æ¥ï¼Œç”Ÿæˆæœ€ç»ˆçš„ yaml æ–‡ä»¶ã€‚\n\n```yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\nresources:\n  # å…¶ä»–èµ„æºä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶å®šä¹‰\n  - deployment.yaml\n\n# ç”¨ configMapGenerator ä»æ–‡ä»¶ä¸­ç”Ÿæˆ ConfigMap\nconfigMapGenerator:\n  - name: game-demo\n    literals:\n      - \"ui_properties_file_name=user-interface.properties\"\n      - \"player_initial_lives=3\"\n    # ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹\n    files:\n      - game.properties\n      - user-interface.properties\n# æœ‰å¤šä¸ª configMap æ—¶ï¼Œå¯ä»¥é€šè¿‡ç»Ÿä¸€çš„ generatorOptions æ¥è®¾ç½®ä¸€äº›é€šç”¨çš„é€‰é¡¹\ngeneratorOptions:\n  disableNameSuffixHash: true\n```\n\nç„¶åä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„å†…å®¹å¯ä»¥å•ç‹¬ç”¨æ–‡ä»¶å®šä¹‰ï¼Œæ­¤æ—¶å¯ä»¥ç»“åˆ IDE çš„è¯­æ³•æ£€æŸ¥ï¼Œä»¥åŠä»£ç è¡¥å…¨åŠŸèƒ½ï¼Œæ¥ç¼–å†™é…ç½®æ–‡ä»¶ã€‚\n\n```properties\n# user-interface.properties\ncolor.good=purple\ncolor.bad=yellow\nallow.textmode=true    \n```\n\nç„¶åå°† `kustomization.yaml` å’Œå…¶ä»–æ‰€éœ€çš„æ–‡ä»¶éƒ½æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼š\n\n```bash\n.\nâ”œâ”€â”€ kustomization.yaml\nâ”œâ”€â”€ deployment.yaml\nâ”œâ”€â”€ game.properties\nâ””â”€â”€ user-interface.properties\n```\n\nç„¶åå°±å¯ä»¥é€šè¿‡ `kubectl apply -k ./` æ¥å°†æ•´ä¸ª kustomize æ–‡ä»¶å¤¹è½¬æ¢ä¸º yaml æ¸…å•ç›´æ¥éƒ¨ç½²åˆ° K8s ä¸­ã€‚\nï¼ˆæ²¡é”™ï¼Œç°åœ¨ Kustomize å·²ç»æˆä¸º kubectl ä¸­çš„å†…ç½®åŠŸèƒ½ï¼å¯ä»¥ä¸ç”¨å…ˆ `kustomize build` ç”Ÿæˆ yaml æ–‡ä»¶å† `kubectl apply` ä¸¤æ­¥èµ°äº†ï¼ï¼‰\n\nå€¼å¾—æé†’çš„æ˜¯ï¼Œè™½ç„¶ `kustomization.yaml` æœ‰ `apiVersion` å’Œ `kind` å­—æ®µï¼Œé•¿å¾—å¾ˆåƒä¸€ä¸ªèµ„æºæ¸…å•ï¼Œä½†å…¶å® K8s çš„ API server å¹¶ä¸è®¤è¯†ä»–ã€‚ Kustomize çš„å·¥ä½œåŸç†å…¶å®æ˜¯å…ˆæ ¹æ® `kustomization.yaml` ç”Ÿæˆ K8s è®¤è¯†çš„ yaml èµ„æºæ¸…å•ï¼Œç„¶åå†é€šè¿‡ `kubectl apply` æ¥éƒ¨ç½²ã€‚\n\né™¤äº†å¯ä»¥ç›´æ¥å°† ConfigMap ä¸ Secret ä¸­çš„æ–‡ä»¶å­—æ®µå†…å®¹ç”¨å•ç‹¬çš„æ–‡ä»¶å®šä¹‰å¤–ï¼Œ Kustomize è¿˜æœ‰å…¶ä»–æ¯”å¦‚ä¸ºéƒ¨ç½²çš„èµ„æºæ·»åŠ ç»Ÿä¸€çš„åç§°å‰ç¼€ã€æ·»åŠ ç»Ÿä¸€å­—æ®µç­‰åŠŸèƒ½ã€‚è¿™äº›å¤§å®¶å¯ä»¥é˜…è¯» Kustomize çš„[å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/)æ¥äº†è§£ã€‚\n\n### å„ç§å·¥å…·çš„ä¼˜ç¼ºç‚¹\n\næˆ‘ä»¬ç›®å‰å·²ç»çŸ¥é“æœ‰ä¸‰ç§åœ¨ K8s ä¸­éƒ¨ç½²èµ„æºçš„æ–¹å¼ï¼š `kubectl apply`ã€Helm å’Œ Kustomize ã€‚\n\nå…¶ä¸­ `kubectl apply` çš„ä¼˜ç¼ºç‚¹å¾ˆæ˜ç¡®ï¼Œä¼˜ç‚¹æ˜¯æœ€ç®€å•ç›´æ¥ï¼Œç¼ºç‚¹æ˜¯ä¼šå¯¼è‡´è¦ä¹ˆ yaml æ¸…å•è¿‡é•¿ï¼Œè¦ä¹ˆéœ€è¦åˆ†å¤šæ–‡ä»¶å¤šæ¬¡éƒ¨ç½²ï¼Œä½¿é›†ç¾¤ä¸­äº§ç”Ÿä¸­é—´çŠ¶æ€ã€‚\n\nè€Œ Helm ä¸ Kustomize æˆ‘ä»¬ä¸Šé¢ä¹Ÿåˆ†æè¿‡ï¼Œå…¶å®éƒ½æ˜¯åŸºäº `kubectl apply` çš„ã€‚ Helm æ˜¯é€šè¿‡ go template å…ˆç”Ÿæˆ yaml æ–‡ä»¶å† `kubectl apply` ï¼Œè€Œ Kustomize æ˜¯é€šè¿‡ `kustomization.yaml` ä¸­çš„å®šä¹‰ç”¨è‡ªå·±çš„ä¸€å¥—é€»è¾‘ç”Ÿæˆ yaml æ–‡ä»¶ï¼Œç„¶åå† `kubectl apply` ã€‚\n\nHelm çš„ä¼˜ç‚¹æ˜¯ Helm Chart å®‰è£…æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ«äºº Helm ä»“åº“ä¸­å·²ç»ä¸Šä¼ å¥½çš„ Chart ï¼Œåªéœ€è¦è®¾ç½®å‚æ•°å°±å¯ä»¥ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯ Kustomize çš„ç¼ºç‚¹ï¼šå¦‚æœæƒ³è¦ä½¿ç”¨åˆ«äººæä¾›çš„ Kustomization è€Œåªä¿®æ”¹å…¶ä¸­çš„ä¸€äº›é…ç½®ï¼Œå¿…é¡»è¦å…ˆæŠŠæ”¾ `kustomization.yaml` çš„æ•´ä¸ªæ–‡ä»¶å¤¹ä¸‹è½½ä¸‹æ¥æ‰èƒ½åšä¿®æ”¹ã€‚\n\nè€Œ Helm çš„ç¼ºç‚¹ä¹Ÿæ˜¯æ˜æ˜¾çš„ï¼Œ Helm ä¾èµ–äºå¾€èµ„æºé‡Œæ³¨å…¥ç‰¹æ®Šçš„ annotation æ¥ç®¡ç† Chart ç”Ÿæˆçš„èµ„æºï¼Œè¿™å¯èƒ½ä¼šå¾ˆéš¾ä¸é›†ç¾¤ä¸­ç°æœ‰çš„ä¸€äº›ç³»ç»Ÿï¼ˆæ¯”å¦‚ Service Mesh æˆ–æ˜¯ GitOps ç³»ç»Ÿç­‰ï¼‰æ”¾ä¸€èµ·ç®¡ç†ã€‚è€Œ Kustomize ç”Ÿæˆçš„ yaml æ¸…å•å°±æ˜¯å¾ˆå¹²å‡€çš„ K8s èµ„æºï¼ŒåŸå…ˆçš„ K8s èµ„æºè¯¥æ˜¯ä»€ä¹ˆè¡¨ç°å°±æ˜¯ä»€ä¹ˆè¡¨ç°ï¼Œä¸ç°æœ‰çš„ç³»ç»Ÿå…¼å®¹ä¸€èˆ¬ä¼šæ¯”è¾ƒå¥½ã€‚\n\nè€Œå¦å¤–ï¼Œç”±äº Helm ä¸ Kustomize éƒ½æ˜¯åŸºäº `kubectl apply` çš„ï¼Œå› æ­¤ä»–ä»¬æœ‰å…±åŒçš„ç¼ºç‚¹ï¼Œå°±æ˜¯ä¸èƒ½åš `kubectl apply` ä¸èƒ½åšçš„äº‹æƒ…ã€‚\n\nä»€ä¹ˆå« `kubectl apply` ä¸èƒ½åšçš„äº‹æƒ…å‘¢ï¼Ÿæ¯”å¦‚è¯´æˆ‘ä»¬è¦åœ¨ K8s ä¸­éƒ¨ç½² Redis é›†ç¾¤ã€‚èªæ˜çš„ä½ å¯èƒ½å°±æƒ³åˆ°è¦ç”¨ Stateful Set ã€ PVC ã€ Headless Service æ¥ä¸€å¥—ç»„åˆæ‹³ã€‚è¿™ç¡®å®å¯ä»¥éƒ¨ç½²ä¸€ä¸ªå¤šèŠ‚ç‚¹ã€æœ‰çŠ¶æ€çš„ Redis Cluster ã€‚å¯æ˜¯å¦‚æœæˆ‘ä»¬è¦å¾€ Redis Cluster é‡ŒåŠ ä¸€ä¸ªèŠ‚ç‚¹å‘¢ï¼Ÿ\n\nä½ å½“ç„¶å¯ä»¥æŠŠ Stateful Set ä¸­çš„ `Replicas` å­—æ®µåŠ ä¸ª 1 ç„¶åç”¨ `kubectl apply` éƒ¨ç½²ï¼Œå¯æ˜¯è¿™å®é™…ä¸Šåªèƒ½å¢åŠ ä¸€ä¸ªä¸€ä¸ª Redis å®ä¾‹ â€”â€” ç„¶åä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿã€‚å…¶ä»–èŠ‚ç‚¹ä¸è®¤è¯†è¿™ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œè®¿é—®è¿™ä¸ªæ–°èŠ‚ç‚¹ä¹Ÿä¸èƒ½æ‹¿åˆ°æ­£ç¡®çš„æ•°æ®ã€‚è¦çŸ¥é“å¾€ Redis Cluster é‡ŒåŠ èŠ‚ç‚¹ï¼Œæ˜¯è¦å…ˆè®©é›†ç¾¤å‘ç°è¿™ä¸ªæ–°èŠ‚ç‚¹ï¼Œç„¶åè¿˜è¦è¿ç§» slot çš„ï¼ `kubectl apply` å¯ä¸ä¼šåšè¿™äº›äº‹ã€‚\n\n> Well, å…¶å®è¿™äº›ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å¢åŠ  initContainer ã€ä¿®æ”¹é•œåƒå¢åŠ å¯åŠ¨è„šæœ¬ç­‰æ–¹å¼ï¼Œå®ç°ç”¨ `kubectl apply` éƒ¨ç½²çš„ã€‚å¯æ˜¯ï¼Œè¿™ä¼šè®©æ•´ä¸ª Pod èµ„æºå˜å¾—å¾ˆéš¾ç†è§£ï¼Œä¹Ÿä¸å¥½ç»´æŠ¤ã€‚è€Œä¸”ï¼Œå¦‚æœä¸æ˜¯å› ä¸ºåšä¸åˆ°ï¼Œè°ä¼šæƒ³å»ä¿®æ”¹åˆ«äººçš„é•œåƒå‘¢ï¼Ÿ\n\næˆ‘ä»¬æ¥ä¸‹æ¥ä¼šä»‹ç» K8s çš„æ ¸å¿ƒæ¶æ„ï¼Œæ¥ç†è§£æˆ‘ä»¬ä¹‹å‰è®²çš„è¿™äº›èµ„æºåˆ°åº•æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚æœ€åä¼šå¼•å‡ºä¸€ç»„æ–°çš„æ¦‚å¿µï¼š Operator ä¸è‡ªå®šä¹‰èµ„æºï¼ˆ Custom Resource Definition ï¼Œç®€ç§° CRD ï¼‰ã€‚é€šè¿‡ Operator ä¸ CRD ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ° `kubectl apply` æ‰€ä¸èƒ½åšåˆ°çš„äº‹ï¼ŒåŒ…æ‹¬ Redis Cluster çš„æ‰©å®¹ã€‚\n\n> DIO: `kubectl apply` çš„èƒ½åŠ›æ˜¯æœ‰é™çš„â€¦â€¦\n> è¶Šæ˜¯éƒ¨ç½²å¤æ‚çš„åº”ç”¨ï¼Œå°±è¶Šä¼šå‘ç° `kubectl apply` çš„èƒ½åŠ›æ˜¯æœ‰æé™çš„â€¦â€¦é™¤éè¶…è¶Š `kubectl apply` ã€‚\n> \n> JOJO: ä½ åˆ°åº•æƒ³è¯´ä»€ä¹ˆï¼Ÿ\n> \n> DIO: æˆ‘ä¸ç”¨ `kubectl apply` äº†ï¼ JOJO ï¼\n> ï¼ˆå…¶å®è¿˜æ˜¯è¦ç”¨çš„ï¼‰\n\n","title":"Kubernetes å…¥é—¨ ï¼ˆ2ï¼‰","abstract":"æˆ‘ä»¬ä¹‹å‰è¯´çš„éƒ½æ˜¯ç”¨äºéƒ¨ç½² Pod çš„èµ„æºï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä»‹ç»ä¸åˆ›å»º Pod ä¸ç›¸å…³çš„èµ„æºï¼šå‚¨å­˜ä¸ç½‘ç»œã€‚\nå…¶å®æˆ‘ä»¬ä¹‹å‰å·²ç»æ¥è§¦è¿‡å‚¨å­˜ç›¸å…³çš„å†…å®¹äº†ï¼šåœ¨è®² Stateful Set æ—¶æˆ‘ä»¬æè¿‡ Stateful Set åˆ›å»ºå‡ºæ¥çš„ Pod éƒ½ä¼šæœ‰ç›¸äº’ç‹¬ç«‹çš„å‚¨å­˜ï¼›è€Œè®² Daemon Set æ—¶æˆ‘ä»¬æåˆ° K8s æ¨èåªåœ¨ Daemon Set çš„ Pod ä¸­è®¿é—®å®¿ä¸»æœºç£ç›˜ã€‚ä½†ç‹¬ç«‹çš„å‚¨å­˜å…·ä½“æŒ‡ä»€ä¹ˆï¼Ÿé™¤äº†è®¿é—®å®¿ä¸»æœºç£ç›˜ä»¥å¤–è¿˜æœ‰ä»€ä¹ˆå…¶ä»–çš„å‚¨å­˜ï¼Ÿ\nåœ¨ Docker ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®¿ä¸»æœºç£ç›˜ä¸Šçš„ä¸€ä¸ªè·¯å¾„ä½œä¸ºä¸€ä¸ª Volume æ¥ç»™å®¹å™¨ç»‘å®šï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ Docker Engine ç®¡ç†çš„ Volume æ¥æä¾›æŒä¹…åŒ–å­˜å‚¨æˆ–æ˜¯å®¹å™¨é—´å…±äº«æ–‡ä»¶ã€‚åœ¨ K8s é‡Œé¢ä¹Ÿæ²¿ç”¨äº† Volume è¿™ä¸ªæ¦‚å¿µï¼Œå¯ä»¥é€šè¿‡ Mount ç»‘å®šåˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œå¹¶é€šè¿‡å®ç° CSI çš„å„ç§å¼•æ“æ¥æä¾›æ›´å¤šæ ·çš„å­˜å‚¨ã€‚","length":875,"created_at":"2022-08-20T21:56:52.000Z","updated_at":"2022-08-20T14:02:18.000Z","tags":["Kubernetes","DevOps","Docker","Cloud Native"],"license":true}}}},"__N_SSG":true}