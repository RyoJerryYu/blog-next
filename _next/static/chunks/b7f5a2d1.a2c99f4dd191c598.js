"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2109],{57214:(r,e,s)=>{s.d(e,{A:()=>C});var t=s(61926),o=s(30856),i=s(53885),n=s(51412),a=s(66385),c=s(89686),u=s(35921),d=s(3712);n.A.Geometry={},t.A.extend(n.A.Geometry,{angle:function(r,e,s){var o,i,n,a,c=[],u=[],d=[];return t.A.deprecated("Geometry.angle()","Geometry.rad()"),r.coords?(c[0]=r.coords.usrCoords[1],c[1]=r.coords.usrCoords[2]):(c[0]=r[0],c[1]=r[1]),e.coords?(u[0]=e.coords.usrCoords[1],u[1]=e.coords.usrCoords[2]):(u[0]=e[0],u[1]=e[1]),s.coords?(d[0]=s.coords.usrCoords[1],d[1]=s.coords.usrCoords[2]):(d[0]=s[0],d[1]=s[1]),o=c[0]-u[0],i=c[1]-u[1],n=d[0]-u[0],Math.atan2(o*(a=d[1]-u[1])-i*n,o*n+i*a)},trueAngle:function(r,e,s){return 57.29577951308232*this.rad(r,e,s)},rad:function(r,e,s){var t,o,i,n,a,c,u;return r.coords?(t=r.coords.usrCoords[1],o=r.coords.usrCoords[2]):(t=r[0],o=r[1]),e.coords?(i=e.coords.usrCoords[1],n=e.coords.usrCoords[2]):(i=e[0],n=e[1]),s.coords?(a=s.coords.usrCoords[1],c=s.coords.usrCoords[2]):(a=s[0],c=s[1]),(u=Math.atan2(c-n,a-i)-Math.atan2(o-n,t-i))<0&&(u+=6.283185307179586),u},angleBisector:function(r,e,s,t){var n,a,c,d,C,A=r.coords.usrCoords,h=e.coords.usrCoords,l=s.coords.usrCoords;return(u.A.exists(t)||(t=r.board),0===h[0])?new i.A(o.A.COORDS_BY_USER,[1,(A[1]+l[1])*.5,(A[2]+l[2])*.5],t):(d=A[1]-h[1],n=Math.atan2(C=A[2]-h[2],d),d=l[1]-h[1],c=(n+(a=Math.atan2(C=l[2]-h[2],d)))*.5,n>a&&(c+=Math.PI),d=Math.cos(c)+h[1],C=Math.sin(c)+h[2],new i.A(o.A.COORDS_BY_USER,[1,d,C],t))},reflection:function(r,e,s){var t,n,a,c,d,C,A=e.coords.usrCoords,h=r.point1.coords.usrCoords,l=r.point2.coords.usrCoords;return u.A.exists(s)||(s=e.board),c=l[1]-h[1],d=l[2]-h[2],t=A[1]-h[1],C=(c*(A[2]-h[2])-d*t)/(c*c+d*d),n=A[1]+2*C*d,a=A[2]-2*C*c,new i.A(o.A.COORDS_BY_USER,[n,a],s)},rotation:function(r,e,s,t){var n,a,c,d,C,A,h=e.coords.usrCoords,l=r.coords.usrCoords;return u.A.exists(t)||(t=e.board),n=h[1]-l[1],a=h[2]-l[2],C=n*(c=Math.cos(s))-a*(d=Math.sin(s))+l[1],A=n*d+a*c+l[2],new i.A(o.A.COORDS_BY_USER,[C,A],t)},perpendicular:function(r,e,s){var t,a,c,d,C,A=r.point1.coords.usrCoords,h=r.point2.coords.usrCoords,l=e.coords.usrCoords;return u.A.exists(s)||(s=e.board),e===r.point1?(t=A[1]+h[2]-A[2],a=A[2]-h[1]+A[1],Math.abs(C=A[0]*h[0])<n.A.eps&&(t=h[2],a=-h[1]),d=[C,t,a],c=!0):e===r.point2?(t=h[1]+A[2]-h[2],a=h[2]-A[1]+h[1],Math.abs(C=A[0]*h[0])<n.A.eps&&(t=A[2],a=-A[1]),d=[C,t,a],c=!1):Math.abs(n.A.innerProduct(l,r.stdform,3))<n.A.eps?(t=l[1]+h[2]-l[2],a=l[2]-h[1]+l[1],Math.abs(C=h[0])<n.A.eps&&(t=h[2],a=-h[1]),c=!0,Math.abs(C)>n.A.eps&&Math.abs(t-l[1])<n.A.eps&&Math.abs(a-l[2])<n.A.eps&&(t=l[1]+A[2]-l[2],a=l[2]-A[1]+l[1],c=!1),d=[C,t,a]):(d=[0,r.stdform[1],r.stdform[2]],d=n.A.crossProduct(d,l),d=n.A.crossProduct(d,r.stdform),c=!0),[new i.A(o.A.COORDS_BY_USER,d,s),c]},circumcenterMidpoint:function(){t.A.deprecated("Geometry.circumcenterMidpoint()","Geometry.circumcenter()"),this.circumcenter.apply(this,arguments)},circumcenter:function(r,e,s,t){var a,c,d,C,A=r.coords.usrCoords,h=e.coords.usrCoords,l=s.coords.usrCoords;return u.A.exists(t)||(t=r.board),a=[h[0]-A[0],-h[2]+A[2],h[1]-A[1]],c=[(A[0]+h[0])*.5,(A[1]+h[1])*.5,(A[2]+h[2])*.5],d=n.A.crossProduct(a,c),a=[l[0]-h[0],-l[2]+h[2],l[1]-h[1]],c=[(h[0]+l[0])*.5,(h[1]+l[1])*.5,(h[2]+l[2])*.5],C=n.A.crossProduct(a,c),new i.A(o.A.COORDS_BY_USER,n.A.crossProduct(d,C),t)},distance:function(r,e,s){var t,o=0;for(s||(s=Math.min(r.length,e.length)),t=0;t<s;t++)o+=(r[t]-e[t])*(r[t]-e[t]);return Math.sqrt(o)},affineDistance:function(r,e,s){var t;return(t=this.distance(r,e,s))>n.A.eps&&(Math.abs(r[0])<n.A.eps||Math.abs(e[0])<n.A.eps)?1/0:t},affineRatio:function(r,e,s){var t;return u.A.exists(r.usrCoords)&&(r=r.usrCoords),u.A.exists(e.usrCoords)&&(e=e.usrCoords),u.A.exists(s.usrCoords)&&(s=s.usrCoords),Math.abs(t=e[1]-r[1])>n.A.eps?(s[1]-r[1])/t:(s[2]-r[2])/(e[2]-r[2])},sortVertices:function(r){for(var e,s=d.A.each(r,d.A.coordsArray),t=s.length,o=null;s[0][0]===s[t-1][0]&&s[0][1]===s[t-1][1]&&s[0][2]===s[t-1][2];)o=s.pop(),t--;return e=s[0],s.sort(function(r,s){return(r[2]===e[2]&&r[1]===e[1]?-1/0:Math.atan2(r[2]-e[2],r[1]-e[1]))-(s[2]===e[2]&&s[1]===e[1]?-1/0:Math.atan2(s[2]-e[2],s[1]-e[1]))}),null!==o&&s.push(o),s},signedTriangle:function(r,e,s){var t=d.A.coordsArray(r),o=d.A.coordsArray(e),i=d.A.coordsArray(s);return .5*((o[1]-t[1])*(i[2]-t[2])-(o[2]-t[2])*(i[1]-t[1]))},signedPolygon:function(r,e){var s,t,o=0,i=d.A.each(r,d.A.coordsArray);for(void 0===e&&(e=!0),e?i.unshift(i[i.length-1]):i=this.sortVertices(i),t=i.length,s=1;s<t;s++)o+=i[s-1][1]*i[s][2]-i[s][1]*i[s-1][2];return .5*o},GrahamScan:function(r){var e,s,t,o,i,a,c,C,A,h,l,p,m,f,_,S,b,v,g,O,E,P,M,R=n.A.eps*n.A.eps,B=this,T=[],D=[],L=d.A.each(r,d.A.coordsArray);if(0===(M=L.length))return[];if(M>1024)for(e=1,c=i=L[0][1],C=a=L[0][2],p=h=L[0][1]-L[0][2],l=A=L[0][1]+L[0][2],m=0,f=0,_=0,S=0,v=0,O=0,b=0,g=0;e<M;e++)(E=L[e][1])<i?(i=E,m=e):E>c&&(c=E,f=e),(E=L[e][2])<a?(a=E,_=e):E>C&&(C=E,S=e),(E=L[e][1]-L[e][2])<h?(h=E,v=e):E>p&&(p=E,O=e),(E=L[e][1]+L[e][2])<A?(A=E,b=e):E>l&&(l=E,g=e);for(e=0;e<M;e++)P=L[e],(M<=1024||e in[m,f,_,S,b,v,g,O]||m!==v&&this.signedTriangle(L[m],L[v],P)>=-R||v!==S&&this.signedTriangle(L[v],L[S],P)>=-R||S!==g&&this.signedTriangle(L[S],L[g],P)>=-R||g!==f&&this.signedTriangle(L[g],L[f],P)>=-R||f!==O&&this.signedTriangle(L[f],L[O],P)>=-R||O!==_&&this.signedTriangle(L[O],L[_],P)>=-R||_!==b&&this.signedTriangle(L[_],L[b],P)>=-R||b!==m&&this.signedTriangle(L[b],L[m],P)>=-R)&&T.push({i:e,c:P});for(e=1,M=T.length,o=0,i=T[0].c[1],a=T[0].c[2];e<M;e++)(T[e].c[2]<a||T[e].c[2]===a&&T[e].c[1]<i)&&(i=T[e].c[1],a=T[e].c[2],o=e);for(t=(T=u.A.swap(T,o,0))[0].c,T.sort(function(r,e){var s=r.c,o=e.c,i=B.signedTriangle(t,s,o);return 0===i?n.A.hypot(s[1]-t[1],s[2]-t[2])-n.A.hypot(o[1]-t[1],o[2]-t[2]):-i}),s=0,e=0;e<M;e++){for(;s>1&&0>=this.signedTriangle(D[s-2].c,D[s-1].c,T[e].c);)D.pop(),s--;D.push(T[e]),s++}return D},convexHull:function(r,e){var s,t,o=[];for(s=0,t=this.GrahamScan(r);s<t.length;s++)e?o.push(t[s].c):o.push(r[t[s].i]);return o},isConvex:function(r){var e,s,t,i,a,c,C,A,h,l,p,m=n.A.eps*n.A.eps,f=0;if(u.A.isArray(r)?e=d.A.each(r,d.A.coordsArray):u.A.exists(r.type)&&r.type===o.A.OBJECT_TYPE_POLYGON&&(e=d.A.each(r.vertices,d.A.coordsArray)),0===(s=e.length)||s<3)return!0;for(t=0,p=null,i=e[s-2][1],a=e[s-2][2],C=e[s-1][1],h=Math.atan2((A=e[s-1][2])-a,C-i);t<s;t++)if(i=C,a=A,c=h,C=e[t][1],A=e[t][2],i!==C||a!==A){if((l=(h=Math.atan2(A-a,C-i))-c)<=-Math.PI?l+=2*Math.PI:l>Math.PI&&(l-=2*Math.PI),null===p){if(0===l)continue;p=l>0?1:-1}else if(p*l<-m)return!1;f+=l}return Math.abs(f/(2*Math.PI))-1<m},calcStraight:function(r,e,s,t){var i,a,c,d,C,A,h,l,p,m;if((u.A.exists(t)||(t=10),A=r.evalVisProp("straightfirst"),h=r.evalVisProp("straightlast"),Math.abs(e.scrCoords[0])<n.A.eps&&(A=!0),Math.abs(s.scrCoords[0])<n.A.eps&&(h=!0),A||h)&&((l=[])[0]=r.stdform[0]-r.stdform[1]*r.board.origin.scrCoords[1]/r.board.unitX+r.stdform[2]*r.board.origin.scrCoords[2]/r.board.unitY,l[1]=r.stdform[1]/r.board.unitX,l[2]=-r.stdform[2]/r.board.unitY,!isNaN(l[0]+l[1]+l[2]))){if(i=!1,a=!1,i=!A&&Math.abs(e.usrCoords[0])>=n.A.eps&&e.scrCoords[1]>=0&&e.scrCoords[1]<=r.board.canvasWidth&&e.scrCoords[2]>=0&&e.scrCoords[2]<=r.board.canvasHeight,a=!h&&Math.abs(s.usrCoords[0])>=n.A.eps&&s.scrCoords[1]>=0&&s.scrCoords[1]<=r.board.canvasWidth&&s.scrCoords[2]>=0&&s.scrCoords[2]<=r.board.canvasHeight,d=(c=this.meetLineBoard(l,r.board,t))[0],C=c[1],!i&&!a&&(!A&&h&&!this.isSameDirection(e,s,d)&&!this.isSameDirection(e,s,C)||A&&!h&&!this.isSameDirection(s,e,d)&&!this.isSameDirection(s,e,C)))return;i?a||(m=this.isSameDir(e,s,d,C)?C:d):a?p=this.isSameDir(e,s,d,C)?d:C:this.isSameDir(e,s,d,C)?(p=d,m=C):(m=d,p=C),p&&e.setCoordinates(o.A.COORDS_BY_USER,p.usrCoords),m&&s.setCoordinates(o.A.COORDS_BY_USER,m.usrCoords)}},calcLineDelimitingPoints:function(r,e,s){var t,i,a,c,u,d,C,A,h,l=!1,p=!1;if(u=r.evalVisProp("straightfirst"),d=r.evalVisProp("straightlast"),Math.abs(e.scrCoords[0])<n.A.eps&&(u=!0),Math.abs(s.scrCoords[0])<n.A.eps&&(d=!0),(C=[])[0]=r.stdform[0]-r.stdform[1]*r.board.origin.scrCoords[1]/r.board.unitX+r.stdform[2]*r.board.origin.scrCoords[2]/r.board.unitY,C[1]=r.stdform[1]/r.board.unitX,C[2]=-r.stdform[2]/r.board.unitY,!isNaN(C[0]+C[1]+C[2])){if((l=!u,p=!d,i=r.board.getBoundingBox(),r.getSlope()>=0?(a=this.projectPointToLine({coords:{usrCoords:[1,i[2],i[1]]}},r,r.board),c=this.projectPointToLine({coords:{usrCoords:[1,i[0],i[3]]}},r,r.board)):(a=this.projectPointToLine({coords:{usrCoords:[1,i[0],i[1]]}},r,r.board),c=this.projectPointToLine({coords:{usrCoords:[1,i[2],i[3]]}},r,r.board)),!l&&!p)&&(!u&&!d&&(t=e.distance(o.A.COORDS_BY_USER,s),Math.abs(e.distance(o.A.COORDS_BY_USER,a)+a.distance(o.A.COORDS_BY_USER,s)-t)>n.A.eps||Math.abs(e.distance(o.A.COORDS_BY_USER,c)+c.distance(o.A.COORDS_BY_USER,s)-t)>n.A.eps)||!u&&d&&!this.isSameDirection(e,s,a)&&!this.isSameDirection(e,s,c)||u&&!d&&!this.isSameDirection(s,e,a)&&!this.isSameDirection(s,e,c)))return;l?p||(h=this.isSameDir(e,s,a,c)?c:a):p?A=this.isSameDir(e,s,a,c)?a:c:this.isSameDir(e,s,a,c)?(A=a,h=c):(h=a,A=c),A&&e.setCoordinates(o.A.COORDS_BY_USER,A.usrCoords),h&&s.setCoordinates(o.A.COORDS_BY_USER,h.usrCoords)}},calcLabelQuadrant:function(r){return r<0&&(r+=2*Math.PI),["rt","urt","top","ulft","lft","llft","lrt"][Math.floor((r+Math.PI/8)/(Math.PI/4))%8]},isSameDir:function(r,e,s,t){var o=e.usrCoords[1]-r.usrCoords[1],i=e.usrCoords[2]-r.usrCoords[2],a=t.usrCoords[1]-s.usrCoords[1],c=t.usrCoords[2]-s.usrCoords[2];return Math.abs(e.usrCoords[0])<n.A.eps&&(o=e.usrCoords[1],i=e.usrCoords[2]),Math.abs(r.usrCoords[0])<n.A.eps&&(o=-r.usrCoords[1],i=-r.usrCoords[2]),o*a+i*c>=0},isSameDirection:function(r,e,s){var t,o,i,a,c=!1;return t=e.usrCoords[1]-r.usrCoords[1],o=e.usrCoords[2]-r.usrCoords[2],i=s.usrCoords[1]-r.usrCoords[1],a=s.usrCoords[2]-r.usrCoords[2],Math.abs(t)<n.A.eps&&(t=0),Math.abs(o)<n.A.eps&&(o=0),Math.abs(i)<n.A.eps&&(i=0),Math.abs(a)<n.A.eps&&(a=0),t>=0&&i>=0?c=o>=0&&a>=0||o<=0&&a<=0:t<=0&&i<=0&&(c=o>=0&&a>=0||o<=0&&a<=0),c},det3p:function(r,e,s){var t,o,i;return t=u.A.isPoint(r)?r.Coords(!0):r,o=u.A.isPoint(e)?e.Coords(!0):e,i=u.A.isPoint(s)?s.Coords(!0):s,(t[1]-i[1])*(o[2]-i[2])-(o[1]-i[1])*(t[2]-i[2])},windingNumber:function(r,e,s){var t,o,i,a,c,d,C=0,A=e.length,h=r[1],l=r[2],p=0;if(0===A)return 0;if((s=s||!1)&&(p=1),isNaN(h)||isNaN(l)||(u.A.exists(e[0].coords)?(t=e[0].coords,o=e[A-1].coords):(t=e[0],o=e[A-1]),t.usrCoords[1]===h&&t.usrCoords[2]===l))return 1;for(d=0;d<A-p;d++)if(u.A.exists(e[d].coords)?(o=e[d].coords.usrCoords,i=e[(d+1)%A].coords.usrCoords):(o=e[d].usrCoords,i=e[(d+1)%A].usrCoords),!(0===o[0]||0===i[0]||isNaN(o[1])||isNaN(i[1])||isNaN(o[2])||isNaN(i[2]))){if(i[2]===l){if(i[1]===h)return 1;if(o[2]===l&&i[1]>h==o[1]<h)return 0}if(o[2]<l!=i[2]<l)if(c=2*(i[2]>o[2])-1,o[1]>=h)if(i[1]>h)C+=c;else{if(0===(a=this.det3p(o,i,r)))return 0;a>0+n.A.eps==i[2]>o[2]&&(C+=c)}else i[1]>h&&(a=this.det3p(o,i,r))>0+n.A.eps==i[2]>o[2]&&(C+=c)}return C},pnpoly:function(r,e,s,t,n){var a,c,d,C,A,h,l,p,m=!1;for(t===o.A.COORDS_BY_USER?(h=(p=new i.A(o.A.COORDS_BY_USER,[r,e],n)).scrCoords[1],l=p.scrCoords[2]):(h=r,l=e),a=0,c=(A=s.length)-2;a<A-1;c=a++)d=u.A.exists(s[a].coords)?s[a].coords:s[a],C=u.A.exists(s[c].coords)?s[c].coords:s[c],d.scrCoords[2]>l!=C.scrCoords[2]>l&&h<(C.scrCoords[1]-d.scrCoords[1])*(l-d.scrCoords[2])/(C.scrCoords[2]-d.scrCoords[2])+d.scrCoords[1]&&(m=!m);return m},intersectionFunction:function(r,e,s,a,c,d){var C=this,A=!1,h=!1;return A=e.elementClass===o.A.OBJECT_CLASS_CURVE&&(e.type===o.A.OBJECT_TYPE_ARC||e.type===o.A.OBJECT_TYPE_SECTOR),h=s.elementClass===o.A.OBJECT_CLASS_CURVE&&(s.type===o.A.OBJECT_TYPE_ARC||s.type===o.A.OBJECT_TYPE_SECTOR),(e.elementClass===o.A.OBJECT_CLASS_CURVE||s.elementClass===o.A.OBJECT_CLASS_CURVE)&&(e.elementClass===o.A.OBJECT_CLASS_CURVE||e.elementClass===o.A.OBJECT_CLASS_CIRCLE)&&(s.elementClass===o.A.OBJECT_CLASS_CURVE||s.elementClass===o.A.OBJECT_CLASS_CIRCLE)?function(){return C.meetCurveCurve(e,s,a,c,e.board)}:(e.elementClass!==o.A.OBJECT_CLASS_CURVE||A||s.elementClass!==o.A.OBJECT_CLASS_LINE)&&(s.elementClass!==o.A.OBJECT_CLASS_CURVE||h||e.elementClass!==o.A.OBJECT_CLASS_LINE)?e.type===o.A.OBJECT_TYPE_POLYGON||s.type===o.A.OBJECT_TYPE_POLYGON?e.elementClass===o.A.OBJECT_CLASS_LINE?function(){var r,t=e.evalVisProp("straightfirst"),o=e.evalVisProp("straightlast"),i=s.evalVisProp("straightfirst"),n=s.evalVisProp("straightlast");return r=!u.A.evaluate(d)&&(!t||!o||!i||!n),C.meetPolygonLine(s,e,a,e.board,r)}:s.elementClass===o.A.OBJECT_CLASS_LINE?function(){var r,t=e.evalVisProp("straightfirst"),o=e.evalVisProp("straightlast"),i=s.evalVisProp("straightfirst"),n=s.evalVisProp("straightlast");return r=!u.A.evaluate(d)&&(!t||!o||!i||!n),C.meetPolygonLine(e,s,a,e.board,r)}:function(){return C.meetPathPath(e,s,a,e.board)}:e.elementClass===o.A.OBJECT_CLASS_LINE&&s.elementClass===o.A.OBJECT_CLASS_LINE?function(){var r,t,n=e.evalVisProp("straightfirst"),c=e.evalVisProp("straightlast"),A=s.evalVisProp("straightfirst"),h=s.evalVisProp("straightlast");return u.A.evaluate(d)||n&&c&&A&&h?C.meet(e.stdform,s.stdform,a,e.board):(r=C.meetSegmentSegment(e.point1.coords.usrCoords,e.point2.coords.usrCoords,s.point1.coords.usrCoords,s.point2.coords.usrCoords),t=!n&&r[1]<0||!c&&r[1]>1||!A&&r[2]<0||!h&&r[2]>1?[0,NaN,NaN]:r[0],new i.A(o.A.COORDS_BY_USER,t,e.board))}:function(){var r,c,l,p=C.meet(e.stdform,s.stdform,a,e.board),m=!0;return u.A.evaluate(d)?p:(e.elementClass!==o.A.OBJECT_CLASS_LINE||(r=e.evalVisProp("straightfirst"),c=e.evalVisProp("straightlast"),r&&c)||(l=C.affineRatio(e.point1.coords,e.point2.coords,p),(c||!(l>1+n.A.eps))&&(r||!(l<0-n.A.eps))))&&(s.elementClass!==o.A.OBJECT_CLASS_LINE||(r=s.evalVisProp("straightfirst"),c=s.evalVisProp("straightlast"),r&&c)||(l=C.affineRatio(s.point1.coords,s.point2.coords,p),(c||!(l>1+n.A.eps))&&(r||!(l<0-n.A.eps))))&&(!A||((m=C.coordsOnArc(e,p))&&h&&(m=C.coordsOnArc(s,p)),m))?p:new i.A(t.A.COORDS_BY_USER,[0,NaN,NaN],e.board)}:function(){return C.meetCurveLine(e,s,a,e.board,u.A.evaluate(d))}},otherIntersectionFunction:function(r,e,s,i){var n,a,c,d=this;return a=r[0],c=r[1],n=a.board,function(){var r,C,A,h,l=e.length,p=u.A.evaluate(i);for(r=l;r>=0;r--){for(a.elementClass===o.A.OBJECT_CLASS_CIRCLE&&[o.A.OBJECT_CLASS_CIRCLE,o.A.OBJECT_CLASS_LINE].indexOf(c.elementClass)>=0?A=d.meet(a.stdform,c.stdform,r,n):a.elementClass===o.A.OBJECT_CLASS_CURVE&&[o.A.OBJECT_CLASS_CURVE,o.A.OBJECT_CLASS_CIRCLE].indexOf(c.elementClass)>=0?A=d.meetCurveCurve(a,c,r,0,n,"segment"):a.elementClass===o.A.OBJECT_CLASS_CURVE&&c.elementClass===o.A.OBJECT_CLASS_LINE&&(A=u.A.exists(a.dataX)?t.A.Math.Geometry.meetCurveLine(a,c,r,a.board,u.A.evaluate(s)):t.A.Math.Geometry.meetCurveLineContinuous(a,c,r,a.board)),h=!1,C=0;!h&&C<l;C++)A.distance(t.A.COORDS_BY_USER,e[C].coords)<p&&(h=!0);if(!h)break}return A}},coordsOnArc:function(r,e){var s=this.rad(r.radiuspoint,r.center,e.usrCoords.slice(1)),t=0,o=this.rad(r.radiuspoint,r.center,r.anglepoint),i=r.evalVisProp("selection");return("minor"===i&&o>Math.PI||"major"===i&&o<Math.PI)&&(t=o,o=2*Math.PI),!(s<t)&&!(s>o)},meet:function(r,e,s,t){var o=n.A.eps;return Math.abs(r[3])<o&&Math.abs(e[3])<o?this.meetLineLine(r,e,s,t):Math.abs(r[3])>=o&&Math.abs(e[3])<o?this.meetLineCircle(e,r,s,t):Math.abs(r[3])<o&&Math.abs(e[3])>=o?this.meetLineCircle(r,e,s,t):this.meetCircleCircle(r,e,s,t)},meetLineBoard:function(r,e,s){var t,a,c,d,C=[];for(u.A.exists(s)||(s=0),C[0]=n.A.crossProduct(r,[s,0,1]),C[1]=n.A.crossProduct(r,[s,1,0]),C[2]=n.A.crossProduct(r,[-s-e.canvasHeight,0,1]),C[3]=n.A.crossProduct(r,[-s-e.canvasWidth,1,0]),c=0;c<4;c++)if(Math.abs(C[c][0])>n.A.eps){for(d=2;d>0;d--)C[c][d]/=C[c][0];C[c][0]=1}return Math.abs(C[1][0])<n.A.eps?(t=C[0],a=C[2]):Math.abs(C[0][0])<n.A.eps?(t=C[1],a=C[3]):C[1][2]<0?(t=C[0],a=C[3][2]>e.canvasHeight?C[2]:C[3]):C[1][2]>e.canvasHeight?(t=C[2],a=C[3][2]<0?C[0]:C[3]):(t=C[1],a=C[3][2]<0?C[0]:C[3][2]>e.canvasHeight?C[2]:C[3]),[new i.A(o.A.COORDS_BY_SCREEN,t.slice(1),e),new i.A(o.A.COORDS_BY_SCREEN,a.slice(1),e)]},meetLineLine:function(r,e,s,t){var a=isNaN(r[5]+e[5])?[0,0,0]:n.A.crossProduct(r,e);return 1e-14>Math.abs(a[0])&&(a[0]=0),new i.A(o.A.COORDS_BY_USER,a,t)},meetLineCircle:function(r,e,s,t){var a,c,d,C,A,h,l,p,m;return e[4]<n.A.eps?Math.abs(n.A.innerProduct([1,e[6],e[7]],r,3))<n.A.eps?new i.A(o.A.COORDS_BY_USER,e.slice(6,8),t):new i.A(o.A.COORDS_BY_USER,[NaN,NaN],t):(d=e[0],c=e.slice(1,3),a=e[3],C=r[0],A=r.slice(1,3),h=c[0]*A[1]-c[1]*A[0],l=a*C*C-(c[0]*A[0]+c[1]*A[1])*C+d,(p=h*h-4*a*l)>-n.A.eps*n.A.eps)?(m=[(-h+(p=Math.sqrt(Math.abs(p))))/(2*a),(-h-p)/(2*a)],0===u.A.evaluate(s)?new i.A(o.A.COORDS_BY_USER,[-(-m[0]*A[1])-C*A[0],-m[0]*A[0]-C*A[1]],t):new i.A(o.A.COORDS_BY_USER,[-(-m[1]*A[1])-C*A[0],-m[1]*A[0]-C*A[1]],t)):new i.A(o.A.COORDS_BY_USER,[0,0,0],t)},meetCircleCircle:function(r,e,s,t){var a;return r[4]<n.A.eps?Math.abs(this.distance(r.slice(6,2),e.slice(6,8))-e[4])<n.A.eps?new i.A(o.A.COORDS_BY_USER,r.slice(6,8),t):new i.A(o.A.COORDS_BY_USER,[0,0,0],t):e[4]<n.A.eps?Math.abs(this.distance(e.slice(6,2),r.slice(6,8))-r[4])<n.A.eps?new i.A(o.A.COORDS_BY_USER,e.slice(6,8),t):new i.A(o.A.COORDS_BY_USER,[0,0,0],t):(a=[e[3]*r[0]-r[3]*e[0],e[3]*r[1]-r[3]*e[1],e[3]*r[2]-r[3]*e[2],0,1,1/0,1/0,1/0],a=n.A.normalize(a),this.meetLineCircle(a,r,s,t))},meetCurveCurve:function(r,e,s,t,n,a){var d;return d=u.A.exists(a)&&"newton"===a?c.A.generalizedNewton(r,e,u.A.evaluate(s),t):3===r.bezierDegree||3===e.bezierDegree?this.meetBezierCurveRedBlueSegments(r,e,s):this.meetCurveRedBlueSegments(r,e,s),new i.A(o.A.COORDS_BY_USER,d,n)},meetCurveLine:function(r,e,s,t,i){var n,a;return u.A.exists(t)||(t=r.board),r.elementClass===o.A.OBJECT_CLASS_CURVE?(n=r,a=e):(n=e,a=r),this.meetCurveLineDiscrete(n,a,s,t,!i)},meetCurveLineContinuous:function(r,e,s,t,a){var u,d,C,A,h,l,p,m,f,_,S,b,v,g=n.A.eps,O=n.A.eps;for(h=(A=this.meetCurveLineDiscrete(r,e,s,t,a)).usrCoords[1],l=A.usrCoords[2],u=function(e){var s,t;return e>r.maxX()||e<r.minX()?1/0:(s=r.X(e)-h)*s+(t=r.Y(e)-l)*t},d=function(s){var t=e.stdform[0]+e.stdform[1]*r.X(s)+e.stdform[2]*r.Y(s);return t*t},b=0,m=(r.maxX()-r.minX())/50,f=r.minX(),S=1e-4,_=NaN;b<50&&(C=c.A.root(u,[Math.max(f,r.minX()),Math.min(f+m,r.maxX())]),!((v=Math.abs(u(C)))<=S)||(S=v,_=C,!(S<g)));b++)f+=m;return C=_,C=c.A.root(d,[Math.max(C-m,r.minX()),Math.min(C+m,r.maxX())]),p=isNaN(v=d(C))||Math.abs(v)>O?0:1,new i.A(o.A.COORDS_BY_USER,[p,r.X(C),r.Y(C)],t)},meetCurveLineDiscrete:function(r,e,s,t,a){var c,d,C,A,h,l,p,m=u.A.evaluate(s),f=e.point1.coords.usrCoords,_=e.point2.coords.usrCoords,S=0,b=r.numberPoints,v=e.evalVisProp("straightfirst"),g=e.evalVisProp("straightlast");for(l=new i.A(o.A.COORDS_BY_USER,[0,NaN,NaN],t),0===f[0]?f=[1,_[1]+e.stdform[2],_[2]-e.stdform[1]]:0===_[0]&&(_=[1,f[1]+e.stdform[2],f[2]-e.stdform[1]]),A=r.points[0].usrCoords,c=1;c<b;c+=r.bezierDegree)if(C=A.slice(0),A=r.points[c].usrCoords,this.distance(C,A)>n.A.eps){for(d=0,p=3===r.bezierDegree?this.meetBeziersegmentBeziersegment([r.points[c-1].usrCoords.slice(1),r.points[c].usrCoords.slice(1),r.points[c+1].usrCoords.slice(1),r.points[c+2].usrCoords.slice(1)],[f.slice(1),_.slice(1)],a):[this.meetSegmentSegment(C,A,f,_)];d<p.length;d++)if(0<=(h=p[d])[1]&&h[1]<=1){if(S===m){if(a&&(!v&&h[2]<0||!g&&h[2]>1))return l;return new i.A(o.A.COORDS_BY_USER,h[0],t)}S+=1}}return l},meetCurveRedBlueSegments:function(r,e,s){var t,o,i,n,a,c,d,C,A,h=u.A.evaluate(s),l=0,p=e.numberPoints,m=r.numberPoints;if(p<=1||m<=1)return[0,NaN,NaN];for(t=1;t<m;t++)for(o=1,i=r.points[t-1].usrCoords,n=r.points[t].usrCoords,C=Math.min(i[1],n[1]),A=Math.max(i[1],n[1]),c=e.points[0].usrCoords;o<p;o++)if(a=c,c=e.points[o].usrCoords,Math.min(a[1],c[1])<A&&Math.max(a[1],c[1])>C&&(d=this.meetSegmentSegment(i,n,a,c))[1]>=0&&d[2]>=0&&(d[1]<1&&d[2]<1||t===m-1&&1===d[1]||o===p-1&&1===d[2])){if(l===h)return d[0];l++}return[0,NaN,NaN]},meetSegmentSegment:function(r,e,s,t){var o,i,a,c,u=n.A.crossProduct(r,e),d=n.A.crossProduct(s,t),C=n.A.crossProduct(u,d);return Math.abs(C[0])<n.A.eps?[C,1/0,1/0]:(C[1]/=C[0],C[2]/=C[0],C[0]/=C[0],a=Math.abs(e[1]-e[0]*r[1])<n.A.eps?2:1,c=r[a]/r[0],o=(C[a]-c)/(0!==e[0]?e[a]/e[0]-c:e[a]),a=Math.abs(t[1]-t[0]*s[1])<n.A.eps?2:1,c=s[a]/s[0],i=(C[a]-c)/(0!==t[0]?t[a]/t[0]-c:t[a]),[C,o,i])},meetPathPath:function(r,e,s,a){var c,d,C,A,h=u.A.evaluate(s);return((C=(c=t.A.Math.Clip._getPath(r,a)).length)>0&&this.distance(c[0].coords.usrCoords,c[C-1].coords.usrCoords,3)<n.A.eps&&c.pop(),(C=(d=t.A.Math.Clip._getPath(e,a)).length)>0&&this.distance(d[0].coords.usrCoords,d[C-1].coords.usrCoords,3)<n.A.eps*n.A.eps&&d.pop(),s<0||t.A.Math.Clip.isEmptyCase(c,d,"intersection"))?new i.A(o.A.COORDS_BY_USER,[0,0,0],a):(t.A.Math.Clip.makeDoublyLinkedList(c),t.A.Math.Clip.makeDoublyLinkedList(d),h<(A=t.A.Math.Clip.findIntersections(c,d,a)[0]).length)?A[h].coords:new i.A(o.A.COORDS_BY_USER,[0,0,0],a)},meetPolygonLine:function(r,e,s,t,n){var a,c,d,C=u.A.evaluate(s),A=[0,0,0],h=r.borders.length,l=[];for(a=0;a<h;a++)d=r.borders[a],c=this.meetSegmentSegment(d.point1.coords.usrCoords,d.point2.coords.usrCoords,e.point1.coords.usrCoords,e.point2.coords.usrCoords),(!n||c[2]>=0&&c[2]<1)&&c[1]>=0&&c[1]<1&&l.push(c[0]);return C>=0&&C<l.length&&(A=l[C]),new i.A(o.A.COORDS_BY_USER,A,t)},_bezierSplit:function(r){var e,s,t,o,i,n;return e=[(r[0][0]+r[1][0])*.5,(r[0][1]+r[1][1])*.5],s=[(r[1][0]+r[2][0])*.5,(r[1][1]+r[2][1])*.5],t=[(r[2][0]+r[3][0])*.5,(r[2][1]+r[3][1])*.5],o=[(e[0]+s[0])*.5,(e[1]+s[1])*.5],i=[(s[0]+t[0])*.5,(s[1]+t[1])*.5],n=[(o[0]+i[0])*.5,(o[1]+i[1])*.5],[[r[0],e,o,n],[n,i,t,r[3]]]},_bezierBbox:function(r){var e=[];return 4===r.length?(e[0]=Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),e[1]=Math.max(r[0][1],r[1][1],r[2][1],r[3][1]),e[2]=Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),e[3]=Math.min(r[0][1],r[1][1],r[2][1],r[3][1])):(e[0]=Math.min(r[0][0],r[1][0]),e[1]=Math.max(r[0][1],r[1][1]),e[2]=Math.max(r[0][0],r[1][0]),e[3]=Math.min(r[0][1],r[1][1])),e},_bezierOverlap:function(r,e){return r[2]>=e[0]&&r[0]<=e[2]&&r[1]>=e[3]&&r[3]<=e[1]},_bezierListConcat:function(r,e,s,t){var o,i=u.A.exists(t),n=0,a=e.length,c=r.length;for(c>0&&a>0&&(1===r[c-1][1]&&0===e[0][1]||i&&1===r[c-1][2]&&0===e[0][2])&&(n=1),o=n;o<a;o++)i&&(e[o][2]*=.5,e[o][2]+=t),e[o][1]*=.5,e[o][1]+=s,r.push(e[o])},_bezierMeetSubdivision:function(r,e,s){var t,o,i,n,a,c,u,d,C,A,h,l,p=[];return(o=this._bezierBbox(e),t=this._bezierBbox(r),this._bezierOverlap(o,t))?s<5?(c=(i=this._bezierSplit(r))[0],u=i[1],n=(i=this._bezierSplit(e))[0],a=i[1],this._bezierListConcat(p,this._bezierMeetSubdivision(c,n,s+1),0,0),this._bezierListConcat(p,this._bezierMeetSubdivision(c,a,s+1),0,.5),this._bezierListConcat(p,this._bezierMeetSubdivision(u,n,s+1),.5,0),this._bezierListConcat(p,this._bezierMeetSubdivision(u,a,s+1),.5,.5),p):(h=[1].concat(r[0]),l=[1].concat(r[3]),C=[1].concat(e[0]),A=[1].concat(e[3]),(d=this.meetSegmentSegment(h,l,C,A))[1]>=0&&d[2]>=0&&d[1]<=1&&d[2]<=1)?[d]:[]:[]},_bezierLineMeetSubdivision:function(r,e,s,t){var o,i,n,a,c,u,d,C,A,h,l=[];return(o=this._bezierBbox(e),i=this._bezierBbox(r),t&&!this._bezierOverlap(i,o))?[]:s<5?(a=(n=this._bezierSplit(r))[0],c=n[1],this._bezierListConcat(l,this._bezierLineMeetSubdivision(a,e,s+1),0),this._bezierListConcat(l,this._bezierLineMeetSubdivision(c,e,s+1),.5),l):(A=[1].concat(r[0]),h=[1].concat(r[3]),d=[1].concat(e[0]),C=[1].concat(e[1]),(u=this.meetSegmentSegment(A,h,d,C))[1]>=0&&u[1]<=1&&(!t||u[2]>=0&&u[2]<=1))?[u]:[]},meetBeziersegmentBeziersegment:function(r,e,s){var t,o,i;for((t=4===r.length&&4===e.length?this._bezierMeetSubdivision(r,e,0):this._bezierLineMeetSubdivision(r,e,0,s)).sort(function(r,e){return(r[1]-e[1])*1e7+(r[2]-e[2])}),o=[],i=0;i<t.length;i++)(0===i||t[i][1]!==t[i-1][1]||t[i][2]!==t[i-1][2])&&o.push(t[i]);return o},meetBezierCurveRedBlueSegments:function(r,e,s){var t,i,a,c,d,C,A,h,l,p,m,f,_,S=u.A.evaluate(s),b=0,v=0,g=[];if(e.numberPoints<e.bezierDegree+1||r.numberPoints<r.bezierDegree+1)return[0,NaN,NaN];for(1===r.bezierDegree&&3===e.bezierDegree&&(C=r,r=e,e=C),f=e.numberPoints-e.bezierDegree,_=r.numberPoints-r.bezierDegree,r.type===o.A.OBJECT_TYPE_SECTOR&&(b=3,_-=3),e.type===o.A.OBJECT_TYPE_SECTOR&&(v=3,f-=3),i=b;i<_;i+=r.bezierDegree)for(A=[(t=r.points)[i].usrCoords.slice(1),t[i+1].usrCoords.slice(1)],3===r.bezierDegree&&(A[2]=t[i+2].usrCoords.slice(1),A[3]=t[i+3].usrCoords.slice(1)),l=this._bezierBbox(A),a=v;a<f;a+=e.bezierDegree)if(h=[(t=e.points)[a].usrCoords.slice(1),t[a+1].usrCoords.slice(1)],3===e.bezierDegree&&(h[2]=t[a+2].usrCoords.slice(1),h[3]=t[a+3].usrCoords.slice(1)),p=this._bezierBbox(h),this._bezierOverlap(l,p)){if(0===(m=this.meetBeziersegmentBeziersegment(A,h)).length)continue;for(c=0;c<m.length;c++)(d=m[c])[1]<-n.A.eps||d[1]>1+n.A.eps||d[2]<-n.A.eps||d[2]>1+n.A.eps||g.push(d);if(g.length>S)return g[S][0]}return g.length>S?g[S][0]:[0,NaN,NaN]},bezierSegmentEval:function(r,e){var s,t,o,i=1-r;return o=0,t=0+(s=i*i*i)*e[0][0],o+=s*e[0][1],t+=(s=3*r*i*i)*e[1][0],o+=s*e[1][1],t+=(s=3*r*r*i)*e[2][0],o+=s*e[2][1],[1,t+=(s=r*r*r)*e[3][0],o+=s*e[3][1]]},bezierArc:function(r,e,s,t,o){var i,a,c,d,C,A,h,l,p,m,f,_,S,b,v,g,O,E,P=e[1],M=e[2],R=e[0],B=[],T=[];for(C=this.distance(e,r),P/=R,M/=R,A=this.rad(r.slice(1),e.slice(1),s.slice(1)),-1===o&&(A=2*Math.PI-A),l=A/4,i=r,i[1]/=i[0],i[2]/=i[0],i[0]/=i[0],d=i.slice(0),t?(B=[P,P+.333*(i[1]-P),P+.666*(i[1]-P),i[1]],T=[M,M+.333*(i[2]-M),M+.666*(i[2]-M),i[2]]):(B=[i[1]],T=[i[2]]);A>n.A.eps;)A>l?(h=l,A-=l):(h=A,A=0),E=[[1,0,0],[P*(1-(p=Math.cos(o*h)))+M*(m=Math.sin(o*h)),p,-m],[M*(1-p)-P*m,m,p]],d=[(g=n.A.matVecMult(E,i))[0]/g[0],g[1]/g[0],g[2]/g[0]],f=i[1]-P,_=i[2]-M,S=d[1]-P,b=d[2]-M,O=n.A.hypot(f+S,_+b),v=Math.abs(b-_)>n.A.eps?(f+S)*(C/O-.5)/(b-_)*8/3:(_+b)*(C/O-.5)/(f-S)*8/3,a=[1,i[1]-v*_,i[2]+v*f],c=[1,d[1]+v*b,d[2]-v*S],u.A.concat(B,[a[1],c[1],d[1]]),u.A.concat(T,[a[2],c[2],d[2]]),i=d.slice(0);return t&&(u.A.concat(B,[d[1]+.333*(P-d[1]),d[1]+.666*(P-d[1]),P]),u.A.concat(T,[d[2]+.333*(M-d[2]),d[2]+.666*(M-d[2]),M])),[B,T]},projectPointToCircle:function(r,e,s){var t,a,c,d,C,A=e.center.coords.usrCoords;return u.A.exists(s)||(s=r.board),u.A.isPoint(r)?(t=r.coords.distance(o.A.COORDS_BY_USER,e.center.coords),a=r.coords.usrCoords):(t=r.distance(o.A.COORDS_BY_USER,e.center.coords),a=r.usrCoords),Math.abs(t)<n.A.eps&&(t=n.A.eps),C=e.Radius()/t,c=A[1]+C*(a[1]-A[1]),d=A[2]+C*(a[2]-A[2]),new i.A(o.A.COORDS_BY_USER,[c,d],s)},projectPointToLine:function(r,e,s){var t,a=[0,e.stdform[1],e.stdform[2]];return u.A.exists(s)||(s=u.A.exists(r.coords)?r.board:e.board),t=u.A.exists(r.coords)?r.coords.usrCoords:r.usrCoords,a=n.A.crossProduct(a,t),new i.A(o.A.COORDS_BY_USER,n.A.crossProduct(a,e.stdform),s)},projectCoordsToSegment:function(r,e,s){var t,o=[s[1]-e[1],s[2]-e[2]],i=[r[1]-e[1],r[2]-e[2]];return Math.abs(o[0])<n.A.eps&&Math.abs(o[1])<n.A.eps?[e,0]:[[1,(t=n.A.innerProduct(i,o)/n.A.innerProduct(o,o))*o[0]+e[1],t*o[1]+e[2]],t]},projectCoordsToBeziersegment:function(r,e,s){var o;return o=t.A.Math.Numerics.fminbr(function(t){var o=[1,e.X(s+t),e.Y(s+t)];return o[1]-=r[1],o[2]-=r[2],o[1]*o[1]+o[2]*o[2]},[0,1]),[[1,e.X(o+s),e.Y(o+s)],o]},projectPointToCurve:function(r,e,s){u.A.exists(s)||(s=r.board);var t=r.X(),o=r.Y(),i=r.position;return u.A.exists(i)||(i="functiongraph"===e.evalVisProp("curvetype")?t:0),this.projectCoordsToCurve(t,o,i,e,s)},projectCoordsToCurve:function(r,e,s,t,n){var a,d,C,A,h,l,p,m,f,_,S,b,v,g,O,E,P,M,R,B,T,D,L,N,Y,y=1/0;if(u.A.exists(n)||(n=t.board),"plot"===t.evalVisProp("curvetype")){if(s=0,h=y,a=0===t.numberPoints?[0,1,1]:[t.Z(0),t.X(0),t.Y(0)],t.numberPoints>1)for(m=[1,r,e],3===t.bezierDegree?A=0:S=[t.Z(0),t.X(0),t.Y(0)],C=0;C<t.numberPoints-1;C++)3===t.bezierDegree?v=this.projectCoordsToBeziersegment(m,t,A):(b=[t.Z(C+1),t.X(C+1),t.Y(C+1)],v=this.projectCoordsToSegment(m,S,b)),p=v[1],f=v[0],0<=p&&p<=1?(l=this.distance(f,m),_=C+p):p<0?(f=S,l=this.distance(S,m),_=C):p>1&&C===t.numberPoints-2&&(f=b,l=this.distance(f,m),_=t.numberPoints-1),l<h&&(h=l,s=_,a=f),3===t.bezierDegree?(A++,C+=2):S=b;d=new i.A(o.A.COORDS_BY_USER,a,n)}else{for(N=t.minX(),Y=t.maxX(),D=N,L=Y,"functiongraph"===t.evalVisProp("curvetype")&&(isNaN(M=Math.abs(e-t.Y(r)))||(D=r-M,L=r+M)),P=(g=function(s){var o,i;return s<N||s>t.maxX_glob?1/0:(o=r-t.X(s))*o+(i=e-t.Y(s))*i})(s),C=0,R=(L-D)/50,O=D;C<50;C++)((E=g(O))<P||P===1/0||isNaN(P))&&(s=O,P=E),O+=R;for(C=0,B=R;C<20&&isNaN(g(s-B));C++,B*=.5);for(isNaN(g(s-B))&&(B=0),T=R,C=0;C<20&&isNaN(g(s+T));C++,T*=.5);isNaN(g(s+T))&&(T=0),s=(s=(s=c.A.fminbr(g,[Math.max(s-B,D),Math.min(s+T,L)]))<N?N:s)>Y?Y:s,d=new i.A(o.A.COORDS_BY_USER,[t.X(s),t.Y(s)],n)}return[t.updateTransform(d),s]},projectCoordsToPolygon:function(r,e){var s,o,i,n,a,c=e.vertices.length,u=1/0;for(s=0;s<c-1;s++)0<=(i=t.A.Math.Geometry.projectCoordsToSegment(r,e.vertices[s].coords.usrCoords,e.vertices[s+1].coords.usrCoords))[1]&&i[1]<=1?(o=t.A.Math.Geometry.distance(i[0],r,3),n=i[0]):i[1]<0?(o=t.A.Math.Geometry.distance(e.vertices[s].coords.usrCoords,r,3),n=e.vertices[s].coords.usrCoords):(o=t.A.Math.Geometry.distance(e.vertices[s+1].coords.usrCoords,r,3),n=e.vertices[s+1].coords.usrCoords),o<u&&(a=n.slice(0),u=o);return a},projectPointToTurtle:function(r,e,s){var t,n,a,c,d,C,A,h,l,p,m=0,f=0,_=1/0,S=e.objects.length;for(u.A.exists(s)||(s=r.board),d=0;d<S;d++)(A=e.objects[d]).elementClass===o.A.OBJECT_CLASS_CURVE&&(t=(l=this.projectPointToCurve(r,A))[0],p=l[1],(C=this.distance(t.usrCoords,r.coords.usrCoords))<_&&(a=t.usrCoords[1],c=t.usrCoords[2],n=p,_=C,h=A,f=m),m+=A.numberPoints);return t=new i.A(o.A.COORDS_BY_USER,[a,c],s),[h.updateTransform(t),n+f]},projectPointToPoint:function(r,e){return e.coords},projectPointToBoard:function(r,e){var s,t,o,i=e||r.board,a=[[1,1,0,0,3,0,1],[-1,2,1,0,1,2,1],[-1,1,2,2,1,2,3],[1,2,3,0,3,2,3]],c=r.coords||r,u=i.getBoundingBox();for(s=0;s<4;s++)(o=a[s])[0]*c.usrCoords[o[1]]<o[0]*u[o[2]]&&((t=n.A.crossProduct([1,u[o[3]],u[o[4]]],[1,u[o[5]],u[o[6]]]))[3]=0,t=n.A.normalize(t),c=this.projectPointToLine({coords:c},{stdform:t},i));return c},distPointLine:function(r,e){var s,t=e[1],o=e[2],i=e[0];return Math.abs(t)+Math.abs(o)<n.A.eps?1/0:(s=t*r[1]+o*r[2]+i,t*=t,o*=o,Math.abs(s)/Math.sqrt(t+o))},distPointSegment:function(r,e,s){var t,o,i,a,c,u,d=n.A.eps*n.A.eps;return t=r[1]-e[1],o=r[2]-e[2],t=t===1/0?1e6:t===-1/0?-1e6:t,o=o===1/0?1e6:o===-1/0?-1e6:o,i=s[1]-e[1],(c=(i=i===1/0?1e6:i===-1/0?-1e6:i)*i+(a=(a=s[2]-e[2])==1/0?1e6:a===-1/0?-1e6:a)*a)>d&&((u=(t*i+o*a)/c)<0?u=0:u>1&&(u=1),t-=u*i,o-=u*a),n.A.hypot(t,o)},intersectionFunction3D:function(r,e,s){var t;return e.type===o.A.OBJECT_TYPE_PLANE3D?s.type===o.A.OBJECT_TYPE_PLANE3D?t=r.intersectionPlanePlane(e,s):s.type===o.A.OBJECT_TYPE_SPHERE3D&&(t=this.meetPlaneSphere(e,s)):e.type===o.A.OBJECT_TYPE_SPHERE3D&&(s.type===o.A.OBJECT_TYPE_PLANE3D?t=this.meetPlaneSphere(s,e):s.type===o.A.OBJECT_TYPE_SPHERE3D&&(t=this.meetSphereSphere(e,s))),t},meet3Planes:function(r,e,s,t,o,i){var a,c,u,d,C,A=[1,0,0,0];for(C=0,a=n.A.crossProduct(o.slice(1),r.slice(1)),c=n.A.crossProduct(r.slice(1),s.slice(1)),u=n.A.crossProduct(s.slice(1),o.slice(1)),d=n.A.innerProduct(r.slice(1),u,3);C<3;C++)A[C+1]=(e*u[C]+t*a[C]+i*c[C])/d;return A},meetPlanePlane:function(r,e,s,t){var o,i,a,c;return a=r.slice(1),c=e.slice(1),o=n.A.crossProduct(a,c),a=s.slice(1),c=t.slice(1),i=n.A.crossProduct(a,c),(c=n.A.crossProduct(o,i)).unshift(0),c},meetPlaneSphere:function(r,e){var s=function(){return n.A.innerProduct(r.normal,e.center.coords,4)-r.d};return[function(){return n.A.axpy(-s(),r.normal,e.center.coords)},r.normal,function(){var r=e.Radius(),t=s();return Math.sqrt(r*r-t*t)}]},meetSphereSphere:function(r,e){var s=function(){var s=r.center.distance(e.center),t=r.Radius(),o=e.Radius();return(t-o)*(t+o)/(s*s)};return[function(){var t=s();return[1,.5*((1-t)*r.center.coords[1]+(1+t)*e.center.coords[1]),.5*((1-t)*r.center.coords[2]+(1+t)*e.center.coords[2]),.5*((1-t)*r.center.coords[3]+(1+t)*e.center.coords[3])]},function(){return a.A.subtract(e.center.coords,r.center.coords)},function(){var t=r.center.distance(e.center),o=r.Radius(),i=e.Radius(),n=s();return Math.sqrt(.5*(o*o+i*i-.5*t*t*(1+n*n)))}]},_paramsOutOfRange:function(r,e,s){return r[0]<e[0]||r[0]>e[1]||r.length>1&&(r[1]<s[0]||r[1]>s[1])},projectCoordsToParametric:function(r,e,s,t){var o,i,a,c,d,C=.01*Math.random()+.5;return 1===s?o=.1*((c=[u.A.evaluate(e.range[0]),u.A.evaluate(e.range[1])])[1]-c[0]):2===s&&(c=[u.A.evaluate(e.range_u[0]),u.A.evaluate(e.range_u[1])],d=[u.A.evaluate(e.range_v[0]),u.A.evaluate(e.range_v[1])],o=.1*Math.min(c[1]-c[0],d[1]-d[0])),i=o/5e6,a=function(s,t,o,i){var n=[e.X.apply(e,o),e.Y.apply(e,o),e.Z.apply(e,o)],a=r[0]-n[0],u=r[1]-n[1],C=r[2]-n[2];return t>=2&&(i[0]=o[0]-c[0],i[1]=-o[0]+c[1]),t>=4&&(i[2]=o[1]-d[0],i[3]=-o[1]+d[1]),a*a+u*u+C*C},0===t.length&&(t[0]=C*(c[0]+c[1]),2===s&&(t[1]=C*(d[0]+d[1]))),n.A.Nlp.FindMinimum(a,s,0,t,o,i,0,200),r=[e.X.apply(e,t),e.Y.apply(e,t),e.Z.apply(e,t)],this._paramsOutOfRange(t,c,d)&&(t[0]=C*(c[0]+c[1]),2===s&&(t[1]=C*(d[0]+d[1])),n.A.Nlp.FindMinimum(a,s,2*s,t,o,i,0,200)),[1,e.X.apply(e,t),e.Y.apply(e,t),e.Z.apply(e,t)]},project3DTo3DPlane:function(r,e,s){var t,o,i;return s=s||[0,0,0],t=n.A.norm(e),o=n.A.innerProduct(r,e,3),i=n.A.innerProduct(s,e,3),n.A.axpy(-((o-i)/t),e,r)},getPlaneBounds:function(r,e,s,t,o){var i,n,a,u,d;return r[2]+e[0]!==0?(a=[[r[0],e[0]],[r[1],e[1]]],u=[t-s[0],t-s[1]],i=(d=c.A.Gauss(a,u))[0],n=d[1],u=[o-s[0],o-s[1]],[i,(d=c.A.Gauss(a,u))[0],n,d[1]]):null},reuleauxPolygon:function(r,e){var s,t=2*Math.PI,o=t/e,i=(e-1)/2,a=0,c=function(c,u){return function(d,C){var A=(d%t+t)%t,h=Math.floor(A/o)%e;return(C||(a=r[0].Dist(r[i]),s=n.A.Geometry.rad([r[0].X()+1,r[0].Y()],r[0],r[i%e])),isNaN(h))?h:(A=.5*A+h*o*.5+s,r[h][c]()+a*Math[u](A))}};return[c("X","cos"),c("Y","sin"),0,t]}});let C=n.A.Geometry}}]);