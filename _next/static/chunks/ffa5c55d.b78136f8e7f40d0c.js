"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6042],{98689:(t,e,s)=>{s.d(e,{A:()=>A});var i=s(61926),o=s(30856),n=s(53885),r=s(33467),h=s(89686),a=s(51412),c=s(57214),l=s(42202),d=s(66385),u=s(73081),p=s(10632),g=s(35921),v=s(29479),m=s(39580),f=s(39135);i.A.Board=function(t,e,s,n,h,a,c,l,d,p,f){if(this.BOARD_MODE_NONE=0,this.BOARD_MODE_DRAG=1,this.BOARD_MODE_MOVE_ORIGIN=2,this.BOARD_MODE_ZOOM=17,this.BOARD_QUALITY_LOW=1,this.BOARD_QUALITY_HIGH=2,g.A.exists(f.document)&&!1!==f.document?this.document=f.document:m.A.isBrowser&&(this.document=document),this.container="",this.id="",this.containerObj=null,g.A.isString(t)?(this.container=t,this.containerObj=m.A.isBrowser?this.document.getElementById(this.container):null):m.A.isBrowser&&(this.containerObj=t,this.container=this.containerObj.getAttribute("id"),null===this.container&&(this.container="null"+parseInt(0x1000000*Math.random()).toString())),m.A.isBrowser&&"no"!==e.type&&null===this.containerObj)throw Error('\nJSXGraph: HTML container element "'+t+'" not found.');g.A.exists(s)&&""!==s&&m.A.isBrowser&&!g.A.exists(this.document.getElementById(s))?this.id=s:this.id=this.generateId(),this.renderer=e,this.grids=[],this.options=g.A.deepCopy(r.A),this.attr=f,"default"!==this.attr.theme&&g.A.exists(i.A.themes[this.attr.theme])&&g.A.mergeAttr(this.options,i.A.themes[this.attr.theme],!0),this.dimension=2,this.jc=new u.A,this.jc.use(this),this.origin={},this.origin.usrCoords=[1,0,0],this.origin.scrCoords=[1,n[0],n[1]],this.zoomX=h,this.zoomY=a,this.unitX=c*this.zoomX,this.unitY=l*this.zoomY,this.keepaspectratio=!1,this.canvasWidth=d,this.canvasHeight=p,v.A.eventify(this),this.hooks=[],this.dependentBoards=[],this.inUpdate=!1,this.objects={},this.objectsList=[],this.groups={},this.animationObjects={},this.highlightedObjects={},this.numObjects=0,this.elementsByName={},this.mode=this.BOARD_MODE_NONE,this.updateQuality=this.BOARD_QUALITY_HIGH,this.isSuspendedRedraw=!1,this.calculateSnapSizes(),this.drag_dx=0,this.drag_dy=0,this.drag_position=[0,0],this.mouse={},this.touches=[],this.xmlString="",this.cPos=[],this.touchMoveLast=0,this.touchMoveLastId=1/0,this.positionAccessLast=0,this.downObjects=[],this.clickObjects={},this.focusObjects=[],this.attr.showcopyright&&this.renderer.displayCopyright(o.A.licenseText,parseInt(this.options.text.fontSize,10)),this.needsFullUpdate=!1,this.reducedUpdate=!1,this.currentCBDef="none",this.geonextCompatibilityMode=!1,this.options.text.useASCIIMathML&&translateASCIIMath?init():this.options.text.useASCIIMathML=!1,this.hasMouseHandlers=!1,this.hasTouchHandlers=!1,this.hasPointerHandlers=!1,this.hasWheelHandlers=!1,this.hasMouseUp=!1,this.hasTouchEnd=!1,this.hasPointerUp=!1,this.resizeHandlers=[],this._drag_offset=[0,0],this._inputDevice="mouse",this._board_touches=[],this.selectingMode=!1,this.isSelecting=!1,this._isScrolling=!1,this._isResizing=!1,this._change3DView=!1,this.selectingBox=[[0,0],[0,0]],this.userLog=[],this.mathLib=Math,this.mathLibJXG=i.A.Math,!0===this.attr.registerevents?this.attr.registerevents={fullscreen:!0,keyboard:!0,pointer:!0,resize:!0,wheel:!0}:"object"==typeof this.attr.registerevents&&(g.A.exists(this.attr.registerevents.fullscreen)||(this.attr.registerevents.fullscreen=!0),g.A.exists(this.attr.registerevents.keyboard)||(this.attr.registerevents.keyboard=!0),g.A.exists(this.attr.registerevents.pointer)||(this.attr.registerevents.pointer=!0),g.A.exists(this.attr.registerevents.resize)||(this.attr.registerevents.resize=!0),g.A.exists(this.attr.registerevents.wheel)||(this.attr.registerevents.wheel=!0)),!1!==this.attr.registerevents&&(this.attr.registerevents.fullscreen&&this.addFullscreenEventHandlers(),this.attr.registerevents.keyboard&&this.addKeyboardEventHandlers(),this.attr.registerevents.pointer&&this.addEventHandlers(),this.attr.registerevents.resize&&this.addResizeEventHandlers(),this.attr.registerevents.wheel&&this.addWheelEventHandlers()),this.methodMap={update:"update",fullUpdate:"fullUpdate",on:"on",off:"off",trigger:"trigger",setAttribute:"setAttribute",setBoundingBox:"setBoundingBox",setView:"setBoundingBox",getBoundingBox:"getBoundingBox",BoundingBox:"getBoundingBox",getView:"getBoundingBox",View:"getBoundingBox",migratePoint:"migratePoint",colorblind:"emulateColorblindness",suspendUpdate:"suspendUpdate",unsuspendUpdate:"unsuspendUpdate",clearTraces:"clearTraces",left:"clickLeftArrow",right:"clickRightArrow",up:"clickUpArrow",down:"clickDownArrow",zoomIn:"zoomIn",zoomOut:"zoomOut",zoom100:"zoom100",zoomElements:"zoomElements",remove:"removeObject",removeObject:"removeObject"}},i.A.extend(i.A.Board.prototype,{generateName:function(t){var e,s,i=this.attr.maxnamelength,n="",r="",h=[],a="";if(t.type===o.A.OBJECT_TYPE_TICKS)return"";for(e=g.A.isPoint(t)||g.A.isPoint3D(t)?["","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]:t.type===o.A.OBJECT_TYPE_ANGLE?["","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&theta;","&iota;","&kappa;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigma;","&tau;","&upsilon;","&phi;","&chi;","&psi;","&omega;"]:["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],g.A.isPoint(t)||g.A.isPoint3D(t)||t.elementClass===o.A.OBJECT_CLASS_LINE||t.type===o.A.OBJECT_TYPE_ANGLE||(n=t.type===o.A.OBJECT_TYPE_POLYGON?"P_{":t.elementClass===o.A.OBJECT_CLASS_CIRCLE?"k_{":t.elementClass===o.A.OBJECT_CLASS_TEXT?"t_{":"s_{",r="}"),s=0;s<i;s++)h[s]=0;for(;h[i-1]<e.length;){for(h[0]=1;h[0]<e.length;h[0]++){for(a=n,s=i;s>0;s--)a+=e[h[s-1]];if(!g.A.exists(this.elementsByName[a+r]))return a+r}for(s=1,h[0]=e.length;s<i;s++)h[s-1]===e.length&&(h[s-1]=1,h[s]+=1)}return""},generateId:function(){for(var t=1;g.A.exists(i.A.boards["jxgBoard"+t]);)t=Math.round(0x1000000*Math.random());return"jxgBoard"+t},setId:function(t,e){var s,i=this.numObjects,o=t.id;if(this.numObjects+=1,""===o||!g.A.exists(o))for(o=this.id+e+i;g.A.exists(this.objects[o]);)s=Math.round(65535*Math.random()),o=this.id+e+i+"-"+s;return t.id=o,this.objects[o]=t,t._pos=this.objectsList.length,this.objectsList[this.objectsList.length]=t,o},finalizeAdding:function(t){!1===t.evalVisProp("visible")&&this.renderer.display(t,!1)},finalizeLabel:function(t){t.hasLabel&&!t.label.evalVisProp("islabel")&&!1===t.label.evalVisProp("visible")&&this.renderer.display(t.label,!1)},checkFrameRate:function(t){var e=!1,s=new Date().getTime();return g.A.exists(t.pointerId)&&this.touchMoveLastId!==t.pointerId&&(e=!0,this.touchMoveLastId=t.pointerId),!e&&(s-this.touchMoveLast)*this.attr.maxframerate>=1e3&&(e=!0),e&&(this.touchMoveLast=s),e},getCoordsTopLeftCorner:function(){var t,e,s,i,o,n=this.document.ownerDocument||this.document,r=n.documentElement||this.document.body.parentNode,h=n.body,a=this.containerObj;if(this.cPos.length>0&&(this.mode===this.BOARD_MODE_DRAG||this.mode===this.BOARD_MODE_MOVE_ORIGIN||new Date().getTime()-this.positionAccessLast<1e3))return this.cPos;if(this.positionAccessLast=new Date().getTime(),a.getBoundingClientRect){for(s=a.getBoundingClientRect(),i=1,o=a;o&&g.A.exists(o.parentNode);)g.A.exists(o.style)&&g.A.exists(o.style.zoom)&&""!==o.style.zoom&&(i*=parseFloat(o.style.zoom)),o=o.parentNode;return t=[s.left*i,s.top*i],t[0]+=m.A.getProp(a,"border-left-width"),t[1]+=m.A.getProp(a,"border-top-width"),"vml"!==this.renderer.type&&(t[0]+=m.A.getProp(a,"padding-left"),t[1]+=m.A.getProp(a,"padding-top")),this.cPos=t.slice(),this.cPos}return t=m.A.getOffset(a),e=this.document.documentElement.ownerDocument,!this.containerObj.currentStyle&&e.defaultView&&(t[0]+=m.A.getProp(r,"margin-left"),t[1]+=m.A.getProp(r,"margin-top"),t[0]+=m.A.getProp(r,"border-left-width"),t[1]+=m.A.getProp(r,"border-top-width"),t[0]+=m.A.getProp(r,"padding-left"),t[1]+=m.A.getProp(r,"padding-top")),h&&(t[0]+=m.A.getProp(h,"left"),t[1]+=m.A.getProp(h,"top")),"object"==typeof google&&google.translate&&(t[0]+=10,t[1]+=25),t[0]+=m.A.getProp(a,"border-left-width"),t[1]+=m.A.getProp(a,"border-top-width"),"vml"!==this.renderer.type&&(t[0]+=m.A.getProp(a,"padding-left"),t[1]+=m.A.getProp(a,"padding-top")),t[0]+=this.attr.offsetx,t[1]+=this.attr.offsety,this.cPos=t.slice(),this.cPos},getPointLoc:function(t,e){var s,i,o;return s=this.getBoundingBox(),2===t.length&&t.unshift(void 0),i=[0,0],o=e||0,g.A.isNumber(o)&&(o=[o,o,o,o]),t[1]>s[2]-o[1]&&(i[0]=1),t[1]<s[0]+o[3]&&(i[0]=-1),t[2]>s[1]-o[0]&&(i[1]=1),t[2]<s[3]+o[2]&&(i[1]=-1),i},getLocationOrigin:function(t){return this.getPointLoc([0,0],t)},getMousePosition:function(t,e){var s,i,o=this.getCoordsTopLeftCorner();return s=m.A.getPosition(t,e,this.document),this.updateCSSTransforms(),i=[1,s[0]-o[0],s[1]-o[1]],i=a.A.matVecMult(this.cssTransMat,i),i[1]/=i[0],i[2]/=i[0],[i[1],i[2]]},initMoveOrigin:function(t,e){this.drag_dx=t-this.origin.scrCoords[1],this.drag_dy=e-this.origin.scrCoords[2],this.mode=this.BOARD_MODE_MOVE_ORIGIN,this.updateQuality=this.BOARD_QUALITY_LOW},initMoveObject:function(t,e,s,i){var n,r,h,a=[],c=[],l=this.objectsList.length,u={visProp:{layer:-1e4}};for(r=0,this._shiftKey=s.shiftKey,this._ctrlKey=s.ctrlKey;r<l;r++)h=(n=this.objectsList[r]).hasPoint&&n.hasPoint(t,e),n.visPropCalc.visible&&h&&(n.triggerEventHandlers([i+"down","down"],[s]),this.downObjects.push(n)),h&&n.isDraggable&&n.visPropCalc.visible&&(this.geonextCompatibilityMode&&(g.A.isPoint(n)||n.elementClass===o.A.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!n.evalVisProp("fixed")&&(n.visProp.layer>u.visProp.layer||n.visProp.layer===u.visProp.layer&&n.lastDragTime.getTime()>=u.lastDragTime.getTime())&&(!this.attr.ignorelabels||!g.A.exists(u.label)||n!==u.label)&&(u=n,a.push(u),g.A.exists(u.coords)?u.elementClass===o.A.OBJECT_CLASS_POINT||u.relativeCoords?c.push(d.A.subtract(u.coords.scrCoords.slice(1),[t,e])):c.push(d.A.subtract(u.actualCoords.scrCoords.slice(1),[t,e])):c.push([0,0]));return this.attr.drag.enabled&&a.length>0&&(this.mode=this.BOARD_MODE_DRAG),this.attr.takefirst?(a.length=1,this._drag_offset=c[0]):(a=a.slice(-1),this._drag_offset=c[c.length-1]),this._drag_offset||(this._drag_offset=[0,0]),"svg"===this.renderer.type&&g.A.exists(a[0])&&a[0].evalVisProp("dragtotopoflayer")&&1===a.length&&g.A.exists(a[0].rendNode)&&a[0].rendNode.parentNode.appendChild(a[0].rendNode),a.length>=1&&(a[0].highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[s,a[0]])),a},moveObject:function(t,e,s,i,r){var h,a,c,l=new n.A(o.A.COORDS_BY_SCREEN,this.getScrCoordsOfMouse(t,e),this);s&&s.obj&&((h=s.obj).coords&&(a=h.coords.scrCoords.slice()),this.addLogEntry("drag",h,l.usrCoords.slice(1)),this.drag_position=[l.scrCoords[1],l.scrCoords[2]],this.drag_position=d.A.add(this.drag_position,this._drag_offset),this._shiftKey=i.shiftKey,this._ctrlKey=i.ctrlKey,g.A.exists(h.coords)?h.setPositionDirectly(o.A.COORDS_BY_SCREEN,this.drag_position,[t,e]):(this.displayInfobox(!1),isNaN(s.targets[0].Xprev+s.targets[0].Yprev)||h.setPositionDirectly(o.A.COORDS_BY_SCREEN,[l.scrCoords[1],l.scrCoords[2]],[s.targets[0].Xprev,s.targets[0].Yprev]),s.targets[0].Xprev=l.scrCoords[1],s.targets[0].Yprev=l.scrCoords[2]),g.A.exists(h.coords)&&(h.prepareUpdate().update(!1).updateRenderer(),this.updateInfobox(h),h.prepareUpdate().update(!0).updateRenderer()),h.coords&&(c=h.coords.scrCoords),h.coords&&a[1]===c[1]&&a[2]===c[2]||(h.triggerEventHandlers([r+"drag","drag"],[i]),this.update(h)),h.highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[i,h]),h.lastDragTime=new Date)},twoFingerMove:function(t,e,s){var i;g.A.exists(t)&&g.A.exists(t.obj)&&((i=t.obj).elementClass===o.A.OBJECT_CLASS_LINE||i.type===o.A.OBJECT_TYPE_POLYGON?this.twoFingerTouchObject(t.targets,i,e):i.elementClass===o.A.OBJECT_CLASS_CIRCLE&&this.twoFingerTouchCircle(t.targets,i,e),s&&i.triggerEventHandlers(["touchdrag","drag"],[s]))},getTwoFingerTransform(t,e,s,i){var r,h,c,l,d,u,p,g,v,m,f,A,b,_,O,E,C,y,w;return h=(r=new n.A(o.A.COORDS_BY_SCREEN,[t.Xprev,t.Yprev],this).usrCoords)[1],c=r[2],l=(r=new n.A(o.A.COORDS_BY_SCREEN,[e.Xprev,e.Yprev],this).usrCoords)[1],d=r[2],g=(r=new n.A(o.A.COORDS_BY_SCREEN,[t.X,t.Y],this).usrCoords)[1],v=r[2],m=(r=new n.A(o.A.COORDS_BY_SCREEN,[e.X,e.Y],this).usrCoords)[1],f=r[2],u=l-h,p=d-c,A=m-g,b=f-v,E=u*u+p*p,_=(A*u+b*p)/E,O=(b*u-A*p)/E,s||(w=a.A.hypot(_,O),_/=w,O/=w),i||(O=0),C=.5*(g+m-_*(h+l)+O*(c+d)),y=.5*(v+f-O*(h+l)-_*(c+d)),[1,0,0,C,_,-O,y,O,_]},twoFingerTouchObject:function(t,e,s){var i,n,r,h,a,c=!1;if(g.A.exists(t[0])&&g.A.exists(t[1])&&!isNaN(t[0].Xprev+t[0].Yprev+t[1].Xprev+t[1].Yprev)){if(n=this.getTwoFingerTransform(t[0],t[1],e.evalVisProp("scalable"),e.evalVisProp("rotatable")),(i=this.create("transform",n,{type:"generic"})).update(),e.elementClass===o.A.OBJECT_CLASS_LINE)r=[],e.point1.draggable()&&r.push(e.point1),e.point2.draggable()&&r.push(e.point2),i.applyOnce(r);else if(e.type===o.A.OBJECT_TYPE_POLYGON){for(h=0,a=e.vertices.length-1,c=e.evalVisProp("snaptogrid")||e.evalVisProp("snaptopoints");h<a&&!c;++h)c=(c=c||e.vertices[h].evalVisProp("snaptogrid")||e.vertices[h].evalVisProp("snaptopoints"))||!e.vertices[h].draggable();if(!c){for(h=0,r=[];h<a;++h)e.vertices[h].draggable()&&r.push(e.vertices[h]);i.applyOnce(r)}}this.update(),e.highlight(!0)}},twoFingerTouchCircle:function(t,e,s){var i,r,h,a,l,d,u,p,v,m,f;"pointCircle"!==e.method&&"pointLine"!==e.method&&g.A.exists(t[0])&&g.A.exists(t[1])&&!isNaN(t[0].Xprev+t[0].Yprev+t[1].Xprev+t[1].Yprev)&&(s===t[0].num?(i=t[1],r=t[0]):(i=t[0],r=t[1]),l=new n.A(o.A.COORDS_BY_SCREEN,[i.Xprev,i.Yprev],this).usrCoords,a=new n.A(o.A.COORDS_BY_SCREEN,[r.Xprev,r.Yprev],this).usrCoords,h=new n.A(o.A.COORDS_BY_SCREEN,[r.X,r.Y],this).usrCoords,u=c.A.rad(a.slice(1),l.slice(1),h.slice(1)),p=this.create("transform",[-l[1],-l[2]],{type:"translate"}),v=this.create("transform",[u],{type:"rotate"}),p.melt(v),e.evalVisProp("scalable")&&(d=c.A.distance(l,h)/c.A.distance(l,a),m=this.create("transform",[d,d],{type:"scale"}),p.melt(m)),f=this.create("transform",[l[1],l[2]],{type:"translate"}),p.melt(f),e.center.draggable()&&p.applyOnce([e.center]),"twoPoints"===e.method?e.point2.draggable()&&p.applyOnce([e.point2]):"pointRadius"===e.method&&g.A.isNumber(e.updateRadius.origin)&&e.setRadius(e.radius*d),this.update(e.center),e.highlight(!0))},highlightElements:function(t,e,s,i){var o,n,r,h={},a=this.objectsList.length;for(o=0;o<a;o++)r=(n=this.objectsList[o]).id,g.A.exists(n.hasPoint)&&n.visPropCalc.visible&&n.hasPoint(t,e)&&(this.updateInfobox(n),g.A.exists(this.highlightedObjects[r])||(h[r]=n,n.highlight(),this.triggerEventHandlers(["mousehit","hit"],[s,n,i])),n.mouseover?n.triggerEventHandlers(["mousemove","move"],[s]):(n.triggerEventHandlers(["mouseover","over"],[s]),n.mouseover=!0));for(o=0;o<a;o++)r=(n=this.objectsList[o]).id,n.mouseover&&!h[r]&&(n.triggerEventHandlers(["mouseout","out"],[s]),n.mouseover=!1)},saveStartPos:function(t,e){var s,n,r=[];if(t.type===o.A.OBJECT_TYPE_TICKS)r.push([1,NaN,NaN]);else if(t.elementClass===o.A.OBJECT_CLASS_LINE)r.push(t.point1.coords.usrCoords),r.push(t.point2.coords.usrCoords);else if(t.elementClass===o.A.OBJECT_CLASS_CIRCLE)r.push(t.center.coords.usrCoords),"twoPoints"===t.method&&r.push(t.point2.coords.usrCoords);else if(t.type===o.A.OBJECT_TYPE_POLYGON)for(s=0,n=t.vertices.length-1;s<n;s++)r.push(t.vertices[s].coords.usrCoords);else if(t.type===o.A.OBJECT_TYPE_SECTOR)r.push(t.point1.coords.usrCoords),r.push(t.point2.coords.usrCoords),r.push(t.point3.coords.usrCoords);else if(g.A.isPoint(t)||t.type===o.A.OBJECT_TYPE_GLIDER)r.push(t.coords.usrCoords);else if(t.elementClass===o.A.OBJECT_CLASS_CURVE)t.points.length>0&&r.push(t.points[0].usrCoords);else try{r.push(t.coords.usrCoords)}catch(t){i.A.debug("JSXGraph+ saveStartPos: obj.coords.usrCoords not available: "+t)}for(s=0,n=r.length;s<n;s++)e.Zstart.push(r[s][0]),e.Xstart.push(r[s][1]),e.Ystart.push(r[s][2])},mouseOriginMoveStart:function(t){var e,s;return(e=this._isRequiredKeyPressed(t,"pan"))&&(s=this.getMousePosition(t),this.initMoveOrigin(s[0],s[1])),e},mouseOriginMove:function(t){var e,s=this.mode===this.BOARD_MODE_MOVE_ORIGIN;return s&&(e=this.getMousePosition(t),this.moveOrigin(e[0],e[1],!0)),s},touchStartMoveOriginOneFinger:function(t){var e,s,i=t.touches;return(e=this.attr.pan.enabled&&!this.attr.pan.needtwofingers&&1===i.length)&&(s=this.getMousePosition(t,0),this.initMoveOrigin(s[0],s[1])),e},touchOriginMove:function(t){var e,s=this.mode===this.BOARD_MODE_MOVE_ORIGIN;return s&&(e=this.getMousePosition(t,0),this.moveOrigin(e[0],e[1],!0)),s},originMoveEnd:function(){this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE},suppressDefault:function(t){return g.A.exists(t)&&t.preventDefault(),!1},addEventHandlers:function(){m.A.supportsPointerEvents()?this.addPointerEventHandlers():(this.addMouseEventHandlers(),this.addTouchEventHandlers()),null!==this.containerObj&&m.A.addEvent(this.containerObj,"contextmenu",this.suppressDefault,this)},removeEventHandlers:function(){(this.hasPointerHandlers||this.hasMouseHandlers||this.hasTouchHandlers)&&null!==this.containerObj&&m.A.removeEvent(this.containerObj,"contextmenu",this.suppressDefault,this),this.removeMouseEventHandlers(),this.removeTouchEventHandlers(),this.removePointerEventHandlers(),this.removeFullscreenEventHandlers(),this.removeKeyboardEventHandlers(),this.removeResizeEventHandlers()},addResizeEventHandlers:function(){if(this.resizeHandlers=[],m.A.isBrowser){try{this.startResizeObserver(),this.resizeHandlers.push("resizeobserver")}catch(t){m.A.addEvent(window,"resize",this.resizeListener,this),this.startIntersectionObserver(),this.resizeHandlers.push("resize")}m.A.addEvent(window,"scroll",this.scrollListener,this),this.resizeHandlers.push("scroll");try{window.matchMedia("print").addEventListener("change",this.printListenerMatch.bind(this)),window.matchMedia("screen").addEventListener("change",this.printListenerMatch.bind(this)),this.resizeHandlers.push("print")}catch(t){i.A.debug("Error adding printListener",t)}}},removeResizeEventHandlers:function(){var t;if(this.resizeHandlers.length>0&&m.A.isBrowser){for(t=0;t<this.resizeHandlers.length;t++)switch(this.resizeHandlers[t]){case"resizeobserver":g.A.exists(this.resizeObserver)&&this.stopResizeObserver();break;case"resize":m.A.removeEvent(window,"resize",this.resizeListener,this),g.A.exists(this.intersectionObserver)&&this.stopIntersectionObserver();break;case"scroll":m.A.removeEvent(window,"scroll",this.scrollListener,this);break;case"print":window.matchMedia("print").removeEventListener("change",this.printListenerMatch.bind(this),!1),window.matchMedia("screen").removeEventListener("change",this.printListenerMatch.bind(this),!1)}this.resizeHandlers=[]}},addPointerEventHandlers:function(){if(!this.hasPointerHandlers&&m.A.isBrowser){var t=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(m.A.addEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),m.A.addEvent(t,"MSPointerMove",this.pointerMoveListener,this)):(m.A.addEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),m.A.addEvent(t,"pointermove",this.pointerMoveListener,this),m.A.addEvent(t,"pointerleave",this.pointerLeaveListener,this),m.A.addEvent(t,"click",this.pointerClickListener,this),m.A.addEvent(t,"dblclick",this.pointerDblClickListener,this)),null!==this.containerObj&&(this.containerObj.style.touchAction="none"),this.hasPointerHandlers=!0}},addMouseEventHandlers:function(){if(!this.hasMouseHandlers&&m.A.isBrowser){var t=this.attr.movetarget||this.containerObj;m.A.addEvent(this.containerObj,"mousedown",this.mouseDownListener,this),m.A.addEvent(t,"mousemove",this.mouseMoveListener,this),m.A.addEvent(t,"click",this.mouseClickListener,this),m.A.addEvent(t,"dblclick",this.mouseDblClickListener,this),this.hasMouseHandlers=!0}},addTouchEventHandlers:function(t){if(!this.hasTouchHandlers&&m.A.isBrowser){var e=this.attr.movetarget||this.containerObj;m.A.addEvent(this.containerObj,"touchstart",this.touchStartListener,this),m.A.addEvent(e,"touchmove",this.touchMoveListener,this),this.hasTouchHandlers=!0}},addWheelEventHandlers:function(){!this.hasWheelHandlers&&m.A.isBrowser&&(m.A.addEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),m.A.addEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this),this.hasWheelHandlers=!0)},addFullscreenEventHandlers:function(){var t,e=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],s=e.length;if(!this.hasFullscreenEventHandlers&&m.A.isBrowser){for(t=0;t<s;t++)m.A.addEvent(this.document,e[t],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!0}},addKeyboardEventHandlers:function(){this.attr.keyboard.enabled&&!this.hasKeyboardHandlers&&m.A.isBrowser&&(m.A.addEvent(this.containerObj,"keydown",this.keyDownListener,this),m.A.addEvent(this.containerObj,"focusin",this.keyFocusInListener,this),m.A.addEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!0)},removeKeyboardEventHandlers:function(){this.hasKeyboardHandlers&&m.A.isBrowser&&(m.A.removeEvent(this.containerObj,"keydown",this.keyDownListener,this),m.A.removeEvent(this.containerObj,"focusin",this.keyFocusInListener,this),m.A.removeEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!1)},removeFullscreenEventHandlers:function(){var t,e=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],s=e.length;if(this.hasFullscreenEventHandlers&&m.A.isBrowser){for(t=0;t<s;t++)m.A.removeEvent(this.document,e[t],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!1}},removePointerEventHandlers:function(){if(this.hasPointerHandlers&&m.A.isBrowser){var t=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(m.A.removeEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),m.A.removeEvent(t,"MSPointerMove",this.pointerMoveListener,this)):(m.A.removeEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),m.A.removeEvent(t,"pointermove",this.pointerMoveListener,this),m.A.removeEvent(t,"pointerleave",this.pointerLeaveListener,this),m.A.removeEvent(t,"click",this.pointerClickListener,this),m.A.removeEvent(t,"dblclick",this.pointerDblClickListener,this)),this.hasWheelHandlers&&(m.A.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),m.A.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasPointerUp&&(window.navigator.msPointerEnabled?m.A.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(m.A.removeEvent(this.document,"pointerup",this.pointerUpListener,this),m.A.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this.hasPointerHandlers=!1}},removeMouseEventHandlers:function(){if(this.hasMouseHandlers&&m.A.isBrowser){var t=this.attr.movetarget||this.containerObj;m.A.removeEvent(this.containerObj,"mousedown",this.mouseDownListener,this),m.A.removeEvent(t,"mousemove",this.mouseMoveListener,this),m.A.removeEvent(t,"click",this.mouseClickListener,this),m.A.removeEvent(t,"dblclick",this.mouseDblClickListener,this),this.hasMouseUp&&(m.A.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.hasWheelHandlers&&(m.A.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),m.A.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasMouseHandlers=!1}},removeTouchEventHandlers:function(){if(this.hasTouchHandlers&&m.A.isBrowser){var t=this.attr.movetarget||this.containerObj;m.A.removeEvent(this.containerObj,"touchstart",this.touchStartListener,this),m.A.removeEvent(t,"touchmove",this.touchMoveListener,this),this.hasTouchEnd&&(m.A.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.hasTouchHandlers=!1}},clickLeftArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]+.1*this.canvasWidth,this.origin.scrCoords[2]),this},clickRightArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]-.1*this.canvasWidth,this.origin.scrCoords[2]),this},clickUpArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]-.1*this.canvasHeight),this},clickDownArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]+.1*this.canvasHeight),this},gestureChangeListener:function(t){var e,s,i,r,h,a,l,d,u,p,v=[],m=[],f=!1,A=this.attr.zoom.factorx,b=this.attr.zoom.factory,_=!1;return this.mode!==this.BOARD_MODE_ZOOM||(t.preventDefault(),r=c.A.distance([t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY],2),void 0===t.scale&&(t.scale=r/this.prevDist),!!g.A.exists(this.prevCoords)&&(v=[t.touches[0].clientX-this.prevCoords[0][0],t.touches[0].clientY-this.prevCoords[0][1]],m=[t.touches[1].clientX-this.prevCoords[1][0],t.touches[1].clientY-this.prevCoords[1][1]],(!(v[0]*v[0]+v[1]*v[1]<100)||!(m[0]*m[0]+m[1]*m[1]<100))&&(s=c.A.rad(v,[0,0],m),"pan"!==this.isPreviousGesture&&Math.abs(s)>.2*Math.PI&&Math.abs(s)<1.8*Math.PI&&(f=!0),"pan"!==this.isPreviousGesture&&!f&&(.77>Math.abs(t.scale)||Math.abs(t.scale)>1.3)&&(f=!0),i=t.scale/this.prevScale,this.prevScale=t.scale,this.prevCoords=[[t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY]],e=new n.A(o.A.COORDS_BY_SCREEN,this.getMousePosition(t,0),this),this.attr.pan.enabled&&this.attr.pan.needtwofingers&&!f?(this.isPreviousGesture="pan",this.moveOrigin(e.scrCoords[1],e.scrCoords[2],!0)):this.attr.zoom.enabled&&.5>Math.abs(i-1)&&(_=!1,l=this.attr.zoom.center,(this.attr.zoom.pinchhorizontal||this.attr.zoom.pinchvertical)&&(d=Math.abs(t.touches[0].clientX-t.touches[1].clientX),h=Math.abs(Math.atan2(Math.abs(t.touches[0].clientY-t.touches[1].clientY),d)),a=Math.PI*this.attr.zoom.pinchsensitivity/90),!this.keepaspectratio&&this.attr.zoom.pinchhorizontal&&h<a?(this.attr.zoom.factorx=i,this.attr.zoom.factory=1,u=0,p=0,_=!0):!this.keepaspectratio&&this.attr.zoom.pinchvertical&&Math.abs(h-.5*Math.PI)<a?(this.attr.zoom.factorx=1,this.attr.zoom.factory=i,u=0,p=0,_=!0):this.attr.zoom.pinch&&(this.attr.zoom.factorx=i,this.attr.zoom.factory=i,u=e.usrCoords[1],p=e.usrCoords[2],_=!0),_&&("board"===l?this.zoomIn():this.zoomIn(u,p),this.attr.zoom.factorx=A,this.attr.zoom.factory=b)),!1)))},gestureStartListener:function(t){var e;return t.preventDefault(),this.prevScale=1,this.prevDist=c.A.distance([t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY],2),this.prevCoords=[[t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY]],this.isPreviousGesture="none",e=this.getMousePosition(t,0),this.initMoveOrigin(e[0],e[1]),this.mode=this.BOARD_MODE_ZOOM,!1},_isRequiredKeyPressed:function(t,e){var s=this.attr[e];return!!s.enabled&&(!!s.needshift&&!!t.shiftKey||!s.needshift&&!t.shiftKey)&&(!!s.needctrl&&!!t.ctrlKey||!s.needctrl&&!t.ctrlKey)},_isPointerRegistered:function(t){var e,s=this._board_touches.length;for(e=0;e<s;e++)if(this._board_touches[e].pointerId===t.pointerId)return!0;return!1},_pointerStorePosition:function(t){var e,s;for(e=0,s=!1;e<this._board_touches.length;e++)if(this._board_touches[e].pointerId===t.pointerId){this._board_touches[e].clientX=t.clientX,this._board_touches[e].clientY=t.clientY,s=!0;break}return!s&&this._board_touches.length<2&&this._board_touches.push({pointerId:t.pointerId,clientX:t.clientX,clientY:t.clientY}),this},_pointerRemoveTouches:function(t){var e;for(e=0;e<this._board_touches.length;e++)if(this._board_touches[e].pointerId===t.pointerId){this._board_touches.splice(e,1);break}return this},_pointerClearTouches:function(t){this._board_touches.length>0&&this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE,this._board_touches=[],this.touches=[]},_getPointerInputDevice:function(t){if(m.A.isBrowser){if("touch"===t.pointerType||window.navigator.msMaxTouchPoints&&window.navigator.msMaxTouchPoints>1)return"touch";if("mouse"===t.pointerType)return"mouse";if("pen"===t.pointerType)return"pen"}return"mouse"},pointerDownListener:function(t,e,s){var i,o,n,r,h,a,c,l,d,u,p="mouse";if(!e&&this._isPointerRegistered(t))return!1;if(null===g.A.evaluate(this.attr.movetarget)&&g.A.exists(t.target)&&g.A.exists(t.target.releasePointerCapture)&&t.target.releasePointerCapture(t.pointerId),e||t.isPrimary,this.hasPointerUp||(window.navigator.msPointerEnabled?m.A.addEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(m.A.addEvent(this.document,"pointerup",this.pointerUpListener,this),m.A.addEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!0),this.hasMouseHandlers&&this.removeMouseEventHandlers(),this.hasTouchHandlers&&this.removeTouchEventHandlers(),this.document.selection&&g.A.isFunction(this.document.selection.empty))this.document.selection.empty();else if(window.getSelection&&(a=window.getSelection()).removeAllRanges)try{a.removeAllRanges()}catch(t){}if(this._inputDevice=this._getPointerInputDevice(t),p=this._inputDevice,this.options.precision.hasPoint=this.options.precision[p],r=this.getMousePosition(t),this._testForSelection(t),this.selectingMode){this._startSelecting(r),this.triggerEventHandlers(["touchstartselecting","pointerstartselecting","startselecting"],[t]);return}if(this.attr.drag.enabled&&e?(h=[e],this.mode=this.BOARD_MODE_DRAG):h=this.initMoveObject(r[0],r[1],t,p),c={num:t.pointerId,X:r[0],Y:r[1],Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},h.length>0){for(i=0,d=h[h.length-1],l=!1;i<this.touches.length;i++)if(this.touches[i].obj===d){o=i,n=this.touches[i].targets.push(c)-1,l=!0;break}l||(n=0,o=this.touches.push({obj:d,targets:[c]})-1),this.dehighlightAll(),d.highlight(!0),this.saveStartPos(d,this.touches[o].targets[n]),t&&t.preventDefault&&!s&&t.preventDefault()}return this.touches.length>0&&!s&&(t.preventDefault(),t.stopPropagation()),!!m.A.isBrowser&&("touch"!==this._getPointerInputDevice(t)?this.mode===this.BOARD_MODE_NONE&&this.mouseOriginMoveStart(t):(this._pointerStorePosition(t),t.touches=this._board_touches,1===t.touches.length&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(t)||2===t.touches.length&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(t))),u="none",this.mode===this.BOARD_MODE_NONE&&(!0===g.A.evaluate(this.attr.browserpan)||!0===g.A.evaluate(this.attr.browserpan.enabled))&&(!1===g.A.evaluate(this.attr.pan.enabled)||!0===g.A.evaluate(this.attr.pan.needtwofingers))&&(u="auto"),this.containerObj.style.touchAction=u,this.triggerEventHandlers(["touchstart","down","pointerdown","MSPointerDown"],[t]),!0)},_handleClicks:function(t,e){var s,i,o=this;if(this.selectingMode)return void t.stopPropagation();if(i=g.A.evaluate(this.attr.clickdelay),g.A.evaluate(this.attr.dblclicksuppressclick))this._preventSingleClick=!1,this._singleClickTimer=setTimeout(function(){if(!o._preventSingleClick)for(s in o.triggerEventHandlers(e,[t]),o.clickObjects)o.clickObjects.hasOwnProperty(s)&&(o.clickObjects[s].triggerEventHandlers(e,[t]),delete o.clickObjects[s])},i);else{for(s in o.triggerEventHandlers(e,[t]),o.clickObjects)o.clickObjects.hasOwnProperty(s)&&o.clickObjects[s].triggerEventHandlers(e,[t]);setTimeout(function(){for(s in o.clickObjects)o.clickObjects.hasOwnProperty(s)&&delete o.clickObjects[s]},i)}t.stopPropagation()},_handleDblClicks:function(t,e){var s;if(this.selectingMode)return void t.stopPropagation();for(s in this._preventSingleClick=!0,clearTimeout(this._singleClickTimer),this.triggerEventHandlers(e,[t]),this.clickObjects)this.clickObjects.hasOwnProperty(s)&&(this.clickObjects[s].triggerEventHandlers(e,[t]),delete this.clickObjects[s]);t.stopPropagation()},pointerClickListener:function(t){this._handleClicks(t,["click","pointerclick"])},pointerDblClickListener:function(t){this._handleDblClicks(t,["dblclick","pointerdblclick"])},mouseClickListener:function(t){this._handleClicks(t,["click","mouseclick"])},mouseDblClickListener:function(t){this._handleDblClicks(t,["dblclick","mousedblclick"])},pointerMoveListener:function(t){var e,s,i,o,n,r="mouse";if("touch"===this._getPointerInputDevice(t)&&!this._isPointerRegistered(t))return this.BOARD_MODE_NONE;if(!this.checkFrameRate(t))return!1;if(this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.mode!==this.BOARD_MODE_NONE&&(t.preventDefault(),t.stopPropagation()),this.updateQuality=this.BOARD_QUALITY_LOW,this._inputDevice=this._getPointerInputDevice(t),r=this._inputDevice,this.options.precision.hasPoint=this.options.precision[r],o=.3333*this.options.precision.hasPoint,i=this.getMousePosition(t),null===g.A.evaluate(this.attr.movetarget)&&i[0]<=o||i[1]<=o||i[0]>=this.canvasWidth-o||i[1]>=this.canvasHeight-o)return this.mode===this.BOARD_MODE_NONE;if(this.selectingMode)this._moveSelecting(i),this.triggerEventHandlers(["touchmoveselecting","moveselecting","pointermoveselecting"],[t,this.mode]);else if(!this.mouseOriginMove(t))if(this.mode===this.BOARD_MODE_DRAG){for(e=0;e<this.touches.length;e++)for(s=0,n=this.touches[e].targets;s<n.length;s++)if(n[s].num===t.pointerId){n[s].X=i[0],n[s].Y=i[1],1===n.length?this.moveObject(i[0],i[1],this.touches[e],t,r):2===n.length&&(this.twoFingerMove(this.touches[e],t.pointerId,t),n[s].Xprev=i[0],n[s].Yprev=i[1]);break}}else"touch"===this._getPointerInputDevice(t)&&(this._pointerStorePosition(t),2===this._board_touches.length&&(t.touches=this._board_touches,this.gestureChangeListener(t))),this.highlightElements(i[0],i[1],t,-1);return this.triggerEventHandlers(["pointermove","MSPointerMove","move"],[t,this.mode]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},pointerUpListener:function(t){var e,s,i,o,n,r=!1;if(this.triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[t]),this.displayInfobox(!1),t){for(e=0;e<this.touches.length;e++)for(s=0,n=this.touches[e].targets;s<n.length;s++)if(n[s].num===t.pointerId){n.splice(s,1),0===n.length&&this.touches.splice(e,1);break}}if(this.originMoveEnd(),this.update(),this.selectingMode)this._stopSelecting(t),this.triggerEventHandlers(["touchstopselecting","pointerstopselecting","stopselecting"],[t]),this.stopSelectionMode();else for(e=this.downObjects.length-1;e>-1;e--){for(s=0,i=!1;s<this.touches.length;s++)this.touches[s].obj.id===this.downObjects[e].id&&(i=!0);i||(this.downObjects[e].triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[t]),g.A.exists(this.downObjects[e].coords)||(this.downObjects[e].snapToGrid(),this.downObjects[e].snapToPoints(),r=!0),o=this.downObjects[e].eventHandlers,(g.A.exists(o.click)&&o.click.length>0||g.A.exists(o.pointerclick)&&o.pointerclick.length>0||g.A.exists(o.dblclick)&&o.dblclick.length>0||g.A.exists(o.pointerdblclick)&&o.pointerdblclick.length>0)&&(this.clickObjects[this.downObjects[e].id]=this.downObjects[e]),this.downObjects.splice(e,1))}return this.hasPointerUp&&(window.navigator.msPointerEnabled?m.A.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(m.A.removeEvent(this.document,"pointerup",this.pointerUpListener,this),m.A.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this._pointerClearTouches(t.pointerId),"touch"!==this._getPointerInputDevice(t)&&this.dehighlightAll(),r&&this.update(),!0},pointerLeaveListener:function(t){return this.displayInfobox(!1),this.dehighlightAll(),!0},touchStartListener:function(t){var e,s,n,h,a,c,l,d,u,p,v=this.options.precision.touch,f=t.touches;for(this.hasTouchEnd||(m.A.addEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!0),this.document.selection&&g.A.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,e=0;e<f.length;e++)f[e].jxg_isused=!1;for(e=0;e<this.touches.length;e++)for(s=0,p=this.touches[e].targets;s<p.length;s++){p[s].num=-1,v=this.options.precision.touch;do{for(n=0;n<f.length;n++)if(Math.abs(Math.pow(f[n].screenX-p[s].X,2)+Math.pow(f[n].screenY-p[s].Y,2))<v*v){p[s].num=n,p[s].X=f[n].screenX,p[s].Y=f[n].screenY,f[n].jxg_isused=!0;break}v*=2}while(-1===p[s].num&&v<this.options.precision.touchMax);-1===p[s].num&&(i.A.debug("i couldn't find a targettouches for target no "+s+" on "+this.touches[e].obj.name+" ("+this.touches[e].obj.id+"). Removed the target."),i.A.debug("eps = "+v+", touchMax = "+r.A.precision.touchMax),p.splice(e,1))}for(e=0;e<f.length;e++)if(!f[e].jxg_isused){if(h=this.getMousePosition(t,e),this.selectingMode)return this._startSelecting(h),this.triggerEventHandlers(["touchstartselecting","startselecting"],[t]),t.preventDefault(),t.stopPropagation(),this.options.precision.hasPoint=this.options.precision.mouse,this.touches.length>0;if(0!==(a=this.initMoveObject(h[0],h[1],t,"touch")).length){if(c=a[a.length-1],u={num:e,X:f[e].screenX,Y:f[e].screenY,Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},g.A.isPoint(c)||c.elementClass===o.A.OBJECT_CLASS_TEXT||c.type===o.A.OBJECT_TYPE_TICKS||c.type===o.A.OBJECT_TYPE_IMAGE)d=[u],this.saveStartPos(c,d[0]),this.touches.push({obj:c,targets:d}),c.highlight(!0);else if(c.elementClass===o.A.OBJECT_CLASS_LINE||c.elementClass===o.A.OBJECT_CLASS_CIRCLE||c.elementClass===o.A.OBJECT_CLASS_CURVE||c.type===o.A.OBJECT_TYPE_POLYGON){for(s=0,l=!1;s<this.touches.length;s++)c.id===this.touches[s].obj.id&&(l=!0,1===this.touches[s].targets.length&&(this.saveStartPos(c,u),this.touches[s].targets.push(u)),f[e].jxg_isused=!0);l||(d=[u],this.saveStartPos(c,d[0]),this.touches.push({obj:c,targets:d}),c.highlight(!0))}}f[e].jxg_isused=!0}return this.touches.length>0&&(t.preventDefault(),t.stopPropagation()),1===f.length&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(t)||2===f.length&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(t)),this.options.precision.hasPoint=this.options.precision.mouse,this.triggerEventHandlers(["touchstart","down"],[t]),!1},touchMoveListener:function(t){var e,s,i,o,n=t.touches;if(!this.checkFrameRate(t))return!1;if(this.mode!==this.BOARD_MODE_NONE&&(t.preventDefault(),t.stopPropagation()),this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,this.updateQuality=this.BOARD_QUALITY_LOW,this.selectingMode){for(e=0;e<n.length;e++)if(!n[e].jxg_isused){s=this.getMousePosition(t,e),this._moveSelecting(s),this.triggerEventHandlers(["touchmoves","moveselecting"],[t,this.mode]);break}}else if(!this.touchOriginMove(t))if(this.mode===this.BOARD_MODE_DRAG){for(e=0;e<this.touches.length;e++)if(1===(o=this.touches[e].targets).length){if(n[o[0].num]){if((s=this.getMousePosition(t,o[0].num))[0]<0||s[0]>this.canvasWidth||s[1]<0||s[1]>this.canvasHeight)return;o[0].X=s[0],o[0].Y=s[1],this.moveObject(s[0],s[1],this.touches[e],t,"touch")}}else if(2===o.length&&o[0].num>-1&&o[1].num>-1&&n[o[0].num]&&n[o[1].num]){if(s=this.getMousePosition(t,o[0].num),i=this.getMousePosition(t,o[1].num),s[0]<0||s[0]>this.canvasWidth||s[1]<0||s[1]>this.canvasHeight||i[0]<0||i[0]>this.canvasWidth||i[1]<0||i[1]>this.canvasHeight)return;o[0].X=s[0],o[0].Y=s[1],o[1].X=i[0],o[1].Y=i[1],this.twoFingerMove(this.touches[e],o[0].num,t),o[0].Xprev=s[0],o[0].Yprev=s[1],o[1].Xprev=i[0],o[1].Yprev=i[1]}}else 2===n.length&&this.gestureChangeListener(t),s=this.getMousePosition(t,0),this.highlightElements(s[0],s[1],t,-1);return this.mode!==this.BOARD_MODE_DRAG&&this.displayInfobox(!1),this.triggerEventHandlers(["touchmove","move"],[t,this.mode]),this.options.precision.hasPoint=this.options.precision.mouse,this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},touchEndListener:function(t){var e,s,i,n,r,h,a=this.options.precision.touch,c=[],l=t&&t.touches,d=!1;if(this.triggerEventHandlers(["touchend","up"],[t]),this.displayInfobox(!1),this.selectingMode)this._stopSelecting(t),this.triggerEventHandlers(["touchstopselecting","stopselecting"],[t]),this.stopSelectionMode();else if(l&&l.length>0){for(e=0;e<this.touches.length;e++)c[e]=this.touches[e];for(e=0,this.touches.length=0;e<l.length;e++)l[e].jxg_isused=!1;for(e=0;e<c.length;e++){for(s=0,n=!1,r=0,h=c[e].targets;s<h.length;s++)for(i=0,h[s].found=!1;i<l.length;i++)if(Math.abs(Math.pow(l[i].screenX-h[s].X,2)+Math.pow(l[i].screenY-h[s].Y,2))<a*a){h[s].found=!0,h[s].num=i,h[s].X=l[i].screenX,h[s].Y=l[i].screenY,r+=1;break}if(g.A.isPoint(c[e].obj)?n=h[0]&&h[0].found:c[e].obj.elementClass===o.A.OBJECT_CLASS_LINE?n=h[0]&&h[0].found||h[1]&&h[1].found:c[e].obj.elementClass===o.A.OBJECT_CLASS_CIRCLE&&(n=1===r||3===r),n)for(this.touches.push({obj:c[e].obj,targets:[]}),s=0;s<h.length;s++)h[s].found&&this.touches[this.touches.length-1].targets.push({num:h[s].num,X:h[s].screenX,Y:h[s].screenY,Xprev:NaN,Yprev:NaN,Xstart:h[s].Xstart,Ystart:h[s].Ystart,Zstart:h[s].Zstart});else c[e].obj.noHighlight()}}else this.touches.length=0;for(e=this.downObjects.length-1;e>-1;e--){for(s=0,n=!1;s<this.touches.length;s++)this.touches[s].obj.id===this.downObjects[e].id&&(n=!0);n||(this.downObjects[e].triggerEventHandlers(["touchup","up"],[t]),g.A.exists(this.downObjects[e].coords)||(this.downObjects[e].snapToGrid(),this.downObjects[e].snapToPoints(),d=!0),this.downObjects.splice(e,1))}return(!l||0===l.length)&&(this.hasTouchEnd&&(m.A.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.originMoveEnd(),d&&this.update()),!0},mouseDownListener:function(t){var e,s,i;if(this.document.selection&&g.A.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),!this.hasMouseUp){if(m.A.addEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!0,this._inputDevice="mouse",this.options.precision.hasPoint=this.options.precision.mouse,e=this.getMousePosition(t),this._testForSelection(t),this.selectingMode){this._startSelecting(e),this.triggerEventHandlers(["mousestartselecting","startselecting"],[t]);return}return 0===(s=this.initMoveObject(e[0],e[1],t,"mouse")).length?(this.mode=this.BOARD_MODE_NONE,i=!0):(this.mouse={obj:null,targets:[{X:e[0],Y:e[1],Xprev:NaN,Yprev:NaN}]},this.mouse.obj=s[s.length-1],this.dehighlightAll(),this.mouse.obj.highlight(!0),this.mouse.targets[0].Xstart=[],this.mouse.targets[0].Ystart=[],this.mouse.targets[0].Zstart=[],this.saveStartPos(this.mouse.obj,this.mouse.targets[0]),t&&t.preventDefault?t.preventDefault():window.event&&(window.event.returnValue=!1)),this.mode===this.BOARD_MODE_NONE&&(i=this.mouseOriginMoveStart(t)),this.triggerEventHandlers(["mousedown","down"],[t]),i}},mouseMoveListener:function(t){var e;if(!this.checkFrameRate(t))return!1;e=this.getMousePosition(t),this.updateQuality=this.BOARD_QUALITY_LOW,this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.selectingMode?(this._moveSelecting(e),this.triggerEventHandlers(["mousemoveselecting","moveselecting"],[t,this.mode])):this.mouseOriginMove(t)||(this.mode===this.BOARD_MODE_DRAG?this.moveObject(e[0],e[1],this.mouse,t,"mouse"):this.highlightElements(e[0],e[1],t,-1),this.triggerEventHandlers(["mousemove","move"],[t,this.mode])),this.updateQuality=this.BOARD_QUALITY_HIGH},mouseUpListener:function(t){var e;if(!1===this.selectingMode&&this.triggerEventHandlers(["mouseup","up"],[t]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mouse&&this.mouse.obj&&!g.A.exists(this.mouse.obj.coords)&&(this.mouse.obj.snapToGrid(this.mouse.targets[0]),this.mouse.obj.snapToPoints()),this.originMoveEnd(),this.dehighlightAll(),this.update(),this.selectingMode)this._stopSelecting(t),this.triggerEventHandlers(["mousestopselecting","stopselecting"],[t]),this.stopSelectionMode();else for(e=0;e<this.downObjects.length;e++)this.downObjects[e].triggerEventHandlers(["mouseup","up"],[t]);this.downObjects.length=0,this.hasMouseUp&&(m.A.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.mouse=null},mouseWheelListener:function(t){var e,s;return!(this.attr.zoom.enabled&&this.attr.zoom.wheel&&this._isRequiredKeyPressed(t,"zoom"))||(e=(t=t||window.event).detail?-t.detail:t.wheelDelta/40,s="board"===this.attr.zoom.center?[]:new n.A(o.A.COORDS_BY_SCREEN,this.getMousePosition(t),this).usrCoords,e>0?this.zoomIn(s[1],s[2]):this.zoomOut(s[1],s[2]),this.triggerEventHandlers(["mousewheel"],[t]),t.preventDefault(),!1)},keyDownListener:function(t){var e,s,n,r,h,a,c=t.target.id,l=0,d=0,u=g.A.evaluate(this.attr.keyboard.dx)/this.unitX,p=g.A.evaluate(this.attr.keyboard.dy)/this.unitY,v=!1,m=!0;return!!this.attr.keyboard.enabled&&""!==c&&(!(r=this.containerObj.shadowRoot||document).activeElement||"INPUT"!==(s=r.activeElement).tagName&&"textarea"!==s.tagName)&&(e=c.replace(this.containerObj.id+"_",""),s=this.select(e),g.A.exists(s.coords)&&(a=s.coords.usrCoords.slice(1)),g.A.evaluate(this.attr.keyboard.panshift)&&t.shiftKey||g.A.evaluate(this.attr.keyboard.panctrl)&&t.ctrlKey?(!0===g.A.evaluate(this.attr.zoom.enabled)&&(v=!0),38===t.keyCode?this.clickUpArrow():40===t.keyCode?this.clickDownArrow():37===t.keyCode?this.clickLeftArrow():39===t.keyCode?this.clickRightArrow():v&&171===t.keyCode?this.zoomIn():v&&173===t.keyCode?this.zoomOut():v&&79===t.keyCode?this.zoom100():m=!1):!t.shiftKey&&!t.ctrlKey&&(g.A.exists(s.visProp)&&(g.A.exists(s.visProp.snaptogrid)&&s.visProp.snaptogrid&&s.evalVisProp("snapsizex")&&s.evalVisProp("snapsizey")?(l=(n=s.getSnapSizes())[0],d=n[1],u=l,p=d):g.A.exists(s.visProp.attracttogrid)&&s.visProp.attracttogrid&&s.evalVisProp("attractordistance")&&s.evalVisProp("attractorunit")&&(d=l=1.1*s.evalVisProp("attractordistance"),"screen"===s.evalVisProp("attractorunit")&&(l/=this.unitX,d/=this.unitX),u=Math.max(l,u),p=Math.max(d,p))),38===t.keyCode?h=[0,p]:40===t.keyCode?h=[0,-p]:37===t.keyCode?h=[-u,0]:39===t.keyCode?h=[u,0]:m=!1,h&&s.isDraggable&&s.visPropCalc.visible&&(this.geonextCompatibilityMode&&(g.A.isPoint(s)||s.elementClass===o.A.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!s.evalVisProp("fixed")&&(this.mode=this.BOARD_MODE_DRAG,g.A.exists(s.coords)&&(h[0]+=a[0],h[1]+=a[1]),g.A.exists(s.coords)?(s.setPosition(i.A.COORDS_BY_USER,h),this.updateInfobox(s)):(this.displayInfobox(!1),s.setPositionDirectly(o.A.COORDS_BY_USER,h,[0,0])),this.triggerEventHandlers(["keymove","move"],[t,this.mode]),s.triggerEventHandlers(["keydrag","drag"],[t]),this.mode=this.BOARD_MODE_NONE)),this.update(),m&&g.A.exists(t.preventDefault)&&t.preventDefault(),m)},keyFocusInListener:function(t){var e,s,i=t.target.id;if(!this.attr.keyboard.enabled||""===i)return!1;e=i.replace(this.containerObj.id+"_",""),s=this.select(e),g.A.exists(s.highlight)&&(s.highlight(!0),this.focusObjects=[e],s.triggerEventHandlers(["hit"],[t])),g.A.exists(s.coords)&&this.updateInfobox(s)},keyFocusOutListener:function(t){if(!this.attr.keyboard.enabled)return!1;this.focusObjects=[],this.dehighlightAll(),this.displayInfobox(!1)},updateContainerDims:function(t,e){var s,i,o,n=t,r=e;return void 0===t&&(n=this.containerObj.offsetWidth,r=this.containerObj.offsetHeight),void 0===t&&window&&window.getComputedStyle&&(isNaN(i=parseFloat((s=window.getComputedStyle(this.containerObj,null)).getPropertyValue("border-left-width"))+parseFloat(s.getPropertyValue("border-right-width")))||(n-=i),isNaN(o=parseFloat(s.getPropertyValue("border-top-width"))+parseFloat(s.getPropertyValue("border-bottom-width")))||(r-=o)),n<=0||r<=0||isNaN(n)||isNaN(r)||(isNaN(this.getBoundingBox()[0])&&this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"keep"),g.A.exists(this._prevDim)&&this._prevDim.w===n&&this._prevDim.h===r||(this.resizeContainer(n,r,!0),this._prevDim={w:n,h:r})),this},startResizeObserver:function(){var t=this;m.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&(this.resizeObserver=new ResizeObserver(function(e){var s;t._isResizing||(t._isResizing=!0,s=e[0].contentRect,window.setTimeout(function(){try{t.updateContainerDims(s.width,s.height)}catch(e){i.A.debug(e),t.stopResizeObserver()}finally{t._isResizing=!1}},t.attr.resize.throttle))}),this.resizeObserver.observe(this.containerObj))},stopResizeObserver:function(){m.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&g.A.exists(this.resizeObserver)&&this.resizeObserver.unobserve(this.containerObj)},resizeListener:function(){var t=this;m.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&(this._isScrolling||this._isResizing||(this._isResizing=!0,window.setTimeout(function(){t.updateContainerDims(),t._isResizing=!1},this.attr.resize.throttle)))},scrollListener:function(t){var e=this;m.A.isBrowser&&(this._isScrolling||(this._isScrolling=!0,window.setTimeout(function(){e._isScrolling=!1},66)))},startIntersectionObserver:function(){var t=this;try{this.intersectionObserver=new IntersectionObserver(function(e){isNaN(t.getBoundingBox()[0])&&t.updateContainerDims()},{root:null,rootMargin:"0px",threshold:.8}),this.intersectionObserver.observe(t.containerObj)}catch(t){i.A.debug("JSXGraph: IntersectionObserver not available in this browser.")}},stopIntersectionObserver:function(){g.A.exists(this.intersectionObserver)&&this.intersectionObserver.unobserve(this.containerObj)},printListener:function(t){this.updateContainerDims()},printListenerMatch:function(t){t.matches&&this.printListener()},initInfobox:function(t){var e=g.A.copyAttributes(t,this.options,"infobox");return e.id=this.id+"_infobox",this.infobox=this.create("text",[0,0,"0,0"],e),this.infobox.dump=!1,this.displayInfobox(!1),this},updateInfobox:function(t){var e,s,i,o,n,r,h,a=t.evalVisProp("showinfobox");return(g.A.evaluate(this.attr.showinfobox)||"inherit"!==a)&&a&&g.A.isPoint(t)&&(i=t.coords.usrCoords[1],o=t.coords.usrCoords[2],r=this.infobox.evalVisProp("distancex"),h=this.infobox.evalVisProp("distancey"),this.infobox.setCoords(i+r/this.unitX,o+h/this.unitY),n=t.evalVisProp("infoboxdigits"),"string"!=typeof t.infoboxText?("auto"===n?this.infobox.useLocale()?(e=this.infobox.formatNumberLocale(i),s=this.infobox.formatNumberLocale(o)):(e=g.A.autoDigits(i),s=g.A.autoDigits(o)):g.A.isNumber(n)?this.infobox.useLocale()?(e=this.infobox.formatNumberLocale(i,n),s=this.infobox.formatNumberLocale(o,n)):(e=g.A.toFixed(i,n),s=g.A.toFixed(o,n)):(e=i,s=o),this.highlightInfobox(e,s,t)):this.highlightCustomInfobox(t.infoboxText,t),this.displayInfobox(!0)),this},displayInfobox:function(t){return!t&&this.focusObjects.length>0&&this.select(this.focusObjects[0]).elementClass===o.A.OBJECT_CLASS_POINT||this.infobox.hiddenByParent===t&&(this.infobox.hiddenByParent=!t,this.infobox.prepareUpdate().updateVisibility(t).updateRenderer()),this},showInfobox:function(t){return this.displayInfobox(t)},highlightInfobox:function(t,e,s){return this.highlightCustomInfobox("("+t+", "+e+")",s),this},highlightCustomInfobox:function(t,e){return this.infobox.setText(t),this},dehighlightAll:function(){var t,e,s={},i=!1;for(t in this.highlightedObjects)this.highlightedObjects.hasOwnProperty(t)&&(e=this.highlightedObjects[t],0>this.focusObjects.indexOf(t)?((this.hasMouseHandlers||this.hasPointerHandlers)&&e.noHighlight(),i=!0):s[t]=e);return this.highlightedObjects=s,"canvas"===this.renderer.type&&i&&(this.prepareUpdate(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw()),this},getScrCoordsOfMouse:function(t,e){return[t,e]},getUsrCoordsOfMouse:function(t){var e=this.getCoordsTopLeftCorner(),s=m.A.getPosition(t,null,this.document),i=s[0]-e[0],r=s[1]-e[1];return new n.A(o.A.COORDS_BY_SCREEN,[i,r],this).usrCoords.slice(1)},getAllUnderMouse:function(t){var e=this.getAllObjectsUnderMouse(t);return e.push(this.getUsrCoordsOfMouse(t)),e},getAllObjectsUnderMouse:function(t){var e,s,i=this.getCoordsTopLeftCorner(),o=m.A.getPosition(t,null,this.document),n=o[0]-i[0],r=o[1]-i[1],h=[],a=this.objectsList.length;for(e=0;e<a;e++)(s=this.objectsList[e]).visPropCalc.visible&&s.hasPoint&&s.hasPoint(n,r)&&(h[h.length]=s);return h},updateCoords:function(){var t,e,s=this.objectsList.length;for(e=0;e<s;e++)t=this.objectsList[e],g.A.exists(t.coords)&&(t.evalVisProp("frozen")?t.is3D?t.element2D.coords.screen2usr():t.coords.screen2usr():t.is3D?t.element2D.coords.usr2screen():(t.coords.usr2screen(),g.A.exists(t.actualCoords)&&t.actualCoords.usr2screen()));return this},moveOrigin:function(t,e,s){var i,r,h,c;return g.A.exists(t)&&g.A.exists(e)&&(i=this.origin.scrCoords[1],r=this.origin.scrCoords[2],this.origin.scrCoords[1]=t,this.origin.scrCoords[2]=e,s&&(this.origin.scrCoords[1]-=this.drag_dx,this.origin.scrCoords[2]-=this.drag_dy),h=new n.A(o.A.COORDS_BY_SCREEN,[0,0],this).usrCoords,c=new n.A(o.A.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords,(h[1]<this.maxboundingbox[0]-a.A.eps||h[2]>this.maxboundingbox[1]+a.A.eps||c[1]>this.maxboundingbox[2]+a.A.eps||c[2]<this.maxboundingbox[3]-a.A.eps)&&(this.origin.scrCoords[1]=i,this.origin.scrCoords[2]=r)),this.updateCoords().clearTraces().fullUpdate(),this.triggerEventHandlers(["boundingbox"]),this},addConditions:function(t){var e,s,n,r,h,a,c,l=[],d=t.indexOf("<data>"),u=t.indexOf("</data>"),v=function(t,e,s,i){return function(){var n,r;r=(n=t.select(e.id)).coords.usrCoords[i],2===i?n.setPositionDirectly(o.A.COORDS_BY_USER,[s(),r]):n.setPositionDirectly(o.A.COORDS_BY_USER,[r,s()]),n.prepareUpdate().update()}},m=function(t,e,s){return function(){var i,o;i=t.select(e.id),o=s(),i.setAttribute({visible:o})}},f=function(t,e,s,i){return function(){var o,n;o=t.select(e.id),n=s(),"strokewidth"===i?o.visProp.strokewidth=n:(n=p.A.rgba2rgbo(n),o.visProp[i+"color"]=n[0],o.visProp[i+"opacity"]=n[1])}},A=function(t,e,s){return function(){t.select(e.id).position=s()}},b=function(t,e,s){return function(){t.select(e.id).setStyle(s())}};if(!(d<0)){for(;d>=0;){if(s=(e=t.slice(d+6,u)).indexOf("="),n=e.slice(0,s),r=e.slice(s+1),s=n.indexOf("."),h=n.slice(0,s),a=this.elementsByName[g.A.unescapeHTML(h)],c=n.slice(s+1).replace(/\s+/g,"").toLowerCase(),r=g.A.createFunction(r,this,"",!0),g.A.exists(this.elementsByName[h]))switch(c){case"x":l.push(v(this,a,r,2));break;case"y":l.push(v(this,a,r,1));break;case"visible":l.push(m(this,a,r));break;case"position":l.push(A(this,a,r));break;case"stroke":l.push(f(this,a,r,"stroke"));break;case"style":l.push(b(this,a,r));break;case"strokewidth":l.push(f(this,a,r,"strokewidth"));break;case"fill":l.push(f(this,a,r,"fill"));break;case"label":break;default:i.A.debug('property "'+c+'" in conditions not yet implemented:'+r)}else i.A.debug("debug conditions: |"+h+"| undefined");d=(t=t.slice(u+7)).indexOf("<data>"),u=t.indexOf("</data>")}this.updateConditions=function(){var t;for(t=0;t<l.length;t++)l[t]();return this.prepareUpdate().updateElements(),!0},this.updateConditions()}},updateConditions:function(){return!1},calculateSnapSizes:function(){var t,e,s,i,r=this.getBoundingBox(),h=g.A.evaluate(this.options.grid.majorStep),a=g.A.evaluate(this.options.grid.gridX),c=g.A.evaluate(this.options.grid.gridY);for(g.A.isArray(h)||(h=[h,h]),h.length<2&&(h=[h[0],h[0]]),g.A.exists(a)&&(h[0]=a),g.A.exists(c)&&(h[1]=c),"auto"===h[0]?h[0]=1:h[0]=g.A.parseNumber(h[0],Math.abs(r[1]-r[3]),1/this.unitX),"auto"===h[1]?h[1]=1:h[1]=g.A.parseNumber(h[1],Math.abs(r[0]-r[2]),1/this.unitY),t=new n.A(o.A.COORDS_BY_USER,[0,0],this),e=new n.A(o.A.COORDS_BY_USER,[h[0],h[1]],this),s=t.scrCoords[1]-e.scrCoords[1],i=t.scrCoords[2]-e.scrCoords[2],this.options.grid.snapSizeX=h[0];Math.abs(s)>25;)this.options.grid.snapSizeX*=2,s/=2;for(this.options.grid.snapSizeY=h[1];Math.abs(i)>25;)this.options.grid.snapSizeY*=2,i/=2;return this},applyZoom:function(){return this.updateCoords().calculateSnapSizes().clearTraces().fullUpdate(),this},zoomIn:function(t,e){var s=this.getBoundingBox(),i=g.A.evaluate(this.attr.zoom.factorx),o=g.A.evaluate(this.attr.zoom.factory),n=(s[2]-s[0])*(1-1/i),r=(s[1]-s[3])*(1-1/o),h=.5,a=.5,c=g.A.evaluate(this.attr.zoom.max),l=g.A.evaluate(this.attr.zoom.eps)||g.A.evaluate(this.attr.zoom.min)||.001;return this.zoomX>c&&i>1||this.zoomY>c&&o>1||this.zoomX<l&&i<1||this.zoomY<l&&o<1?this:(g.A.isNumber(t)&&g.A.isNumber(e)&&(h=(t-s[0])/(s[2]-s[0]),a=(s[1]-e)/(s[1]-s[3])),this.setBoundingBox([s[0]+n*h,s[1]-r*a,s[2]-n*(1-h),s[3]+r*(1-a)],this.keepaspectratio,"update"),this.applyZoom())},zoomOut:function(t,e){var s=this.getBoundingBox(),i=g.A.evaluate(this.attr.zoom.factorx),o=g.A.evaluate(this.attr.zoom.factory),n=(s[2]-s[0])*(1-i),r=(s[1]-s[3])*(1-o),h=.5,a=.5,c=g.A.evaluate(this.attr.zoom.eps)||g.A.evaluate(this.attr.zoom.min)||.001;return this.zoomX<c||this.zoomY<c?this:(g.A.isNumber(t)&&g.A.isNumber(e)&&(h=(t-s[0])/(s[2]-s[0]),a=(s[1]-e)/(s[1]-s[3])),this.setBoundingBox([s[0]+n*h,s[1]-r*a,s[2]-n*(1-h),s[3]+r*(1-a)],this.keepaspectratio,"update"),this.applyZoom())},zoom100:function(){var t,e,s;return g.A.exists(this.attr.boundingbox)?this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"reset"):(e=((t=this.getBoundingBox())[2]-t[0])*(1-this.zoomX)*.5,s=(t[1]-t[3])*(1-this.zoomY)*.5,this.setBoundingBox([t[0]+e,t[1]-s,t[2]-e,t[3]+s],this.keepaspectratio,"reset")),this.applyZoom()},zoomAllPoints:function(){var t,e,s,i,o=0,n=0,r=0,h=0,a=this.objectsList.length;for(t=0;t<a;t++)i=this.objectsList[t],g.A.isPoint(i)&&i.visPropCalc.visible&&(i.coords.usrCoords[1]<o?o=i.coords.usrCoords[1]:i.coords.usrCoords[1]>n&&(n=i.coords.usrCoords[1]),i.coords.usrCoords[2]>h?h=i.coords.usrCoords[2]:i.coords.usrCoords[2]<r&&(r=i.coords.usrCoords[2]));return e=50/this.unitX,s=50/this.unitY,this.setBoundingBox([o-e,h+s,n+e,r-s],this.keepaspectratio,"update"),this.applyZoom()},zoomElements:function(t){var e,s,i,o,n,r=[1/0,-1/0,-1/0,1/0];if(!g.A.isArray(t)||0===t.length)return this;for(e=0;e<t.length;e++)s=this.select(t[e]).bounds(),g.A.isArray(s)&&(s[0]<r[0]&&(r[0]=s[0]),s[1]>r[1]&&(r[1]=s[1]),s[2]>r[2]&&(r[2]=s[2]),s[3]<r[3]&&(r[3]=s[3]));return g.A.isArray(r)&&(i=.5*(r[0]+r[2]),o=.5*(r[1]+r[3]),n=Math.max(1.5*(r[2]-r[0])*.5,1.5*(r[1]-r[3])*.5),this.setBoundingBox([i-n,o+n,i+n,o-n],this.keepaspectratio,"update")),this},setZoom:function(t,e){var s=this.attr.zoom.factorx,i=this.attr.zoom.factory;return this.attr.zoom.factorx=t/this.zoomX,this.attr.zoom.factory=e/this.zoomY,this.zoomIn(),this.attr.zoom.factorx=s,this.attr.zoom.factory=i,this},_removeObj:function(t,e){var s,n;if(g.A.isArray(t)){for(n=0;n<t.length;n++)this._removeObj(t[n],e);return this}if(t=this.select(t),!g.A.exists(t)||g.A.isString(t))return this;try{for(s in t.childElements)t.childElements.hasOwnProperty(s)&&t.childElements[s].board._removeObj(t.childElements[s]);for(s in t.objects)t.objects.hasOwnProperty(s)&&t.objects[s].board._removeObj(t.objects[s]);if(e)for(s in this.objects)this.objects.hasOwnProperty(s)&&g.A.exists(this.objects[s].childElements)&&g.A.exists(this.objects[s].childElements.hasOwnProperty(t.id))&&(delete this.objects[s].childElements[t.id],delete this.objects[s].descendants[t.id]);else if(g.A.exists(t.ancestors))for(s in t.ancestors)t.ancestors.hasOwnProperty(s)&&g.A.exists(t.ancestors[s].childElements)&&g.A.exists(t.ancestors[s].childElements.hasOwnProperty(t.id))&&(delete t.ancestors[s].childElements[t.id],delete t.ancestors[s].descendants[t.id]);if(t._pos>-1)for(this.objectsList.splice(t._pos,1),n=t._pos;n<this.objectsList.length;n++)this.objectsList[n]._pos--;else t.type!==o.A.OBJECT_TYPE_TURTLE&&i.A.debug("Board.removeObject: object "+t.id+" not found in list.");delete this.objects[t.id],delete this.elementsByName[t.name],t.visProp&&t.evalVisProp("trace")&&t.clearTrace(),g.A.exists(t.remove)&&t.remove()}catch(e){i.A.debug(t.id+": Could not be removed: "+e)}return this},removeObject:function(t,e){var s;if(this.renderer.suspendRedraw(this),g.A.isArray(t))for(s=0;s<t.length;s++)this._removeObj(t[s],e);else this._removeObj(t,e);return this.renderer.unsuspendRedraw(),this.update(),this},removeAncestors:function(t){var e;for(e in t.ancestors)t.ancestors.hasOwnProperty(e)&&this.removeAncestors(t.ancestors[e]);return this.removeObject(t),this},initGeonextBoard:function(){var t,e,s;return t=this.create("point",[0,0],{id:this.id+"g00e0",name:"Ursprung",withLabel:!1,visible:!1,fixed:!0}),e=this.create("point",[1,0],{id:this.id+"gX0e0",name:"Punkt_1_0",withLabel:!1,visible:!1,fixed:!0}),s=this.create("point",[0,1],{id:this.id+"gY0e0",name:"Punkt_0_1",withLabel:!1,visible:!1,fixed:!0}),this.create("line",[t,e],{id:this.id+"gXLe0",name:"X-Achse",withLabel:!1,visible:!1}),this.create("line",[t,s],{id:this.id+"gYLe0",name:"Y-Achse",withLabel:!1,visible:!1}),this},resizeContainer:function(t,e,s,i){var o,n,r,h,a;return n=this.canvasWidth,r=this.canvasHeight,i||(o=this.getBoundingBox()),this.canvasWidth=parseFloat(t),this.canvasHeight=parseFloat(e),s||(this.containerObj.style.width=this.canvasWidth+"px",this.containerObj.style.height=this.canvasHeight+"px"),this.renderer.resize(this.canvasWidth,this.canvasHeight),i?(h=(this.canvasWidth-n)*.5,a=(this.canvasHeight-r)*.5,this.moveOrigin(this.origin.scrCoords[1]+h,this.origin.scrCoords[2]+a)):this.setBoundingBox(o,this.keepaspectratio,"keep"),this},showDependencies:function(){var t,e,s,i,o;for(t in e="<p>\n",this.objects)if(this.objects.hasOwnProperty(t)){for(s in o=0,this.objects[t].childElements)this.objects[t].childElements.hasOwnProperty(s)&&(o+=1);for(s in o>=0&&(e+="<strong>"+this.objects[t].id+":</strong> "),this.objects[t].childElements)this.objects[t].childElements.hasOwnProperty(s)&&(e+=this.objects[t].childElements[s].id+"("+this.objects[t].childElements[s].name+"), ");e+="<p>\n"}return e+="</p>\n",(i=window.open()).document.open(),i.document.write(e),i.document.close(),this},showXML:function(){var t=window.open("");return t.document.open(),t.document.write("<pre>"+g.A.escapeHTML(this.xmlString)+"</pre>"),t.document.close(),this},prepareUpdate:function(t){var e,s,i,n=this.objectsList.length;for(e=0;e<n;e++)if(i=this.objectsList[e],this._change3DView||g.A.exists(t)&&"view3d_slider"===t.elType){if(i.needsUpdate=i.visProp.element3d||"view3d"===i.elType||"view3d_slider"===i.elType||this.needsFullUpdate,i.visProp.element3d&&i.visProp.element3d.type===o.A.OBJECT_TYPE_SPHERE3D)for(s=0;s<i.parents.length;s++)this.objects[i.parents[s]].needsUpdate=!0}else i.needsUpdate=i.needsRegularUpdate||this.needsFullUpdate;for(e in this.groups)this.groups.hasOwnProperty(e)&&((i=this.groups[e]).needsUpdate=i.needsRegularUpdate||this.needsFullUpdate);return this},updateElements:function(t){var e,s;for(e=0,t=this.select(t);e<this.objectsList.length;e++)s=this.objectsList[e],this.needsFullUpdate&&s.elementClass===o.A.OBJECT_CLASS_TEXT&&s.updateSize(),s.update(!g.A.exists(t)||s.id!==t.id).updateVisibility();for(e in this.groups)this.groups.hasOwnProperty(e)&&this.groups[e].update(t);return this},updateRenderer:function(){var t,e=this.objectsList.length;if(this.renderer){if("canvas"===this.renderer.type)this.updateRendererCanvas();else for(t=0;t<e;t++)this.objectsList[t].updateRenderer();return this}},updateRendererCanvas:function(){var t,e,s,i=this.objectsList.length,o=[];for(t=0;t<i;t++)if("view3d"===(e=this.objectsList[t]).elType&&e.evalVisProp("depthorder.enabled")){o=e.evalVisProp("depthorder.layers"),e.updateRenderer();break}for(t=0,i=(s=this.objectsList.toSorted(function(t,e){return t.visProp.layer!==e.visProp.layer?t.visProp.layer-e.visProp.layer:-1!==o.indexOf(t.visProp.layer)&&(t.visProp.element3d||e.visProp.element3d)?t.visProp.element3d&&!e.visProp.element3d?-1:e.visProp.element3d&&!t.visProp.element3d?1:t.visProp.element3d.zIndex-e.visProp.element3d.zIndex:t._pos-e._pos})).length;t<i;t++)s[t].prepareUpdate().updateRenderer();return this},addHook:function(t,e,s){return i.A.deprecated("Board.addHook()","Board.on()"),e=g.A.def(e,"update"),s=g.A.def(s,this),this.hooks.push([e,t]),this.on(e,t,s),this.hooks.length-1},addEvent:i.A.shortcut(i.A.Board.prototype,"on"),removeHook:function(t){return i.A.deprecated("Board.removeHook()","Board.off()"),this.hooks[t]&&(this.off(this.hooks[t][0],this.hooks[t][1]),this.hooks[t]=null),this},removeEvent:i.A.shortcut(i.A.Board.prototype,"off"),updateHooks:function(t){var e=Array.prototype.slice.call(arguments,0);return i.A.deprecated("Board.updateHooks()","Board.triggerEventHandlers()"),e[0]=g.A.def(e[0],"update"),this.triggerEventHandlers([e[0]],arguments),this},addChild:function(t){return g.A.exists(t)&&g.A.exists(t.containerObj)&&(this.dependentBoards.push(t),this.update()),this},removeChild:function(t){var e;for(e=this.dependentBoards.length-1;e>=0;e--)this.dependentBoards[e]===t&&this.dependentBoards.splice(e,1);return this},update:function(t){var e,s,i,o,n;if(this.inUpdate||this.isSuspendedUpdate)return this;for(this.inUpdate=!0,"all"===this.attr.minimizereflow&&this.containerObj&&"vml"!==this.renderer.type&&(n=this.document.activeElement,o=this.renderer.removeToInsertLater(this.containerObj)),"svg"===this.attr.minimizereflow&&"svg"===this.renderer.type&&(n=this.document.activeElement,o=this.renderer.removeToInsertLater(this.renderer.svgRoot)),this.prepareUpdate(t).updateElements(t).updateConditions(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw(),this.triggerEventHandlers(["update"],[]),o&&(o(),n.focus()),s=this.dependentBoards.length,e=0;e<s;e++)i=this.dependentBoards[e],g.A.exists(i)&&i!==this&&(i.updateQuality=this.updateQuality,i.prepareUpdate().updateElements().updateConditions(),i.renderer.suspendRedraw(this),i.updateRenderer(),i.renderer.unsuspendRedraw(),i.triggerEventHandlers(["update"],[]));return this.inUpdate=!1,this},fullUpdate:function(){return this.needsFullUpdate=!0,this.update(),this.needsFullUpdate=!1,this},addGrid:function(){return this.create("grid",[]),this},removeGrids:function(){var t;for(t=0;t<this.grids.length;t++)this.removeObject(this.grids[t]);return this.grids.length=0,this.update(),this},create:function(t,e,s){var o,n;for(t=t.toLowerCase(),g.A.exists(e)||(e=[]),g.A.exists(s)||(s={}),n=0;n<e.length;n++)g.A.isString(e[n])&&("text"!==t||2!==n)&&("solidofrevolution3d"!==t||2!==n)&&("text3d"!==t||2!==n&&4!==n)&&("input"!==t&&"checkbox"!==t&&"button"!==t||2!==n&&3!==n)&&"curve"!==t&&"functiongraph"!==t&&"implicitcurve"!==t&&(n>0&&"view3d"===e[0].elType?e[n]=e[0].select(e[n]):e[n]=this.select(e[n]));if(g.A.isFunction(i.A.elements[t]))o=i.A.elements[t](this,e,s);else throw Error("JSXGraph: create: Unknown element type given: "+t);return g.A.exists(o)?o.prepareUpdate&&o.update&&o.updateRenderer&&o.fullUpdate():i.A.debug("JSXGraph: create: failure creating "+t),o},createElement:function(){return i.A.deprecated("Board.createElement()","Board.create()"),this.create.apply(this,arguments)},clearTraces:function(){var t;for(t=0;t<this.objectsList.length;t++)this.objectsList[t].clearTrace();return this.numTraces=0,this},suspendUpdate:function(){return this.inUpdate||(this.isSuspendedUpdate=!0),this},unsuspendUpdate:function(){return this.isSuspendedUpdate&&(this.isSuspendedUpdate=!1,this.fullUpdate()),this},setBoundingBox:function(t,e,s){var i,o,n,r,h,c,l,d,u,p=0,v=0,f=1,A=m.A.getDimensions(this.containerObj,this.document);return!g.A.isArray(t)||t[0]<this.maxboundingbox[0]-a.A.eps||t[1]>this.maxboundingbox[1]+a.A.eps||t[2]>this.maxboundingbox[2]+a.A.eps||t[3]<this.maxboundingbox[3]-a.A.eps||(g.A.exists(s)||(s="reset"),n=this.unitX,r=this.unitY,this.canvasWidth=parseFloat(A.width),this.canvasHeight=parseFloat(A.height),o=this.canvasWidth,i=this.canvasHeight,e?(this.keepaspectratio?isNaN(h=n/r)&&(h=1):h=1,"keep"===s&&(f=this.zoomX/this.zoomY),c=t[2]-t[0],l=t[1]-t[3],d=n*c,u=r*l,o>=i?(d>=u?this.unitY=i/l:this.unitY=i/Math.abs(c)*a.A.sign(l)/f,this.unitX=this.unitY*h):(u>d?this.unitX=o/c:this.unitX=o/Math.abs(l)*a.A.sign(c)*f,this.unitY=this.unitX/h),p=(o/this.unitX-c)*.5,v=(i/this.unitY-l)*.5,this.keepaspectratio=!0):(this.unitX=o/(t[2]-t[0]),this.unitY=i/(t[1]-t[3]),this.keepaspectratio=!1),this.moveOrigin(-this.unitX*(t[0]-p),this.unitY*(t[1]+v)),"update"===s?(this.zoomX*=this.unitX/n,this.zoomY*=this.unitY/r):"reset"===s&&(this.zoomX=g.A.exists(this.attr.zoomx)?this.attr.zoomx:1,this.zoomY=g.A.exists(this.attr.zoomy)?this.attr.zoomy:1)),this},getBoundingBox:function(){var t=new n.A(o.A.COORDS_BY_SCREEN,[0,0],this).usrCoords,e=new n.A(o.A.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords;return[t[1],t[2],e[1],e[2]]},_set:function(t,e){t=t.toLocaleLowerCase(),null!==e&&g.A.isObject(e)&&!g.A.exists(e.id)&&!g.A.exists(e.name)?g.A.mergeAttr(this.attr[t],e):this.attr[t]=e},setAttribute:function(t){var e,s,n,r,h,a,c={};for(e=0;e<arguments.length;e++)s=arguments[e],g.A.isString(s)?(n=s.split(":"),c[g.A.trim(n[0])]=g.A.trim(n[1])):g.A.isArray(s)?c[s[0]]=s[1]:i.A.extend(c,s);for(e in c)if(c.hasOwnProperty(e)&&(r=e.replace(/\s+/g,"").toLowerCase(),h=c[e]),h=(!h.toLowerCase||"false"!==h.toLowerCase())&&h,this.attr[r]!==h)switch(r){case"axis":!1===h&&g.A.exists(this.defaultAxes)&&(this.defaultAxes.x.setAttribute({visible:!1}),this.defaultAxes.y.setAttribute({visible:!1}));break;case"boundingbox":this.setBoundingBox(h,this.keepaspectratio),this._set(r,h);break;case"defaultaxes":g.A.exists(this.defaultAxes.x)&&g.A.exists(h.x)&&this.defaultAxes.x.setAttribute(h.x),g.A.exists(this.defaultAxes.y)&&g.A.exists(h.y)&&this.defaultAxes.y.setAttribute(h.y);break;case"title":this.document.getElementById(this.container+"_ARIAlabel").innerHTML=h,this._set(r,h);break;case"keepaspectratio":this._set(r,h),this.setBoundingBox(this.getBoundingBox(),h,"keep");break;case"document":case"maxboundingbox":this[r]=h,this._set(r,h);break;case"zoomx":case"zoomy":this[r]=h,this._set(r,h),this.setZoom(this.attr.zoomx,this.attr.zoomy);break;case"registerevents":case"renderer":break;case"fullscreen":case"screenshot":(a=this.containerObj.ownerDocument.getElementById(this.container+"_navigation_"+r))&&g.A.exists(h.symbol)&&(a.innerHTML=g.A.evaluate(h.symbol)),this._set(r,h);break;case"selection":h.visible=!1,h.withLines=!1,h.vertices={visible:!1},this._set(r,h);break;case"showcopyright":"svg"===this.renderer.type&&((a=this.containerObj.ownerDocument.getElementById(this.renderer.uniqName("licenseText")))?a.style.display=g.A.evaluate(h)?"inline":"none":g.A.evaluate(h)&&this.renderer.displayCopyright(o.A.licenseText,parseInt(this.options.text.fontSize,10)));default:g.A.exists(this.attr[r])&&this._set(r,h)}return this.containerObj.ownerDocument.getElementById(this.container+"_navigationbar").remove(),this.renderer.drawNavigationBar(this,this.attr.navbar),this.triggerEventHandlers(["attribute"],[c,this]),this.fullUpdate(),this},addAnimation:function(t){var e=this;return this.animationObjects[t.id]=t,this.animationIntervalCode||(this.animationIntervalCode=window.setInterval(function(){e.animate()},t.board.attr.animationdelay)),this},stopAllAnimation:function(){var t;for(t in this.animationObjects)this.animationObjects.hasOwnProperty(t)&&g.A.exists(this.animationObjects[t])&&(this.animationObjects[t]=null,delete this.animationObjects[t]);return window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode,this},animate:function(){var t,e,s,i,n,r,h,a,c=0,l=null;for(e in this.animationObjects)if(this.animationObjects.hasOwnProperty(e)&&g.A.exists(this.animationObjects[e])){if(c+=1,(s=this.animationObjects[e]).animationPath&&(i=g.A.isFunction(s.animationPath)?s.animationPath(new Date().getTime()-s.animationStart):s.animationPath.pop(),!g.A.exists(i)||!g.A.isArray(i)&&isNaN(i)?delete s.animationPath:(s.setPositionDirectly(o.A.COORDS_BY_USER,i),s.fullUpdate(),l=s)),s.animationData){for(n in h=0,s.animationData)s.animationData.hasOwnProperty(n)&&(r=s.animationData[n].pop(),g.A.exists(r)?(h+=1,(t={})[n]=r,s.setAttribute(t)):delete s.animationData[r]);0===h&&delete s.animationData}g.A.exists(s.animationData)||g.A.exists(s.animationPath)||(this.animationObjects[e]=null,delete this.animationObjects[e],g.A.exists(s.animationCallback)&&(a=s.animationCallback,s.animationCallback=null,a()))}return 0===c?(window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode):this.update(l),this},migratePoint:function(t,e,s){var i,o,n,r,h,a,c=!1;for(o in t=this.select(t),e=this.select(e),g.A.exists(t.label)&&(a=t.label.id,c=!0,this.removeObject(t.label)),t.childElements)if(t.childElements.hasOwnProperty(o)){for(n in i=t.childElements[o],r=!1,i)i.hasOwnProperty(n)&&i[n]===t&&(i[n]=e,r=!0);for(r&&delete t.childElements[o],h=0;h<i.parents.length;h++)i.parents[h]===t.id&&(i.parents[h]=e.id);e.addChild(i)}return s&&(c&&(delete e.childElements[a],delete e.descendants[a]),e.label&&this.removeObject(e.label),delete this.elementsByName[e.name],e.name=t.name,c&&e.createLabel()),this.removeObject(t),g.A.exists(e.name)&&""!==e.name&&(this.elementsByName[e.name]=e),this.fullUpdate(),this},emulateColorblindness:function(t){var e,s;if(g.A.exists(t)||(t="none"),this.currentCBDef===t)return this;for(e in this.objects)this.objects.hasOwnProperty(e)&&(s=this.objects[e],"none"!==t?("none"===this.currentCBDef&&(s.visPropOriginal={strokecolor:s.visProp.strokecolor,fillcolor:s.visProp.fillcolor,highlightstrokecolor:s.visProp.highlightstrokecolor,highlightfillcolor:s.visProp.highlightfillcolor}),s.setAttribute({strokecolor:p.A.rgb2cb(s.eval(s.visPropOriginal.strokecolor),t),fillcolor:p.A.rgb2cb(s.eval(s.visPropOriginal.fillcolor),t),highlightstrokecolor:p.A.rgb2cb(s.eval(s.visPropOriginal.highlightstrokecolor),t),highlightfillcolor:p.A.rgb2cb(s.eval(s.visPropOriginal.highlightfillcolor),t)})):g.A.exists(s.visPropOriginal)&&i.A.extend(s.visProp,s.visPropOriginal));return this.currentCBDef=t,this.update(),this},select:function(t,e){var s,i,o,n,r=t;if(null===r)return r;if(g.A.isString(r)&&""!==r)g.A.exists(this.objects[r])?r=this.objects[r]:g.A.exists(this.elementsByName[r])?r=this.elementsByName[r]:g.A.exists(this.groups[r])&&(r=this.groups[r]);else if(!e&&(g.A.isFunction(r)||g.A.isObject(r)&&!g.A.isFunction(r.setAttribute))){for(o=0,s=g.A.filterElements(this.objectsList,r),i={},n=s.length;o<n;o++)i[s[o].id]=s[o];r=new f.A(i)}else g.A.isObject(r)&&g.A.exists(r.id)&&!g.A.exists(this.objects[r.id])&&(r=null);return r},hasPoint:function(t,e){var s=t,i=e,o=this.getBoundingBox();return g.A.exists(t)&&g.A.isArray(t.usrCoords)&&(s=t.usrCoords[1],i=t.usrCoords[2]),!!(g.A.isNumber(s)&&g.A.isNumber(i)&&o[0]<s&&s<o[2]&&o[1]>i&&i>o[3])},updateCSSTransforms:function(){var t=this.containerObj,e=t,s=t;if(this.cssTransMat=m.A.getCSSTransformMatrix(e),g.A.exists(e.getRootNode)){for(e=e.parentNode===e.getRootNode()?e.parentNode.host:e.parentNode;e;)this.cssTransMat=a.A.matMatMult(m.A.getCSSTransformMatrix(e),this.cssTransMat),e=e.parentNode===e.getRootNode()?e.parentNode.host:e.parentNode;this.cssTransMat=a.A.inverse(this.cssTransMat)}else{for(e=e.offsetParent;e;){for(this.cssTransMat=a.A.matMatMult(m.A.getCSSTransformMatrix(e),this.cssTransMat),s=s.parentNode;s!==e;)this.cssTransMat=a.A.matMatMult(m.A.getCSSTransformMatrix(e),this.cssTransMat),s=s.parentNode;e=e.offsetParent}this.cssTransMat=a.A.inverse(this.cssTransMat)}return this},startSelectionMode:function(){this.selectingMode=!0,this.selectionPolygon.setAttribute({visible:!0}),this.selectingBox=[[0,0],[0,0]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate()},stopSelectionMode:function(){return this.selectingMode=!1,this.selectionPolygon.setAttribute({visible:!1}),[this.selectionPolygon.vertices[0].coords,this.selectionPolygon.vertices[2].coords]},_startSelecting:function(t){this.isSelecting=!0,this.selectingBox=[[t[0],t[1]],[t[0],t[1]]],this._setSelectionPolygonFromBox()},_moveSelecting:function(t){this.isSelecting&&(this.selectingBox[1]=[t[0],t[1]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate())},_stopSelecting:function(t){var e=this.getMousePosition(t);this.isSelecting=!1,this.selectingBox[1]=[e[0],e[1]],this._setSelectionPolygonFromBox()},_setSelectionPolygonFromBox:function(){var t=this.selectingBox[0],e=this.selectingBox[1];this.selectionPolygon.vertices[0].setPositionDirectly(i.A.COORDS_BY_SCREEN,[t[0],t[1]]),this.selectionPolygon.vertices[1].setPositionDirectly(i.A.COORDS_BY_SCREEN,[t[0],e[1]]),this.selectionPolygon.vertices[2].setPositionDirectly(i.A.COORDS_BY_SCREEN,[e[0],e[1]]),this.selectionPolygon.vertices[3].setPositionDirectly(i.A.COORDS_BY_SCREEN,[e[0],t[1]])},_testForSelection:function(t){this._isRequiredKeyPressed(t,"selection")&&(g.A.exists(this.selectionPolygon)||this._createSelectionPolygon(this.attr),this.startSelectionMode())},_createSelectionPolygon:function(t){var e;return g.A.exists(this.selectionPolygon)||!0===(e=g.A.copyAttributes(t,r.A,"board","selection")).enabled&&(this.selectionPolygon=this.create("polygon",[[0,0],[0,0],[0,0],[0,0]],e)),this},__evt__attribute:function(t){},__evt__down:function(t){},__evt__mousedown:function(t){},__evt__pendown:function(t){},__evt__pointerdown:function(t){},__evt__touchstart:function(t){},__evt__up:function(t){},__evt__mouseup:function(t){},__evt__pointerup:function(t){},__evt__touchend:function(t){},__evt__click:function(t){},__evt__dblclick:function(t){},__evt__mouseclick:function(t){},__evt__mousedblclick:function(t){},__evt__pointerclick:function(t){},__evt__pointerdblclick:function(t){},__evt__move:function(t,e){},__evt__mousemove:function(t,e){},__evt__penmove:function(t,e){},__evt__pointermove:function(t,e){},__evt__touchmove:function(t,e){},__evt__keymove:function(t,e){},__evt__hit:function(t,e,s){},__evt__mousehit:function(t,e,s){},__evt__update:function(){},__evt__boundingbox:function(){},__evt__startselecting:function(){},__evt__mousestartselecting:function(){},__evt__pointerstartselecting:function(){},__evt__touchstartselecting:function(){},__evt__stopselecting:function(){},__evt__mousestopselecting:function(){},__evt__pointerstopselecting:function(){},__evt__touchstopselecting:function(){},__evt__moveselecting:function(){},__evt__mousemoveselecting:function(){},__evt__pointermoveselecting:function(){},__evt__touchmoveselecting:function(){},__evt:function(){},toFullscreen:function(t){var e,s,i,o,n=this.document;return t=t||this.container,this._fullscreen_inner_id=t,i=n.getElementById(t),e="fullscreenwrap_"+t,g.A.exists(i._cssFullscreenStore)||(i._cssFullscreenStore={w:(o=this.containerObj.getBoundingClientRect()).width,h:o.height}),n.getElementById(e)?s=n.getElementById(e):((s=document.createElement("div")).classList.add("JXG_wrap_private"),s.setAttribute("id",e),i.parentNode.insertBefore(s,i),s.appendChild(i)),s.requestFullscreen=s.requestFullscreen||s.webkitRequestFullscreen||s.mozRequestFullScreen||s.msRequestFullscreen,null===(void 0!==n.fullscreenElement?n.fullscreenElement:void 0!==n.webkitFullscreenElement?n.webkitFullscreenElement:n.msFullscreenElement)?s.requestFullscreen&&(s.requestFullscreen(),this.startFullscreenResizeObserver(s)):(this.stopFullscreenResizeObserver(s),g.A.exists(document.exitFullscreen)?document.exitFullscreen():g.A.exists(document.webkitExitFullscreen)&&document.webkitExitFullscreen()),this},fullscreenListener:function(t){var e,s,i,o=this.document;e=this._fullscreen_inner_id,g.A.exists(e)&&(i=void 0!==o.fullscreenElement?o.fullscreenElement:void 0!==o.webkitFullscreenElement?o.webkitFullscreenElement:o.msFullscreenElement,s=o.getElementById(e),i?(s._cssFullscreenStore.id=i.id,s._cssFullscreenStore.isFullscreen=!0,s._cssFullscreenStore.margin=s.style.margin,s._cssFullscreenStore.width=s.style.width,s._cssFullscreenStore.height=s.style.height,s._cssFullscreenStore.transform=s.style.transform,s.style.width=s._cssFullscreenStore.w+"px",s.style.height=s._cssFullscreenStore.h+"px",s.style.margin="",m.A.scaleJSXGraphDiv(i.id,e,o,g.A.evaluate(this.attr.fullscreen.scale)),i=null):g.A.exists(s._cssFullscreenStore)&&(s._cssFullscreenStore.isFullscreen=!1,s.style.margin=s._cssFullscreenStore.margin,s.style.width=s._cssFullscreenStore.width,s.style.height=s._cssFullscreenStore.height,s.style.transform=s._cssFullscreenStore.transform,s._cssFullscreenStore=null,s.parentElement.replaceWith(s)),this.updateCSSTransforms())},startFullscreenResizeObserver:function(t){var e=this;return m.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&(this.resizeObserver=new ResizeObserver(function(s){var i,o,n=e.document;e._isResizing||(e._isResizing=!0,window.setTimeout(function(){try{i=e._fullscreen_inner_id,o=void 0!==n.fullscreenElement?n.fullscreenElement:void 0!==n.webkitFullscreenElement?n.webkitFullscreenElement:n.msFullscreenElement,null!==o&&m.A.scaleJSXGraphDiv(o.id,i,n,g.A.evaluate(e.attr.fullscreen.scale))}catch(s){e.stopFullscreenResizeObserver(t)}finally{e._isResizing=!1}},e.attr.resize.throttle))}),this.resizeObserver.observe(t)),this},stopFullscreenResizeObserver:function(t){return m.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&g.A.exists(this.resizeObserver)&&this.resizeObserver.unobserve(t),this},addLogEntry:function(t,e,s){var i,o,n=this.userLog.length-1;return g.A.exists(e.elementClass)&&(o=e.id),g.A.evaluate(this.attr.logging.enabled)&&(i=new Date().getTime(),n>=0&&this.userLog[n].type===t&&this.userLog[n].id===o&&i-this.userLog[n].end<500?(this.userLog[n].end=i,this.userLog[n].endpos=s):this.userLog.push({type:t,id:o,start:i,startpos:s,end:i,endpos:s,bbox:this.getBoundingBox(),canvas:[this.canvasWidth,this.canvasHeight],zoom:[this.zoomX,this.zoomY]})),this},createRoulette:function(t,e,s,i,o,n,r){var c=this;return new function(){var d,u=0,p=0,g=0,v=s,m=h.A.root(function(s){var i=t.X(v),o=t.Y(v),n=e.X(s),r=e.Y(s);return(i-n)*(i-n)+(o-r)*(o-r)},[0,2*Math.PI]),f=0,A=0,b=c.create("transform",[function(){return u}],{type:"rotate"}),_=c.create("transform",[function(){return u},function(){return t.X(v)},function(){return t.Y(v)}],{type:"rotate"}),O=c.create("transform",[function(){return p},function(){return g}],{type:"translate"}),E=function(t,e,s){var i=h.A.D(t.X)(e),o=h.A.D(t.Y)(e),n=h.A.D(t.X)(s),r=h.A.D(t.Y)(s),c=h.A.D(t.X)((e+s)*.5),l=h.A.D(t.Y)((e+s)*.5),d=a.A.hypot(i,o),u=a.A.hypot(n,r);return(d+4*a.A.hypot(c,l)+u)*(s-e)/6},C=function(t){return d-E(e,m,t)},y=Math.PI/18,w=9*y,x=null;return this.rolling=function(){var s,n,a,x,P;f=v+o*i,d=E(t,v,f),A=h.A.root(C,m),s=new l.A(t.X(f),t.Y(f)),n=new l.A(e.X(A),e.Y(A)),a=new l.A(h.A.D(t.X)(f),h.A.D(t.Y)(f)),x=new l.A(h.A.D(e.X)(A),h.A.D(e.Y)(A)),u=Math.atan2((P=l.A.C.div(a,x)).imaginary,P.real),P.div(l.A.C.abs(P)),P.mult(n),p=s.real-P.real,g=s.imaginary-P.imaginary,u<-y&&u>-w?(u=-y,_.applyOnce(r)):u>y&&u<w?(u=y,_.applyOnce(r)):(b.applyOnce(r),O.applyOnce(r),v=f,m=A),c.update()},this.start=function(){return n>0&&(x=window.setInterval(this.rolling,n)),this},this.stop=function(){return window.clearInterval(x),this},this}}});let A=i.A.Board}}]);